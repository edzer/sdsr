<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatial Data Science - 10&nbsp; Statistical modelling of spatial data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-PointPattern.html" rel="next">
<link href="./part-3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-04YTZNEH1K"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-04YTZNEH1K', { 'anonymize_ip': true});
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-3.html">Models for Spatial Data</a></li><li class="breadcrumb-item"><a href="./10-Models.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/sdsr/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-hello.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Spaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Geometries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Spherical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Attributes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Cubes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R for Spatial Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Introsf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to sf and stars</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Large.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Large data and cloud native</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models for Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-PointPattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Point Pattern Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Interpolation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Geostatistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multivariate and Spatiotemporal Geostatistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Areal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Proximity and Areal Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Measures of Spatial Autocorrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-SpatialRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Econometrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial Econometrics Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Older R Spatial Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rbasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ERRATA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Errata to the printed ed.</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-lm" id="toc-sec-lm" class="nav-link active" data-scroll-target="#sec-lm"><span class="header-section-number">10.1</span> Mapping with non-spatial regression and ML models</a></li>
  <li><a href="#sec-supportstatistical" id="toc-sec-supportstatistical" class="nav-link" data-scroll-target="#sec-supportstatistical"><span class="header-section-number">10.2</span> Support and statistical modelling</a></li>
  <li><a href="#time-in-predictive-models" id="toc-time-in-predictive-models" class="nav-link" data-scroll-target="#time-in-predictive-models"><span class="header-section-number">10.3</span> Time in predictive models</a></li>
  <li><a href="#sec-design" id="toc-sec-design" class="nav-link" data-scroll-target="#sec-design"><span class="header-section-number">10.4</span> Design-based and model-based inference</a></li>
  <li><a href="#sec-models-with-coordinates" id="toc-sec-models-with-coordinates" class="nav-link" data-scroll-target="#sec-models-with-coordinates"><span class="header-section-number">10.5</span> Predictive models with coordinates</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">10.6</span> Exercises</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/edzer/sdsr/edit/main/10-Models.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-3.html">Models for Spatial Data</a></li><li class="breadcrumb-item"><a href="./10-Models.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-modelling" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p></p>
<p>So far in this book, we mostly addressed the problem of <em>describing</em> data. This included geometrical measures, predicates, or transformations that involved geometries, or by summary measures of attributes, or by plots involving variability in the geometry, the feature attributes, or both.</p>
<p>Statistical modelling aims at going beyond describing the data, it considers the data as a sample drawn from a population, and tries to make assessments (inference) about the population sampled from, for instance by quantifying relationships between variables, estimating population parameters, and predicting the outcome of observations that could have been taken but were not, as is the case in interpolation problems. This is usually done by adopting a model for the data, where for instance observations are decomposed as follows:</p>
<p><span id="eq-model"><span class="math display">\[
\mbox{observed} = \mbox{explained} + \mbox{remainder}
\tag{10.1}\]</span></span></p>
<p>where “explained” typically uses external variables (predictors, covariates, in machine learning confusingly also called features) that are related to the observed variable and some kind of regression model to translate into variability of the observed variable, and “remainder” is remaining variability that could not be explained. Interest may focus on the nature and magnitude or the relations between predictors and the observed variable, or in predicting new observations.</p>
<p>Statistical models, and <em>sampling</em> hinge on the concept of probability, which in typical spatial data science problems is not a force of nature but has to be assumed in one way or another. If we are faced with data that come from (spatially) random sampling and we are interested in estimating means or totals, a <em>design-based</em> approach that assumes randomness in the sample locations is the most straightforward analysis approach, as pointed out in more detail in <a href="#sec-design" class="quarto-xref"><span>Section 10.4</span></a>. If observations were not sampled randomly, or if our interest is in predicting values at specific locations (mapping), a <em>model-based</em> approach is needed. The remaining chapters in this part deal with model-based approaches.</p>
<section id="sec-lm" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="sec-lm">
<span class="header-section-number">10.1</span> Mapping with non-spatial regression and ML models</h2>
<p>Regression models or other machine learning (ML) models can be applied to spatial and spatiotemporal data just the way they are applied for predicting new observations in non-spatial problems:</p>
<ol type="1">
<li>
<strong>estimate</strong>: for a set of observations, a regression or ML model is fitted using predictor values corresponding to the observations (in ML jargon, this step is also known as “train”)</li>
<li>
<strong>predict</strong>: for a new situation, known predictor values are combined with the fitted model to predict the value of the observed variable, along with a prediction error or prediction interval if possible</li>
</ol>
<p>Objects of class <code>sf</code> need no special treatment, as they are <code>data.frame</code>s. To create maps of the resulting predictions, predicted values need to be added to the <code>sf</code> object, which can be done using the <code>nc</code> dataset loaded as in <a href="01-hello.html" class="quarto-xref"><span>Chapter 1</span></a> by:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>SID <span class="op">=</span> <span class="va">SID74</span><span class="op">/</span><span class="va">BIR74</span>, NWB <span class="op">=</span> <span class="va">NWBIR74</span><span class="op">/</span><span class="va">BIR74</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">nc1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SID</span> <span class="op">~</span> <span class="va">NWB</span>, <span class="va">nc1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">nc1</span>, interval <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">pr</span></span>
<span><span class="fu">bind_cols</span><span class="op">(</span><span class="va">nc</span>, <span class="va">pr</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#  [1] "AREA"      "PERIMETER" "CNTY_"     "CNTY_ID"   "NAME"     </span></span>
<span><span class="co">#  [6] "FIPS"      "FIPSNO"    "CRESS_ID"  "BIR74"     "SID74"    </span></span>
<span><span class="co"># [11] "NWBIR74"   "BIR79"     "SID79"     "NWBIR79"   "geom"     </span></span>
<span><span class="co"># [16] "fit"       "lwr"       "upr"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where we see that</p>
<ul>
<li>
<code>lm</code> estimates a linear model and works directly on an <code>sf</code> object</li>
<li>the output is used for a <code>predict</code> model, which predicts values corresponding to the observations in <code>nc1</code>, the same <code>sf</code> object</li>
<li>
<code>predict</code> creates three columns: <code>fit</code> for predicted values and <code>lwr</code> and <code>upr</code> for the 95% prediction intervals</li>
<li>these three columns have been added to the final object using <code>bind_cols</code>.</li>
</ul>
<p>In general the datasets for model estimation and prediction do not have to be the same. <a href="07-Introsf.html#sec-starspredict" class="quarto-xref"><span>Section 7.4.6</span></a> points out how this can be done with <code>stars</code> objects (essentially by going through a long <code>data.frame</code> representation of the datacube and converting the predicted results back, potentially in a chunked fashion).</p>
<div style="page-break-after: always;"></div>
<p>Because many regression and ML type problems share this same structure, packages like <strong>caret</strong> <span class="citation" data-cites="R-caret">(<a href="references.html#ref-R-caret" role="doc-biblioref">Kuhn 2022</a>)</span> or <strong>tidymodels</strong> <span class="citation" data-cites="R-tidymodels">(<a href="references.html#ref-R-tidymodels" role="doc-biblioref">Kuhn and Wickham 2022</a>)</span> allow for automated evaluation and comparison over a large set of model alternatives, offering a large set of model evaluation criteria and cross-validation strategies. Such cross-validation approaches assume independent observations, which is often not a reasonable assumption for spatial data, for instance because of spatial correlation <span class="citation" data-cites="Ploton2020">(<a href="references.html#ref-Ploton2020" role="doc-biblioref">Ploton et al. 2020</a>)</span> or because of strong spatial clustering in sample data <span class="citation" data-cites="meyerpebesmanc">(<a href="references.html#ref-meyerpebesmanc" role="doc-biblioref">Meyer and Pebesma 2022</a>)</span>, or both, and a number of R packages provide methods that are meant as replacements for naive cross-validation, including <strong>spatialsample</strong> <span class="citation" data-cites="R-spatialsample">(<a href="references.html#ref-R-spatialsample" role="doc-biblioref">Silge and Mahoney 2023</a>)</span>, <strong>CAST</strong> <span class="citation" data-cites="R-CAST">(<a href="references.html#ref-R-CAST" role="doc-biblioref">Meyer, Milà, and Ludwig 2023</a>)</span>, <strong>mlr3spatial</strong> <span class="citation" data-cites="R-mlr3spatial">(<a href="references.html#ref-R-mlr3spatial" role="doc-biblioref">Becker and Schratz 2022</a>)</span>, and <strong>mlr3spatiotempcv</strong> <span class="citation" data-cites="R-mlr3spatiotempcv">(<a href="references.html#ref-R-mlr3spatiotempcv" role="doc-biblioref">Schratz and Becker 2022</a>)</span>.</p>
<p>Strong spatial clustering of sample can arise when sample data are composed by joining different databases, each with very different sampling density. This is often the case in global datasets <span class="citation" data-cites="meyerpebesmanc">(<a href="references.html#ref-meyerpebesmanc" role="doc-biblioref">Meyer and Pebesma 2022</a>)</span>. Another example of strong clustering arises when, for sampling ground truth points of a land cover class, polygons are digitised and points are sampled within these polygons at the resolution of pixels in satellite imagery.</p>
<p>Spatial correlation in the “remainder” part of the model may be decreased by adding spatial coordinates or functions of spatial coordinates to the set of predictors. This also carries a risk of over-optimistic predictions in extrapolation cases, (cross-) validation, and model assessment, and is further discussed in <a href="#sec-models-with-coordinates" class="quarto-xref"><span>Section 10.5</span></a>.</p>
</section><section id="sec-supportstatistical" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="sec-supportstatistical">
<span class="header-section-number">10.2</span> Support and statistical modelling</h2>
<p>Support of data (<a href="01-hello.html#sec-support" class="quarto-xref"><span>Section 1.6</span></a>; <a href="05-Attributes.html" class="quarto-xref"><span>Chapter 5</span></a>) plays a lead role in the statistical analysis of spatial data. Methods for areal data (Chapters <a href="14-Areal.html" class="quarto-xref"><span>14</span></a>-<a href="17-Econometrics.html" class="quarto-xref"><span>17</span></a>) are devised for data with area support, where the set of areas cover the entire area of interest.</p>
<p>By showing an extensive variable (<a href="05-Attributes.html#sec-extensiveintensive" class="quarto-xref"><span>Section 5.3.1</span></a>) in a polygon choropleth map as done in <a href="01-hello.html#fig-first-map" class="quarto-xref">Figure&nbsp;<span>1.1</span></a> one runs the risk that the information is related with the polygon size, and that the signal shown is actually the size of the polygons, in colour. For the variable <em>population count</em> one would divide by the polygon area to show the (intensive) variable <em>population density</em>, in order to create an informative map. In the analysis of health data, like disease incidences over a time period shown in <a href="01-hello.html#fig-first-map" class="quarto-xref">Figure&nbsp;<span>1.1</span></a>, rather than dividing by polygon area to get a spatial density, observations are usually converted to probabilities or <em>incidence rates</em> by dividing over the population size of the associated polygons. As such they are (still) associated with the polygon area but their support is associated with the population total. It is these totals that inform the (Poisson) variability used by subsequent modelling in for instance CAR-type models (<a href="16-SpatialRegression.html" class="quarto-xref"><span>Chapter 16</span></a>).</p>
<p><a href="11-PointPattern.html" class="quarto-xref"><span>Chapter 11</span></a> deals in principle with point support observations, but at some stage needs to acknowledge that observations have non-zero size: tree stem “points” cannot be separated distances smaller than the tree diameter. Also, points in point pattern analysis are considered in their <em>observation window</em>, the area for which the point dataset is exhaustive, or complete. The observation window is of influence in many of the analysis tools. If points are observed on a line network, then the observation window consists of the set of lines observed, and distances measured through this network.</p>
<p>Geostatistical data (Chapters <a href="12-Interpolation.html" class="quarto-xref"><span>12</span></a> and <a href="13-Geostatistics.html" class="quarto-xref"><span>13</span></a>) usually start with point support observations and may end with predictions (spatial interpolations) for unobserved point locations distributed over the area of interest, or, may end in predictions for means over areas (block kriging; <a href="12-Interpolation.html#sec-blockkriging" class="quarto-xref"><span>Section 12.5</span></a>). Alternatively, observations may be aggregates over regions <span class="citation" data-cites="rtop">(<a href="references.html#ref-rtop" role="doc-biblioref">Skøien et al. 2014</a>)</span>. In remote sensing data, pixel values are usually associated with aggregates over the pixel area. Challenges may be the filling of gaps in images such as gaps caused by cloud coverage, from pixels neighbouring in space and time <span class="citation" data-cites="gapfill">Militino et al. (<a href="references.html#ref-militinoetal19" role="doc-biblioref">2019</a>)</span>.</p>
<p>When combining data with different spatial supports, for instance polygons from administrative regions and raster layers, it is often seen that all information is “brought together” to the highest resolution, by simply extracting polygon values at pixel locations, and proceeding from there, with all the newly created “observations”. This of course bears a large risk of producing non-sensible results when analysing these “data”, and a proper downsampling strategy, possibly using simulations to cope with uncertainty, would be a better alternative. For naive users, using software that is not aware of support of values associated with areas and using software that does not warn against naive downsampling is of course not a helpful situation.</p>
</section><section id="time-in-predictive-models" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="time-in-predictive-models">
<span class="header-section-number">10.3</span> Time in predictive models</h2>
<p><span class="citation" data-cites="schabenberger+gotway:2005">Schabenberger and Gotway (<a href="references.html#ref-schabenberger+gotway:2005" role="doc-biblioref">2005</a>)</span> already noted that in many cases, statistical analysis of spatiotemporal data proceeds either by reducing time, then working on the problem spatially (time first, space later) or reducing space, then working on the problem temporally (space first, time later). An example of the first approach is given in <a href="12-Interpolation.html" class="quarto-xref"><span>Chapter 12</span></a> where a dataset with a year of hourly values (detailed in <a href="13-Geostatistics.html" class="quarto-xref"><span>Chapter 13</span></a>) are reduced to station mean values (time first) after which these means are interpolated spatially (space later). Examples from the area of remote sensing are</p>
<ul>
<li>
<span class="citation" data-cites="sits">Simoes et al. (<a href="references.html#ref-sits" role="doc-biblioref">2021</a>)</span> use supervised machine learning and time series deep learning to segmentise pixel time series into sequences of land use (time first), and then smooth the resulting sequences of maps to remove improbable transitions in isolated pixels (space later)</li>
<li>
<span class="citation" data-cites="bfast">Verbesselt et al. (<a href="references.html#ref-bfast" role="doc-biblioref">2010</a>)</span> use (unsupervised) structural change algorithms to find breakpoints in pixel time series (time first), which are interpreted in the context deforestation later on.</li>
</ul>
<p>Examples of space first, time later in the area of remote sensing are any case where a single scene or scenes belonging to a single season are classified, and multi-year changes in land use or land cover are assessed by comparing time sequences of classified scenes. An example of this is <span class="citation" data-cites="brown2022dynamic">Brown et al. (<a href="references.html#ref-brown2022dynamic" role="doc-biblioref">2022</a>)</span>. Examples where space and time are considered <em>jointly</em> are the spatiotemporal interpolation in <a href="13-Geostatistics.html" class="quarto-xref"><span>Chapter 13</span></a>, and <span class="citation" data-cites="LU2016227">Lu et al. (<a href="references.html#ref-LU2016227" role="doc-biblioref">2016</a>)</span> in the context of remote sensing.</p>
</section><section id="sec-design" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="sec-design">
<span class="header-section-number">10.4</span> Design-based and model-based inference</h2>
<p> </p>
<p>Statistical inference means the action of estimating parameters about a population from sample data. Suppose we denote the variable of interest with <span class="math inline">\(z(s)\)</span>, where <span class="math inline">\(z\)</span> is the attribute value measured at location <span class="math inline">\(s\)</span>, and we are interested in estimating the mean value of <span class="math inline">\(z(s)\)</span> over a domain <span class="math inline">\(D\)</span>, <span class="math display">\[z(s)=\frac{1}{|D|} \int_{ u \in D} z(u)du,\]</span> with <span class="math inline">\(|D|\)</span> the area of <span class="math inline">\(D\)</span>, from sample data <span class="math inline">\(z(s_1),...,z(s_n)\)</span>.</p>
<p>Then, there are two possibilities to proceed: model-based, or design-based. A model-based approach considers <span class="math inline">\(z(s)\)</span> to be a realisation of a super-population <span class="math inline">\(Z(s)\)</span> (using capital letters to indicate random variables), and could for instance postulate a model for its spatial variability in the form of <span class="math display">\[Z(s) = m + e(s), \  \ \mbox{E}(e(s)) = 0, \  \ \mbox{Cov(e(s))} = \Sigma(\theta)\]</span> with <span class="math inline">\(m\)</span> a constant mean and <span class="math inline">\(e(s)\)</span> a residual with mean zero and covariance matrix <span class="math inline">\(\Sigma(\theta)\)</span>. This would require choosing the covariance function <span class="math inline">\(\Sigma()\)</span> and estimating its parameters <span class="math inline">\(\theta\)</span> from <span class="math inline">\(z(s)\)</span>, and then computing a block kriging prediction <span class="math inline">\(\hat{Z}(D)\)</span> (<a href="12-Interpolation.html#sec-blockkriging" class="quarto-xref"><span>Section 12.5</span></a>). This approach makes no assumptions about how <span class="math inline">\(z(s)\)</span> was sampled <em>spatially</em>, but of course it should allow for choosing the covariance function and estimating its parameters; inference is conditional to the validity of the postulated model.</p>
<p> </p>
<p>Rather than assuming a superpopulation model, the design-based approach <span class="citation" data-cites="de1990model brus2021 breidt2017model">(<a href="references.html#ref-de1990model" role="doc-biblioref">De Gruijter and Ter Braak 1990</a>; <a href="references.html#ref-brus2021" role="doc-biblioref">Brus 2021a</a>; <a href="references.html#ref-breidt2017model" role="doc-biblioref">Breidt, Opsomer, et al. 2017</a>)</span> assumes randomness in the locations, which is justified (only) when using random sampling. It <em>requires</em> that the sample data were obtained by probability sampling, meaning that some form of spatial random sampling was used where all elements of <span class="math inline">\(z(s)\)</span> had a known and positive probability of being included in the sample obtained. The random process is that of sampling: <span class="math inline">\(z(s_1)\)</span> is a realisation of the random process <span class="math inline">\(z(S_1)\)</span>, the first observation taken <em>over repeated random sampling</em>. Design-based estimators only need these inclusion probabilities to estimate mean values with standard errors. This means that for instance given a simple random sample, the unweighted sample mean is used to estimate the population mean, and no model parameters need to be fit.</p>
<p>Now the question is whether <span class="math inline">\(z(s_1)\)</span> and <span class="math inline">\(z(s_2)\)</span> can be expected to be correlated when <span class="math inline">\(s_1\)</span> and <span class="math inline">\(s_2\)</span> are close together. The question does not work out as long as <span class="math inline">\(z(s_1)\)</span> and <span class="math inline">\(z(s_2)\)</span> are just two numbers: we need some kind of framework, random variables, that recreates this situation to form two sets of numbers for which we can consider correlation. The misconception here, as explained in <span class="citation" data-cites="brus2021">Brus (<a href="references.html#ref-brus2021" role="doc-biblioref">2021a</a>)</span>, is that the two are always spatially correlated, but this is only the case when working under model-based approaches: <span class="math inline">\(Z(s_1)\)</span> and <span class="math inline">\(Z(s_2)\)</span> may well be correlated (“model-dependent”), but although in a particular random sample (realisation) <span class="math inline">\(z(s_1)\)</span> and <span class="math inline">\(z(s_2)\)</span> <em>may</em> be close in space, the corresponding random variables <span class="math inline">\(z(S_1)\)</span> and <span class="math inline">\(z(S_2)\)</span> considered over repeated random sampling are not close together, and, are design-independent. Both situations can coexist without contradiction and are a consequence of choosing to work under one inference framework or the other.</p>
<p>The choice whether to work under a design-based or model-based framework depends on the purpose of the study and the data collection process. The model-based framework lends itself best for cases:</p>
<ul>
<li>where predictions are required for individual locations, or for areas too small to be sampled</li>
<li>where the available data were not collected using a known random sampling scheme (i.e., the inclusion probabilities are unknown, or are zero over particular areas and or times)</li>
</ul>
<p>Design-based approaches are most suitable when:</p>
<ul>
<li>observations were collected using a spatial random sampling process</li>
<li>aggregated properties of the entire sample region (or sub-region) are needed</li>
<li>estimates are required that are not sensitive to model misspecification, for instance when needed for regulatory or legal purposes</li>
</ul>
<p>In case a sampling procedure is to be planned <span class="citation" data-cites="de2006sampling">(<a href="references.html#ref-de2006sampling" role="doc-biblioref">De Gruijter et al. 2006</a>)</span>, some form of spatial random sampling is definitely worth considering since it opens up the possibility of following both inference frameworks.</p>
</section><section id="sec-models-with-coordinates" class="level2" data-number="10.5"><h2 data-number="10.5" class="anchored" data-anchor-id="sec-models-with-coordinates">
<span class="header-section-number">10.5</span> Predictive models with coordinates</h2>
<p> </p>
<p>In data science projects, coordinates may be seen as features in a larger set of predictors (or features, or covariates) and treated accordingly. There are some pitfalls in doing so.</p>
<p>As usual when working with predictors, it is good to choose predictive methods that are not sensitive to shifts in origin or shifts in unit (scale). Assuming a two-dimensional problem, predictive models should also not be sensitive to arbitrary rotations of the <span class="math inline">\(x\)</span>- and <span class="math inline">\(y\)</span>- or latitude and longitude axes. For projected (2D, Cartesian) coordinates this can be assured, e.g., by using polynomials of order <span class="math inline">\(n\)</span> as <span class="math inline">\((x+y)^n\)</span>, rather than <span class="math inline">\((x)^n + (y)^n\)</span>; for a second order polynomial this involves including the term <span class="math inline">\(xy\)</span>, so that an ellipsoidal-shape trend surface does not have to be aligned with the <span class="math inline">\(x-\)</span> or <span class="math inline">\(y-\)</span>axis. For a GAM model with spline components, one would use a spline in two dimensions <span class="math inline">\(s(x,y)\)</span> rather than two independent splines <span class="math inline">\(s(x)\)</span> and <span class="math inline">\(s(y)\)</span> that do not allow for interaction. An exception to this “rule” would be when a pure latitude effect is desired for instance to account for yearly total solar energy influx.</p>
<p>When the area covered by the data is large, the difference between using ellipsoidal coordinates and projected coordinates will automatically become larger, and hence choosing one of both will have an effect on predictive modelling. For very large extents and global models, polynomials or splines in latitude and longitude will not work well as they ignore the circular nature of longitude and the coordinate singularities at the poles. Here, spherical harmonics, base functions that are continuous on the sphere with increasing spatial frequencies can replace polynomials or be used as spline base functions.</p>
<p>In many cases, the spatial coordinates over which samples were collected also define the space over which predictions are made, setting them apart from other features. Many simple predictive approaches, including most machine learning methods, assume sample data to be independent. When samples are collected by spatially random sampling over the spatial target area, this assumption may be justified when working under a design-based context <span class="citation" data-cites="brusejss">(<a href="references.html#ref-brusejss" role="doc-biblioref">Brus 2021b</a>)</span>. This context, however, treats the coordinate space as the variable over which we randomise, which affords predicting values for a new <em>randomly chosen</em> location but rules out making predictions for fixed locations; this implies that averages of areas over which samples were collected, can be obtained, but not spatial interpolations. In case predictions for fixed locations are required, or in case data were not collected by spatial random sampling, a model-based approach (as taken in <a href="12-Interpolation.html" class="quarto-xref"><span>Chapter 12</span></a>) is needed and typically some form of spatial and/or temporal autocorrelation of residuals must be assumed.</p>
<p> </p>
<p>A common case is where sample data are collected opportunistically (“whatever could be found”), and are then used in a predictive framework that does not weight them. This has a consequence that the resulting model may be biased towards over-represented areas (in predictor space and/or in spatial coordinates space), and that simple (random) cross-validation statistics may be over-optimistic when taken as performance measures for spatial prediction <span class="citation" data-cites="meyerpebesma meyerpebesmanc mila2022nearest">(<a href="references.html#ref-meyerpebesma" role="doc-biblioref">Meyer and Pebesma 2021</a>, <a href="references.html#ref-meyerpebesmanc" role="doc-biblioref">2022</a>; <a href="references.html#ref-mila2022nearest" role="doc-biblioref">Mila et al. 2022</a>)</span>. Adaptive cross-validation measures such as spatial cross-validation may help getting more relevant measures for predictive performance.</p>
</section><section id="exercises" class="level2" data-number="10.6"><h2 data-number="10.6" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">10.6</span> Exercises</h2>
<p>Use R to solve the following exercises.</p>
<ol type="1">
<li>Following the <code>lm</code> example of <a href="#sec-lm" class="quarto-xref"><span>Section 10.1</span></a> use a random forest model to predict <code>SID</code> values (e.g., using package <strong>randomForest</strong>), and plot the random forest predictions against observations, along with the <span class="math inline">\(x=y\)</span> line.</li>
<li>Create a new dataset by randomly sampling 1000 points from the <code>nc</code> dataset, and rerun the linear regression model of <a href="#sec-lm" class="quarto-xref"><span>Section 10.1</span></a> on this dataset. Consider the <code>summary</code> of the fitted models, in particular the estimated coefficients, their standard errors, and the residual standard error. What has changed?</li>
<li>Redo the water-land classification of <a href="07-Introsf.html#sec-starspredict" class="quarto-xref"><span>Section 7.4.6</span></a> using <code><a href="https://rdrr.io/pkg/class/man/knn.html">class::knn</a></code> instead of <code>lda</code>, using a value of <code>k = 5</code>, and compare the resulting predictions with those of <code>lda</code>.</li>
<li>For the linear model using <code>nc</code> and for the <code>knn</code> example of the previous exercise, add a first and a second order linear model in the spatial coordinates and compare the results (use <code>st_centroid</code> to obtain polygon centroids, and <code>st_coordinates</code> to extract the <code>x</code> and <code>y</code> coordinates in matrix form).</li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-R-mlr3spatial" class="csl-entry" role="listitem">
Becker, Marc, and Patrick Schratz. 2022. <em>Mlr3spatial: Support for Spatial Objects Within the Mlr3 Ecosystem</em>. <a href="https://CRAN.R-project.org/package=mlr3spatial">https://CRAN.R-project.org/package=mlr3spatial</a>.
</div>
<div id="ref-breidt2017model" class="csl-entry" role="listitem">
Breidt, F Jay, Jean D Opsomer, et al. 2017. <span>“Model-Assisted Survey Estimation with Modern Prediction Techniques.”</span> <em>Statistical Science</em> 32 (2): 190–205.
</div>
<div id="ref-brown2022dynamic" class="csl-entry" role="listitem">
Brown, C. F., Steven P Brumby, Brookie Guzder-Williams, Tanya Birch, Samantha Brooks Hyde, Joseph Mazzariello, Wanda Czerwinski, et al. 2022. <span>“Dynamic World, Near Real-Time Global 10 m Land Use Land Cover Mapping.”</span> <em>Scientific Data</em> 9 (1): 1–17. <a href="https://doi.org/10.1038/s41597-022-01307-4">https://doi.org/10.1038/s41597-022-01307-4</a>.
</div>
<div id="ref-brus2021" class="csl-entry" role="listitem">
Brus, Dick J. 2021a. <span>“Statistical Approaches for Spatial Sample Survey: Persistent Misconceptions and New Developments.”</span> <em>European Journal of Soil Science</em> 72 (2): 686–703. <a href="https://doi.org/10.1111/ejss.12988">https://doi.org/10.1111/ejss.12988</a>.
</div>
<div id="ref-brusejss" class="csl-entry" role="listitem">
———. 2021b. <span>“Statistical Approaches for Spatial Sample Survey: Persistent Misconceptions and New Developments.”</span> <em>European Journal of Soil Science</em> 72 (2): 686–703. <a href="https://doi.org/10.1111/ejss.12988">https://doi.org/10.1111/ejss.12988</a>.
</div>
<div id="ref-de2006sampling" class="csl-entry" role="listitem">
De Gruijter, J. J., Dick J. Brus, Marc F. P. Bierkens, and Martin Knotters. 2006. <em>Sampling for Natural Resource Monitoring</em>. Springer Science &amp; Business Media.
</div>
<div id="ref-de1990model" class="csl-entry" role="listitem">
De Gruijter, J. J., and C. J. F. Ter Braak. 1990. <span>“Model-Free Estimation from Spatial Samples: A Reappraisal of Classical Sampling Theory.”</span> <em>Mathematical Geology</em> 22 (4): 407–15.
</div>
<div id="ref-gapfill" class="csl-entry" role="listitem">
Gerber, Florian, Rogier de Jong, Michael E Schaepman, Gabriela Schaepman-Strub, and Reinhard Furrer. 2018. <span>“Predicting Missing Values in Spatio-Temporal Remote Sensing Data.”</span> <em>IEEE Transactions on Geoscience and Remote Sensing</em> 56 (5): 2841–53.
</div>
<div id="ref-Heaton2018" class="csl-entry" role="listitem">
Heaton, Matthew J., Abhirup Datta, Andrew O. Finley, Reinhard Furrer, Joseph Guinness, Rajarshi Guhaniyogi, Florian Gerber, et al. 2018. <span>“A Case Study Competition Among Methods for Analyzing Large Spatial Data.”</span> <em>Journal of Agricultural, Biological and Environmental Statistics</em>, December. <a href="https://doi.org/10.1007/s13253-018-00348-w">https://doi.org/10.1007/s13253-018-00348-w</a>.
</div>
<div id="ref-R-caret" class="csl-entry" role="listitem">
Kuhn, Max. 2022. <em>Caret: Classification and Regression Training</em>. <a href="https://github.com/topepo/caret/">https://github.com/topepo/caret/</a>.
</div>
<div id="ref-R-tidymodels" class="csl-entry" role="listitem">
Kuhn, Max, and Hadley Wickham. 2022. <em>Tidymodels: Easily Install and Load the Tidymodels Packages</em>. <a href="https://CRAN.R-project.org/package=tidymodels">https://CRAN.R-project.org/package=tidymodels</a>.
</div>
<div id="ref-LU2016227" class="csl-entry" role="listitem">
Lu, Meng, Edzer Pebesma, Alber Sanchez, and Jan Verbesselt. 2016. <span>“Spatio-Temporal Change Detection from Multidimensional Arrays: Detecting Deforestation from MODIS Time Series.”</span> <em>ISPRS Journal of Photogrammetry and Remote Sensing</em> 117: 227–36. <a href="https://doi.org/10.1016/j.isprsjprs.2016.03.007">https://doi.org/10.1016/j.isprsjprs.2016.03.007</a>.
</div>
<div id="ref-R-CAST" class="csl-entry" role="listitem">
Meyer, Hanna, Carles Milà, and Marvin Ludwig. 2023. <em>CAST: Caret Applications for Spatial-Temporal Models</em>. <a href="https://CRAN.R-project.org/package=CAST">https://CRAN.R-project.org/package=CAST</a>.
</div>
<div id="ref-meyerpebesma" class="csl-entry" role="listitem">
Meyer, Hanna, and Edzer Pebesma. 2021. <span>“Predicting into Unknown Space? Estimating the Area of Applicability of Spatial Prediction Models.”</span> <em>Methods in Ecology and Evolution</em> 12 (9): 1620–33. <a href="https://doi.org/10.1111/2041-210X.13650">https://doi.org/10.1111/2041-210X.13650</a>.
</div>
<div id="ref-meyerpebesmanc" class="csl-entry" role="listitem">
———. 2022. <span>“Machine Learning-Based Global Maps of Ecological Variables and the Challenge of Assessing Them.”</span> <em>Nature Communincations</em> 13.<a href="https://doi.org/10.1038/s41467-022-29838-9%20">https://doi.org/10.1038/s41467-022-29838-9 </a>.
</div>
<div id="ref-mila2022nearest" class="csl-entry" role="listitem">
Mila, Carles, Jorge Mateu, Edzer Pebesma, and Hanna Meyer. 2022. <span>“Nearest Neighbour Distance Matching Leave-One-Out Cross-Validation for Map Validation.”</span> <em>Methods in Ecology and Evolution</em> 13 (6): 1304–16. <a href="https://doi.org/10.1111/2041-210X.13851">https://doi.org/10.1111/2041-210X.13851</a>.
</div>
<div id="ref-militinoetal19" class="csl-entry" role="listitem">
Militino, A. F., M. D. Ugarte, U. Pérez-Goya, and M. G. Genton. 2019. <span>“Interpolation of the Mean Anomalies for Cloud-Filling in Land Surface Temperature and Normalized Difference Vegetation Index.”</span> <em>IEEE Transactions on Geoscience and Remote Sensing</em> 57 (8): 6068–78. <a href="https://doi.org/10.1109/TGRS.2019.2904193">https://doi.org/10.1109/TGRS.2019.2904193</a>.
</div>
<div id="ref-Ploton2020" class="csl-entry" role="listitem">
Ploton, Pierre, Frédéric Mortier, Maxime Réjou-Méchain, Nicolas Barbier, Nicolas Picard, Vivien Rossi, Carsten Dormann, et al. 2020. <span>“Spatial Validation Reveals Poor Predictive Performance of Large-Scale Ecological Mapping Models.”</span> <em>Nature Communications</em> 11 (1): 4540. <a href="https://www.nature.com/articles/s41467-020-18321-y">https://www.nature.com/articles/s41467-020-18321-y</a>.
</div>
<div id="ref-schabenberger+gotway:2005" class="csl-entry" role="listitem">
Schabenberger, O., and C. A. Gotway. 2005. <em>Statistical Methods for Spatial Data Analysis</em>. Boca Raton/London: Chapman &amp; Hall/CRC.
</div>
<div id="ref-R-mlr3spatiotempcv" class="csl-entry" role="listitem">
Schratz, Patrick, and Marc Becker. 2022. <em>Mlr3spatiotempcv: Spatiotemporal Resampling Methods for Mlr3</em>. <a href="https://CRAN.R-project.org/package=mlr3spatiotempcv">https://CRAN.R-project.org/package=mlr3spatiotempcv</a>.
</div>
<div id="ref-R-spatialsample" class="csl-entry" role="listitem">
Silge, Julia, and Michael Mahoney. 2023. <em>Spatialsample: Spatial Resampling Infrastructure</em>. <a href="https://CRAN.R-project.org/package=spatialsample">https://CRAN.R-project.org/package=spatialsample</a>.
</div>
<div id="ref-sits" class="csl-entry" role="listitem">
Simoes, Rolf, Gilberto Camara, Gilberto Queiroz, Felipe Souza, Pedro R. Andrade, Lorena Santos, Alexandre Carvalho, and Karine Ferreira. 2021. <span>“Satellite Image Time Series Analysis for Big Earth Observation Data.”</span> <em>Remote Sensing</em> 13 (13). <a href="https://doi.org/10.3390/rs13132428">https://doi.org/10.3390/rs13132428</a>.
</div>
<div id="ref-rtop" class="csl-entry" role="listitem">
Skøien, Jon O, Günter Blöschl, Gregor Laaha, E Pebesma, Juraj Parajka, and Alberto Viglione. 2014. <span>“Rtop: An <span>R</span> Package for Interpolation of Data with a Variable Spatial Support, with an Example from River Networks.”</span> <em>Computers &amp; Geosciences</em> 67: 180–90.
</div>
<div id="ref-bfast" class="csl-entry" role="listitem">
Verbesselt, Jan, Rob Hyndman, Glenn Newnham, and Darius Culvenor. 2010. <span>“Detecting Trend and Seasonal Changes in Satellite Image Time Series.”</span> <em>Remote Sensing of Environment</em> 114 (1): 106–15. <a href="https://doi.org/10.1016/j.rse.2009.08.014">https://doi.org/10.1016/j.rse.2009.08.014</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-spatial\.org\/book\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./part-3.html" class="pagination-link" aria-label="Models for Spatial Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Models for Spatial Data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-PointPattern.html" class="pagination-link" aria-label="Point Pattern Analysis">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Point Pattern Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb2" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Statistical modelling of spatial data {#sec-modelling}</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, echo=FALSE}</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="in">system.file("gpkg/nc.gpkg", package="sf") |&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="in">    read_sf() -&gt; nc</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>\index{statistical models}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>So far in this book, we mostly addressed the problem of</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>_describing_ data. This included geometrical measures, predicates,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>or transformations that involved geometries, or by summary measures</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>of attributes, or by plots involving variability in the geometry,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>the feature attributes, or both.</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>Statistical modelling aims at going beyond describing the data,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>it considers the data as a sample drawn from a population, and</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>tries to make assessments (inference) about the population sampled</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>from, for instance by quantifying relationships between variables,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>estimating population parameters, and predicting the outcome of</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>observations that could have been taken but were not, as is the</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>case in interpolation problems. This is usually done by adopting a</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>model for the data, where for instance observations are decomposed</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>as follows:</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>\mbox{observed} = \mbox{explained} + \mbox{remainder}</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>$$ {#eq-model}</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>where "explained" typically uses external variables (predictors,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>covariates, in machine learning confusingly also called features)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>that are related to the observed variable and some kind of regression</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>model to translate into variability of the observed variable, and</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>"remainder" is remaining variability that could not be explained.</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>Interest may focus on the nature and magnitude or the relations</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>between predictors and the observed variable, or in predicting</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>new observations.</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>Statistical models, and _sampling_ hinge on the concept of</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>probability, which in typical spatial data science problems is not a</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>force of nature but has to be assumed in one way or another.  If we</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>are faced with data that come from (spatially) random sampling and</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>we are interested in estimating means or totals, a _design-based_</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>approach that assumes randomness in the sample locations is the most</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>straightforward analysis approach, as pointed out in more detail in</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>@sec-design. If observations were not sampled randomly, or if our</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>interest is in predicting values at specific locations (mapping),</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>a _model-based_ approach is needed. The remaining chapters in this</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>part deal with model-based approaches.</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mapping with non-spatial regression and ML models {#sec-lm}</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>Regression models or other machine learning (ML) models can be</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>applied to spatial and spatiotemporal data just the way they are</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>applied for predicting new observations in non-spatial problems:</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**estimate**: for a set of observations, a regression or ML model is fitted</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>using predictor values corresponding to the observations (in ML jargon, this</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>step is also known as "train")</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**predict**: for a new situation, known predictor values are combined</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>with the fitted model to predict the value of the observed variable, along</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>with a prediction error or prediction interval if possible</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>Objects of class <span class="in">`sf`</span> need no special treatment, as they are</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="in">`data.frame`</span>s. To create maps of the resulting predictions, predicted</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>values need to be added to the <span class="in">`sf`</span> object, which can be done using the <span class="in">`nc`</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>dataset loaded as in @sec-intro by:</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sid, cache = FALSE}</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="in">nc |&gt; mutate(SID = SID74/BIR74, NWB = NWBIR74/BIR74) -&gt; nc1</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="in">lm(SID ~ NWB, nc1) |&gt;</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="in">  predict(nc1, interval = "prediction") -&gt; pr</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="in">bind_cols(nc, pr) |&gt; names()</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>where we see that </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`lm`</span> estimates a linear model and works directly on an <span class="in">`sf`</span> object</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the output is used for a <span class="in">`predict`</span> model, which predicts values corresponding</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>to the observations in <span class="in">`nc1`</span>, the same <span class="in">`sf`</span> object</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`predict`</span> creates three columns: <span class="in">`fit`</span> for predicted values and <span class="in">`lwr`</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>and <span class="in">`upr`</span> for the 95\% prediction intervals</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>these three columns have been added to the final object using <span class="in">`bind_cols`</span>.</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>In general the datasets for model estimation and prediction do not</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>have to be the same.  @sec-starspredict points out how this can</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>be done with <span class="in">`stars`</span> objects (essentially by going through a long</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="in">`data.frame`</span> representation of the datacube and converting the</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>predicted results back, potentially in a chunked fashion).</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>Because many regression and ML type problems share this same</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>structure, packages like **caret** [@R-caret] or **tidymodels**</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@R-tidymodels</span><span class="co">]</span> allow for automated evaluation and comparison over</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>a large set of model alternatives, offering a large set of model</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>evaluation criteria and cross-validation strategies.  Such</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>cross-validation approaches assume independent observations,</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>which is often not a reasonable assumption for spatial data, for</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>instance because of spatial correlation <span class="co">[</span><span class="ot">@Ploton2020</span><span class="co">]</span> or because</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>of strong spatial clustering in sample data <span class="co">[</span><span class="ot">@meyerpebesmanc</span><span class="co">]</span>, or</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>both, and a number of R packages provide methods that are meant as</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>replacements for naive cross-validation, including **spatialsample**</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@R-spatialsample</span><span class="co">]</span>, **CAST** [@R-CAST], **mlr3spatial**</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@R-mlr3spatial</span><span class="co">]</span>, and **mlr3spatiotempcv** <span class="co">[</span><span class="ot">@R-mlr3spatiotempcv</span><span class="co">]</span>.</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>Strong spatial clustering of sample can arise when sample data are</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>composed by joining different databases, each with very different</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>sampling density. This is often the case in global datasets</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@meyerpebesmanc</span><span class="co">]</span>. Another example of strong clustering arises when,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>for sampling ground truth points of a land cover class, polygons</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>are digitised and points are sampled within these polygons at the</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>resolution of pixels in satellite imagery.</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>Spatial correlation in the "remainder" part of the model may be</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>decreased by adding spatial coordinates or functions of spatial</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>coordinates to the set of predictors. This also carries a risk</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>of over-optimistic predictions in extrapolation cases, (cross-)</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>validation, and model assessment, and is further discussed in</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>@sec-models-with-coordinates.</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a><span class="fu">## Support and statistical modelling {#sec-supportstatistical}</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>Support of data (@sec-support; @sec-featureattributes) plays a</span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>lead role in the statistical analysis of spatial data. Methods</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>for areal data (Chapters <span class="co">[</span><span class="ot">-@sec-area</span><span class="co">]</span>-<span class="co">[</span><span class="ot">-@sec-spatecon</span><span class="co">]</span>) are devised for data</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>with area support, where the set of areas cover the entire area</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>of interest.  </span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>By showing an extensive variable (@sec-extensiveintensive)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>in a polygon choropleth map as done in @fig-first-map one runs</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>the risk that the information is related with the polygon size,</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>and that the signal shown is actually the size of the polygons,</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>in colour.  For the variable _population count_ one would divide</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>by the polygon area to show the (intensive) variable _population</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>density_, in order to create an informative map.  In the analysis</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>of health data, like disease incidences over a time period shown</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>in @fig-first-map, rather than dividing by polygon area to get a</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>spatial density, observations are usually converted to probabilities</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>or _incidence rates_ by dividing over the population size of the</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>associated polygons. As such they are (still) associated with the</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>polygon area but their support is associated with the population</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>total. It is these totals that inform the (Poisson) variability</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>used by subsequent modelling in for instance CAR-type models</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>(@sec-spatglmm).</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>@sec-pointpatterns deals in principle with point support</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>observations, but at some stage needs to acknowledge that</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>observations have non-zero size: tree stem "points" cannot be</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>separated distances smaller than the tree diameter. Also, points in</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>point pattern analysis are considered in their _observation window_,</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>the area for which the point dataset is exhaustive, or complete.</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>The observation window is of influence in many of the analysis</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>tools. If points are observed on a line network, then the observation</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>window consists of the set of lines observed, and distances measured</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>through this network.</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>Geostatistical data (Chapters <span class="co">[</span><span class="ot">-@sec-interpolation</span><span class="co">]</span> and <span class="co">[</span><span class="ot">-@sec-stgeostatistics</span><span class="co">]</span>)</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>usually start with point support observations and may end with</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>predictions (spatial interpolations) for unobserved point locations</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>distributed over the area of interest, or, may end in predictions for</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>means over areas (block kriging; @sec-blockkriging). Alternatively,</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>observations may be aggregates over regions <span class="co">[</span><span class="ot">@rtop</span><span class="co">]</span>. In remote</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>sensing data, pixel values are usually associated with aggregates</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>over the pixel area. Challenges may be the filling of gaps in images</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>such as gaps caused by cloud coverage, from pixels neighbouring in</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>space and time <span class="co">[</span><span class="ot">@gapfill, @Heaton2018, @militinoetal19</span><span class="co">]</span>.</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>When combining data with different spatial supports, for instance polygons</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>from administrative regions and raster layers, it is often seen that</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>all information is "brought together" to the highest resolution,</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>by simply extracting polygon values at pixel locations, and</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>proceeding from there, with all the newly created "observations".</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>This of course bears a large risk of producing non-sensible results</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>when analysing these "data", and a proper downsampling strategy,</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>possibly using simulations to cope with uncertainty, would be a</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>better alternative. For naive users, using software that is not</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>aware of support of values associated with areas and using software</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>that does not warn against naive downsampling is of course not a</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>helpful situation.</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time in predictive models</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>@schabenberger+gotway:2005 already noted that in many cases,</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>statistical analysis of spatiotemporal data proceeds either by</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>reducing time, then working on the problem spatially (time first,</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>space later) or reducing space, then working on the problem</span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>temporally (space first, time later). An example of the first</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>approach is given in @sec-interpolation where a dataset with a year</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>of hourly values (detailed in @sec-stgeostatistics) are reduced</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>to station mean values (time first) after which these means are</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>interpolated spatially (space later). Examples from the area of</span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>remote sensing are</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>@sits use supervised machine learning and time series deep learning</span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>  to segmentise pixel time series into sequences of land use (time</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>  first), and then smooth the resulting sequences of maps to remove</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>  improbable transitions in isolated pixels (space later)</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>@bfast use (unsupervised) structural change algorithms to</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>  find breakpoints in pixel time series (time first), which are interpreted</span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>  in the context deforestation later on.</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>Examples of space first, time later in the area of remote sensing are</span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>any case where a single scene or scenes belonging to a single season</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>are classified, and multi-year changes in land use or land cover</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>are assessed by comparing time sequences of classified scenes. An</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>example of this is @brown2022dynamic.  Examples where space and</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>time are considered _jointly_ are the spatiotemporal interpolation</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>in @sec-stgeostatistics, and @LU2016227 in the context of remote</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>sensing.</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="fu">## Design-based and model-based inference {#sec-design}</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>\index{inference!design-based}</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>\index{inference!model-based}</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>\index{design-based inference}</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>\index{model-based inference}</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>Statistical inference means the action of estimating parameters</span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>about a population from sample data. Suppose we denote the variable</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>of interest with $z(s)$, where $z$ is the attribute value measured</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>at location $s$, and we are interested in estimating the </span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>mean value of $z(s)$ over a domain $D$,</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>$$z(s)=\frac{1}{|D|} \int_{ u \in D} z(u)du,$$</span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a>with $|D|$ the area of $D$, from sample data $z(s_1),...,z(s_n)$.</span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>Then, there are two possibilities to proceed: model-based, or</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>design-based. A model-based approach considers $z(s)$ to be a</span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>realisation of a super-population $Z(s)$ (using capital letters to</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>indicate random variables), and could for instance postulate a</span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>model for its spatial variability in the form of</span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a>$$Z(s) = m + e(s), \  \ \mbox{E}(e(s)) = 0, \  \ \mbox{Cov(e(s))} = \Sigma(\theta)$$</span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>with $m$ a constant mean and $e(s)$ a residual with mean zero and</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>covariance matrix $\Sigma(\theta)$. This</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>would require choosing the covariance function $\Sigma()$ and</span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>estimating its parameters $\theta$ from $z(s)$, and then computing a</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>block kriging prediction $\hat{Z}(D)$ (@sec-blockkriging).</span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>This approach makes no assumptions about how $z(s)$ was sampled</span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>_spatially_, but of course it should allow for choosing the</span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a>covariance function and estimating its parameters; inference is</span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>conditional to the validity of the postulated model.</span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>\index{superpopulation model}</span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a>\index{spatial random sampling}</span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>\index{random sampling}</span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a>Rather than assuming a superpopulation model, the design-based</span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>approach <span class="co">[</span><span class="ot">@de1990model; @brus2021; @breidt2017model</span><span class="co">]</span> assumes</span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>randomness in the locations, which is justified (only) when using</span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>random sampling. It _requires_ that the sample data were obtained</span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>by probability sampling, meaning that some form of spatial random</span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a>sampling was used where all elements of $z(s)$ had a known and</span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>positive probability of being included in the sample obtained. The</span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a>random process is that of sampling: $z(s_1)$ is a realisation of</span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a>the random process $z(S_1)$, the first observation taken _over</span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a>repeated random sampling_.  Design-based estimators only need</span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a>these inclusion probabilities to estimate mean values with standard</span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a>errors. This means that for instance given a simple random sample,</span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>the unweighted sample mean is used to estimate the population mean,</span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>and no model parameters need to be fit.</span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>Now the question is whether $z(s_1)$ and $z(s_2)$ can be expected</span>
<span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>to be correlated when $s_1$ and $s_2$ are close together. The question</span>
<span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>does not work out as long as $z(s_1)$ and $z(s_2)$ are just two numbers:</span>
<span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>we need some kind of framework, random variables, that recreates this</span>
<span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>situation to form two sets of numbers for which we can consider correlation.</span>
<span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>The misconception here, as explained in @brus2021, is that the two</span>
<span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>are always spatially correlated, but this is only the case when</span>
<span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>working under model-based approaches: $Z(s_1)$ and $Z(s_2)$ may</span>
<span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>well be correlated ("model-dependent"), but although in a particular</span>
<span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>random sample (realisation) $z(s_1)$ and $z(s_2)$ _may_ be close</span>
<span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>in space, the corresponding random variables $z(S_1)$ and $z(S_2)$</span>
<span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>considered over repeated random sampling are not close together,</span>
<span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>and, are design-independent. Both situations can coexist without</span>
<span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>contradiction and are a consequence of choosing to work under one</span>
<span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>inference framework or the other.</span>
<span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>The choice whether to work under a design-based or model-based</span>
<span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>framework depends on the purpose of the study and the data collection</span>
<span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>process. The model-based framework lends itself best for cases:</span>
<span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>where predictions are required for individual locations, or</span>
<span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>  for areas too small to be sampled</span>
<span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>where the available data were not collected using a known random</span>
<span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>  sampling scheme (i.e., the inclusion probabilities are unknown,</span>
<span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>  or are zero over particular areas and or times)</span>
<span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>Design-based approaches are most suitable when:</span>
<span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>observations were collected using a spatial random sampling process</span>
<span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>aggregated properties of the entire sample region (or sub-region)</span>
<span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>  are needed</span>
<span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>estimates are required that are not sensitive to model</span>
<span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>misspecification, for instance when needed for regulatory or legal</span>
<span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>purposes</span>
<span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>In case a sampling procedure is to be planned <span class="co">[</span><span class="ot">@de2006sampling</span><span class="co">]</span>, some</span>
<span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>form of spatial random sampling is definitely worth considering since</span>
<span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>it opens up the possibility of following both inference frameworks.</span>
<span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictive models with coordinates {#sec-models-with-coordinates}</span></span>
<span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>\index{predictive models}</span>
<span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>\index{coordinates!as predictors}</span>
<span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>In data science projects, coordinates may be seen as features in a</span>
<span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a>larger set of predictors (or features, or covariates) and treated</span>
<span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>accordingly. There are some pitfalls in doing so.</span>
<span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>As usual when working with predictors, it is good to choose</span>
<span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>predictive methods that are not sensitive to shifts in origin</span>
<span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>or shifts in unit (scale).  Assuming a two-dimensional problem,</span>
<span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a>predictive models should also not be sensitive to arbitrary rotations</span>
<span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>of the $x$- and $y$- or latitude and longitude axes.  For projected (2D,</span>
<span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>Cartesian) coordinates this can be assured, e.g., by using polynomials</span>
<span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>of order $n$ as $(x+y)^n$, rather than $(x)^n + (y)^n$; for a second</span>
<span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a>order polynomial this involves including the term $xy$, so that an</span>
<span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>ellipsoidal-shape trend surface does not have to be aligned with</span>
<span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>the $x-$ or $y-$axis.  For a GAM model with spline components, one</span>
<span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>would use a spline in two dimensions $s(x,y)$ rather than two</span>
<span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>independent splines $s(x)$ and $s(y)$ that do not allow for</span>
<span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>interaction. An exception to this "rule" would be when a pure</span>
<span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>latitude effect is desired for instance to account for yearly total</span>
<span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a>solar energy influx.</span>
<span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>When the area covered by the data is large, the difference between</span>
<span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>using ellipsoidal coordinates and projected coordinates</span>
<span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>will automatically become larger, and hence choosing one of both</span>
<span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>will have an effect on predictive modelling.  For very large extents</span>
<span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>and global models, polynomials or splines in latitude and longitude</span>
<span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>will not work well as they ignore the circular nature of longitude</span>
<span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>and the coordinate singularities at the poles. Here, spherical</span>
<span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>harmonics, base functions that are continuous on the sphere with</span>
<span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>increasing spatial frequencies can replace polynomials or be used</span>
<span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a>as spline base functions.</span>
<span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>In many cases, the spatial coordinates over which samples were</span>
<span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a>collected also define the space over which predictions are made,</span>
<span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>setting them apart from other features. Many simple predictive</span>
<span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>approaches, including most machine learning methods, assume</span>
<span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>sample data to be independent.  When samples are collected by</span>
<span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>spatially random sampling over the spatial target area, this</span>
<span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>assumption may be justified when working under a design-based context</span>
<span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@brusejss</span><span class="co">]</span>. This context, however, treats the coordinate space as</span>
<span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>the variable over which we randomise, which affords predicting</span>
<span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>values for a new _randomly chosen_ location but rules out making</span>
<span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a>predictions for fixed locations; this implies that averages of</span>
<span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>areas over which samples were collected, can be obtained, but not</span>
<span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>spatial interpolations.  In case predictions for fixed locations</span>
<span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a>are required, or in case data were not collected by spatial</span>
<span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>random sampling, a model-based approach (as taken in </span>
<span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>@sec-interpolation) is needed and typically some form of spatial</span>
<span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a>and/or temporal autocorrelation of residuals must be assumed.</span>
<span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>\index{cross-validation}</span>
<span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>\index{spatial cross-validation}</span>
<span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a>A common case is where sample data are collected opportunistically</span>
<span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>("whatever could be found"), and are then used in a predictive</span>
<span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>framework that does not weight them. This has a consequence that the</span>
<span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>resulting model may be biased towards over-represented areas (in</span>
<span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a>predictor space and/or in spatial coordinates space), and that simple</span>
<span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>(random) cross-validation statistics may be over-optimistic when</span>
<span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>taken as performance measures for spatial prediction [@meyerpebesma;</span>
<span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>@meyerpebesmanc; @mila2022nearest].  Adaptive cross-validation</span>
<span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a>measures such as spatial cross-validation may help getting more</span>
<span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>relevant measures for predictive performance.</span>
<span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>Use R to solve the following exercises.</span>
<span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Following the <span class="in">`lm`</span> example of @sec-lm use a random forest model</span>
<span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a>to predict <span class="in">`SID`</span> values (e.g., using package **randomForest**), and </span>
<span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a>plot the random forest predictions against observations, along</span>
<span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a>with the $x=y$ line.</span>
<span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create a new dataset by randomly sampling 1000 points from the</span>
<span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a><span class="in">`nc`</span> dataset, and rerun the linear regression model of @sec-lm on </span>
<span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a>this dataset. Consider the <span class="in">`summary`</span> of the fitted models, in </span>
<span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>particular the estimated coefficients, their standard errors,</span>
<span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>and the residual standard error.  What has changed?</span>
<span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Redo the water-land classification of @sec-starspredict</span>
<span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>using <span class="in">`class::knn`</span> instead of <span class="in">`lda`</span>, using a value of <span class="in">`k = 5`</span>, </span>
<span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>and compare the resulting predictions with those of <span class="in">`lda`</span>.</span>
<span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>For the linear model using <span class="in">`nc`</span> and for the <span class="in">`knn`</span> example of the</span>
<span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>previous exercise, add a first and a second order linear model in</span>
<span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>the spatial coordinates and compare the results (use <span class="in">`st_centroid`</span></span>
<span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>to obtain polygon centroids, and <span class="in">`st_coordinates`</span> to extract the</span>
<span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a><span class="in">`x`</span> and <span class="in">`y`</span> coordinates in matrix form).</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/sdsr/edit/main/10-Models.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>