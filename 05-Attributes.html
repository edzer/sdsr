<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Spatial Data Science - 5&nbsp; Attributes and Support</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06-Cubes.html" rel="next">
<link href="./04-Spherical.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-04YTZNEH1K"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-04YTZNEH1K', { 'anonymize_ip': true});
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-1.html">Spatial Data</a></li><li class="breadcrumb-item"><a href="./05-Attributes.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/sdsr/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-hello.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Spaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Geometries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Spherical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Attributes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Cubes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R for Spatial Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Introsf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to sf and stars</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Large.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Large data and cloud native</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models for Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-PointPattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Point Pattern Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Interpolation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Geostatistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multivariate and Spatiotemporal Geostatistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Areal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Proximity and Areal Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Measures of Spatial Autocorrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-SpatialRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Econometrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial Econometrics Models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Older R Spatial Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rbasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ERRATA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Errata to the printed ed.</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-agr" id="toc-sec-agr" class="nav-link active" data-scroll-target="#sec-agr"><span class="header-section-number">5.1</span> Attribute-geometry relationships and support</a></li>
  <li><a href="#aggregating-and-summarising" id="toc-aggregating-and-summarising" class="nav-link" data-scroll-target="#aggregating-and-summarising"><span class="header-section-number">5.2</span> Aggregating and summarising</a></li>
  <li>
<a href="#sec-area-weighted" id="toc-sec-area-weighted" class="nav-link" data-scroll-target="#sec-area-weighted"><span class="header-section-number">5.3</span> Area-weighted interpolation</a>
  <ul class="collapse">
<li><a href="#sec-extensiveintensive" id="toc-sec-extensiveintensive" class="nav-link" data-scroll-target="#sec-extensiveintensive">Spatially extensive and intensive variables</a></li>
  <li><a href="#dasymetric-mapping" id="toc-dasymetric-mapping" class="nav-link" data-scroll-target="#dasymetric-mapping">Dasymetric mapping</a></li>
  <li><a href="#support-in-file-formats" id="toc-support-in-file-formats" class="nav-link" data-scroll-target="#support-in-file-formats">Support in file formats</a></li>
  </ul>
</li>
  <li><a href="#sec-updownscaling" id="toc-sec-updownscaling" class="nav-link" data-scroll-target="#sec-updownscaling"><span class="header-section-number">5.4</span> Up- and Downscaling</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5.5</span> Exercises</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/edzer/sdsr/edit/main/05-Attributes.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-1.html">Spatial Data</a></li><li class="breadcrumb-item"><a href="./05-Attributes.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-featureattributes" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p> </p>
<p>Feature <em>attributes</em> refer to the properties of features (“things”) that do not describe the feature’s geometry. Feature attributes can be <em>derived</em> from geometry (such as length of a <code>LINESTRING</code> or area of a <code>POLYGON</code>), but they can also refer to non-derived properties, such as:</p>
<ul>
<li>name of a street or county</li>
<li>number of people living in a country</li>
<li>type of a road</li>
<li>soil type in a polygon from a soil map</li>
<li>opening hours of a shop</li>
<li>body weight or heart beat rate of an animal</li>
<li>NO<span class="math inline">\(_2\)</span> concentration measured at an air quality monitoring station</li>
</ul>
<p>In some cases, time properties can be seen as attributes of features, for instance the date of birth of a person or the construction year of a road. When an attribute such as for instance air quality is a function of both space and time, time is best handled on equal footing with geometry (often in a data cube, see <a href="06-Cubes.html" class="quarto-xref"><span>Chapter 6</span></a>).</p>
<p>Spatial data science software implementing simple features typically organises data in tables that contain both geometries and attributes for features; this is true for <code>geopandas</code> in Python, <code>PostGIS</code> tables in PostgreSQL, and <code>sf</code> objects in R. The geometric operations described in <a href="03-Geometries.html#sec-opgeom" class="quarto-xref"><span>Section 3.2</span></a> operate on geometries <em>only</em>, and may occasionally yield new attributes (predicates, measures, or transformations), but they do not operate on attributes present.</p>
<p>When, while manipulating geometries, attribute <em>values</em> are retained unmodified, support problems may arise. If we look into a simple case of replacing a county polygon with the centroid of that polygon on a dataset that has attributes, we see that R package <strong>sf</strong> issues a warning:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"gpkg/nc.gpkg"</span>, package<span class="op">=</span><span class="st">"sf"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="fl">32119</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">BIR74</span>, <span class="va">SID74</span>, <span class="va">NAME</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">x</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stderr">
<pre><code># Warning: st_centroid assumes attributes are constant over
# geometries</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<p>The reason for this is that the dataset contains variables with values that are associated with entire polygons – in this case population counts – meaning they are not associated with a <code>POINT</code> geometry replacing the polygon.</p>
<p></p>
<p>In <a href="01-hello.html#sec-support" class="quarto-xref"><span>Section 1.6</span></a> we already described that for non-point geometries (lines, polygons), feature attribute values either have <em>point support</em>, meaning that the value applies to <em>every point</em>, or they have <em>block support</em>, meaning that the value <em>summarises all points</em> in the geometry. (Other options, non-point support smaller than the geometry, or support larger than the associated geometry, may also occur.) This chapter will describe different ways in which an attribute may relate to the geometry, its consequences on analysing such data, and ways to derive attribute data for different geometries (up- and downscaling).</p>
<p> </p>
<section id="sec-agr" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="sec-agr">
<span class="header-section-number">5.1</span> Attribute-geometry relationships and support</h2>
<p> </p>
<p>Changing the feature geometry without changing the feature attributes does change the <em>feature</em>, since the feature is characterised by the combination of geometry and attributes. Can we, ahead of time, predict whether the resulting feature will still meaningfully relate to the attribute value when we replace all geometries for instance with their convex hull or centroid? It depends.</p>
<p>Take the example of a road, represented by a <code>LINESTRING</code>, which has an attribute property <em>road width</em> equal to 10 m. What can we say about the road width of an arbitrary sub-section of this road? That depends on whether the attribute road length describes, for instance the road width <em>everywhere</em>, meaning that road width is constant along the road, or whether it describes an aggregate property, such as minimum or average road width. In case of the minimum, for an arbitrary subsection of the road one could still argue that the minimum road width must be at least as large as the minimum road width for the whole segment, but it may no longer be <em>the minimum</em> for that subsection. This gives us two “types” for the attribute-geometry relationship (<strong>AGR</strong>):</p>
<ul>
<li>
<strong>constant</strong> the attribute value is valid everywhere in or over the geometry; we can think of the feature as consisting of an infinite number of points that all have this attribute value; in geostatistical terminology this is known as a variable with <em>point support</em>
</li>
<li>
<strong>aggregate</strong> the attribute is an aggregate, a summary value over the geometry; we can think of the feature as a <em>single</em> observation with a value that is associated with the <em>entire</em> geometry; this is also known as a variable having <em>block support</em>
</li>
</ul>
<p> </p>
<p>For polygon data, typical examples of <strong>constant</strong> AGR (point support) variables are:</p>
<ul>
<li>land use for a land use polygon</li>
<li>rock units or geologic strata in a geological map</li>
<li>soil type in a soil map</li>
<li>elevation class in an elevation map that shows elevation as classes</li>
<li>climate zone in a climate zone map</li>
</ul>
<p>A typical property of such variables is that they have geometries that are not man-made and also not associated with a sensor device (such as remote sensing image pixel boundaries). Instead, the geometry follows from mapping the variable observed.</p>
<p>Examples for the <strong>aggregate</strong> AGR (block support) variables are:</p>
<ul>
<li>population, either as number of persons or as population density</li>
<li>other socio-economic variables, summarised by area</li>
<li>average reflectance over a remote sensing pixel</li>
<li>total emission of pollutants by region</li>
<li>block mean NO<span class="math inline">\(_2\)</span> concentrations, such as obtained by block kriging over square blocks (<a href="12-Interpolation.html#sec-blockkriging" class="quarto-xref"><span>Section 12.5</span></a>) or by a dispersion model that predicts areal means</li>
</ul>
<p>A typical property of such variables is that associated geometries come for instance from legislation, observation devices or analysis choices, but not intrinsically from the observed variable.</p>
<p></p>
<p>A third type of AGR arises when an attribute <em>identifies</em> a feature geometry; we call an attribute an <strong>identity</strong> variable when the associated geometry uniquely identifies the variable’s value (there are no other geometries with the same value). An example is county name: the name identifies the county, and is still the county for any sub-area (point support), but for arbitrary sub-areas, the attributes loses the <strong>identity</strong> property to become a <strong>constant</strong> attribute. An example is:</p>
<ul>
<li>an arbitrary point (or region) inside a county is still part of the county and must have the same value for county name, but it no longer identifies the (entire) geometry corresponding to that county</li>
</ul>
<p>The challenge here is that spatial information (ignoring time for simplicity) belongs to different phenomena types <span class="citation" data-cites="scheider2016">(<a href="references.html#ref-scheider2016" role="doc-biblioref">Scheider et al. 2016</a>)</span>, including:</p>
<ul>
<li>
<strong>fields</strong>: where over <em>continuous</em> space, every location corresponds to a single value, examples including elevation, air quality, or land use</li>
<li>
<strong>objects</strong>: found at a <em>discrete</em> set of locations, such as houses, trees, or persons</li>
<li>
<strong>aggregates</strong>: values arising as spatial sums, totals, or averages of fields, counts or densities of objects, associated with lines or regions</li>
</ul>
<p> </p>
<p>but that different spatial geometry types (points, lines, polygons, raster cells) have no simple mapping to these phenomena types:</p>
<ul>
<li>points may refer to sample locations of observations on fields (air quality) or to locations of objects</li>
<li>lines may be used for objects (roads, rivers), contours of a field, or administrative borders</li>
<li>raster pixels and polygons may reflect fields of a categorical variable such as land use (<em>coverage</em>), but also aggregates such as population density</li>
<li>raster or other mesh triangulations may have different variables associated with nodes (points), edges (lines), or faces (areas, cells), for instance when partial differential equations are approximated using <em>staggered grids</em> <span class="citation" data-cites="Haltiner Collins13">(<a href="references.html#ref-Haltiner" role="doc-biblioref">Haltiner and Williams 1980</a>; <a href="references.html#ref-Collins13" role="doc-biblioref">Collins et al. 2013</a>)</span>
</li>
</ul>
<p>Properly specifying attribute-geometry relationships, and warning against their absence or cases when change in geometry (change of support) implies a change of information can help to avoid a large class of common spatial data analysis mistakes <span class="citation" data-cites="stasch2014">(<a href="references.html#ref-stasch2014" role="doc-biblioref">Stasch et al. 2014</a>)</span> associated with the <em>support</em> of spatial data.</p>
</section><section id="aggregating-and-summarising" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="aggregating-and-summarising">
<span class="header-section-number">5.2</span> Aggregating and summarising</h2>
<p>Aggregating records in a table (or <code>data.frame</code>) involves two steps:</p>
<ul>
<li>grouping records based on a grouping predicate, and</li>
<li>applying an aggregation function to the attribute values of a group to summarise them into a single number.</li>
</ul>
<p>In SQL, this looks for instance like</p>
<pre><code>SELECT GroupID, SUM(population) FROM table GROUP BY GroupID;</code></pre>
<p>indicating the aggregation <em>function</em> (<code>SUM</code>) and the <em>grouping predicate</em> (<code>GroupID</code>).</p>
<p>R package <strong>dplyr</strong> for instance uses two steps to accomplish this: function <code>group_by</code> specifies the group membership of records, <code>summarise</code> computes data summaries (such as <code>sum</code> or <code>mean</code>) for each of the groups. The (base) R method <code>aggregate</code> combines both in a single function call that takes the table, the grouping predicate(s), and the aggregation function(s) as arguments.</p>
<p>An example for the North Carolina counties is shown in <a href="#fig-ncaggregation" class="quarto-xref">Figure&nbsp;<span>5.1</span></a>. Here, we grouped counties by their position (according to the quadrant in which the county centroid is with respect to ellipsoidal coordinate <code>POINT(-79, 35.5)</code>) and summed the number of disease cases per group. The result shows that the geometries of the resulting groups have been unioned (<a href="03-Geometries.html#sec-bintrans" class="quarto-xref"><span>Section 3.2.6</span></a>): this is necessary because the <code>MULTIPOLYGON</code> formed by just putting all the county geometries together would have many duplicate boundaries, and hence would not be <em>valid</em> (<a href="03-Geometries.html#sec-valid" class="quarto-xref"><span>Section 3.1.2</span></a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"gpkg/nc.gpkg"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># encode quadrant by two logicals:</span></span>
<span><span class="va">nc</span><span class="op">$</span><span class="va">lng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">79</span></span>
<span><span class="va">nc</span><span class="op">$</span><span class="va">lat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">35.5</span></span>
<span><span class="va">nc.grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">nc</span><span class="op">[</span><span class="st">"SID74"</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">lng</span>, <span class="va">nc</span><span class="op">$</span><span class="va">lat</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="va">nc.grp</span><span class="op">[</span><span class="st">"SID74"</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="st">'EPSG:32119'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>graticule <span class="op">=</span> <span class="cn">TRUE</span>, axes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-ncaggregation" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ncaggregation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-Attributes_files/figure-html/fig-ncaggregation-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ncaggregation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.1: SID74 total incidences aggregated to four areas
</figcaption></figure>
</div>
</div>
</div>
<p>Plotting collated county polygons is technically not a problem, but for this case would raise the wrong suggestion that the group sums relate to individual counties, rather than to the grouped counties.</p>
<p>One particular property of aggregation in this way is that each record is assigned to a single group; this has the advantage that the sum of the group-wise sums equals the sum of the un-grouped data: for variables that reflect <em>amount</em>, nothing gets lost and nothing is added. The newly formed geometry is the result of unioning the geometries of the contributing records.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">nc</span>, <span class="fl">2264</span><span class="op">)</span></span>
<span><span class="va">gr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span></span>
<span>   label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">paste0</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>,</span>
<span>   geom <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span>, reset <span class="op">=</span> <span class="cn">FALSE</span>, border <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">gr</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-ncblocks" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ncblocks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-Attributes_files/figure-html/fig-ncblocks-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ncblocks-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.2: Example target blocks plotted over North Carolina counties
</figcaption></figure>
</div>
</div>
</div>
<p>When we need an aggregate for a new area that is <em>not</em> a union of the geometries for a group of records, and we use a spatial predicate, then single records may be matched to multiple groups. When taking the rectangles of <a href="#fig-ncblocks" class="quarto-xref">Figure&nbsp;<span>5.2</span></a> as the target areas, and summing for each rectangle the disease cases of the counties that <em>intersect</em> with the rectangles of <a href="#fig-ncblocks" class="quarto-xref">Figure&nbsp;<span>5.2</span></a>, the sum of these will be much larger:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">nc</span><span class="op">[</span><span class="st">"SID74"</span><span class="op">]</span>, <span class="va">gr</span>, <span class="va">sum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>sid74_sum_counties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">SID74</span><span class="op">)</span>,</span>
<span>  sid74_sum_rectangles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">a</span><span class="op">$</span><span class="va">SID74</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>#   sid74_sum_counties sid74_sum_rectangles 
#                  667                 2621</code></pre>
</div>
</div>
<p>Choosing another predicate, such as <em>contains</em> or <em>covers</em>, would on the contrary result in much smaller values, because many counties are not contained by <em>any</em> of the target geometries. However, there are a few cases where this approach might be good or satisfactory:</p>
<ul>
<li>when we want to aggregate <code>POINT</code> geometries by a set of polygons, and all points are contained by a single polygon. If points fall on a shared boundary than they are assigned to both polygons (this is the case for DE-9IM-based GEOS library; the s2geometry library has the option to define polygons as “semi-open”, which implies that points are assigned to maximally one polygon when polygons do not overlap)</li>
<li>when aggregating many very small polygons or raster pixels over larger areas, for instance <em>averaging</em> altitude from a 30 m resolution raster over North Carolina counties, the error made by multiple matches may be insignificant</li>
<li>when the many-to-many match is reduced to the single largest area match, as shown in <a href="07-Introsf.html#fig-largest" class="quarto-xref">Figure&nbsp;<span>7.4</span></a>
</li>
</ul>
<p>A more comprehensive approach to aggregating spatial data associated with areas to larger, arbitrary shaped areas is by using area-weighted interpolation.</p>
</section><section id="sec-area-weighted" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="sec-area-weighted">
<span class="header-section-number">5.3</span> Area-weighted interpolation</h2>
<p> </p>
<p>When we want to combine geometries and attributes of two datasets such that we get attribute values of a source dataset summarised for the geometries of a target, where source and target geometries are unrelated, area-weighted interpolation may be a simple approach. In effect, it considers the area of overlap of the source and target geometries, and uses that to weigh the source attribute values into the target value <span class="citation" data-cites="goodchild thomas do Do2021">(<a href="references.html#ref-goodchild" role="doc-biblioref">Goodchild and Lam 1980</a>; <a href="references.html#ref-thomas" role="doc-biblioref">Do, Thomas-Agnan, and Vanhems 2015a</a>, <a href="references.html#ref-do" role="doc-biblioref">2015b</a>; <a href="references.html#ref-Do2021" role="doc-biblioref">Do, Laurent, and Vanhems 2021</a>)</span>. This method is also known as conservative region aggregation or regridding <span class="citation" data-cites="conservative">(<a href="references.html#ref-conservative" role="doc-biblioref">Jones 1999</a>)</span>. Here, we follow the notation of <span class="citation" data-cites="do">Do, Thomas-Agnan, and Vanhems (<a href="references.html#ref-do" role="doc-biblioref">2015b</a>)</span>.</p>
<p>Area-weighted interpolation computes, for each of <span class="math inline">\(q\)</span> spatial target areas <span class="math inline">\(T_j\)</span>, a weighted average from the values <span class="math inline">\(Y_i\)</span> corresponding to the <span class="math inline">\(p\)</span> spatial source areas <span class="math inline">\(S_i\)</span>,</p>
<p><span id="eq-aw"><span class="math display">\[
\hat{Y}_j(T_j) = \sum_{i=1}^p w_{ij} Y_i(S_i)
\tag{5.1}\]</span></span></p>
<p>where the <span class="math inline">\(w_{ij}\)</span> depend on the amount of overlap of <span class="math inline">\(T_j\)</span> and <span class="math inline">\(S_i\)</span>, and the amount of overlap is <span class="math inline">\(A_{ij} = T_j \cap S_i\)</span>. How <span class="math inline">\(w_{ij}\)</span> depends on <span class="math inline">\(A_{ij}\)</span> is discussed below.</p>
<p>Different options exist for choosing weights, including methods using external variables <span class="citation" data-cites="mennis">(including dasymetric mapping, <a href="references.html#ref-mennis" role="doc-biblioref">Mennis 2003</a>)</span>. Two simple approaches for computing weights that do not use external variables arise, depending on whether the variable <span class="math inline">\(Y\)</span> is <em>intensive</em> or <em>extensive</em>.</p>
<section id="sec-extensiveintensive" class="level3"><h3 class="anchored" data-anchor-id="sec-extensiveintensive">Spatially extensive and intensive variables</h3>
<p> </p>
<p>Extensive variables correspond to amounts, associated with a physical size (length, area, volume, counts of items). An example of a extensive variable is <em>population count</em>. It is associated with an area, and if that area is cut into smaller areas, the population count needs to be split too. Because population is rarely uniform over space, this does not need to be done proportionally to the smaller areas but the sum of the population count for the smaller areas needs to equal that of the total. Intensive variables are variables that do not have values proportional to support: if the area is split, values may vary but <em>on average</em> remain the same. An example of a related variable that is <em>intensive</em> is population density. If an area is split into smaller areas, population density is not split similarly: the <em>sum</em> of population densities for the smaller areas is a meaningless measure, as opposed to the <em>average</em> of the population densities which will be similar to the density of the total area.</p>
<p>When we assume that the <strong>extensive</strong> variable <span class="math inline">\(Y\)</span> is uniformly distributed over space, the value <span class="math inline">\(Y_{ij}\)</span>, derived from <span class="math inline">\(Y_i\)</span> for a sub-area of <span class="math inline">\(S_i\)</span>, <span class="math inline">\(A_{ij} = T_j \cap S_i\)</span> of <span class="math inline">\(S_i\)</span> is</p>
<p><span class="math display">\[\hat{Y}_{ij}(A_{ij}) = \frac{|A_{ij}|}{|S_i|} Y_i(S_i)\]</span></p>
<p>where <span class="math inline">\(|\cdot|\)</span> denotes the spatial area. For estimating <span class="math inline">\(Y_j(T_j)\)</span> we sum all the elements over area <span class="math inline">\(T_j\)</span>:</p>
<p><span id="eq-awextensive"><span class="math display">\[
\hat{Y}_j(T_j) = \sum_{i=1}^p \frac{|A_{ij}|}{|S_i|} Y_i(S_i)
\tag{5.2}\]</span></span></p>
<p>For an <strong>intensive</strong> variable, under the assumption that the variable has a constant value over each area <span class="math inline">\(S_i\)</span>, the estimate for a sub-area equals that of the total area,</p>
<p><span class="math display">\[\hat{Y}_{ij} = Y_i(S_i)\]</span></p>
<p>and we can estimate the value of <span class="math inline">\(Y\)</span> for a new spatial unit <span class="math inline">\(T_j\)</span> by an area-weighted average of the source values:</p>
<p><span id="eq-awintensive"><span class="math display">\[
\hat{Y}_j(T_j) = \sum_{i=1}^p \frac{|A_{ij}|}{|T_j|} Y_i(S_i)
\tag{5.3}\]</span></span></p>
</section><section id="dasymetric-mapping" class="level3"><h3 class="anchored" data-anchor-id="dasymetric-mapping">Dasymetric mapping</h3>
<p></p>
<p>Dasymetric mapping distributes variables, such as population, known at a coarse spatial aggregation level over finer spatial units by using other variables that are associated with population distribution, such as land use, building density, or road density. The simplest approach to dasymetric mapping is obtained for extensive variables, where the ratio <span class="math inline">\(|A_{ij}| / |S_i|\)</span> in <a href="#eq-awextensive" class="quarto-xref">Equation&nbsp;<span>5.2</span></a> is replaced by the ratio of another extensive variable <span class="math inline">\(X_{ij}(S_{ij})/X_i(S_i)\)</span>, which has to be known for both the intersecting regions <span class="math inline">\(S_{ij}\)</span> and the source regions <span class="math inline">\(S_i\)</span>. <span class="citation" data-cites="do">Do, Thomas-Agnan, and Vanhems (<a href="references.html#ref-do" role="doc-biblioref">2015b</a>)</span> discuss several alternatives for intensive <span class="math inline">\(Y\)</span> and/or <span class="math inline">\(X\)</span>, and cases where <span class="math inline">\(X\)</span> is known for other areas.</p>
</section><section id="support-in-file-formats" class="level3"><h3 class="anchored" data-anchor-id="support-in-file-formats">Support in file formats</h3>
<p></p>
<p>GDAL’s vector API supports reading and writing so-called field domains, which can have a “split policy” and a “merge policy” indicating what should be done with attribute variables when geometries are split or merged. The values of these can be “duplicate” for split and “geometry weighted” for merge, in case of spatially intensive variables, or they can be “geometry ratio” for split and “sum” for merge, in case of spatially extensive variables. At the time of writing this, the <a href="https://github.com/OSGeo/gdal/pull/3638">file formats supporting this</a> are GeoPackage and FileGDB.</p>
</section></section><section id="sec-updownscaling" class="level2" data-number="5.4"><h2 data-number="5.4" class="anchored" data-anchor-id="sec-updownscaling">
<span class="header-section-number">5.4</span> Up- and Downscaling</h2>
<p> </p>
<p>Up- and downscaling refers in general to obtaining high-resolution information from low-resolution data (downscaling) or obtaining low-resolution information from high-resolution data (upscaling). Both activities involve the attributes’ relation to geometries and both change support. They are synonymous with aggregation (upscaling) and disaggregation (downscaling). The simplest form of downscaling is sampling (or extracting) polygon, line or grid cell values at point locations. This works well for variables with point-support (“constant” AGR), but is at best approximate when the values are aggregates. Challenging applications for downscaling include high-resolution prediction of variables obtained by low-resolution weather prediction models or climate change models, and the high-resolution prediction of satellite image derived variables based on the fusion of sensors with different spatial and temporal resolutions.</p>
<p>The application of areal interpolation using (<a href="#eq-aw" class="quarto-xref">Equation&nbsp;<span>5.1</span></a>) with its realisations for extensive (<a href="#eq-awextensive" class="quarto-xref">Equation&nbsp;<span>5.2</span></a>) and intensive (<a href="#eq-awintensive" class="quarto-xref">Equation&nbsp;<span>5.3</span></a>) variables allows moving information from any source area <span class="math inline">\(S_i\)</span> to any target area <span class="math inline">\(T_j\)</span> as long as the two areas have some overlap. This means that one can go arbitrarily to much larger units (aggregation) or to much smaller units (disaggregation). Of course this makes only sense to the extent that the assumptions hold: over the source regions extensive variables need to be uniformly distributed and intensive variables need to have a constant value.</p>
<p>The ultimate disaggregation involves retrieving (extracting) point values from line or area data. For this, we cannot work with equations -<a href="#eq-awextensive" class="quarto-xref">Equation&nbsp;<span>5.2</span></a> or -<a href="#eq-awintensive" class="quarto-xref">Equation&nbsp;<span>5.3</span></a> because <span class="math inline">\(|A_{ij}| = 0\)</span> for points, but under the assumption of having a constant value over the geometry, for intensive variables the value <span class="math inline">\(Y_i(S_i)\)</span> can be assigned to points as long as all points can be uniquely assigned to a single source area <span class="math inline">\(S_i\)</span>. For polygon data, this implies that <span class="math inline">\(Y\)</span> needs to be a coverage variable (<a href="03-Geometries.html#sec-coverages" class="quarto-xref"><span>Section 3.4</span></a>). For extensive variables, extracting a value at a point is rather meaningless, as it should always give a zero value.</p>
<p>In cases where values associated with areas are <strong>aggregate</strong> values over the area, the assumptions made by area-weighted interpolation or dasymetric mapping – uniformity or constant values over the source areas – are highly unrealistic. In such cases, these simple approaches could still be reasonable approximations, for instance when:</p>
<ul>
<li>the source and target area are nearly identical</li>
<li>the variability inside source units is very small, and the variable is nearly uniform or constant</li>
</ul>
<div style="page-break-after: always;"></div>
<p>In other cases, results obtained using these methods are merely consequences of unjustified assumptions. Statistical aggregation methods that can estimate quantities for larger regions from points or smaller regions include:</p>
<ul>
<li>design-based methods, which require that a probability sample is available from the target region, with known inclusion probabilities <span class="citation" data-cites="brus2021">(<a href="references.html#ref-brus2021" role="doc-biblioref">Brus 2021</a>, <a href="references.html#sec-design" class="quarto-xref" role="doc-biblioref"><span>Section 10.4</span></a>)</span>, and</li>
<li>model-based methods, which assume a random field model with spatially correlated values (block kriging, <a href="12-Interpolation.html#sec-blockkriging" class="quarto-xref"><span>Section 12.5</span></a>)</li>
</ul>
<p></p>
<p>Alternative disaggregation methods include:</p>
<ul>
<li>deterministic, smoothing-based approaches such as kernel- or spline-based smoothing methods <span class="citation" data-cites="toblerpyc martin89">(<a href="references.html#ref-toblerpyc" role="doc-biblioref">Tobler 1979</a>; <a href="references.html#ref-martin89" role="doc-biblioref">Martin 1989</a>)</span>
</li>
<li>statistical, model-based approaches such as area-to-area and area-to-point kriging <span class="citation" data-cites="kyriakidis04 stcos">(<a href="references.html#ref-kyriakidis04" role="doc-biblioref">Kyriakidis 2004</a>; <a href="references.html#ref-stcos" role="doc-biblioref">Raim et al. 2021</a>)</span>.</li>
</ul>
<p></p>
</section><section id="exercises" class="level2" data-number="5.5"><h2 data-number="5.5" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">5.5</span> Exercises</h2>
<p>Where relevant, try to make the following exercises with R.</p>
<ol type="1">
<li>When we add a variable to the <code>nc</code> dataset by <code>nc$State = "North Carolina"</code> (i.e., all counties get assigned the same state name). Which value would you attach to this variable for the attribute-geometry relationship (agr)?</li>
<li>Create a new <code>sf</code> object from the geometry obtained by <code>st_union(nc)</code>, and assign <code>"North Carolina"</code> to the variable <code>State</code>. Which <code>agr</code> can you now assign to this attribute variable?</li>
<li>Use <code>st_area</code> to add a variable with name <code>area</code> to <code>nc</code>. Compare the <code>area</code> and <code>AREA</code> variables in the <code>nc</code> dataset. What are the units of <code>AREA</code>? Are the two linearly related? If there are discrepancies, what could be the cause?</li>
<li>Is the <code>area</code> variable intensive or extensive? Is its agr equal to <code>constant</code>, <code>identity</code> or <code>aggregate</code>?</li>
<li>Consider <a href="#fig-awiex" class="quarto-xref">Figure&nbsp;<span>5.3</span></a>: using the equations in <a href="#sec-extensiveintensive" class="quarto-xref"><span>Section 5.3.1</span></a>, compute the area-weighted interpolations for (a) the dashed cell and (b) for the square enclosing all four solid cells, first for the case where the four cells represent (i) an extensive variable, and (ii) an intensive variable. The red numbers are the data values of the source areas.</li>
</ol>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html">st_make_grid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="st">"LINESTRING(0 0,1 1)"</span><span class="op">)</span><span class="op">)</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.125</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html">text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.8</span>, <span class="fl">.2</span>, <span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.8</span>, <span class="fl">.8</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">8</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-awiex" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-awiex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="05-Attributes_files/figure-html/fig-awiex-1.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-awiex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5.3: Example data for area-weighted interpolation
</figcaption></figure>
</div>
</div>
</div>
<!--
* Find the name of the county that contains `POINT(-78.34046 35.017)`
* Find the names of all counties with boundaries that touch county `Sampson`.
* List the names of all counties that are less than 50 km away from county `Sampson`.
-->


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-brus2021" class="csl-entry" role="listitem">
Brus, Dick J. 2021. <span>“Statistical Approaches for Spatial Sample Survey: Persistent Misconceptions and New Developments.”</span> <em>European Journal of Soil Science</em> 72 (2): 686–703. <a href="https://doi.org/10.1111/ejss.12988">https://doi.org/10.1111/ejss.12988</a>.
</div>
<div id="ref-Collins13" class="csl-entry" role="listitem">
Collins, Sarah N., Robert S. James, Pallav Ray, Katherine Chen, Angie Lassman, and James Brownlee. 2013. <span>“Grids in Numerical Weather and Climate Models.”</span> In <em>Climate Change and Regional/Local Responses</em>, edited by Yuanzhi Zhang and Pallav Ray. Rijeka: IntechOpen. <a href="https://doi.org/10.5772/55922">https://doi.org/10.5772/55922</a>.
</div>
<div id="ref-Do2021" class="csl-entry" role="listitem">
Do, Van Huyen, Thibault Laurent, and Anne Vanhems. 2021. <span>“Guidelines on Areal Interpolation Methods.”</span> In <em>Advances in Contemporary Statistics and Econometrics: Festschrift in Honor of Christine Thomas-Agnan</em>, edited by Abdelaati Daouia and Anne Ruiz-Gazen, 385–407. Cham: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-030-73249-3_20">https://doi.org/10.1007/978-3-030-73249-3_20</a>.
</div>
<div id="ref-thomas" class="csl-entry" role="listitem">
Do, Van Huyen, Christine Thomas-Agnan, and Anne Vanhems. 2015a. <span>“Accuracy of Areal Interpolation Methods for Count Data.”</span> <em>Spatial Statistics</em> 14: 412–38. <a href="https://doi.org/10.1016/j.spasta.2015.07.005">https://doi.org/10.1016/j.spasta.2015.07.005</a>.
</div>
<div id="ref-do" class="csl-entry" role="listitem">
———. 2015b. <span>“Spatial Reallocation of Areal Data: A Review.”</span> <em>Rev. Econ. Rég. Urbaine</em> 1/2: 27–58. <a href="https://www.tse-fr.eu/sites/default/files/medias/doc/wp/mad/wp_tse_397_v2.pdf">https://www.tse-fr.eu/sites/default/files/medias/doc/wp/mad/wp_tse_397_v2.pdf</a>.
</div>
<div id="ref-goodchild" class="csl-entry" role="listitem">
Goodchild, Michael F, and Nina Siu Ngan Lam. 1980. <em>Areal Interpolation: A Variant of the Traditional Spatial Problem</em>. Department of Geography, University of Western Ontario London, ON, Canada.
</div>
<div id="ref-Haltiner" class="csl-entry" role="listitem">
Haltiner, G. J., and R. T. Williams. 1980. <em>Numerical Prediction and Dynamic Meteorology</em>. New York: John Wiley; Sons.
</div>
<div id="ref-conservative" class="csl-entry" role="listitem">
Jones, Philip W. 1999. <span>“First- and Second-Order Conservative Remapping Schemes for Grids in Spherical Coordinates.”</span> <em>Mon. Wea. Rev.</em> 127: 2204–10. <a href="https://doi.org/%2010.1175/1520-0493(1999)%20">https://doi.org/ 10.1175/1520-0493(1999) </a>.
</div>
<div id="ref-kyriakidis04" class="csl-entry" role="listitem">
Kyriakidis, P. C. 2004. <span>“A Geostatistical Framework for Areal-to-Point Spatial Interpolation.”</span> <em>Geographical Analysis</em> 36: 259–89.
</div>
<div id="ref-martin89" class="csl-entry" role="listitem">
Martin, D. 1989. <span>“Mapping Population Data from Zone Centroid Locations.”</span> <em>Transactions of the Institute of British Geographers, New Series</em> 14: 90–97.
</div>
<div id="ref-mennis" class="csl-entry" role="listitem">
Mennis, Jeremy. 2003. <span>“Generating Surface Models of Population Using Dasymetric Mapping.”</span> <em>The Professional Geographer</em> 55 (1): 31–42.
</div>
<div id="ref-stcos" class="csl-entry" role="listitem">
Raim, A. M., S. H. Holan, J. R. Bradley, and C. K. Wikle. 2021. <span>“Spatio-Temporal Change of Support Modeling with r.”</span> <em>Computational Statistics</em> 36: 749–80. <a href="https://doi.org/%2010.1007/s00180-020-01029-4%20">https://doi.org/ 10.1007/s00180-020-01029-4 </a>.
</div>
<div id="ref-scheider2016" class="csl-entry" role="listitem">
Scheider, Simon, Benedikt Gräler, Edzer Pebesma, and Christoph Stasch. 2016. <span>“Modeling Spatiotemporal Information Generation.”</span> <em>International Journal of Geographical Information Science</em> 30 (10): 1980–2008. <a href="https://doi.org/10.1080/13658816.2016.1151520">https://doi.org/10.1080/13658816.2016.1151520</a>.
</div>
<div id="ref-stasch2014" class="csl-entry" role="listitem">
Stasch, Christoph, Simon Scheider, Edzer Pebesma, and Werner Kuhn. 2014. <span>“Meaningful Spatial Prediction and Aggregation.”</span> <em>Environmental Modelling &amp; Software</em> 51: 149–65. <a href="https://doi.org/10.1016/j.envsoft.2013.09.006">https://doi.org/10.1016/j.envsoft.2013.09.006</a>.
</div>
<div id="ref-toblerpyc" class="csl-entry" role="listitem">
Tobler, W. R. 1979. <span>“Smooth Pycnophylactic Interpolation for Geographical Regions.”</span> <em>Journal of the American Statistical Association</em> 74: 519–30.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-spatial\.org\/book\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./04-Spherical.html" class="pagination-link" aria-label="Spherical Geometries">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06-Cubes.html" class="pagination-link" aria-label="Data Cubes">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb9" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Attributes and Support {#sec-featureattributes}</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>\index{support}</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>\index{geometry!support}</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>Feature _attributes_ refer to the properties of features ("things")</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>that do not describe the feature's geometry. Feature attributes can</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>be _derived_ from geometry (such as length of a <span class="in">`LINESTRING`</span> or area</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>of a <span class="in">`POLYGON`</span>), but they can also refer to non-derived properties,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>such as:</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>name of a street or county</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>number of people living in a country</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>type of a road</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>soil type in a polygon from a soil map</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>opening hours of a shop</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>body weight or heart beat rate of an animal</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>NO$_2$ concentration measured at an air quality monitoring station</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>In some cases, time properties can be seen as attributes of</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>features, for instance the date of birth of a person or the construction</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>year of a road. When an attribute such as for instance air quality</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>is a function of both space and time, time is best handled on</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>equal footing with geometry (often in a data cube, see </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>@sec-datacube).</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>Spatial data science software implementing simple features</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>typically organises data in tables that contain both geometries and</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>attributes for features; this is true for <span class="in">`geopandas`</span> in Python,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="in">`PostGIS`</span> tables in PostgreSQL, and <span class="in">`sf`</span> objects in R.  The geometric</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>operations described in @sec-opgeom operate</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>on geometries _only_, and may occasionally yield new attributes</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>(predicates, measures, or transformations), but they do not operate</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>on attributes present.</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>When, while manipulating geometries, attribute _values_ are retained</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>unmodified, support problems may arise.</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>If we look into a simple case of replacing a county polygon with</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>the centroid of that polygon on a dataset that has attributes,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>we see that R package **sf** issues a warning:</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-countycentroid, cache = FALSE, echo = !knitr::is_latex_output()}</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf) |&gt; suppressPackageStartupMessages()</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr) |&gt; suppressPackageStartupMessages()</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="in">system.file("gpkg/nc.gpkg", package="sf") |&gt;</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="in">    read_sf() |&gt;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="in">    st_transform(32119) |&gt;</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="in">    select(BIR74, SID74, NAME) |&gt;</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="in">    st_centroid() -&gt; x</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>The reason for this is that the dataset contains variables with</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>values that are associated with entire polygons -- in this case</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>population counts -- meaning they are not associated with a</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="in">`POINT`</span> geometry replacing the polygon.</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>\index{warning!assumes attributes are constant over geometries of x}</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>In @sec-support we already described that for non-point</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>geometries (lines, polygons), feature attribute values either</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>have _point support_, meaning that the value applies to _every</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>point_, or they have _block support_, meaning that the value</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>_summarises all points_ in the geometry. (Other options,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>non-point support smaller than the geometry, or support larger</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>than the associated geometry, may also occur.) This chapter</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>will describe different ways in which an attribute may relate to</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>the geometry, its consequences on analysing such data, and ways to</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>derive attribute data for different geometries (up- and downscaling).</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>\index{support!point}</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>\index{support!block}</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>\index{support!upscaling}</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>\index{support!downscaling}</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Attribute-geometry relationships and support {#sec-agr}</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>\index{attribute-geometry relationship}</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>\index{geometry!relationship to attribute}</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>agr}</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>Changing the feature geometry without changing the feature attributes</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>does change the _feature_, since the feature is characterised by</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>the combination of geometry and attributes. Can we, ahead of time,</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>predict whether the resulting feature will still meaningfully relate</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>to the attribute value when we replace all geometries for instance</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>with their convex hull or centroid? It depends.</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>Take the example of a road, represented by a <span class="in">`LINESTRING`</span>, which has</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>an attribute property _road width_ equal to 10 m. What can we say about</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>the road width of an arbitrary sub-section of this road? That depends</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>on whether the attribute road length describes, for instance the</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>road width _everywhere_, meaning that road width is constant along the</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>road, or whether it describes an aggregate property, such as minimum</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>or average road width.  In case of the minimum, for an arbitrary</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>subsection of the road one could still argue that the minimum</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>road width must be at least as large as the minimum road width for</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>the whole segment, but it may no longer be _the minimum_ for that</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>subsection. This gives us two "types" for the attribute-geometry</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>relationship (**AGR**):</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**constant** the attribute value is valid everywhere in or over the</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>geometry; we can think of the feature as consisting of an infinite</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>number of points that all have this attribute value; in geostatistical</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>terminology this is known as a variable with _point support_</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**aggregate** the attribute is an aggregate, a summary value over</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>the geometry; we can think of the feature as a _single_ observation</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>with a value that is associated with the _entire_ geometry; this is</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>also known as a variable having _block support_</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>\index{attribute-geometry relationship!constant}</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>\index{attribute-geometry relationship!aggregate}</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>For polygon data, typical examples of **constant** AGR (point</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>support) variables are:</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>land use for a land use polygon</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>rock units or geologic strata in a geological map</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>soil type in a soil map</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>elevation class in an elevation map that shows elevation as classes</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>climate zone in a climate zone map</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>A typical property of such variables is that they have geometries</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>that are not man-made and also not associated with a sensor device</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>(such as remote sensing image pixel boundaries). Instead, the geometry</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>follows from mapping the variable observed.</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>Examples for the **aggregate** AGR (block support) variables are:</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>population, either as number of persons or as population density</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>other socio-economic variables, summarised by area</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>average reflectance over a remote sensing pixel</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>total emission of pollutants by region</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>block mean NO$_2$ concentrations, such as obtained by block kriging </span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>  over square blocks (@sec-blockkriging) or by a dispersion model that</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>  predicts areal means</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>A typical property of such variables is that associated geometries</span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>come for instance from legislation, observation devices or analysis</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>choices, but not intrinsically from the observed variable.</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>\index{attribute-geometry relationship!identity}</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>A third type of AGR arises when an attribute _identifies_ a feature</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>geometry; we call an attribute an **identity** variable when</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>the associated geometry uniquely identifies the variable's value</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>(there are no other geometries with the same value). An example is</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>county name: the name identifies the county, and is still the county</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>for any sub-area (point support), but for arbitrary sub-areas, the</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>attributes loses the **identity** property to become a **constant**</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>attribute. An example is:</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>an arbitrary point (or region) inside a county is still part of the</span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>county and must have the same value for county name, but it no</span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>longer identifies the (entire) geometry corresponding to that county</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>The challenge here is that spatial information (ignoring time for</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>simplicity) belongs to different phenomena types <span class="co">[</span><span class="ot">@scheider2016</span><span class="co">]</span>,</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>including:</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**fields**: where over _continuous_ space, every location corresponds to a single value, examples including elevation, air quality, or land use</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**objects**: found at a _discrete_ set of locations, such as houses, trees, or persons</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**aggregates**: values arising as spatial sums, totals, or averages of fields, counts or densities of objects, associated with lines or regions</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>\index{fields}</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>\index{objects}</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>\index{aggregates}</span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>but that different spatial geometry types (points, lines, polygons,</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>raster cells) have no simple mapping to these phenomena types:</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>points may refer to sample locations of observations on fields (air quality) or to locations of objects</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>lines may be used for objects (roads, rivers), contours of a field, or administrative borders</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>raster pixels and polygons may reflect fields of a categorical</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>variable such as land use (_coverage_), but also aggregates such</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>as population density</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>raster or other mesh triangulations may have different variables</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>associated with nodes (points), edges (lines), or faces</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>(areas, cells), for instance when partial differential equations</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>are approximated using _staggered grids_ <span class="co">[</span><span class="ot">@Haltiner; @Collins13</span><span class="co">]</span></span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>Properly specifying attribute-geometry relationships, and warning</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>against their absence or cases when change in geometry (change</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>of support) implies a change of information can help to avoid a</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>large class of common spatial data analysis mistakes <span class="co">[</span><span class="ot">@stasch2014</span><span class="co">]</span></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>associated with the _support_ of spatial data.</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a><span class="fu">## Aggregating and summarising</span></span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>Aggregating records in a table (or <span class="in">`data.frame`</span>) involves two steps:</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>grouping records based on a grouping predicate, and</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>applying an aggregation function to the attribute values of a</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>group to summarise them into a single number.</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>In SQL, this looks for instance like</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a><span class="in">SELECT GroupID, SUM(population) FROM table GROUP BY GroupID;</span></span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>indicating the aggregation _function_ (<span class="in">`SUM`</span>) and the</span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>_grouping predicate_ (<span class="in">`GroupID`</span>). </span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>R package **dplyr** for instance uses two steps to accomplish this:</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>function <span class="in">`group_by`</span> specifies the group membership of records,</span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a><span class="in">`summarise`</span> computes data summaries (such as <span class="in">`sum`</span> or <span class="in">`mean`</span>)</span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>for each of the groups. The (base) R method <span class="in">`aggregate`</span> combines</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>both in a single function call that takes the table, the grouping</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>predicate(s), and the aggregation function(s) as arguments.</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>An example for the North Carolina counties is shown in</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>@fig-ncaggregation. Here, we grouped counties by their position</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>(according to the quadrant in which the county centroid is with</span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>respect to ellipsoidal coordinate <span class="in">`POINT(-79, 35.5)`</span>) and summed</span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>the number of disease cases per group. The result shows that</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>the geometries of the resulting groups have been unioned </span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>(@sec-bintrans): this is necessary because the <span class="in">`MULTIPOLYGON`</span></span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>formed by just putting all the county geometries together would</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>have many duplicate boundaries, and hence would not be _valid_</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>(@sec-valid).</span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-ncaggregation, echo = !knitr::is_latex_output()}</span></span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "SID74 total incidences aggregated to four areas"</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.height: 4</span></span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a><span class="in">nc &lt;- read_sf(system.file("gpkg/nc.gpkg", package = "sf"))</span></span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a><span class="in"># encode quadrant by two logicals:</span></span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a><span class="in">nc$lng &lt;- st_coordinates(st_centroid(st_geometry(nc)))[,1] &gt; -79</span></span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a><span class="in">nc$lat &lt;- st_coordinates(st_centroid(st_geometry(nc)))[,2] &gt; 35.5</span></span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a><span class="in">nc.grp &lt;- aggregate(nc["SID74"], list(nc$lng, nc$lat), sum)</span></span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a><span class="in">nc.grp["SID74"] |&gt; st_transform('EPSG:32119') |&gt;</span></span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a><span class="in">  plot(graticule = TRUE, axes = TRUE)</span></span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>Plotting collated county polygons is technically not a problem, but</span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>for this case would raise the wrong suggestion that the group sums</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>relate to individual counties, rather than to the grouped counties.</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>One particular property of aggregation in this way is that each</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>record is assigned to a single group; this has the advantage that</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>the sum of the group-wise sums equals the sum of the un-grouped data:</span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>for variables that reflect _amount_, nothing gets lost and nothing</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>is added. The newly formed geometry is the result of unioning the</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>geometries of the contributing records.</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-ncblocks, echo=!knitr::is_latex_output()}</span></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Example target blocks plotted over North Carolina counties"</span></span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a><span class="in">nc &lt;- st_transform(nc, 2264)</span></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a><span class="in">gr &lt;- st_sf(</span></span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a><span class="in">   label = apply(expand.grid(1:10, LETTERS[10:1])[,2:1], 1, paste0, collapse = " "),</span></span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a><span class="in">   geom = st_make_grid(nc))</span></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_geometry(nc), reset = FALSE, border = 'grey')</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_geometry(gr), add = TRUE)</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>When we need an aggregate for a new area that is _not_ a union of the</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>geometries for a group of records, and we use a spatial predicate,</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>then single records may be matched to multiple groups. When taking</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>the rectangles of @fig-ncblocks as the target areas,</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>and summing for each rectangle the disease cases of the counties</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>that _intersect_ with the rectangles of @fig-ncblocks,</span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>the sum of these will be much larger:</span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-aggnc, echo=!knitr::is_latex_output()}</span></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a><span class="in">a &lt;- aggregate(nc["SID74"], gr, sum)</span></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a><span class="in">c(sid74_sum_counties = sum(nc$SID74),</span></span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a><span class="in">  sid74_sum_rectangles = sum(a$SID74, na.rm = TRUE))</span></span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>Choosing another predicate, such as _contains_ or _covers_, would on</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>the contrary result in much smaller values, because many counties</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>are not contained by _any_ of the target geometries. However, there are</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>a few cases where this approach might be good or satisfactory:</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>when we want to aggregate <span class="in">`POINT`</span> geometries by a set of polygons,</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>and all points are contained by a single polygon. If points fall on a</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>shared boundary than they are assigned to both polygons (this is</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>the case for DE-9IM-based GEOS library; the s2geometry library has</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>the option to define polygons as "semi-open", which implies that</span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>points are assigned to maximally one polygon when polygons do not</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>overlap)</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>when aggregating many very small polygons or raster pixels over</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>larger areas, for instance _averaging_ altitude from a 30 m resolution raster</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>over North Carolina counties, the error made by multiple matches</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>may be insignificant</span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>when the many-to-many match is reduced to the single largest area</span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>match, as shown in @fig-largest</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>A more comprehensive approach to aggregating spatial data associated</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>with areas to larger, arbitrary shaped areas is by using area-weighted</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>interpolation.</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a><span class="fu">## Area-weighted interpolation {#sec-area-weighted}</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>\index{area-weighted interpolation}</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>\index{interpolation!area-weighted}</span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>\index{conservative region aggregation}</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>\index{conservative region regridding}</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>When we want to combine geometries and attributes of two datasets</span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>such that we get attribute values of a source dataset summarised for</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>the geometries of a target, where source and target geometries are</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>unrelated, area-weighted interpolation may be a simple approach. In</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>effect, it considers the area of overlap of the source and target</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>geometries, and uses that to weigh the source attribute values into</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>the target value <span class="co">[</span><span class="ot">@goodchild; @thomas; @do; @Do2021</span><span class="co">]</span>.  This method</span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>is also known as conservative region aggregation or regridding</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@conservative</span><span class="co">]</span>. Here, we follow the notation of @do.</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>Area-weighted interpolation computes, for each of $q$ spatial target</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>areas $T_j$, a weighted average from the values $Y_i$ corresponding</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>to the $p$ spatial source areas $S_i$,</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>\hat{Y}_j(T_j) = \sum_{i=1}^p w_{ij} Y_i(S_i)</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>$$ {#eq-aw}</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>where the $w_{ij}$ depend on the amount of overlap of $T_j$ and</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>$S_i$, and the amount of overlap is $A_{ij} = T_j \cap S_i$. How</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>$w_{ij}$ depends on $A_{ij}$ is discussed below.</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>Different options exist for choosing weights, including methods</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>using external variables <span class="co">[</span><span class="ot">including dasymetric mapping, @mennis</span><span class="co">]</span>.</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>Two simple approaches for computing weights that do not use external</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>variables arise, depending on whether the variable $Y$ is _intensive_</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>or _extensive_.</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatially extensive and intensive variables {#sec-extensiveintensive}</span></span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>\index{extensive properties}</span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>\index{intensive properties}</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>Extensive variables correspond to amounts, associated with a</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>physical size (length, area, volume, counts of items).  An example</span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>of a extensive variable is _population count_. It is associated with</span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>an area, and if that area is cut into smaller areas, the population</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>count needs to be split too.  Because population is rarely uniform</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>over space, this does not need to be done proportionally to the</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>smaller areas but the sum of the population count for the smaller</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>areas needs to equal that of the total.  Intensive variables are</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>variables that do not have values proportional to support: if the</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>area is split, values may vary but _on average_ remain the same.</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>An example of a related variable that is _intensive_ is population</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>density. If an area is split into smaller areas, population density</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>is not split similarly: the _sum_ of population densities for the</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>smaller areas is a meaningless measure, as opposed to the _average_</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>of the population densities which will be similar to the density</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>of the total area.</span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>When we assume that the **extensive** variable $Y$ is uniformly</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>distributed over space, the value $Y_{ij}$, derived from $Y_i$</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>for a sub-area of $S_i$, $A_{ij} = T_j \cap S_i$ of $S_i$ is</span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>$$\hat{Y}_{ij}(A_{ij}) = \frac{|A_{ij}|}{|S_i|} Y_i(S_i)$$</span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>where $|\cdot|$ denotes the spatial area.</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>For estimating $Y_j(T_j)$ we sum all the elements over area $T_j$:</span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>\hat{Y}_j(T_j) = \sum_{i=1}^p \frac{|A_{ij}|}{|S_i|} Y_i(S_i)</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>$$ {#eq-awextensive}</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>For an **intensive** variable, under the assumption that the variable</span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>has a constant value over each area $S_i$, the estimate for a</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a>sub-area equals that of the total area,</span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>$$\hat{Y}_{ij} = Y_i(S_i)$$</span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a>and we can estimate the value of $Y$ for a new spatial unit $T_j$</span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>by an area-weighted average of the source values:</span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>\hat{Y}_j(T_j) = \sum_{i=1}^p \frac{|A_{ij}|}{|T_j|} Y_i(S_i)</span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>$$ {#eq-awintensive}</span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dasymetric mapping</span></span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>\index{dasymetric mapping}</span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>Dasymetric mapping distributes variables, such as population,</span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>known at a coarse spatial aggregation level over finer spatial</span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a>units by using other variables that are associated with population</span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a>distribution, such as land use, building density, or road density.</span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a>The simplest approach to dasymetric mapping is obtained for</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>extensive variables, where the ratio $|A_{ij}| / |S_i|$ in</span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a>@eq-awextensive is replaced by the ratio of another extensive</span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a>variable $X_{ij}(S_{ij})/X_i(S_i)$, which has to be known for both</span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a>the intersecting regions $S_{ij}$ and the source regions $S_i$.</span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>@do discuss several alternatives for intensive $Y$ and/or $X$,</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a>and cases where $X$ is known for other areas.</span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a><span class="fu">### Support in file formats</span></span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a>\index{support!in file formats}</span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a>GDAL's vector API supports reading and writing so-called field</span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a>domains, which can have a "split policy" and a "merge policy"</span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a>indicating what should be done with attribute variables when</span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a>geometries are split or merged. The values of these can be</span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a>"duplicate" for split and "geometry weighted" for merge, in</span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a>case of spatially intensive variables, or they can be "geometry</span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a>ratio" for split and "sum" for merge, in case of spatially</span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a>extensive variables.  At the time of writing this, the [file</span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a>formats supporting this](https://github.com/OSGeo/gdal/pull/3638)</span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a>are GeoPackage and FileGDB.</span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Up- and Downscaling {#sec-updownscaling}</span></span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a>\index{upscaling}</span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a>\index{downscaling}</span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a>Up- and downscaling refers in general to obtaining high-resolution</span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a>information from low-resolution data (downscaling) or obtaining</span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a>low-resolution information from high-resolution data (upscaling).</span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a>Both activities involve the attributes' relation to geometries and</span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a>both change support. They are synonymous with aggregation (upscaling)</span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a>and disaggregation (downscaling).  The simplest form of downscaling</span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a>is sampling (or extracting) polygon, line or grid cell values at</span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a>point locations. This works well for variables with point-support</span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a>("constant" AGR), but is at best approximate when the values are</span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a>aggregates.  Challenging applications for downscaling include</span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a>high-resolution prediction of variables obtained by low-resolution</span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a>weather prediction models or climate change models, and the</span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a>high-resolution prediction of satellite image derived variables</span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a>based on the fusion of sensors with different spatial and temporal</span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a>resolutions.</span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a>The application of areal interpolation using (@eq-aw) with</span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a>its realisations for extensive (@eq-awextensive) and intensive</span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a>(@eq-awintensive) variables allows moving information from any</span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>source area $S_i$ to any target area $T_j$ as long as the two areas</span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>have some overlap. This means that one can go arbitrarily to much</span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a>larger units (aggregation) or to much smaller units (disaggregation).</span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a>Of course this makes only sense to the extent that the assumptions</span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a>hold: over the source regions extensive variables need to be</span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a>uniformly distributed and intensive variables need to have a</span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a>constant value.</span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a>The ultimate disaggregation involves retrieving (extracting)</span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a>point values from line or area data. For this, we cannot work with</span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a>equations -@eq-awextensive or -@eq-awintensive because</span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a>$|A_{ij}| = 0$ for points, but under the assumption of having a</span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a>constant value over the geometry, for intensive variables the value</span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>$Y_i(S_i)$ can be assigned to points as long as all points can be</span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a>uniquely assigned to a single source area $S_i$. For polygon data,</span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>this implies that $Y$ needs to be a coverage variable (@sec-coverages).</span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a>For extensive variables, extracting a value at a point is rather</span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a>meaningless, as it should always give a zero value.</span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a>In cases where values associated with areas are **aggregate** values</span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a>over the area, the assumptions made by area-weighted interpolation</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>or dasymetric mapping -- uniformity or constant values over the</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a>source areas -- are highly unrealistic. In such cases, these simple</span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a>approaches could still be reasonable approximations, for instance when:</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the source and target area are nearly identical</span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the variability inside source units is very small, and the variable</span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a>is nearly uniform or constant</span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a>In other cases, results obtained using these methods are merely</span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a>consequences of unjustified assumptions. Statistical aggregation</span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>methods that can estimate quantities for larger regions from points</span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a>or smaller regions include:</span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>design-based methods, which require that a probability sample is</span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a>available from the target region, with known inclusion probabilities</span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@brus2021, @sec-design</span><span class="co">]</span>, and</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>model-based methods, which assume a random field model with spatially</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a>correlated values (block kriging, @sec-blockkriging)</span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a>\index{kriging!block}</span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a>Alternative disaggregation methods include:</span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>deterministic, smoothing-based approaches such as kernel- or spline-based</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a>smoothing methods <span class="co">[</span><span class="ot">@toblerpyc; @martin89</span><span class="co">]</span></span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>statistical, model-based approaches such as area-to-area and</span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>area-to-point kriging <span class="co">[</span><span class="ot">@kyriakidis04; @stcos</span><span class="co">]</span>.</span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>\index{interpolation!area-to-area}</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>Where relevant, try to make the following exercises with R.</span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>When we add a variable to the <span class="in">`nc`</span> dataset by `nc$State =</span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>"North Carolina"` (i.e., all counties get assigned the same state</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a>name). Which value would you attach to this variable for the</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>attribute-geometry relationship (agr)?</span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Create a new <span class="in">`sf`</span> object from the geometry obtained by</span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a><span class="in">`st_union(nc)`</span>, and assign <span class="in">`"North Carolina"`</span> to the variable</span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a><span class="in">`State`</span>. Which <span class="in">`agr`</span> can you now assign to this attribute variable?</span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Use <span class="in">`st_area`</span> to add a variable with name <span class="in">`area`</span> to <span class="in">`nc`</span>. Compare</span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>the <span class="in">`area`</span> and <span class="in">`AREA`</span> variables in the <span class="in">`nc`</span> dataset. What are</span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>the units of <span class="in">`AREA`</span>? Are the two linearly related? If there are</span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a>discrepancies, what could be the cause?</span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Is the <span class="in">`area`</span> variable intensive or extensive? Is its agr equal to</span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a><span class="in">`constant`</span>, <span class="in">`identity`</span> or <span class="in">`aggregate`</span>?</span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Consider @fig-awiex: using the equations in </span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>@sec-extensiveintensive, compute the area-weighted interpolations</span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a>for (a) the dashed cell and (b) for the square enclosing all four solid</span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>cells, first for the case where the four cells represent (i) an extensive</span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a>variable, and (ii) an intensive variable. The red numbers are the</span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>data values of the source areas.</span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-awiex, echo = !knitr::is_latex_output()}</span></span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 40%</span></span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Example data for area-weighted interpolation"</span></span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a><span class="in">g &lt;- st_make_grid(st_bbox(st_as_sfc("LINESTRING(0 0,1 1)")), n = c(2,2))</span></span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(0,4))</span></span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a><span class="in">plot(g)</span></span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a><span class="in">plot(g[1] * diag(c(3/4, 1)) + c(0.25, 0.125), add = TRUE, lty = 2)</span></span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a><span class="in">text(c(.2, .8, .2, .8), c(.2, .2, .8, .8), c(1,2,4,8), col = 'red')</span></span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--</span></span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a><span class="co">* Find the name of the county that contains `POINT(-78.34046 35.017)`</span></span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a><span class="co">* Find the names of all counties with boundaries that touch county `Sampson`.</span></span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a><span class="co">* List the names of all counties that are less than 50 km away from county `Sampson`.</span></span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a><span class="co">--&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/sdsr/edit/main/05-Attributes.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>