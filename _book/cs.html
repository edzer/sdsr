<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Coordinates | Spatial Data Science</title>
  <meta name="description" content="description_xx" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Coordinates | Spatial Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="description_xx" />
  <meta name="github-repo" content="edzer/sdsr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Coordinates | Spatial Data Science" />
  
  <meta name="twitter:description" content="description_xx" />
  

<meta name="author" content="Edzer Pebesma, Roger Bivand" />


<meta name="date" content="2021-07-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="geometries.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    // close the dropdown menu when an option is clicked
    $("#allCodeButton").dropdown("toggle");
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // if code block has been labeled with class `fold-show`, show the code on init!
    var classList = $(this).attr('class').split(/\s+/);
    for (var i = 0; i < classList.length; i++) {
    if (classList[i] === 'fold-show') {
        show = true;
      }
    }

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // hack: return show to false, otherwise all next codeBlocks will be shown!
    show = false;

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn {
  margin-bottom: 4px;
}

.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}

.open > .dropdown-menu {
    display: block;
    color: #ffffff;
    background-color: #ffffff;
    background-image: none;
    border-color: #92897e;
}

.dropdown-menu > li > a {
  display: block;
  padding: 3px 20px;
  clear: both;
  font-weight: 400;
  line-height: 1.42857143;
  color: #000000;
  white-space: nowrap;
}

.dropdown-menu > li > a:hover,
.dropdown-menu > li > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
}

.dropdown-menu > .active > a,
.dropdown-menu > .active > a:hover,
.dropdown-menu > .active > a:focus {
  color: #ffffff;
  text-decoration: none;
  background-color: #e95420;
  outline: 0;
}
.dropdown-menu > .disabled > a,
.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  color: #aea79f;
}

.dropdown-menu > .disabled > a:hover,
.dropdown-menu > .disabled > a:focus {
  text-decoration: none;
  cursor: not-allowed;
  background-color: transparent;
  background-image: none;
  filter: progid:DXImageTransform.Microsoft.gradient(enabled = false);
}

.btn {
  display: inline-block;
  margin-bottom: 1;
  font-weight: normal;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  -ms-touch-action: manipulation;
      touch-action: manipulation;
  cursor: pointer;
  background-image: none;
  border: 1px solid transparent;
  padding: 4px 8px;
  font-size: 14px;
  line-height: 1.42857143;
  border-radius: 4px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.btn:focus,
.btn:active:focus,
.btn.active:focus,
.btn.focus,
.btn:active.focus,
.btn.active.focus {
  outline: 5px auto -webkit-focus-ring-color;
  outline-offset: -2px;
}
.btn:hover,
.btn:focus,
.btn.focus {
  color: #ffffff;
  text-decoration: none;
}
.btn:active,
.btn.active {
  background-image: none;
  outline: 0;
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn.disabled,
.btn[disabled],
fieldset[disabled] .btn {
  cursor: not-allowed;
  filter: alpha(opacity=65);
  opacity: 0.65;
  box-shadow: none;
}
a.btn.disabled,
fieldset[disabled] a.btn {
  pointer-events: none;
}
.btn-default {
  color: #ffffff;
  background-color: #aea79f; #important
  border-color: #aea79f;
}

.btn-default:focus,
.btn-default.focus {
  color: #ffffff;
  background-color: #978e83;
  border-color: #6f675e;
}

.btn-default:hover {
  color: #ffffff;
  background-color: #978e83;
  border-color: #92897e;
}
.btn-default:active,
.btn-default.active,
.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
  border-radius: 0;
}
.btn-group > .btn:first-child {
  margin-left: 0;
}
.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn:last-child:not(:first-child),
.btn-group > .dropdown-toggle:not(:first-child) {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group > .btn-group {
  float: left;
}
.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
  border-radius: 0;
}
.btn-group > .btn-group:first-child:not(:last-child) > .btn:last-child,
.btn-group > .btn-group:first-child:not(:last-child) > .dropdown-toggle {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}
.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.btn-group .dropdown-toggle:active,
.btn-group.open .dropdown-toggle {
  outline: 0;
}
.btn-group > .btn + .dropdown-toggle {
  padding-right: 8px;
  padding-left: 8px;
}
.btn-group > .btn-lg + .dropdown-toggle {
  padding-right: 12px;
  padding-left: 12px;
}
.btn-group.open .dropdown-toggle {
  box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
}
.btn-group.open .dropdown-toggle.btn-link {
  box-shadow: none;
}

</style>
<script>
var str = '<div class="btn-group pull-right" style="position: fixed; right: 50px; top: 10px; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" id="allCodeButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All Code</a></li><li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li></ul></div>';
document.write(str);
</script>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="part"><span><b>I Spatial Data</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#a-first-map"><i class="fa fa-check"></i><b>1.1</b> A first map</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>1.2</b> Coordinate reference systems</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#rasterize"><i class="fa fa-check"></i><b>1.3</b> Raster and vector data</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#raster-types"><i class="fa fa-check"></i><b>1.4</b> Raster types</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#time-series-arrays-data-cubes"><i class="fa fa-check"></i><b>1.5</b> Time series, arrays, data cubes</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#support"><i class="fa fa-check"></i><b>1.6</b> Support</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#spatial-data-science-software"><i class="fa fa-check"></i><b>1.7</b> Spatial data science software</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cs.html"><a href="cs.html"><i class="fa fa-check"></i><b>2</b> Coordinates</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cs.html"><a href="cs.html#units"><i class="fa fa-check"></i><b>2.1</b> Quantities, units, datum</a></li>
<li class="chapter" data-level="2.2" data-path="cs.html"><a href="cs.html#ellipsoidal-coordinates"><i class="fa fa-check"></i><b>2.2</b> Ellipsoidal coordinates</a></li>
<li class="chapter" data-level="2.3" data-path="cs.html"><a href="cs.html#crs"><i class="fa fa-check"></i><b>2.3</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#proj"><i class="fa fa-check"></i><b>2.4</b> PROJ and mapping accuracy</a></li>
<li class="chapter" data-level="2.5" data-path="cs.html"><a href="cs.html#wkt2"><i class="fa fa-check"></i><b>2.5</b> WKT-2</a></li>
<li class="chapter" data-level="2.6" data-path="cs.html"><a href="cs.html#exercises-1"><i class="fa fa-check"></i><b>2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="geometries.html"><a href="geometries.html"><i class="fa fa-check"></i><b>3</b> Geometries</a>
<ul>
<li class="chapter" data-level="3.1" data-path="geometries.html"><a href="geometries.html#simplefeatures"><i class="fa fa-check"></i><b>3.1</b> Simple feature geometries</a></li>
<li class="chapter" data-level="3.2" data-path="geometries.html"><a href="geometries.html#opgeom"><i class="fa fa-check"></i><b>3.2</b> Operations on geometries</a></li>
<li class="chapter" data-level="3.3" data-path="geometries.html"><a href="geometries.html#precision"><i class="fa fa-check"></i><b>3.3</b> Precision</a></li>
<li class="chapter" data-level="3.4" data-path="geometries.html"><a href="geometries.html#coverages"><i class="fa fa-check"></i><b>3.4</b> Coverages: tessellations and rasters</a></li>
<li class="chapter" data-level="3.5" data-path="geometries.html"><a href="geometries.html#networks"><i class="fa fa-check"></i><b>3.5</b> Networks</a></li>
<li class="chapter" data-level="3.6" data-path="geometries.html"><a href="geometries.html#exercises-2"><i class="fa fa-check"></i><b>3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spherical.html"><a href="spherical.html"><i class="fa fa-check"></i><b>4</b> Spherical Geometries</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spherical.html"><a href="spherical.html#straight-lines"><i class="fa fa-check"></i><b>4.1</b> Straight lines</a></li>
<li class="chapter" data-level="4.2" data-path="spherical.html"><a href="spherical.html#ring-direction"><i class="fa fa-check"></i><b>4.2</b> Ring direction</a></li>
<li class="chapter" data-level="4.3" data-path="spherical.html"><a href="spherical.html#full-polygon"><i class="fa fa-check"></i><b>4.3</b> Full polygon</a></li>
<li class="chapter" data-level="4.4" data-path="spherical.html"><a href="spherical.html#bounding-box-rectangle-and-cap"><i class="fa fa-check"></i><b>4.4</b> Bounding box, rectangle, and cap</a></li>
<li class="chapter" data-level="4.5" data-path="spherical.html"><a href="spherical.html#validity-on-the-sphere"><i class="fa fa-check"></i><b>4.5</b> Validity on the sphere</a></li>
<li class="chapter" data-level="4.6" data-path="spherical.html"><a href="spherical.html#exercises-3"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="featureattributes.html"><a href="featureattributes.html"><i class="fa fa-check"></i><b>5</b> Attributes and Support</a>
<ul>
<li class="chapter" data-level="5.1" data-path="featureattributes.html"><a href="featureattributes.html#agr"><i class="fa fa-check"></i><b>5.1</b> Attribute-geometry relationships and support</a></li>
<li class="chapter" data-level="5.2" data-path="featureattributes.html"><a href="featureattributes.html#aggregating-and-summarising"><i class="fa fa-check"></i><b>5.2</b> Aggregating and Summarising</a></li>
<li class="chapter" data-level="5.3" data-path="featureattributes.html"><a href="featureattributes.html#area-weighted"><i class="fa fa-check"></i><b>5.3</b> Area-weighted interpolation</a></li>
<li class="chapter" data-level="5.4" data-path="featureattributes.html"><a href="featureattributes.html#updownscaling"><i class="fa fa-check"></i><b>5.4</b> Up- and Downscaling</a></li>
<li class="chapter" data-level="5.5" data-path="featureattributes.html"><a href="featureattributes.html#exercises-4"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="datacube.html"><a href="datacube.html"><i class="fa fa-check"></i><b>6</b> Data Cubes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="datacube.html"><a href="datacube.html#a-four-dimensional-data-cube"><i class="fa fa-check"></i><b>6.1</b> A four-dimensional data cube</a></li>
<li class="chapter" data-level="6.2" data-path="datacube.html"><a href="datacube.html#dimensions-attributes-and-support"><i class="fa fa-check"></i><b>6.2</b> Dimensions, attributes, and support</a></li>
<li class="chapter" data-level="6.3" data-path="datacube.html"><a href="datacube.html#dcoperations"><i class="fa fa-check"></i><b>6.3</b> Operations on data cubes</a></li>
<li class="chapter" data-level="6.4" data-path="datacube.html"><a href="datacube.html#vectordatacubes"><i class="fa fa-check"></i><b>6.4</b> Aggregating raster to vector cubes</a></li>
<li class="chapter" data-level="6.5" data-path="datacube.html"><a href="datacube.html#switching"><i class="fa fa-check"></i><b>6.5</b> Switching dimension with attributes</a></li>
<li class="chapter" data-level="6.6" data-path="datacube.html"><a href="datacube.html#otherdynamic"><i class="fa fa-check"></i><b>6.6</b> Other dynamic spatial data</a></li>
<li class="chapter" data-level="6.7" data-path="datacube.html"><a href="datacube.html#exercises-5"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II R for Spatial Data Science</b></span></li>
<li class="chapter" data-level="7" data-path="sf.html"><a href="sf.html"><i class="fa fa-check"></i><b>7</b> Introduction to sf and stars</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sf.html"><a href="sf.html#sfintro"><i class="fa fa-check"></i><b>7.1</b> Package <code>sf</code></a></li>
<li class="chapter" data-level="7.2" data-path="sf.html"><a href="sf.html#spatial-joins"><i class="fa fa-check"></i><b>7.2</b> Spatial joins</a></li>
<li class="chapter" data-level="7.3" data-path="sf.html"><a href="sf.html#package-stars"><i class="fa fa-check"></i><b>7.3</b> Package <code>stars</code></a></li>
<li class="chapter" data-level="7.4" data-path="sf.html"><a href="sf.html#vector-data-cube-examples"><i class="fa fa-check"></i><b>7.4</b> Vector data cube examples</a></li>
<li class="chapter" data-level="7.5" data-path="sf.html"><a href="sf.html#raster-to-vector"><i class="fa fa-check"></i><b>7.5</b> raster-to-vector, vector-to-raster</a></li>
<li class="chapter" data-level="7.6" data-path="sf.html"><a href="sf.html#projsf"><i class="fa fa-check"></i><b>7.6</b> Coordinate transformations and conversions</a></li>
<li class="chapter" data-level="7.7" data-path="sf.html"><a href="sf.html#warp"><i class="fa fa-check"></i><b>7.7</b> transforming and warping rasters</a></li>
<li class="chapter" data-level="7.8" data-path="sf.html"><a href="sf.html#exercises-6"><i class="fa fa-check"></i><b>7.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="large.html"><a href="large.html"><i class="fa fa-check"></i><b>8</b> Large data sets</a>
<ul>
<li class="chapter" data-level="8.1" data-path="large.html"><a href="large.html#largesf"><i class="fa fa-check"></i><b>8.1</b> Vector data: <code>sf</code></a></li>
<li class="chapter" data-level="8.2" data-path="large.html"><a href="large.html#raster-data-stars"><i class="fa fa-check"></i><b>8.2</b> Raster data: <code>stars</code></a></li>
<li class="chapter" data-level="8.3" data-path="large.html"><a href="large.html#very-large-data-cubes"><i class="fa fa-check"></i><b>8.3</b> Very large data cubes</a></li>
<li class="chapter" data-level="8.4" data-path="large.html"><a href="large.html#exercises-7"><i class="fa fa-check"></i><b>8.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>9</b> Plotting spatial data</a>
<ul>
<li class="chapter" data-level="9.1" data-path="plotting.html"><a href="plotting.html#transform"><i class="fa fa-check"></i><b>9.1</b> Every plot is a projection</a></li>
<li class="chapter" data-level="9.2" data-path="plotting.html"><a href="plotting.html#plotting-points-lines-polygons-grid-cells"><i class="fa fa-check"></i><b>9.2</b> Plotting points, lines, polygons, grid cells</a></li>
<li class="chapter" data-level="9.3" data-path="plotting.html"><a href="plotting.html#base-plot"><i class="fa fa-check"></i><b>9.3</b> Base <code>plot</code></a></li>
<li class="chapter" data-level="9.4" data-path="plotting.html"><a href="plotting.html#maps-with-ggplot2"><i class="fa fa-check"></i><b>9.4</b> Maps with <code>ggplot2</code></a></li>
<li class="chapter" data-level="9.5" data-path="plotting.html"><a href="plotting.html#tmap"><i class="fa fa-check"></i><b>9.5</b> Maps with <code>tmap</code></a></li>
<li class="chapter" data-level="9.6" data-path="plotting.html"><a href="plotting.html#interactive-maps-leaflet-mapview-tmap"><i class="fa fa-check"></i><b>9.6</b> Interactive maps: <code>leaflet</code>, <code>mapview</code>, <code>tmap</code></a></li>
</ul></li>
<li class="part"><span><b>III Models for Spatial Data</b></span></li>
<li class="chapter" data-level="10" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html"><i class="fa fa-check"></i><b>10</b> Statistical modelling of spatial data</a>
<ul>
<li class="chapter" data-level="10.1" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html#design"><i class="fa fa-check"></i><b>10.1</b> Design-based and model-based inference</a></li>
<li class="chapter" data-level="10.2" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html#predictive-models-with-coordinates"><i class="fa fa-check"></i><b>10.2</b> Predictive models with coordinates</a></li>
<li class="chapter" data-level="10.3" data-path="statistical-modelling-of-spatial-data.html"><a href="statistical-modelling-of-spatial-data.html#model-based-inference"><i class="fa fa-check"></i><b>10.3</b> Model-based inference</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="pointpatterns.html"><a href="pointpatterns.html"><i class="fa fa-check"></i><b>11</b> Point Pattern Analysis</a></li>
<li class="chapter" data-level="12" data-path="interpolation.html"><a href="interpolation.html"><i class="fa fa-check"></i><b>12</b> Spatial Interpolation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="interpolation.html"><a href="interpolation.html#a-first-dataset"><i class="fa fa-check"></i><b>12.1</b> A first dataset</a></li>
<li class="chapter" data-level="12.2" data-path="interpolation.html"><a href="interpolation.html#sample-variogram"><i class="fa fa-check"></i><b>12.2</b> Sample variogram</a></li>
<li class="chapter" data-level="12.3" data-path="interpolation.html"><a href="interpolation.html#fitting-variogram-models"><i class="fa fa-check"></i><b>12.3</b> Fitting variogram models</a></li>
<li class="chapter" data-level="12.4" data-path="interpolation.html"><a href="interpolation.html#kriging"><i class="fa fa-check"></i><b>12.4</b> Kriging interpolation</a></li>
<li class="chapter" data-level="12.5" data-path="interpolation.html"><a href="interpolation.html#blockkriging"><i class="fa fa-check"></i><b>12.5</b> Areal means: block kriging</a></li>
<li class="chapter" data-level="12.6" data-path="interpolation.html"><a href="interpolation.html#conditional-simulation"><i class="fa fa-check"></i><b>12.6</b> Conditional simulation</a></li>
<li class="chapter" data-level="12.7" data-path="interpolation.html"><a href="interpolation.html#trend-models"><i class="fa fa-check"></i><b>12.7</b> Trend models</a></li>
<li class="chapter" data-level="12.8" data-path="interpolation.html"><a href="interpolation.html#atpk"><i class="fa fa-check"></i><b>12.8</b> Area-to-point kriging</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="stgeostatistics.html"><a href="stgeostatistics.html"><i class="fa fa-check"></i><b>13</b> Multivariate and Spatiotemporal Geostatistics</a>
<ul>
<li class="chapter" data-level="13.1" data-path="stgeostatistics.html"><a href="stgeostatistics.html#preparing-the-air-quality-dataset"><i class="fa fa-check"></i><b>13.1</b> Preparing the air quality dataset</a></li>
<li class="chapter" data-level="13.2" data-path="stgeostatistics.html"><a href="stgeostatistics.html#multivariable-geostatistics"><i class="fa fa-check"></i><b>13.2</b> Multivariable geostatistics</a></li>
<li class="chapter" data-level="13.3" data-path="stgeostatistics.html"><a href="stgeostatistics.html#spatiotemporal-geostatistics"><i class="fa fa-check"></i><b>13.3</b> Spatiotemporal geostatistics</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="area.html"><a href="area.html"><i class="fa fa-check"></i><b>14</b> Proximity and Areal Data</a>
<ul>
<li class="chapter" data-level="14.1" data-path="area.html"><a href="area.html#representing-proximity-in-spdep"><i class="fa fa-check"></i><b>14.1</b> Representing proximity in <strong>spdep</strong></a></li>
<li class="chapter" data-level="14.2" data-path="area.html"><a href="area.html#contiguous-neighbours"><i class="fa fa-check"></i><b>14.2</b> Contiguous neighbours</a></li>
<li class="chapter" data-level="14.3" data-path="area.html"><a href="area.html#graph-based-neighbours"><i class="fa fa-check"></i><b>14.3</b> Graph-based neighbours</a></li>
<li class="chapter" data-level="14.4" data-path="area.html"><a href="area.html#distance-based-neighbours"><i class="fa fa-check"></i><b>14.4</b> Distance-based neighbours</a></li>
<li class="chapter" data-level="14.5" data-path="area.html"><a href="area.html#weights-specification"><i class="fa fa-check"></i><b>14.5</b> Weights specification</a></li>
<li class="chapter" data-level="14.6" data-path="area.html"><a href="area.html#higher-order-neighbours"><i class="fa fa-check"></i><b>14.6</b> Higher order neighbours</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="spatautocorr.html"><a href="spatautocorr.html"><i class="fa fa-check"></i><b>15</b> Measures of spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="15.1" data-path="spatautocorr.html"><a href="spatautocorr.html#measures-and-process-mis-specification"><i class="fa fa-check"></i><b>15.1</b> Measures and process mis-specification</a></li>
<li class="chapter" data-level="15.2" data-path="spatautocorr.html"><a href="spatautocorr.html#global-measures"><i class="fa fa-check"></i><b>15.2</b> Global measures</a></li>
<li class="chapter" data-level="15.3" data-path="spatautocorr.html"><a href="spatautocorr.html#local-measures"><i class="fa fa-check"></i><b>15.3</b> Local measures</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="spatglmm.html"><a href="spatglmm.html"><i class="fa fa-check"></i><b>16</b> Spatial Regression</a>
<ul>
<li class="chapter" data-level="16.1" data-path="spatglmm.html"><a href="spatglmm.html#markov-random-field-and-multilevel-models-with-spatial-weights"><i class="fa fa-check"></i><b>16.1</b> Markov random field and multilevel models with spatial weights</a></li>
<li class="chapter" data-level="16.2" data-path="spatglmm.html"><a href="spatglmm.html#multilevel-models-of-the-boston-data-set"><i class="fa fa-check"></i><b>16.2</b> Multilevel models of the Boston data set</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="spatecon.html"><a href="spatecon.html"><i class="fa fa-check"></i><b>17</b> Spatial econometrics models</a>
<ul>
<li class="chapter" data-level="17.1" data-path="spatecon.html"><a href="spatecon.html#spatial-econometric-models-definitions"><i class="fa fa-check"></i><b>17.1</b> Spatial econometric models: definitions</a></li>
<li class="chapter" data-level="17.2" data-path="spatecon.html"><a href="spatecon.html#maximum-likelihood-estimation-in-spatialreg"><i class="fa fa-check"></i><b>17.2</b> Maximum likelihood estimation in <strong>spatialreg</strong></a></li>
<li class="chapter" data-level="17.3" data-path="spatecon.html"><a href="spatecon.html#impacts"><i class="fa fa-check"></i><b>17.3</b> Impacts</a></li>
<li class="chapter" data-level="17.4" data-path="spatecon.html"><a href="spatecon.html#spatecon_pred"><i class="fa fa-check"></i><b>17.4</b> Predictions</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="sp-and-raster.html"><a href="sp-and-raster.html"><i class="fa fa-check"></i><b>18</b> sp and raster</a>
<ul>
<li class="chapter" data-level="18.1" data-path="sp-and-raster.html"><a href="sp-and-raster.html#links-and-differences-between-sf-and-sp"><i class="fa fa-check"></i><b>18.1</b> links and differences between sf and sp</a></li>
<li class="chapter" data-level="18.2" data-path="sp-and-raster.html"><a href="sp-and-raster.html#migration-packages"><i class="fa fa-check"></i><b>18.2</b> migration packages</a></li>
<li class="chapter" data-level="18.3" data-path="sp-and-raster.html"><a href="sp-and-raster.html#raster-stars-and-sf"><i class="fa fa-check"></i><b>18.3</b> raster, stars and sf</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="all-r-code-in-this-book.html"><a href="all-r-code-in-this-book.html"><i class="fa fa-check"></i>All R code in this book</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R basics</a>
<ul>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#pipes"><i class="fa fa-check"></i>Pipes</a></li>
<li class="chapter" data-level="18.4" data-path="r-basics.html"><a href="r-basics.html#data-structures"><i class="fa fa-check"></i><b>18.4</b> Data structures</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cs" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Coordinates</h1>
<p>“<em>Data are not just numbers, they are numbers with a context</em>”;
“<em>In data analysis, context provides meaning</em>” <span class="citation">(Cobb and Moore <a href="#ref-cobbmoore" role="doc-biblioref">1997</a>)</span></p>
<p>Before we can try to understand geometries like points, lines,
polygons, coverage and grids, it is useful to review coordinate
systems so that we have an idea what exactly coordinates of a
point reflect. For spatial data, the location of observations
are characterized by coordinates, and coordinates are defined in
a coordinate system. Different coordinate systems can be used for
this, and the most important difference is whether coordinates are
defined over a 2-dimensional or 3-dimensional space referenced
to orthogonal axes (Cartesian coordinates), or using distance
and directions (polar coordinates, spherical and ellipsoidal
coordinates). Besides a location of observation, all observations
are associated with time of observation, and so time coordinate
systems are also briefly discussed. First we will briefly review
<em>quantities</em>, to learn what units and datum are.</p>
<div id="units" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Quantities, units, datum</h2>
<p>The VIM (International vocabulary of metrology, <span class="citation">BIPM et al. (<a href="#ref-vim" role="doc-biblioref">2012</a>)</span>)
defines a <em>quantity</em> as a “property of a phenomenon, body, or
substance, where the property has a magnitude that can be expressed
as a number and a reference”, where “[a] reference can be a measurement
unit, a measurement procedure, a reference material, or a combination
of such.”</p>
<p>Although one could argue whether all data is constituted of
quantities, there is no need to argue that proper data handling
requires that numbers (or symbols) are accompanied by information
on what they mean, in particular what they refer to.</p>
<p>A measurement system consist of <em>base units</em> for base quantities, and
<em>derived units</em> for derived quantities. For instance, the SI system
of units <span class="citation">(Bureau International des Poids et Mesures <a href="#ref-SI" role="doc-biblioref">2006</a>)</span> consist of the seven base units length (metre,
m), mass (kilogram, kg), time (second, s), electric current
(ampere, A), thermodynamic temperature (Kelvin, K), amount of
substance (mole, mol), and luminous intensity (candela, cd).
Derived units are composed of products of integer powers of base
units; examples are speed (<span class="math inline">\(\mbox{m}~\mbox{s}^{-1}\)</span>), density
(<span class="math inline">\(\mbox{kg}~\mbox{m}^{-3}\)</span>) and area (<span class="math inline">\(\mbox{m}^2\)</span>).</p>
<p>The special case of unitless measures can refer to either cases
where units cancel out (e.g. mass fraction: kg/kg, or angle measured
in rad: m/m) or to cases where objects or events were counted
(e.g. 5 apples). Adding an angle to a count of apples would not
make sense; adding 5 apples to 3 oranges may make sense if the
result is reinterpreted as a superclass, e.g. as <em>pieces of fruit</em>.
Many data variables have units that are not expressible as SI base
units or derived units. <span class="citation">Hand (<a href="#ref-hand" role="doc-biblioref">2004</a>)</span> discusses many such measurement scales,
e.g. those used to measure intelligence in social sciences, in the
context of measurement units.</p>
<p>For many quantities, the natural origin of values is zero. This
works for amounts, where differences between amounts result in
meaningful negative values. For locations and times, differences
have a natural zero interpretation: distance and duration. Absolute
location (position) and time need a fixed origin, from which we
can meaningfully measure other absolute space-time points: we
call this <strong>a datum</strong>.
For space, a datum involves more than one dimension. The combination
of a datum and a measurement unit (scale) is a <em>reference system</em>.</p>
<p>We will now elaborate how spatial locations can be expressed as
either ellipsoidal or Cartesian coordinates. The next sections will
deal with temporal and spatial reference systems, and how they are
handled in R.</p>
</div>
<div id="ellipsoidal-coordinates" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Ellipsoidal coordinates</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="cs.html#cb16-1" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb16-2"><a href="cs.html#cb16-2" aria-hidden="true"></a><span class="kw">plot</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="dt">asp =</span> <span class="dv">1</span>)</span>
<span id="cb16-3"><a href="cs.html#cb16-3" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">pos =</span> <span class="dv">0</span>, <span class="dt">at =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb16-4"><a href="cs.html#cb16-4" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">pos =</span> <span class="dv">0</span>, <span class="dt">at =</span> <span class="dv">-6</span><span class="op">:</span><span class="dv">6</span>)</span>
<span id="cb16-5"><a href="cs.html#cb16-5" aria-hidden="true"></a>xd =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">by =</span> <span class="fl">.1</span>)</span>
<span id="cb16-6"><a href="cs.html#cb16-6" aria-hidden="true"></a><span class="kw">lines</span>(xd, <span class="kw">sqrt</span>(<span class="dv">25</span> <span class="op">-</span><span class="st"> </span>xd<span class="op">^</span><span class="dv">2</span>), <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb16-7"><a href="cs.html#cb16-7" aria-hidden="true"></a><span class="kw">lines</span>(xd, <span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">25</span> <span class="op">-</span><span class="st"> </span>xd<span class="op">^</span><span class="dv">2</span>), <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb16-8"><a href="cs.html#cb16-8" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">length =</span> <span class="fl">.15</span>, <span class="dt">angle =</span> <span class="dv">20</span>)</span>
<span id="cb16-9"><a href="cs.html#cb16-9" aria-hidden="true"></a><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="fl">2.7</span>, <span class="dt">label =</span> <span class="st">&quot;r&quot;</span>, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb16-10"><a href="cs.html#cb16-10" aria-hidden="true"></a>xd =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">3</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">.1</span>)</span>
<span id="cb16-11"><a href="cs.html#cb16-11" aria-hidden="true"></a><span class="kw">lines</span>(xd, <span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>xd<span class="op">^</span><span class="dv">2</span>), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb16-12"><a href="cs.html#cb16-12" aria-hidden="true"></a><span class="kw">text</span>(<span class="fl">1.2</span>, <span class="fl">0.5</span>, <span class="dt">label =</span> <span class="kw">parse</span>(<span class="dt">text =</span> <span class="st">&quot;phi&quot;</span>), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb16-13"><a href="cs.html#cb16-13" aria-hidden="true"></a><span class="kw">lines</span>(<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb16-14"><a href="cs.html#cb16-14" aria-hidden="true"></a><span class="kw">lines</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb16-15"><a href="cs.html#cb16-15" aria-hidden="true"></a><span class="kw">text</span>(<span class="fl">3.3</span>, <span class="fl">0.3</span>, <span class="dt">label =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span>
<span id="cb16-16"><a href="cs.html#cb16-16" aria-hidden="true"></a><span class="kw">text</span>(<span class="fl">0.3</span>, <span class="fl">4.3</span>, <span class="dt">label =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:polar"></span>
<img src="sds_files/figure-html/polar-1.png" alt="Two-dimensional polar (red) and Cartesian (blue) coordinates" width="50%" />
<p class="caption">
Figure 2.1: Two-dimensional polar (red) and Cartesian (blue) coordinates
</p>
</div>
<p>Figure <a href="cs.html#fig:polar">2.1</a> shows both polar and Cartesian coordinates
for a two-dimensional situation. In Cartesian coordinates,
the point shown is <span class="math inline">\((x,y) = (3,4)\)</span>, for polar coordinates it is
<span class="math inline">\((r,\phi) = (5, \mbox{arctan}(4/3))\)</span>, where <span class="math inline">\(\mbox{arctan}(4/3)\)</span> is
approximately <span class="math inline">\(0.93\)</span> radians, or <span class="math inline">\(53^{\circ}\)</span>. Note that <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span>
and <span class="math inline">\(r\)</span> all have length units, where <span class="math inline">\(\phi\)</span> is an angle (a unitless
length/length ratio). Converting back and forth between Cartesian
and polar coordinates is trivial, as
<span class="math display">\[x = r~\mbox{cos} \phi,\]</span>
<span class="math display">\[y = r~\mbox{sin} \phi,\]</span>
<span class="math display">\[r = \sqrt{x^2 + y^2}, \ \mbox{and}\]</span>
<span class="math display">\[\phi = \mbox{atan2}(y, x)\]</span>
where <span class="math inline">\(\mbox{atan2}\)</span> is used in favor of <span class="math inline">\(\mbox{atan}(y/x)\)</span> to take care
of the right quadrant.</p>
<div id="ellipsoidal-coordinates-1" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Ellipsoidal coordinates</h3>
<p>In three dimensions, where Cartesian coordinates are expressed as
<span class="math inline">\((x,y,z)\)</span>, spherical coordinates are the three-dimensional equivalent
of polar coordinates and can be expressed as <span class="math inline">\((r,\lambda,\phi)\)</span>, where</p>
<ul>
<li><span class="math inline">\(r\)</span> is the radius of the sphere,</li>
<li><span class="math inline">\(\lambda\)</span> is the longitude, measured in the <span class="math inline">\((x,y)\)</span> plane counter-clockwise from positive <span class="math inline">\(x\)</span>, and</li>
<li><span class="math inline">\(\phi\)</span> is the latitude, the angle between the vector and the <span class="math inline">\((x,y)\)</span> plane.</li>
</ul>
<p>Figure <a href="cs.html#fig:sphere">2.2</a> illustrates Cartesian geocentric and
ellipsoidal coordinates.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="cs.html#cb17-1" aria-hidden="true"></a><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(sf))</span>
<span id="cb17-2"><a href="cs.html#cb17-2" aria-hidden="true"></a>e =<span class="st"> </span><span class="kw">cbind</span>(<span class="op">-</span><span class="dv">90</span><span class="op">:</span><span class="dv">90</span>,<span class="dv">0</span>) <span class="co"># equator</span></span>
<span id="cb17-3"><a href="cs.html#cb17-3" aria-hidden="true"></a>f1 =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(<span class="dv">0</span>, <span class="dv">-90</span><span class="op">:</span><span class="dv">90</span>)) <span class="co"># 0/antimerid.</span></span>
<span id="cb17-4"><a href="cs.html#cb17-4" aria-hidden="true"></a>f2 =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(<span class="dv">90</span>, <span class="dv">-90</span><span class="op">:</span><span class="dv">90</span>), <span class="kw">cbind</span>(<span class="dv">270</span>, <span class="dv">90</span><span class="op">:-</span><span class="dv">90</span>))<span class="co"># +/- 90</span></span>
<span id="cb17-5"><a href="cs.html#cb17-5" aria-hidden="true"></a>eq =<span class="st"> </span><span class="kw">st_sfc</span>(<span class="kw">st_linestring</span>(e), <span class="kw">st_linestring</span>(f1), <span class="kw">st_linestring</span>(f2), <span class="dt">crs=</span><span class="dv">4326</span>)</span>
<span id="cb17-6"><a href="cs.html#cb17-6" aria-hidden="true"></a></span>
<span id="cb17-7"><a href="cs.html#cb17-7" aria-hidden="true"></a>geoc =<span class="st"> </span><span class="kw">st_transform</span>(eq, <span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-8"><a href="cs.html#cb17-8" aria-hidden="true"></a>cc =<span class="st"> </span><span class="kw">rbind</span>(geoc[[<span class="dv">1</span>]], <span class="ot">NA</span>, geoc[[<span class="dv">2</span>]], <span class="ot">NA</span>, geoc[[<span class="dv">3</span>]])</span>
<span id="cb17-9"><a href="cs.html#cb17-9" aria-hidden="true"></a>from3d =<span class="st"> </span><span class="cf">function</span>(x, offset, maxz, minz) {</span>
<span id="cb17-10"><a href="cs.html#cb17-10" aria-hidden="true"></a>    x =<span class="st"> </span>x[,<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>)] <span class="op">+</span><span class="st"> </span>offset <span class="co"># move to y right, x up, z backw</span></span>
<span id="cb17-11"><a href="cs.html#cb17-11" aria-hidden="true"></a>    x[,<span class="dv">2</span>] =<span class="st"> </span>x[,<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>maxz      <span class="co"># shift y to left</span></span>
<span id="cb17-12"><a href="cs.html#cb17-12" aria-hidden="true"></a>    d =<span class="st"> </span>maxz</span>
<span id="cb17-13"><a href="cs.html#cb17-13" aria-hidden="true"></a>    z =<span class="st"> </span>x[,<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>minz <span class="op">+</span><span class="st"> </span>offset</span>
<span id="cb17-14"><a href="cs.html#cb17-14" aria-hidden="true"></a>    x[,<span class="dv">1</span>] =<span class="st"> </span>x[,<span class="dv">1</span>] <span class="op">*</span><span class="st"> </span>(d<span class="op">/</span>z)</span>
<span id="cb17-15"><a href="cs.html#cb17-15" aria-hidden="true"></a>    x[,<span class="dv">2</span>] =<span class="st"> </span>x[,<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>(d<span class="op">/</span>z)</span>
<span id="cb17-16"><a href="cs.html#cb17-16" aria-hidden="true"></a>    x[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</span>
<span id="cb17-17"><a href="cs.html#cb17-17" aria-hidden="true"></a>}</span>
<span id="cb17-18"><a href="cs.html#cb17-18" aria-hidden="true"></a>maxz =<span class="st"> </span><span class="kw">max</span>(cc[,<span class="dv">3</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-19"><a href="cs.html#cb17-19" aria-hidden="true"></a>minz =<span class="st"> </span><span class="kw">min</span>(cc[,<span class="dv">3</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb17-20"><a href="cs.html#cb17-20" aria-hidden="true"></a>offset =<span class="st"> </span><span class="fl">3e7</span></span>
<span id="cb17-21"><a href="cs.html#cb17-21" aria-hidden="true"></a>circ =<span class="st"> </span><span class="kw">from3d</span>(cc, offset, maxz, minz)</span>
<span id="cb17-22"><a href="cs.html#cb17-22" aria-hidden="true"></a>mx =<span class="st"> </span><span class="kw">max</span>(cc, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1.1</span></span>
<span id="cb17-23"><a href="cs.html#cb17-23" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(mx, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb17-24"><a href="cs.html#cb17-24" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, mx, <span class="dv">0</span>))</span>
<span id="cb17-25"><a href="cs.html#cb17-25" aria-hidden="true"></a>z =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, mx))</span>
<span id="cb17-26"><a href="cs.html#cb17-26" aria-hidden="true"></a>ll =<span class="st"> </span><span class="kw">rbind</span>(x, <span class="ot">NA</span>, y, <span class="ot">NA</span>, z)</span>
<span id="cb17-27"><a href="cs.html#cb17-27" aria-hidden="true"></a>l0 =<span class="st">  </span><span class="kw">from3d</span>(ll, offset, maxz, minz)</span>
<span id="cb17-28"><a href="cs.html#cb17-28" aria-hidden="true"></a>mx =<span class="st"> </span><span class="kw">max</span>(cc, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span></span>
<span id="cb17-29"><a href="cs.html#cb17-29" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(mx, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb17-30"><a href="cs.html#cb17-30" aria-hidden="true"></a>y =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, mx, <span class="dv">0</span>))</span>
<span id="cb17-31"><a href="cs.html#cb17-31" aria-hidden="true"></a>z =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, mx))</span>
<span id="cb17-32"><a href="cs.html#cb17-32" aria-hidden="true"></a>ll =<span class="st"> </span><span class="kw">rbind</span>(x, <span class="ot">NA</span>, y, <span class="ot">NA</span>, z)</span>
<span id="cb17-33"><a href="cs.html#cb17-33" aria-hidden="true"></a>l =<span class="st">  </span><span class="kw">from3d</span>(ll, offset, maxz, minz)</span>
<span id="cb17-34"><a href="cs.html#cb17-34" aria-hidden="true"></a></span>
<span id="cb17-35"><a href="cs.html#cb17-35" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb17-36"><a href="cs.html#cb17-36" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb17-37"><a href="cs.html#cb17-37" aria-hidden="true"></a><span class="kw">plot.new</span>()</span>
<span id="cb17-38"><a href="cs.html#cb17-38" aria-hidden="true"></a><span class="kw">plot.window</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="kw">min</span>(circ[,<span class="dv">1</span>],<span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">3607103</span><span class="op">*</span><span class="fl">1.02</span>), </span>
<span id="cb17-39"><a href="cs.html#cb17-39" aria-hidden="true"></a>                        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(circ[,<span class="dv">2</span>],<span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2873898</span><span class="op">*</span><span class="fl">1.1</span>), <span class="dt">asp =</span> <span class="dv">1</span>)</span>
<span id="cb17-40"><a href="cs.html#cb17-40" aria-hidden="true"></a><span class="kw">lines</span>(circ)</span>
<span id="cb17-41"><a href="cs.html#cb17-41" aria-hidden="true"></a><span class="kw">lines</span>(l0)</span>
<span id="cb17-42"><a href="cs.html#cb17-42" aria-hidden="true"></a><span class="kw">text</span>(l[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>),], <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb17-43"><a href="cs.html#cb17-43" aria-hidden="true"></a><span class="co"># add POINT(60 47)</span></span>
<span id="cb17-44"><a href="cs.html#cb17-44" aria-hidden="true"></a>p =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(60 47)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-45"><a href="cs.html#cb17-45" aria-hidden="true"></a>p =<span class="st"> </span>p[[<span class="dv">1</span>]]</span>
<span id="cb17-46"><a href="cs.html#cb17-46" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p[<span class="dv">1</span>],<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p[<span class="dv">1</span>],p[<span class="dv">2</span>],<span class="dv">0</span>), <span class="kw">c</span>(p[<span class="dv">1</span>],p[<span class="dv">2</span>],p[<span class="dv">2</span>]))</span>
<span id="cb17-47"><a href="cs.html#cb17-47" aria-hidden="true"></a>ptsl =<span class="st">  </span><span class="kw">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb17-48"><a href="cs.html#cb17-48" aria-hidden="true"></a><span class="kw">lines</span>(ptsl, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb17-49"><a href="cs.html#cb17-49" aria-hidden="true"></a><span class="kw">points</span>(ptsl[<span class="dv">4</span>,<span class="dv">1</span>], ptsl[<span class="dv">4</span>,<span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</span>
<span id="cb17-50"><a href="cs.html#cb17-50" aria-hidden="true"></a></span>
<span id="cb17-51"><a href="cs.html#cb17-51" aria-hidden="true"></a><span class="kw">plot.new</span>()</span>
<span id="cb17-52"><a href="cs.html#cb17-52" aria-hidden="true"></a><span class="kw">plot.window</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="kw">min</span>(circ[,<span class="dv">1</span>],<span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">3607103</span><span class="op">*</span><span class="fl">1.02</span>), </span>
<span id="cb17-53"><a href="cs.html#cb17-53" aria-hidden="true"></a>                        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(circ[,<span class="dv">2</span>],<span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dv">2873898</span><span class="op">*</span><span class="fl">1.1</span>), <span class="dt">asp =</span> <span class="dv">1</span>)</span>
<span id="cb17-54"><a href="cs.html#cb17-54" aria-hidden="true"></a><span class="kw">lines</span>(circ)</span>
<span id="cb17-55"><a href="cs.html#cb17-55" aria-hidden="true"></a></span>
<span id="cb17-56"><a href="cs.html#cb17-56" aria-hidden="true"></a>p =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(60 47)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-57"><a href="cs.html#cb17-57" aria-hidden="true"></a>p =<span class="st"> </span>p[[<span class="dv">1</span>]]</span>
<span id="cb17-58"><a href="cs.html#cb17-58" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p[<span class="dv">1</span>],p[<span class="dv">2</span>],p[<span class="dv">3</span>]))</span>
<span id="cb17-59"><a href="cs.html#cb17-59" aria-hidden="true"></a>pt =<span class="st">  </span><span class="kw">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb17-60"><a href="cs.html#cb17-60" aria-hidden="true"></a><span class="kw">lines</span>(pt)</span>
<span id="cb17-61"><a href="cs.html#cb17-61" aria-hidden="true"></a><span class="kw">points</span>(pt[<span class="dv">2</span>,<span class="dv">1</span>], pt[<span class="dv">2</span>,<span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</span>
<span id="cb17-62"><a href="cs.html#cb17-62" aria-hidden="true"></a></span>
<span id="cb17-63"><a href="cs.html#cb17-63" aria-hidden="true"></a>p0 =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(60 0)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-64"><a href="cs.html#cb17-64" aria-hidden="true"></a>p0 =<span class="st"> </span>p0[[<span class="dv">1</span>]]</span>
<span id="cb17-65"><a href="cs.html#cb17-65" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb17-66"><a href="cs.html#cb17-66" aria-hidden="true"></a>pt =<span class="st">  </span><span class="kw">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb17-67"><a href="cs.html#cb17-67" aria-hidden="true"></a><span class="kw">lines</span>(pt)</span>
<span id="cb17-68"><a href="cs.html#cb17-68" aria-hidden="true"></a></span>
<span id="cb17-69"><a href="cs.html#cb17-69" aria-hidden="true"></a>p0 =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(0 0)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-70"><a href="cs.html#cb17-70" aria-hidden="true"></a>p0 =<span class="st"> </span>p0[[<span class="dv">1</span>]]</span>
<span id="cb17-71"><a href="cs.html#cb17-71" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb17-72"><a href="cs.html#cb17-72" aria-hidden="true"></a>pt =<span class="st">  </span><span class="kw">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb17-73"><a href="cs.html#cb17-73" aria-hidden="true"></a><span class="kw">lines</span>(pt)</span>
<span id="cb17-74"><a href="cs.html#cb17-74" aria-hidden="true"></a></span>
<span id="cb17-75"><a href="cs.html#cb17-75" aria-hidden="true"></a>p0 =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(0 90)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-76"><a href="cs.html#cb17-76" aria-hidden="true"></a>p0 =<span class="st"> </span>p0[[<span class="dv">1</span>]]</span>
<span id="cb17-77"><a href="cs.html#cb17-77" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb17-78"><a href="cs.html#cb17-78" aria-hidden="true"></a>pt =<span class="st">  </span><span class="kw">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb17-79"><a href="cs.html#cb17-79" aria-hidden="true"></a><span class="kw">lines</span>(pt, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb17-80"><a href="cs.html#cb17-80" aria-hidden="true"></a></span>
<span id="cb17-81"><a href="cs.html#cb17-81" aria-hidden="true"></a>p0 =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(90 0)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-82"><a href="cs.html#cb17-82" aria-hidden="true"></a>p0 =<span class="st"> </span>p0[[<span class="dv">1</span>]]</span>
<span id="cb17-83"><a href="cs.html#cb17-83" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb17-84"><a href="cs.html#cb17-84" aria-hidden="true"></a>pt =<span class="st">  </span><span class="kw">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb17-85"><a href="cs.html#cb17-85" aria-hidden="true"></a><span class="kw">lines</span>(pt, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb17-86"><a href="cs.html#cb17-86" aria-hidden="true"></a></span>
<span id="cb17-87"><a href="cs.html#cb17-87" aria-hidden="true"></a>f1 =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">60</span>, <span class="dv">0</span>))</span>
<span id="cb17-88"><a href="cs.html#cb17-88" aria-hidden="true"></a>arc =<span class="st"> </span><span class="kw">st_sfc</span>(<span class="kw">st_linestring</span>(f1), <span class="dt">crs=</span><span class="dv">4326</span>)</span>
<span id="cb17-89"><a href="cs.html#cb17-89" aria-hidden="true"></a>geoc =<span class="st"> </span><span class="kw">st_transform</span>(arc, <span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-90"><a href="cs.html#cb17-90" aria-hidden="true"></a>cc =<span class="st"> </span><span class="kw">rbind</span>(geoc[[<span class="dv">1</span>]])</span>
<span id="cb17-91"><a href="cs.html#cb17-91" aria-hidden="true"></a>circ =<span class="st"> </span><span class="kw">from3d</span>(cc, offset, maxz, minz)</span>
<span id="cb17-92"><a href="cs.html#cb17-92" aria-hidden="true"></a><span class="kw">lines</span>(circ, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb17-93"><a href="cs.html#cb17-93" aria-hidden="true"></a></span>
<span id="cb17-94"><a href="cs.html#cb17-94" aria-hidden="true"></a>f1 =<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">cbind</span>(<span class="dv">60</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">47</span>))</span>
<span id="cb17-95"><a href="cs.html#cb17-95" aria-hidden="true"></a>arc =<span class="st"> </span><span class="kw">st_sfc</span>(<span class="kw">st_linestring</span>(f1), <span class="dt">crs=</span><span class="dv">4326</span>)</span>
<span id="cb17-96"><a href="cs.html#cb17-96" aria-hidden="true"></a>geoc =<span class="st"> </span><span class="kw">st_transform</span>(arc, <span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb17-97"><a href="cs.html#cb17-97" aria-hidden="true"></a>cc =<span class="st"> </span><span class="kw">rbind</span>(geoc[[<span class="dv">1</span>]])</span>
<span id="cb17-98"><a href="cs.html#cb17-98" aria-hidden="true"></a>circ =<span class="st"> </span><span class="kw">from3d</span>(cc, offset, maxz, minz)</span>
<span id="cb17-99"><a href="cs.html#cb17-99" aria-hidden="true"></a><span class="kw">lines</span>(circ, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</span>
<span id="cb17-100"><a href="cs.html#cb17-100" aria-hidden="true"></a></span>
<span id="cb17-101"><a href="cs.html#cb17-101" aria-hidden="true"></a><span class="kw">text</span>(pt[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">+</span><span class="dv">100000</span>, pt[<span class="dv">1</span>,<span class="dv">2</span>]<span class="op">+</span><span class="dv">50000</span>, <span class="dt">labels =</span> <span class="kw">expression</span>(phi), <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>) <span class="co"># lat</span></span>
<span id="cb17-102"><a href="cs.html#cb17-102" aria-hidden="true"></a><span class="kw">text</span>(pt[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">+</span><span class="dv">20000</span>, pt[<span class="dv">1</span>,<span class="dv">2</span>]<span class="op">-</span><span class="dv">50000</span>, <span class="dt">labels =</span> <span class="kw">expression</span>(lambda), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>) <span class="co"># lng</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:sphere"></span>
<img src="sds_files/figure-html/sphere-1.png" alt="Cartesian geocentric coordinates (left) measure three distances, ellipsoidal coordinates (right) measure two angles, and possibly an ellipsoidal height" width="672" />
<p class="caption">
Figure 2.2: Cartesian geocentric coordinates (left) measure three distances, ellipsoidal coordinates (right) measure two angles, and possibly an ellipsoidal height
</p>
</div>
<p><span class="math inline">\(\lambda\)</span> typically varies between <span class="math inline">\(-180^{\circ}\)</span> and <span class="math inline">\(180^{\circ}\)</span>
(or alternatively from <span class="math inline">\(0^{\circ}\)</span> to <span class="math inline">\(360^{\circ}\)</span>), <span class="math inline">\(\phi\)</span> from
<span class="math inline">\(-90^{\circ}\)</span> to <span class="math inline">\(90^{\circ}\)</span>. When we are only interested in points
<em>on</em> a sphere with given radius, we can drop <span class="math inline">\(r\)</span>: <span class="math inline">\((\lambda,\phi)\)</span>
now suffice to identify any point.</p>
<p>It should be noted that this is just <em>a</em> definition, one could for
instance also choose to measure polar angle, the angle between
the vector and <span class="math inline">\(z\)</span>, instead of latitude. There is also a long
tradition of specifying points as <span class="math inline">\((\phi,\lambda)\)</span> but throughout
this book we will stick to longitude-latitude, <span class="math inline">\((\lambda,\phi)\)</span>.
The point denoted in figure <a href="cs.html#fig:sphere">2.2</a> has <span class="math inline">\((\lambda,\phi)\)</span>
or ellipsoidal coordinates with values</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="cs.html#cb18-1" aria-hidden="true"></a>p =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(60 47)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb18-2"><a href="cs.html#cb18-2" aria-hidden="true"></a>p[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code># POINT (60 47)</code></pre>
<p>with angles measured in degrees, and geocentric coordinates</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="cs.html#cb20-1" aria-hidden="true"></a>p =<span class="st"> </span><span class="kw">st_as_sfc</span>(<span class="st">&quot;POINT(60 47)&quot;</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb20-2"><a href="cs.html#cb20-2" aria-hidden="true"></a>p[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code># POINT Z (2178844 3773868 4641765)</code></pre>
<p>with unit metres.</p>
<p>For points on an ellipse, there are two ways in which angle can be
expressed (figure <a href="cs.html#fig:ellipse">2.3</a>): measured from the center of
the ellipse (<span class="math inline">\(\psi\)</span>), or measured perpendicular to the tangent on
the ellipse at the target point (<span class="math inline">\(\phi\)</span>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="cs.html#cb22-1" aria-hidden="true"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb22-2"><a href="cs.html#cb22-2" aria-hidden="true"></a>x =<span class="st"> </span><span class="dv">4</span></span>
<span id="cb22-3"><a href="cs.html#cb22-3" aria-hidden="true"></a>y =<span class="st"> </span><span class="dv">5</span><span class="op">/</span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">48</span>)</span>
<span id="cb22-4"><a href="cs.html#cb22-4" aria-hidden="true"></a><span class="kw">plot</span>(x, y, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">8</span>,<span class="dv">8</span>), <span class="dt">asp =</span> <span class="dv">1</span>)</span>
<span id="cb22-5"><a href="cs.html#cb22-5" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">pos =</span> <span class="dv">0</span>, <span class="dt">at =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>)</span>
<span id="cb22-6"><a href="cs.html#cb22-6" aria-hidden="true"></a><span class="kw">axis</span>(<span class="dv">2</span>, <span class="dt">pos =</span> <span class="dv">0</span>, <span class="dt">at =</span> <span class="dv">-5</span><span class="op">:</span><span class="dv">5</span>)</span>
<span id="cb22-7"><a href="cs.html#cb22-7" aria-hidden="true"></a>xd =<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">8</span>, <span class="dv">8</span>, <span class="dt">by =</span> <span class="fl">.1</span>)</span>
<span id="cb22-8"><a href="cs.html#cb22-8" aria-hidden="true"></a><span class="kw">lines</span>(xd, <span class="dv">5</span><span class="op">/</span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">64</span> <span class="op">-</span><span class="st"> </span>xd<span class="op">^</span><span class="dv">2</span>), <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb22-9"><a href="cs.html#cb22-9" aria-hidden="true"></a><span class="kw">lines</span>(xd, <span class="dv">5</span><span class="op">/</span><span class="dv">8</span> <span class="op">*</span><span class="st"> </span><span class="op">-</span><span class="kw">sqrt</span>(<span class="dv">64</span> <span class="op">-</span><span class="st"> </span>xd<span class="op">^</span><span class="dv">2</span>), <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb22-10"><a href="cs.html#cb22-10" aria-hidden="true"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, x, y, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">length =</span> <span class="fl">.15</span>, <span class="dt">angle =</span> <span class="dv">20</span>)</span>
<span id="cb22-11"><a href="cs.html#cb22-11" aria-hidden="true"></a>b =<span class="st"> </span>(x <span class="op">*</span><span class="st"> </span><span class="dv">25</span>) <span class="op">/</span><span class="st"> </span>(<span class="op">-</span>y <span class="op">*</span><span class="st"> </span><span class="dv">64</span>)</span>
<span id="cb22-12"><a href="cs.html#cb22-12" aria-hidden="true"></a>a =<span class="st"> </span>y <span class="op">-</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>b</span>
<span id="cb22-13"><a href="cs.html#cb22-13" aria-hidden="true"></a><span class="kw">abline</span>(a, b, <span class="dt">col =</span> <span class="st">&#39;grey&#39;</span>)</span>
<span id="cb22-14"><a href="cs.html#cb22-14" aria-hidden="true"></a>b =<span class="st"> </span><span class="dv">-1</span><span class="op">/</span>b</span>
<span id="cb22-15"><a href="cs.html#cb22-15" aria-hidden="true"></a>x0 =<span class="st"> </span>x <span class="op">-</span><span class="st"> </span>y <span class="op">/</span><span class="st"> </span>b</span>
<span id="cb22-16"><a href="cs.html#cb22-16" aria-hidden="true"></a><span class="kw">arrows</span>(x0, <span class="dv">0</span>, x, y, <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>, <span class="dt">length =</span> <span class="fl">.15</span>, <span class="dt">angle =</span> <span class="dv">20</span>)</span>
<span id="cb22-17"><a href="cs.html#cb22-17" aria-hidden="true"></a><span class="kw">text</span>(<span class="fl">1.2</span>, <span class="fl">0.5</span>, <span class="dt">label =</span> <span class="kw">parse</span>(<span class="dt">text =</span> <span class="st">&quot;psi&quot;</span>), <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</span>
<span id="cb22-18"><a href="cs.html#cb22-18" aria-hidden="true"></a><span class="kw">text</span>(<span class="dv">3</span>, <span class="fl">0.5</span>, <span class="dt">label =</span> <span class="kw">parse</span>(<span class="dt">text =</span> <span class="st">&quot;phi&quot;</span>), <span class="dt">col =</span> <span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:ellipse"></span>
<img src="sds_files/figure-html/ellipse-1.png" alt="Angles on an ellipse: geodetic (blue) and geocentric (red) latitude" width="50%" />
<p class="caption">
Figure 2.3: Angles on an ellipse: geodetic (blue) and geocentric (red) latitude
</p>
</div>
<p>The most commonly used parametric model for the Earth is <em>an
ellipsoid of revolution</em>, an ellipsoid with two equal semi-axes
<span class="citation">(Iliffe and Lott <a href="#ref-iliffelott" role="doc-biblioref">2008</a>)</span>. In effect, this is a flattened sphere (or spheroid):
the distance between the poles is (slightly: about 0.33%) smaller
than the distance between two opposite points on the equator. Under
this model, longitude is always measured along a circle (as in
figure <a href="cs.html#fig:sphere">2.2</a>), and latitude along an ellipse (as in
figure <a href="cs.html#fig:ellipse">2.3</a>). If we
think of figure <a href="cs.html#fig:ellipse">2.3</a> as a cross section of the Earth
passing through the poles, the <em>geodetic</em> latitude measure <span class="math inline">\(\phi\)</span>
is the one used when no further specification is given. The latitude
measure <span class="math inline">\(\psi\)</span> is called the <em>geocentric latitude</em>.</p>
<p>In addition to longitude and latitude we can add <em>altitude</em>
or elevation to define points that are not on the ellipsoid, and
obtain a three dimensional space again. When defining altitude,
we need to choose</p>
<ul>
<li>where zero altitude is: on the ellipsoid, or relative to the surface approximating mean sea level (the geoid)?</li>
<li>which direction is positive, and</li>
<li>which direction is “straight up”: perpendicular to the ellipsoid surface,
or in the direction perpendicular to the surface of the geoid?</li>
</ul>
<p>All these choices may matter, depending on the application area
and required measurement accuracies.</p>
<p>The shape of the Earth is not a perfect ellipsoid. As a consequence,
several ellipsoids with different shape parameters and bound to
the Earth in different ways are being used. Such ellipsoids are called
<em>datums</em>, and are briefly discussed in section <a href="cs.html#crs">2.3</a>, along
with <em>coordinate reference systems</em>.</p>
</div>
<div id="projections" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Projected coordinates, distances</h3>
<p>Because paper maps and computer screens are much more abundant
and practical than globes, most of the time we look at spatial
data we see it <em>projected</em>: drawn on a flat, two-dimensional
surface. Computing the locations in a two-dimensional space means
that we work with <em>projected</em> coordinates. Projecting ellipsoidal
coordinates means that shapes, directions, areas, or even all three,
are distorted <span class="citation">(Iliffe and Lott <a href="#ref-iliffelott" role="doc-biblioref">2008</a>)</span>.</p>
<p>Distances between two points <span class="math inline">\(p_i\)</span> and <span class="math inline">\(p_j\)</span> in Cartesian coordinates are computed
as Euclidean distances, in two dimensions by
<span class="math display">\[d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2}\]</span>
with <span class="math inline">\(p_i = (x_i,y_i)\)</span>
and in three dimensions by
<span class="math display">\[d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2+(z_i-z_j)^2}\]</span>
with <span class="math inline">\(p_i = (x_i,y_i,z_i).\)</span>
These distances represent the length of a <em>straight</em> line between
two points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<p>For two points on a circle, the length of the arc of two points <span class="math inline">\(c_1 = (r,{\phi}_i)\)</span> and
<span class="math inline">\(c_2 = (r, \phi_2)\)</span> is
<span class="math display">\[s_{ij}=r~|\phi_1-\phi_2| = r ~\theta\]</span>
with <span class="math inline">\(\theta\)</span> the angle between <span class="math inline">\(\phi_1\)</span> and <span class="math inline">\(\phi_2\)</span> in radians.
For very small values of <span class="math inline">\(\theta\)</span>, we will have <span class="math inline">\(s_{ij} \approx d_{ij}\)</span>,
because a small arc segment is nearly straight.</p>
<p>For two points <span class="math inline">\(p_1 = (\lambda_1,\phi_1)\)</span> and <span class="math inline">\(p_2 = (\lambda_2,\phi_2)\)</span> on a sphere with radius <span class="math inline">\(r&#39;\)</span>, the <em>great circle
distance</em> is the arc length between <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> on the circle
that passes through <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> and has the center of the sphere as its center, and
is given by <span class="math inline">\(s_{12} = r ~ \theta_{12}\)</span> with
<span class="math display">\[\theta_{12} = \arccos(\sin \phi_1 \cdot \sin \phi_2 + \cos \phi_1 \cdot \cos \phi_2 \cdot \cos(|\lambda_1-\lambda_2|))\]</span>
the angle between <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span>, in radians.</p>
<p>Arc distances between two points on a spheroid are more complicated
to compute; a good discussion on the topic and an explanation of
the method implemented in GeographicLib (part of PROJ) is given
in <span class="citation">Karney (<a href="#ref-karney2013algorithms" role="doc-biblioref">2013</a>)</span>.</p>
<p>To show that these distance measures actually give different
values, we computed them for the distance Berlin - Paris. Here,
<code>gc_</code> refers to ellipsoidal and spherical great circle distances,
<code>straight_</code> refers to straight line, Euclidean distances between
Cartesian geocentric coordinates associated on the WGS84 ellipse
and sphere:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="cs.html#cb23-1" aria-hidden="true"></a>pts =<span class="st"> </span><span class="kw">st_sfc</span>(<span class="kw">st_point</span>(<span class="kw">c</span>(<span class="fl">13.4050</span>, <span class="fl">52.5200</span>)), <span class="kw">st_point</span>(<span class="kw">c</span>(<span class="fl">2.3522</span>, <span class="fl">48.8566</span>)), <span class="dt">crs =</span> <span class="st">&#39;EPSG:4326&#39;</span>)</span>
<span id="cb23-2"><a href="cs.html#cb23-2" aria-hidden="true"></a>s2_orig =<span class="st"> </span><span class="kw">sf_use_s2</span>(<span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code># Spherical geometry (s2) switched off</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="cs.html#cb25-1" aria-hidden="true"></a>d1 =<span class="st"> </span><span class="kw">c</span>(<span class="dt">gc_ellipse =</span> <span class="kw">st_distance</span>(pts)[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb25-2"><a href="cs.html#cb25-2" aria-hidden="true"></a><span class="kw">sf_use_s2</span>(<span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code># Spherical geometry (s2) switched on</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="cs.html#cb27-1" aria-hidden="true"></a><span class="co"># or, without using s2, use st_distance(st_transform(pts, &quot;+proj=longlat +ellps=sphere&quot;))</span></span>
<span id="cb27-2"><a href="cs.html#cb27-2" aria-hidden="true"></a>d2 =<span class="st"> </span><span class="kw">c</span>(<span class="dt">gc_sphere =</span> <span class="kw">st_distance</span>(pts)[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb27-3"><a href="cs.html#cb27-3" aria-hidden="true"></a>p =<span class="st"> </span><span class="kw">st_transform</span>(pts, <span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb27-4"><a href="cs.html#cb27-4" aria-hidden="true"></a>d3 =<span class="st"> </span><span class="kw">c</span>(<span class="dt">straight_ellipse =</span> units<span class="op">::</span><span class="kw">set_units</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(<span class="kw">apply</span>(<span class="kw">do.call</span>(cbind, p), <span class="dv">1</span>, diff)<span class="op">^</span><span class="dv">2</span>)), m))</span>
<span id="cb27-5"><a href="cs.html#cb27-5" aria-hidden="true"></a>p2 =<span class="st"> </span><span class="kw">st_transform</span>(pts, <span class="st">&quot;+proj=longlat +ellps=sphere&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_transform</span>(<span class="st">&quot;+proj=geocent&quot;</span>)</span>
<span id="cb27-6"><a href="cs.html#cb27-6" aria-hidden="true"></a>d4 =<span class="st"> </span><span class="kw">c</span>(<span class="dt">straight_sphere =</span> units<span class="op">::</span><span class="kw">set_units</span>(<span class="kw">sqrt</span>(<span class="kw">sum</span>(<span class="kw">apply</span>(<span class="kw">do.call</span>(cbind, p2), <span class="dv">1</span>, diff)<span class="op">^</span><span class="dv">2</span>)), m))</span>
<span id="cb27-7"><a href="cs.html#cb27-7" aria-hidden="true"></a>res =<span class="st"> </span><span class="kw">c</span>(d1,d3,d2,d4)</span>
<span id="cb27-8"><a href="cs.html#cb27-8" aria-hidden="true"></a><span class="co"># print as km, re-add names:</span></span>
<span id="cb27-9"><a href="cs.html#cb27-9" aria-hidden="true"></a><span class="kw">sf_use_s2</span>(s2_orig) <span class="co"># back to what it was before changing</span></span>
<span id="cb27-10"><a href="cs.html#cb27-10" aria-hidden="true"></a>res <span class="op">%&gt;%</span><span class="st"> </span>units<span class="op">::</span><span class="kw">set_units</span>(km) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">setNames</span>(<span class="kw">names</span>(res)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">digits =</span> <span class="dv">5</span>)</span></code></pre></div>
<pre><code># Units: [km]
#       gc_ellipse straight_ellipse        gc_sphere  straight_sphere 
#           879.70           879.00           877.46           876.77</code></pre>
</div>
<div id="bounded" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Bounded and unbounded spaces</h3>
<p>Two-dimensional and three-dimensional Euclidean spaces (<span class="math inline">\(R^2\)</span> and
<span class="math inline">\(R^3\)</span>) are unbounded: every line in this space has infinite length,
distances, areas or volumes are unbounded. In contrast, spaces
defined on a circle (<span class="math inline">\(S^1\)</span>) or sphere (<span class="math inline">\(S^2\)</span>) define a bounded set:
there may be infinitely many points but the length and area of the
circle and the radius, area and volume of a sphere are bound.</p>
<p>This may sound trivial, but leads to some interesting findings
when handling spatial data. A polygon on <span class="math inline">\(R^2\)</span> has unambiguously an
inside and an outside. On a sphere, <span class="math inline">\(S^2\)</span>, any polygon divides
the sphere in two parts, and which of these two is to be considered
inside and which outside is ambiguous and needs to be defined
e.g. by the traversal direction. Chapter <a href="spherical.html#spherical">4</a> will
further discuss consequences when working with geometries on <span class="math inline">\(S^2\)</span>.</p>
</div>
</div>
<div id="crs" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Coordinate Reference Systems</h2>
<p>We follow <span class="citation">Lott (<a href="#ref-lott2015" role="doc-biblioref">2015</a>)</span> when defining the following concepts (italics indicate literal quoting):</p>
<ul>
<li>a <strong>coordinate system</strong> is a <em>set of mathematical rules for specifying how coordinates are to be assigned to points</em></li>
<li>a <strong>datum</strong> is a <em>parameter or set of parameters that define the position of the origin, the scale, and the orientation of a coordinate system</em>,</li>
<li>a <strong>geodetic datum</strong> is a <em>datum describing the relationship of a two- or three-dimensional coordinate system to the Earth</em>, and</li>
<li>a <strong>coordinate reference system</strong> is a <em>coordinate system that is related to an object by a datum; for geodetic and vertical datums, the object will be the Earth.</em></li>
</ul>
<p>A readable text that further explains these concepts is <span class="citation">Iliffe and Lott (<a href="#ref-iliffelott" role="doc-biblioref">2008</a>)</span>.</p>
<p>The Earth does not follow a regular shape. The topography of the
Earth is of course known to vary strongly, but also the surface
formed by constant gravity at mean sea level, the geoid, is
irregular. A commonly used model that is fit to the geoid is an
ellipsoid of revolution, which is an ellipse with two identical
minor axes. Fitting such an ellipsoid to the Earth gives a datum.
However, fitting it to different areas, or based on different sets of
reference points gives different fits, and hence different datums:
a datum can for instance be fixed to a particular tectonic plate
(like ETRS89), others can be globally fit (like WGS84). More local
fits lead to smaller approximation errors.</p>
<p>The definitions above imply that coordinates in degrees longitude
and latitude only have a meaning, i.e. can only be interpreted
unambiguously as Earth coordinates, when the datum they are
associated with is given.</p>
<p>Note that for projected data, the data that <em>were</em> projected
are associated with a reference ellipsoid (datum). Going from
one projection to another <em>without</em> changing datum is called
<em>coordinate conversion</em>, and passes through the ellipsoidal
coordinates associated with the datum involved. This process is
lossless and invertible: the parameters and equations associated
with a <em>conversion</em> are not empirical. Recomputing coordinates in a
new datum is called <em>coordinate transformation</em>, and is approximate:
because datums are a result of model fitting, transformations
between datums are models too that have been fit; the equations
involved are empirical, and multiple transformation paths, based
on different model fits and associated with different accuracies,
are possible.</p>
<p>Plate tectonics imply that within a global datum, fixed objects may
have coordinates that change over time, and that transformations
from one datum to another may be time-dependent. Earthquakes are a
cause of more local and sudden changes in coordinates.</p>
</div>
<div id="proj" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> PROJ and mapping accuracy</h2>
<p>Very few living people active in open source geospatial software
can remember the time before PROJ. PROJ <span class="citation">(Evenden <a href="#ref-evenden:90" role="doc-biblioref">1990</a>)</span> started in the
1970s as a Fortran project, and was released in 1985 as a C library
for cartographic projections. It came with command line tools for
direct and inverse projections, and could be linked to software
to let it support (re)projection directly. Originally, datums were
considered implicit, and no datum transformations were allowed.</p>
<p>In the early 2000s, PROJ was known as PROJ.4, after its never changing
major version number. Amongst others motivated by the rise of GPS,
the need for datum transformations increased and PROJ.4 was extended
with rudimentary datum support. PROJ definitions for coordinate
reference systems would look like this:</p>
<pre><code>+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs</code></pre>
<p>where <em>key</em>=<em>value</em> pairs are preceded by a <code>+</code> and separated by
a space. This form came to be known as “PROJ.4 string”, since the
PROJ project stayed at version 4.x for several decades. Other datums
would come with fields like</p>
<pre><code>+ellps=bessel +towgs84=565.4,50.3,465.6,-0.399,0.344,-1.877,4.072</code></pre>
<p>indicating another ellipse, as well as the seven (or three)
parameters for transforming from this ellipse to WGS84 (the “World
Geodetic System 1984” global datum once popularized by GPS),
effectively defining the datum in terms of a transformation to WGS84.</p>
<p>Along with PROJ.4 came a set of databases with known (registered)
projections, from which the best known is the EPSG registry.
National mapping agencies would provide (and update over time)
their best guesses of <code>+towgs84=</code> parameters for national coordinate
reference systems, and distribute it through the EPSG registry,
which was part of PROJ distributions.
For some transformations, <em>datum grids</em> were available and
distributed as part of PROJ.4: such grids are raster maps that provide
for every location pre-computed values for the shift in longitude
and latitude, or elevation, for a particular datum transformation.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="cs.html#cb31-1" aria-hidden="true"></a><span class="kw">library</span>(stars)</span>
<span id="cb31-2"><a href="cs.html#cb31-2" aria-hidden="true"></a><span class="kw">library</span>(rnaturalearth)</span>
<span id="cb31-3"><a href="cs.html#cb31-3" aria-hidden="true"></a>countries110 =<span class="st"> </span><span class="kw">st_as_sf</span>(countries110)</span>
<span id="cb31-4"><a href="cs.html#cb31-4" aria-hidden="true"></a>uk =<span class="st"> </span>countries110[countries110<span class="op">$</span>admin <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;United Kingdom&quot;</span>),] <span class="op">%&gt;%</span></span>
<span id="cb31-5"><a href="cs.html#cb31-5" aria-hidden="true"></a><span class="st">        </span><span class="kw">st_geometry</span>()</span>
<span id="cb31-6"><a href="cs.html#cb31-6" aria-hidden="true"></a>r =<span class="st"> </span><span class="kw">read_stars</span>(<span class="st">&quot;data/uk_os_OSTN15_NTv2_OSGBtoETRS.tif&quot;</span>)</span>
<span id="cb31-7"><a href="cs.html#cb31-7" aria-hidden="true"></a><span class="co"># r = read_stars(&quot;/vsicurl/https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif&quot;)</span></span>
<span id="cb31-8"><a href="cs.html#cb31-8" aria-hidden="true"></a>hook =<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb31-9"><a href="cs.html#cb31-9" aria-hidden="true"></a>        <span class="kw">plot</span>(uk, <span class="dt">border =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-10"><a href="cs.html#cb31-10" aria-hidden="true"></a>}</span>
<span id="cb31-11"><a href="cs.html#cb31-11" aria-hidden="true"></a><span class="kw">plot</span>(r[,,,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">hook =</span> hook, <span class="dt">key.pos =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code># downsample set to c(1,1,1)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:horizontalgrid"></span>
<img src="sds_files/figure-html/horizontalgrid-1.png" alt="UK horizontal datum grid, from datum OSGB 1936 (EPSG:4277) to datum ETRS89 (EPSG:4258); units arc-seconds" width="672" />
<p class="caption">
Figure 2.4: UK horizontal datum grid, from datum OSGB 1936 (EPSG:4277) to datum ETRS89 (EPSG:4258); units arc-seconds
</p>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="cs.html#cb33-1" aria-hidden="true"></a>h =<span class="st"> </span><span class="kw">read_stars</span>(<span class="st">&quot;data/uk_os_OSGM15_GB.tif&quot;</span>)</span>
<span id="cb33-2"><a href="cs.html#cb33-2" aria-hidden="true"></a><span class="co"># h = read_stars(&quot;/vsicurl/https://cdn.proj.org/uk_os_OSGM15_GB.tif&quot;)</span></span>
<span id="cb33-3"><a href="cs.html#cb33-3" aria-hidden="true"></a><span class="kw">plot</span>(h, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>)</span>
<span id="cb33-4"><a href="cs.html#cb33-4" aria-hidden="true"></a><span class="kw">plot</span>(uk, <span class="dt">border =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:verticalgrid"></span>
<img src="sds_files/figure-html/verticalgrid-1.png" alt="UK vertical datum grid, from ETRS89 (EPSG:4937) to ODN height (EPSG:5701), units m" width="672" />
<p class="caption">
Figure 2.5: UK vertical datum grid, from ETRS89 (EPSG:4937) to ODN height (EPSG:5701), units m
</p>
</div>
<p>In PROJ.4, every coordinate transformation had to go through a
conversion to and from WGS84; even reprojecting data associated with
a datum different from WGS84 had to go through a transformation to
and from WGS84. The associated errors of up to 100 m were acceptable
for mapping purposes for not too small areas, but applications that
need high accuracy transformations, e.g. precision agriculture,
planning flights of UAV’s, or object tracking are often more
demanding in terms of accuracy.</p>
<p>In 2018, after a successful “GDAL Coordinate System Barn Raising”
initiative, a number of companies profiting from the open source
geospatial software stack supported the development of a more modern,
mature coordinate transformation system in PROJ. Over a few years,
PROJ.4 evolved through versions 5, 6, 7 and 8 and was hence renamed
into PROJ (or PR<span class="math inline">\(\phi\)</span>J).</p>
<p>The most notable changes include:</p>
<ul>
<li>although PROJ.4 strings can still be used to initialize certain
coordinate reference systems, they are no longer sufficient to
represent all of them; a new format, WKT2 (described in next section)
replaces it.</li>
<li>WGS84 as a hub datum is dropped: coordinate transformation no longer
need to go through a particular datum</li>
<li>Multiple conversion or transformation paths (so-called pipelines)
to go from CRS A to CRS B are possible, and can be reported along
with the associated accuracy; PROJ will by default use the most accurate
one but user control is possible</li>
<li>transformation pipelines can chain an arbitrary number of
elementary transformation operations, including swapping of axes
and unit transformations</li>
<li>datum grids, of which there are now <em>many</em> more, are no longer distributed
with the library but are accessible from a CDN; PROJ allows to enabling and
disabling network access to access these grids, and only downloads the section
of the grid actually needed, storing it in a cache on the user’s machine for
future use</li>
<li>coordinate transformations receive support for epochs, time-dependent
transformations (and hence: four-dimensional coordinates, including the
source and target time)</li>
<li>the set of files with registered coordinate reference systems is handled
in an SQLite database.</li>
<li>instead of always handling axis order (longitude, latitude),
when the authority defines differently this is now obeyed (with the
most notable example: EPSG:4326 defines axis order to be latitude,
longitude.)</li>
</ul>
<p>All these points sound like massive improvements, and accuracies
of transformation can be below 1 metre. An interesting point
is the last: Where we could safely assume for many decades that
spatial data with ellipsoidal coordinates would have axis order
(longitude, latitude), this is no longer the case. We will see in
section <a href="#axisorder"><strong>??</strong></a> how to deal with this.</p>
<p>Examples of a horizontal datum grids, downloaded from cdn.proj.org,
are shown in figure <a href="cs.html#fig:horizontalgrid">2.4</a> and for a vertical
datum grid in figure <a href="cs.html#fig:verticalgrid">2.5</a>. Datum grids may carry
per-pixel accuracy values.</p>
</div>
<div id="wkt2" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> WKT-2</h2>
<p><span class="citation">Lott (<a href="#ref-lott2015" role="doc-biblioref">2015</a>)</span> describes a standard for encoding coordinate reference
systems, as well as transformations between them using <em>well known
text</em>; the standard (and format) is referred to informally as
WKT-2. As mentioned above, GDAL and PROJ fully support this encoding.
An example of WKT2 for CRS <code>OGC:CRS84</code> is:</p>
<pre><code>GEOGCRS[&quot;WGS 84&quot;,
    DATUM[&quot;World Geodetic System 1984&quot;,
        ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
            LENGTHUNIT[&quot;metre&quot;,1]],
        ID[&quot;EPSG&quot;,6326]],
    PRIMEM[&quot;Greenwich&quot;,0,
        ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
        ID[&quot;EPSG&quot;,8901]],
    CS[ellipsoidal,2],
        AXIS[&quot;longitude&quot;,east,
            ORDER[1],
            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
                ID[&quot;EPSG&quot;,9122]]],
        AXIS[&quot;latitude&quot;,north,
            ORDER[2],
            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,
                ID[&quot;EPSG&quot;,9122]]]]</code></pre>
<p>This shows a WGS84 ellipsoid, and a coordinate system with the axis
order (longitude, latitude) that can be used to replace <code>EPSG:4326</code>
when one wants unambiguously “traditional” (GIS) axis order.</p>
<p>A longer introduction on the history and recent changes in PROJ is
given in <span class="citation">(R. Bivand <a href="#ref-rogerCRS" role="doc-biblioref">2020</a><a href="#ref-rogerCRS" role="doc-biblioref">b</a>)</span>, building upon the work of <span class="citation">(Knudsen and Evers <a href="#ref-knudsen+evers17" role="doc-biblioref">2017</a>; Evers and Knudsen <a href="#ref-evers+knudsen17" role="doc-biblioref">2017</a>)</span></p>
</div>
<div id="exercises-1" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Exercises</h2>
<p>Try to solve the following exercises with R (without loading packages); try to use functions where appropriate:</p>
<ol style="list-style-type: decimal">
<li>list three <em>geographic</em> measures that do not have a natural zero origin
<!-- latitude, longitude, elevation --></li>
<li>convert the <span class="math inline">\((x,y)\)</span> points <span class="math inline">\((10,2)\)</span>, <span class="math inline">\((-10,-2)\)</span>, <span class="math inline">\((10,-2)\)</span> and <span class="math inline">\((0,10)\)</span> to polar coordinates</li>
<li>convert the polar <span class="math inline">\((r,\phi)\)</span> points <span class="math inline">\((10,45^{\circ})\)</span>, <span class="math inline">\((0,100^{\circ})\)</span> and <span class="math inline">\((5,359^{\circ})\)</span> to Cartesian coordinates</li>
<li>assuming the Earth is a sphere with a radius of 6371 km, compute for <span class="math inline">\((\lambda,\phi)\)</span> points the great circle distance between <span class="math inline">\((10,10)\)</span> and <span class="math inline">\((11,10)\)</span>, between <span class="math inline">\((10,80)\)</span> and <span class="math inline">\((11,80)\)</span>, between <span class="math inline">\((10,10)\)</span> and <span class="math inline">\((10,11)\)</span> and between <span class="math inline">\((10,80)\)</span> and <span class="math inline">\((10,81)\)</span> (units: degree). What are the distance units?</li>
</ol>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references hanging-indent">
<div id="ref-vim">
<p>BIPM, IEC, ILAC IFCC, IUPAP IUPAC, and OIML ISO. 2012. “The International Vocabulary of Metrology–Basic and General Concepts and Associated Terms (Vim), 3rd Edn. JCGM 200: 2012.” <em>JCGM (Joint Committee for Guides in Metrology)</em>. <a href="https://www.bipm.org/en/publications/guides/">https://www.bipm.org/en/publications/guides/</a>.</p>
</div>
<div id="ref-rogerCRS">
<p>Bivand, Roger. 2020b. <em>Why Have Crs, Projections and Transformations Changed?</em> <a href="%20https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html%20">https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html</a>.</p>
</div>
<div id="ref-SI">
<p>Bureau International des Poids et Mesures. 2006. <em>The International System of Units (SI), 8th Edition</em>. Organisation Intergouvernementale de la Convention du Mètre. <a href="https://www.bipm.org/en/publications/si-brochure/download.html">https://www.bipm.org/en/publications/si-brochure/download.html</a>.</p>
</div>
<div id="ref-cobbmoore">
<p>Cobb, George W., and David S. Moore. 1997. “Mathematics, Statistics and Teaching.” <em>The American Mathematical Monthly</em> 104 (9): 801–23. <a href="%20http://www.jstor.org/stable/2975286%20">http://www.jstor.org/stable/2975286</a>.</p>
</div>
<div id="ref-evenden:90">
<p>Evenden, Gerald I. 1990. <em>Cartographic Projection Procedures for the UNIX Environment — a User’s Manual</em>. <a href="http://download.osgeo.org/proj/OF90-284.pdf">http://download.osgeo.org/proj/OF90-284.pdf</a>.</p>
</div>
<div id="ref-evers+knudsen17">
<p>Evers, Kristian, and Thomas Knudsen. 2017. <em>Transformation Pipelines for Proj.4</em>. <a href="https://www.fig.net/resources/proceedings/fig_proceedings/fig2017/papers/iss6b/ISS6B_evers_knudsen_9156.pdf">https://www.fig.net/resources/proceedings/fig_proceedings/fig2017/papers/iss6b/ISS6B_evers_knudsen_9156.pdf</a>.</p>
</div>
<div id="ref-hand">
<p>Hand, David J. 2004. <em>Measurement: Theory and Practice</em>. A Hodder Arnold Publication.</p>
</div>
<div id="ref-iliffelott">
<p>Iliffe, Jonathan, and Roger Lott. 2008. <em>Datums and Map Projections for Remote Sensing, Gis, and Surveying. Whittles Pub</em>. CRC Press, Scotland, UK.</p>
</div>
<div id="ref-karney2013algorithms">
<p>Karney, Charles FF. 2013. “Algorithms for Geodesics.” <em>Journal of Geodesy</em> 87 (1): 43–55. <a href="https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf">https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf</a>.</p>
</div>
<div id="ref-knudsen+evers17">
<p>Knudsen, Thomas, and Kristian Evers. 2017. <em>Transformation Pipelines for Proj.4</em>. <a href="https://meetingorganizer.copernicus.org/EGU2017/EGU2017-8050.pdf">https://meetingorganizer.copernicus.org/EGU2017/EGU2017-8050.pdf</a>.</p>
</div>
<div id="ref-lott2015">
<p>Lott, Roger. 2015. “Geographic Information-Well-Known Text Representation of Coordinate Reference Systems.” Open Geospatial Consortium. <a href="%20http://docs.opengeospatial.org/is/12-063r5/12-063r5.html%20">http://docs.opengeospatial.org/is/12-063r5/12-063r5.html</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="geometries.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/edzer/sdsr/edit/master/02-Spaces.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
