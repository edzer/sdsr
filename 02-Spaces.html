<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Coordinates – Spatial Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03-Geometries.html" rel="next">
<link href="./01-hello.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cd7de1037569933fbb609f06423bd096.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-04YTZNEH1K"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-04YTZNEH1K', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-1.html">Spatial Data</a></li><li class="breadcrumb-item"><a href="./02-Spaces.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/sdsr/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-hello.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Spaces.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Geometries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Spherical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Attributes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Cubes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R for Spatial Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Introsf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to sf and stars</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Large.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Large data and cloud native</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models for Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-PointPattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Point Pattern Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Interpolation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Geostatistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multivariate and Spatiotemporal Geostatistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Areal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Proximity and Areal Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Measures of Spatial Autocorrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-SpatialRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Econometrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial Econometrics Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Older R Spatial Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rbasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ERRATA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Errata to the printed ed.</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-units" id="toc-sec-units" class="nav-link active" data-scroll-target="#sec-units"><span class="header-section-number">2.1</span> Quantities, units, datum</a></li>
  <li><a href="#ellipsoidal-coordinates" id="toc-ellipsoidal-coordinates" class="nav-link" data-scroll-target="#ellipsoidal-coordinates"><span class="header-section-number">2.2</span> Ellipsoidal coordinates</a>
  <ul class="collapse">
  <li><a href="#spherical-or-ellipsoidal-coordinates" id="toc-spherical-or-ellipsoidal-coordinates" class="nav-link" data-scroll-target="#spherical-or-ellipsoidal-coordinates">Spherical or ellipsoidal coordinates</a></li>
  <li><a href="#sec-projections" id="toc-sec-projections" class="nav-link" data-scroll-target="#sec-projections">Projected coordinates, distances</a></li>
  <li><a href="#sec-bounded" id="toc-sec-bounded" class="nav-link" data-scroll-target="#sec-bounded">Bounded and unbounded spaces</a></li>
  </ul></li>
  <li><a href="#sec-crs" id="toc-sec-crs" class="nav-link" data-scroll-target="#sec-crs"><span class="header-section-number">2.3</span> Coordinate reference systems</a></li>
  <li><a href="#sec-projlib" id="toc-sec-projlib" class="nav-link" data-scroll-target="#sec-projlib"><span class="header-section-number">2.4</span> PROJ and mapping accuracy</a></li>
  <li><a href="#sec-wkt2" id="toc-sec-wkt2" class="nav-link" data-scroll-target="#sec-wkt2"><span class="header-section-number">2.5</span> WKT-2</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.6</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/edzer/sdsr/edit/python/02-Spaces.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-1.html">Spatial Data</a></li><li class="breadcrumb-item"><a href="./02-Spaces.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-cs" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>“<em>Data are not just numbers, they are numbers with a context</em>”; “<em>In data analysis, context provides meaning</em>” <span class="citation" data-cites="cobbmoore">(<a href="references.html#ref-cobbmoore" role="doc-biblioref">Cobb and Moore 1997</a>)</span></p>
<p>Before we can try to understand geometries like points, lines, polygons, coverage and grids, it is useful to review coordinate systems so that we have an idea what exactly coordinates of a point reflect. For spatial data, the location of observations are characterised by coordinates, and coordinates are defined in a coordinate system. Different coordinate systems can be used for this, and the most important difference is whether coordinates are defined over a 2 dimensional or 3 dimensional space referenced to orthogonal axes (Cartesian coordinates), or using distance and directions (polar coordinates, spherical and ellipsoidal coordinates). Besides a location of observation, all observations are associated with time of observation, and so time coordinate systems are also briefly discussed. First we will briefly review <em>quantities</em>, to learn what units and datum are.</p>
<section id="sec-units" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-units"><span class="header-section-number">2.1</span> Quantities, units, datum</h2>
<p> </p>
<p>The VIM (“International Vocabulary of Metrology”, <span class="citation" data-cites="vim">BIPM et al. (<a href="references.html#ref-vim" role="doc-biblioref">2012</a>)</span>) defines a <em>quantity</em> as a “property of a phenomenon, body, or substance, where the property has a magnitude that can be expressed as a number and a reference”, where “[a] reference can be a measurement unit, a measurement procedure, a reference material, or a combination of such.” Although one could argue about whether all data is constituted of quantities, there is no need to argue that proper data handling requires that numbers (or symbols) are accompanied by information on what they mean, in particular what they refer to.</p>
<p>A measurement system consists of <em>base units</em> for base quantities, and <em>derived units</em> for derived quantities. For instance, the SI system of units <span class="citation" data-cites="SI">(<a href="references.html#ref-SI" role="doc-biblioref">Bureau International des Poids et Mesures 2006</a>)</span> consists of seven base units: length (metre, m), mass (kilogram, kg), time (second, s), electric current (ampere, A), thermodynamic temperature (Kelvin, K), amount of substance (mole, mol), and luminous intensity (candela, cd). Derived units are composed of products of integer powers of base units; examples are speed (<span class="math inline">\(\mbox{m}~\mbox{s}^{-1}\)</span>), density (<span class="math inline">\(\mbox{kg}~\mbox{m}^{-3}\)</span>) and area (<span class="math inline">\(\mbox{m}^2\)</span>).</p>
<p>The special case of unitless measures can refer to either cases where units cancel out (for instance mass fraction: kg/kg, or angle measured in rad: m/m) or to cases where objects or events were counted (such as “5 apples”). Adding an angle to a count of apples would not make sense; adding 5 apples to 3 oranges may make sense if the result is reinterpreted in terms of a superclass, in this case as <em>pieces of fruit</em>. Many data variables have units that are not expressible as SI base units or derived units. <span class="citation" data-cites="hand">Hand (<a href="references.html#ref-hand" role="doc-biblioref">2004</a>)</span> discusses many such measurement scales, including those used to measure variables like intelligence in social sciences, in the context of measurement units.</p>
<p>For many quantities, the natural origin of values is zero. This works for amounts, where differences between amounts result in meaningful negative values. For locations and times, differences have a natural zero interpretation: distance and duration. Absolute location (position) and time need a fixed origin, from which we can meaningfully measure other absolute space time points: we call this <strong>a datum</strong>. For space, a datum involves more than one dimension. The combination of a datum and a measurement unit (scale) is a <em>reference system</em>.</p>
<p></p>
<p>We will now elaborate how spatial locations can be expressed as either ellipsoidal or Cartesian coordinates. The next sections will deal with temporal and spatial reference systems, and how they are handled in R.</p>
</section>
<section id="ellipsoidal-coordinates" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="ellipsoidal-coordinates"><span class="header-section-number">2.2</span> Ellipsoidal coordinates</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">pos =</span> <span class="dv">0</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">pos =</span> <span class="dv">0</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">6</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>xd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xd, <span class="fu">sqrt</span>(<span class="dv">25</span> <span class="sc">-</span> xd<span class="sc">^</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xd, <span class="sc">-</span><span class="fu">sqrt</span>(<span class="dv">25</span> <span class="sc">-</span> xd<span class="sc">^</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">length =</span> .<span class="dv">15</span>, <span class="at">angle =</span> <span class="dv">20</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.5</span>, <span class="fl">2.7</span>, <span class="at">label =</span> <span class="st">"r"</span>, <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>xd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">3</span><span class="sc">/</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xd, <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> xd<span class="sc">^</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.2</span>, <span class="fl">0.5</span>, <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="st">"phi"</span>), <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">'blue'</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">'blue'</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">3.3</span>, <span class="fl">0.3</span>, <span class="at">label =</span> <span class="st">"x"</span>, <span class="at">col =</span> <span class="st">'blue'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.3</span>, <span class="fl">4.3</span>, <span class="at">label =</span> <span class="st">"y"</span>, <span class="at">col =</span> <span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-polar" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-polar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-Spaces_files/figure-html/fig-polar-1.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-polar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Two-dimensional polar (red) and Cartesian (blue) coordinates
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-polar" class="quarto-xref">Figure&nbsp;<span>2.1</span></a> shows both polar and Cartesian coordinates for a two-dimensional situation. In Cartesian coordinates, the point shown is <span class="math inline">\((x,y) = (3,4)\)</span>, for polar coordinates it is <span class="math inline">\((r,\phi) = (5, \mbox{arctan}(4/3))\)</span>, where <span class="math inline">\(\mbox{arctan}(4/3)\)</span> is approximately <span class="math inline">\(0.93\)</span> radians, or <span class="math inline">\(53^{\circ}\)</span>. Note that <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span> and <span class="math inline">\(r\)</span> all have length units, where <span class="math inline">\(\phi\)</span> is an angle (a unitless length/length ratio). Converting back and forth between Cartesian and polar coordinates is trivial, as <span class="math display">\[x = r~\mbox{cos} \phi,\ \ \ y = r~\mbox{sin} \phi, \ \mbox{and}\]</span> <span class="math display">\[r = \sqrt{x^2 + y^2}, \ \ \ \phi = \mbox{atan2}(y, x)\]</span> where <span class="math inline">\(\mbox{atan2}\)</span> is used in favour of <span class="math inline">\(\mbox{atan}(y/x)\)</span> to take care of the right quadrant.</p>
<section id="spherical-or-ellipsoidal-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="spherical-or-ellipsoidal-coordinates">Spherical or ellipsoidal coordinates</h3>
<p> </p>
<p>In three dimensions, where Cartesian coordinates are expressed as <span class="math inline">\((x,y,z)\)</span>, spherical coordinates are the three-dimensional equivalent of polar coordinates and can be expressed as <span class="math inline">\((r,\lambda,\phi)\)</span>, where:</p>
<ul>
<li><span class="math inline">\(r\)</span> is the radius of the sphere,</li>
<li><span class="math inline">\(\lambda\)</span> is the longitude, measured in the <span class="math inline">\((x,y)\)</span> plane counter-clockwise from positive <span class="math inline">\(x\)</span>, and</li>
<li><span class="math inline">\(\phi\)</span> is the latitude, the angle between the vector and the <span class="math inline">\((x,y)\)</span> plane.</li>
</ul>
<p><a href="#fig-sphere" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> illustrates Cartesian geocentric and ellipsoidal coordinates.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="sc">|&gt;</span> <span class="fu">suppressPackageStartupMessages</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="sc">-</span><span class="dv">90</span><span class="sc">:</span><span class="dv">90</span>,<span class="dv">0</span>) <span class="co"># equator</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">90</span><span class="sc">:</span><span class="dv">90</span>)) <span class="co"># 0/antimerid.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">90</span>, <span class="sc">-</span><span class="dv">90</span><span class="sc">:</span><span class="dv">90</span>), <span class="fu">cbind</span>(<span class="dv">270</span>, <span class="dv">90</span><span class="sc">:-</span><span class="dv">90</span>))<span class="co"># +/- 90</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>eq <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(e), <span class="fu">st_linestring</span>(f1), <span class="fu">st_linestring</span>(f2), <span class="at">crs=</span><span class="st">'OGC:CRS84'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>geoc <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(eq, <span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(geoc[[<span class="dv">1</span>]], <span class="cn">NA</span>, geoc[[<span class="dv">2</span>]], <span class="cn">NA</span>, geoc[[<span class="dv">3</span>]])</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>from3d <span class="ot">&lt;-</span> <span class="cf">function</span>(x, offset, maxz, minz) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">=</span> x[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>)] <span class="sc">+</span> offset <span class="co"># move to y right, x up, z backw</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    x[,<span class="dv">2</span>] <span class="ot">=</span> x[,<span class="dv">2</span>] <span class="sc">-</span> maxz      <span class="co"># shift y to left</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">=</span> maxz</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">=</span> x[,<span class="dv">3</span>] <span class="sc">-</span> minz <span class="sc">+</span> offset</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    x[,<span class="dv">1</span>] <span class="ot">=</span> x[,<span class="dv">1</span>] <span class="sc">*</span> (d<span class="sc">/</span>z)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    x[,<span class="dv">2</span>] <span class="ot">=</span> x[,<span class="dv">2</span>] <span class="sc">*</span> (d<span class="sc">/</span>z)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>maxz <span class="ot">&lt;-</span> <span class="fu">max</span>(cc[,<span class="dv">3</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>minz <span class="ot">&lt;-</span> <span class="fu">min</span>(cc[,<span class="dv">3</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>offset <span class="ot">&lt;-</span> <span class="fl">3e7</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>circ <span class="ot">&lt;-</span> <span class="fu">from3d</span>(cc, offset, maxz, minz)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>mx <span class="ot">&lt;-</span> <span class="fu">max</span>(cc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(mx, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, mx, <span class="dv">0</span>))</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, mx))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x, <span class="cn">NA</span>, y, <span class="cn">NA</span>, z)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>l0 <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(ll, offset, maxz, minz)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>mx <span class="ot">&lt;-</span> <span class="fu">max</span>(cc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.2</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(mx, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, mx, <span class="dv">0</span>))</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, mx))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>ll <span class="ot">&lt;-</span> <span class="fu">rbind</span>(x, <span class="cn">NA</span>, y, <span class="cn">NA</span>, z)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(ll, offset, maxz, minz)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.window</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">min</span>(circ[,<span class="dv">1</span>],<span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">3607103</span><span class="sc">*</span><span class="fl">1.02</span>), </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(circ[,<span class="dv">2</span>],<span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2873898</span><span class="sc">*</span><span class="fl">1.1</span>), <span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(circ)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(l0)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(l[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>),], <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>), <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co"># add POINT(60 47)</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(60 47)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p[[<span class="dv">1</span>]]</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p[<span class="dv">1</span>],<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p[<span class="dv">1</span>],p[<span class="dv">2</span>],<span class="dv">0</span>), <span class="fu">c</span>(p[<span class="dv">1</span>],p[<span class="dv">2</span>],p[<span class="dv">2</span>]))</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>ptsl <span class="ot">&lt;-</span> <span class="fu">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ptsl, <span class="at">col =</span> <span class="st">'blue'</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(ptsl[<span class="dv">4</span>,<span class="dv">1</span>], ptsl[<span class="dv">4</span>,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">'blue'</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.window</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">min</span>(circ[,<span class="dv">1</span>],<span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">3607103</span><span class="sc">*</span><span class="fl">1.02</span>), </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">min</span>(circ[,<span class="dv">2</span>],<span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2873898</span><span class="sc">*</span><span class="fl">1.1</span>), <span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(circ)</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(60 47)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p[[<span class="dv">1</span>]]</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p[<span class="dv">1</span>],p[<span class="dv">2</span>],p[<span class="dv">3</span>]))</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pt)</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(pt[<span class="dv">2</span>,<span class="dv">1</span>], pt[<span class="dv">2</span>,<span class="dv">2</span>], <span class="at">col =</span> <span class="st">'blue'</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(60 0)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> p0[[<span class="dv">1</span>]]</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pt)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(0 0)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> p0[[<span class="dv">1</span>]]</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pt)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(0 90)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> p0[[<span class="dv">1</span>]]</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pt, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(90 0)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> p0[[<span class="dv">1</span>]]</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(p0[<span class="dv">1</span>],p0[<span class="dv">2</span>],p0[<span class="dv">3</span>]))</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span>  <span class="fu">from3d</span>(pts, offset, maxz, minz)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(pt, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">60</span>, <span class="dv">0</span>))</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>arc <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(f1), <span class="at">crs=</span><span class="st">'OGC:CRS84'</span>)</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>geoc <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(arc, <span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(geoc[[<span class="dv">1</span>]])</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>circ <span class="ot">&lt;-</span> <span class="fu">from3d</span>(cc, offset, maxz, minz)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(circ, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">60</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">47</span>))</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>arc <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(f1), <span class="at">crs=</span><span class="st">'OGC:CRS84'</span>)</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>geoc <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(arc, <span class="st">"+proj=geocent"</span>)</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>cc <span class="ot">&lt;-</span> <span class="fu">rbind</span>(geoc[[<span class="dv">1</span>]])</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>circ <span class="ot">&lt;-</span> <span class="fu">from3d</span>(cc, offset, maxz, minz)</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(circ, <span class="at">col =</span> <span class="st">'blue'</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pt[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="dv">100000</span>, pt[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="dv">50000</span>, <span class="at">labels =</span> <span class="fu">expression</span>(phi), <span class="at">col =</span> <span class="st">'blue'</span>) <span class="co"># lat</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(pt[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="dv">20000</span>, pt[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">-</span><span class="dv">50000</span>, <span class="at">labels =</span> <span class="fu">expression</span>(lambda), <span class="at">col =</span> <span class="st">'red'</span>) <span class="co"># lng</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sphere" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sphere-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-Spaces_files/figure-html/fig-sphere-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sphere-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Cartesian geocentric coordinates (left) measure three distances, ellipsoidal coordinates (right) measure two angles, and possibly an ellipsoidal height
</figcaption>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\(\lambda\)</span> typically varies between <span class="math inline">\(-180^{\circ}\)</span> and <span class="math inline">\(180^{\circ}\)</span> (or alternatively from <span class="math inline">\(0^{\circ}\)</span> to <span class="math inline">\(360^{\circ}\)</span>), <span class="math inline">\(\phi\)</span> from <span class="math inline">\(-90^{\circ}\)</span> to <span class="math inline">\(90^{\circ}\)</span>. When we are only interested in points <em>on</em> a sphere with given radius, we can drop <span class="math inline">\(r\)</span>: <span class="math inline">\((\lambda,\phi)\)</span> now suffice to identify any point.</p>
<div style="page-break-after: always;"></div>
<p>It should be noted that this is just <em>a</em> definition, one could for instance also choose to measure polar angle, the angle between the vector and <span class="math inline">\(z\)</span>, instead of latitude. There is also a long tradition of specifying points as <span class="math inline">\((\phi,\lambda)\)</span> but throughout this book we will stick to longitude-latitude, <span class="math inline">\((\lambda,\phi)\)</span>. The point denoted in <a href="#fig-sphere" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> has <span class="math inline">\((\lambda,\phi)\)</span> or ellipsoidal coordinates with angular values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(60 47)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># POINT (60 47)</code></pre>
</div>
</div>
<p>measured in degrees, and geocentric coordinates</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(<span class="st">"POINT(60 47)"</span>, <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>) <span class="sc">|&gt;</span> <span class="fu">st_transform</span>(<span class="st">"+proj=geocent"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>p[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># POINT Z (2178844 3773868 4641765)</code></pre>
</div>
</div>
<p>measured in metres.</p>
<p></p>
<p>For points on an ellipse, there are two ways in which angle can be expressed (<a href="#fig-ellipse" class="quarto-xref">Figure&nbsp;<span>2.3</span></a>): measured from the centre of the ellipse (<span class="math inline">\(\psi\)</span>), or measured perpendicular to the tangent on the ellipse at the target point (<span class="math inline">\(\phi\)</span>).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">8</span> <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">48</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>,<span class="dv">6</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>,<span class="dv">8</span>), <span class="at">asp =</span> <span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">pos =</span> <span class="dv">0</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">pos =</span> <span class="dv">0</span>, <span class="at">at =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>xd <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>, <span class="at">by =</span> .<span class="dv">1</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xd, <span class="dv">5</span><span class="sc">/</span><span class="dv">8</span> <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">64</span> <span class="sc">-</span> xd<span class="sc">^</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(xd, <span class="dv">5</span><span class="sc">/</span><span class="dv">8</span> <span class="sc">*</span> <span class="sc">-</span><span class="fu">sqrt</span>(<span class="dv">64</span> <span class="sc">-</span> xd<span class="sc">^</span><span class="dv">2</span>), <span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, x, y, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">length =</span> .<span class="dv">15</span>, <span class="at">angle =</span> <span class="dv">20</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> (x <span class="sc">*</span> <span class="dv">25</span>) <span class="sc">/</span> (<span class="sc">-</span>y <span class="sc">*</span> <span class="dv">64</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> y <span class="sc">-</span> x <span class="sc">*</span> b</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(a, b, <span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span>b</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> x <span class="sc">-</span> y <span class="sc">/</span> b</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(x0, <span class="dv">0</span>, x, y, <span class="at">col =</span> <span class="st">'blue'</span>, <span class="at">length =</span> .<span class="dv">15</span>, <span class="at">angle =</span> <span class="dv">20</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">1.2</span>, <span class="fl">0.5</span>, <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="st">"psi"</span>), <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">3</span>, <span class="fl">0.5</span>, <span class="at">label =</span> <span class="fu">parse</span>(<span class="at">text =</span> <span class="st">"phi"</span>), <span class="at">col =</span> <span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-ellipse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ellipse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-Spaces_files/figure-html/fig-ellipse-1.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ellipse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Angles on an ellipse: geodetic (blue) and geocentric (red) latitude
</figcaption>
</figure>
</div>
</div>
</div>
<p>The most commonly used parametric model for the Earth is <em>an ellipsoid of revolution</em>, an ellipsoid with two equal semi-axes <span class="citation" data-cites="iliffelott">(<a href="references.html#ref-iliffelott" role="doc-biblioref">Iliffe and Lott 2008</a>)</span>. In effect, this is a flattened sphere (or spheroid): the distance between the poles is (slightly: about 0.33%) smaller than the distance between two opposite points on the equator. Under this model, longitude is always measured along a circle (as in <a href="#fig-sphere" class="quarto-xref">Figure&nbsp;<span>2.2</span></a>), and latitude along an ellipse (as in <a href="#fig-ellipse" class="quarto-xref">Figure&nbsp;<span>2.3</span></a>). If we think of <a href="#fig-ellipse" class="quarto-xref">Figure&nbsp;<span>2.3</span></a> as a cross section of the Earth passing through the poles, the <em>geodetic</em> latitude measure <span class="math inline">\(\phi\)</span> is the one used when no further specification is given. The latitude measure <span class="math inline">\(\psi\)</span> is called the <em>geocentric latitude</em>.</p>
<p> </p>
<p>we can add <em>altitude</em> or elevation to longitude and latitude to define points that are above or below the ellipsoid, and obtain a three-dimensional space again. When defining altitude, we need to choose:</p>
<ul>
<li>where zero altitude is: on the ellipsoid, or relative to the surface approximating mean sea level (the geoid)?</li>
<li>which direction is positive, and</li>
<li>which direction is “straight up”: perpendicular to the ellipsoid surface, or in the direction of gravity, perpendicular to the surface of the geoid?</li>
</ul>
<p>All these choices may matter, depending on the application area and required measurement accuracies.</p>
<p>The shape of the Earth is not a perfect ellipsoid. As a consequence, several ellipsoids with different shape parameters and bound to the Earth in different ways are being used. Such ellipsoids are called <em>datums</em>, and are briefly discussed in <a href="#sec-crs" class="quarto-xref"><span>Section 2.3</span></a>, along with <em>coordinate reference systems</em>.</p>
</section>
<section id="sec-projections" class="level3">
<h3 class="anchored" data-anchor-id="sec-projections">Projected coordinates, distances</h3>
<p>Because paper maps and computer screens are much more abundant and practical than globes, when we look at spatial data we see it <em>projected</em>: drawn on a flat, two-dimensional surface. Computing the locations in a two-dimensional space means that we work with <em>projected</em> coordinates. Projecting ellipsoidal coordinates means that shapes, directions, areas, or even all three, are distorted <span class="citation" data-cites="iliffelott">(<a href="references.html#ref-iliffelott" role="doc-biblioref">Iliffe and Lott 2008</a>)</span>.</p>
<p> </p>
<p>Distances between two points <span class="math inline">\(p_i\)</span> and <span class="math inline">\(p_j\)</span> in Cartesian coordinates are computed as Euclidean distances, in two dimensions by <span class="math display">\[d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2}\]</span> with <span class="math inline">\(p_i = (x_i,y_i)\)</span> and in three dimensions by <span class="math display">\[d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2+(z_i-z_j)^2}\]</span> with <span class="math inline">\(p_i = (x_i,y_i,z_i).\)</span> These distances represent the length of a <em>straight</em> line between two points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<p>For two points on a circle, the length of the arc of two points <span class="math inline">\(c_1 = (r,{\phi}_1)\)</span> and <span class="math inline">\(c_2 = (r, \phi_2)\)</span> is <span class="math display">\[s_{ij}=r~|\phi_1-\phi_2| = r ~\theta\]</span> with <span class="math inline">\(\theta\)</span> the angle between <span class="math inline">\(\phi_1\)</span> and <span class="math inline">\(\phi_2\)</span> in radians. For very small values of <span class="math inline">\(\theta\)</span>, we will have <span class="math inline">\(s_{ij} \approx d_{ij}\)</span>, because a small arc segment is nearly straight.</p>
<p></p>
<p>For two points <span class="math inline">\(p_1 = (\lambda_1,\phi_1)\)</span> and <span class="math inline">\(p_2 =
(\lambda_2,\phi_2)\)</span> on a sphere with radius <span class="math inline">\(r'\)</span>, the <em>great circle distance</em> is the arc length between <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> on the circle that passes through <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> and has the centre of the sphere as its centre, and is given by <span class="math inline">\(s_{12} = r ~ \theta_{12}\)</span> with <span class="math display">\[\theta_{12} = \arccos(\sin \phi_1 \cdot \sin \phi_2 + \cos \phi_1 \cdot \cos \phi_2 \cdot \cos(|\lambda_1-\lambda_2|))\]</span> the angle between <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span>, in radians.</p>
<p>Arc distances between two points on a spheroid are more complicated to compute; a good discussion on the topic and an explanation of the method implemented in GeographicLib (part of PROJ) is given in <span class="citation" data-cites="karney2013algorithms">Karney (<a href="references.html#ref-karney2013algorithms" role="doc-biblioref">2013</a>)</span>.</p>
<p></p>
<p>To show that these distance measures actually give different values, we computed them for the distance Berlin - Paris. Here, <code>gc_</code> refers to ellipsoidal and spherical great circle distances, <code>str_</code> refers to straight line, Euclidean distances between Cartesian geocentric coordinates associated on the WGS84 ellipse and sphere:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pts <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">13.4050</span>, <span class="fl">52.5200</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="fl">2.3522</span>, <span class="fl">48.8566</span>)), <span class="at">crs =</span> <span class="st">'OGC:CRS84'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>s2_orig <span class="ot">&lt;-</span> <span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">gc_ellipse =</span> <span class="fu">st_distance</span>(pts)[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">TRUE</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># or, without using s2, use st_distance(st_transform(pts, "+proj=cart +ellps=sphere"))</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">gc_sphere =</span> <span class="fu">st_distance</span>(pts)[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(pts, <span class="st">"+proj=cart +ellps=WGS84"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">str_ellipse =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">apply</span>(<span class="fu">do.call</span>(cbind, p), <span class="dv">1</span>, diff)<span class="sc">^</span><span class="dv">2</span>)), m))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(pts, <span class="st">"+proj=cart +ellps=sphere"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>d4 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">str_sphere =</span> units<span class="sc">::</span><span class="fu">set_units</span>(<span class="fu">sqrt</span>(<span class="fu">sum</span>(<span class="fu">apply</span>(<span class="fu">do.call</span>(cbind, p2), <span class="dv">1</span>, diff)<span class="sc">^</span><span class="dv">2</span>)), m))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">c</span>(d1, d3, d2, d4) <span class="co"># note order</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print as km, re-add names:</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(s2_orig) <span class="co"># back to what it was before changing</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>res <span class="sc">|&gt;</span> units<span class="sc">::</span><span class="fu">set_units</span>(km) <span class="sc">|&gt;</span> <span class="fu">setNames</span>(<span class="fu">names</span>(res)) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">digits =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Units: [km]
#  gc_ellipse str_ellipse   gc_sphere  str_sphere 
#      879.70      879.00      877.46      879.00</code></pre>
</div>
</div>
</section>
<section id="sec-bounded" class="level3">
<h3 class="anchored" data-anchor-id="sec-bounded">Bounded and unbounded spaces</h3>
<p> </p>
<p>Two-dimensional and three-dimensional Euclidean spaces (<span class="math inline">\(R^2\)</span> and <span class="math inline">\(R^3\)</span>) are unbounded. Every line in this space has infinite length, and areas or volumes have no natural upper limit. In contrast, spaces defined on a circle (<span class="math inline">\(S^1\)</span>) or sphere (<span class="math inline">\(S^2\)</span>) define a bounded set: there may be infinitely many points but the length and area of the circle, and the radius, area and volume of a sphere are bounded.</p>
<p>This may sound trivial but leads to some interesting challenges when handling spatial data. A polygon on <span class="math inline">\(R^2\)</span> has unambiguously an inside and an outside. On a sphere, <span class="math inline">\(S^2\)</span>, any polygon divides the sphere in two parts, and which of these two is to be considered inside and which outside is ambiguous and needs to be defined by the traversal direction. <a href="04-Spherical.html" class="quarto-xref"><span>Chapter 4</span></a> will further discuss consequences when working with geometries on <span class="math inline">\(S^2\)</span>.</p>
<p> </p>
</section>
</section>
<section id="sec-crs" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-crs"><span class="header-section-number">2.3</span> Coordinate reference systems</h2>
<p></p>
<p>We follow <span class="citation" data-cites="lott2015">Lott (<a href="references.html#ref-lott2015" role="doc-biblioref">2015</a>)</span> when defining the following concepts (italics indicate literal quoting):</p>
<ul>
<li>a <strong>coordinate system</strong> is a <em>set of mathematical rules for specifying how coordinates are to be assigned to points</em>,</li>
<li>a <strong>datum</strong> is a <em>parameter or set of parameters that define the position of the origin, the scale, and the orientation of a coordinate system</em>,</li>
<li>a <strong>geodetic datum</strong> is a <em>datum describing the relationship of a two- or three-dimensional coordinate system to the Earth</em>, and</li>
<li>a <strong>coordinate reference system</strong> is a <em>coordinate system that is related to an object by a datum; for geodetic and vertical datums, the object will be the Earth.</em></li>
</ul>
<p> </p>
<p>A readable text that further explains these concepts is <span class="citation" data-cites="iliffelott">Iliffe and Lott (<a href="references.html#ref-iliffelott" role="doc-biblioref">2008</a>)</span>.</p>
<p>The Earth does not follow a regular shape. The topography of the Earth is of course known to vary strongly, but also the surface formed by constant gravity at mean sea level, the geoid, is irregular. A commonly used model that is fit to the geoid is an ellipsoid of revolution, which is an ellipsoid with two identical minor axes. Fitting such an ellipsoid to the Earth gives a datum. However, fitting it to different areas, or based on different sets of reference points gives different fits, and hence different datums: a datum can for instance be fixed to a particular tectonic plate (like the European Terrestrial Reference System 1989 (ETRS89)), others can be globally fit (like WGS84). More local fits lead to smaller approximation errors.</p>
<p></p>
<p>The definitions above imply that coordinates in degrees longitude and latitude only have a meaning and can only be interpreted unambiguously as Earth coordinates, when the datum they are associated with is given.</p>
<p>Note that for projected data, the data that <em>were</em> projected are associated with a reference ellipsoid (datum). Going from one projection to another <em>without</em> changing datum is called <em>coordinate conversion</em>, and passes through the ellipsoidal coordinates associated with the datum involved. This process is lossless and invertible: the parameters and equations associated with a <em>conversion</em> are not empirical. Recomputing coordinates in a new datum is called <em>coordinate transformation</em>, and is approximate: because datums are a result of model fitting, transformations between datums are models too that have been fit; the equations involved are empirical, and multiple transformation paths, based on different model fits and associated with different accuracies, are possible.</p>
<p> </p>
<p>Plate tectonics imply that within a global datum, fixed objects may have coordinates that change over time, and that transformations from one datum to another may be time-dependent. Earthquakes are a cause of more local and sudden changes in coordinates. Local datums may be fixed to tectonic plates (such as ETRS89), or may be dynamic.</p>
<p></p>
</section>
<section id="sec-projlib" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-projlib"><span class="header-section-number">2.4</span> PROJ and mapping accuracy</h2>
<p>Very few living people active in open source geospatial software can remember the time before PROJ. PROJ <span class="citation" data-cites="evenden:90">(<a href="references.html#ref-evenden:90" role="doc-biblioref">Evenden 1990</a>)</span> started in the 1970s as a Fortran project, and was released in 1985 as a C library for cartographic projections. It came with command line tools for direct and inverse projections, and could be linked to software to let it support (re)projection directly. Originally, datums were considered implicit, and no datum transformations were allowed.</p>
<p> </p>
<p>In the early 2000s, PROJ was known as PROJ.4, after its never-changing major version number. Amongst others motivated by the rise of GPS, the need for datum transformations increased and PROJ.4 was extended with rudimentary datum support. PROJ definitions for coordinate reference systems would look like this:</p>
<pre><code>+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs</code></pre>
<p>where <em>key</em>=<em>value</em> pairs are preceded by a <code>+</code> and separated by a space. This form came to be known as “PROJ.4 string”, since the PROJ project stayed at version 4.x for several decades. Other datums would come with fields like:</p>
<pre><code>+ellps=bessel +towgs84=565.4,50.3,465.6,-0.399,0.344,-1.877,4.072</code></pre>
<p>indicating another ellipse, as well as the seven (or three) parameters for transforming from this ellipse to WGS84 (the “World Geodetic System 1984” global datum once popularised by GPS), effectively defining the datum in terms of a transformation to WGS84.</p>
<p>Along with PROJ.4 came a set of databases with known (registered) projections, from which the best known is the European Petroleum Survey Group (EPSG) registry. National mapping agencies would provide (and update over time) their best guesses of <code>+towgs84</code> parameters for national coordinate reference systems, and distribute through the EPSG registry, which was part of PROJ distributions. For some transformations, <em>datum grids</em> were available and distributed as part of PROJ.4: such grids are raster maps that provide for every location pre-computed values for the shift in longitude and latitude, or elevation, for a particular datum transformation.</p>
<p>In PROJ.4, every coordinate transformation had to go through a conversion to and from WGS84; even reprojecting data associated with a datum different from WGS84 had to go through a transformation to and from WGS84. The associated errors of up to 100 m were acceptable for mapping purposes for not too small areas, but some applications need higher accuracy transformations. Examples include precision agriculture, planning flights of UAV’s, or object tracking.</p>
<p>In 2018, after a successful “GDAL Coordinate System Barn Raising” initiative, a number of companies profiting from the open source geospatial software stack supported the development of a more modern, mature coordinate transformation system in PROJ. Over a few years, PROJ.4 evolved through versions 5, 6, 7, 8 and 9 and was hence renamed into PROJ (or PR<span class="math inline">\(\phi\)</span>J).</p>
<p> </p>
<p>The most notable changes include:</p>
<ul>
<li>although PROJ.4 strings can still be used to initialise certain coordinate reference systems, they are no longer sufficient to represent all of them; a new format, WKT-2 (described in next section) replaces it</li>
<li>WGS84 as a hub datum is dropped: coordinate transformations no longer need to go through a particular datum</li>
<li>multiple conversion or transformation paths (so-called pipelines) to go from CRS A to CRS B are possible, and can be reported along with the associated accuracy; PROJ will by default use the most accurate one but user control is possible</li>
<li>transformation pipelines can chain an arbitrary number of elementary transformation operations, including swapping of axes and unit transformations</li>
<li>datum grids, of which there are now <em>many</em> more, are no longer distributed with the library but are accessible from a content delivery network (CDN); PROJ allows enabling and disabling network access to these grids and only downloads the section(s) of the grid actually needed, storing it in a cache on the user’s machine for future use</li>
<li>coordinate transformations receive support for epochs, time-dependent transformations (and hence: four-dimensional coordinates, including the source and target time)</li>
<li>the set of files with registered coordinate reference systems is handled in an SQLite database</li>
<li>instead of always handling axis order (longitude, latitude), when the authority defines differently this is now obeyed (but see <a href="#sec-wkt2" class="quarto-xref"><span>Section 2.5</span></a> and <a href="07-Introsf.html#sec-axisorder" class="quarto-xref"><span>Section 7.7.6</span></a>)</li>
</ul>
<p> </p>
<p>All these points sound like massive improvements, and accuracies of transformation can be below 1 metre. An interesting point is the last: Where we could safely assume for many decades that spatial data with ellipsoidal coordinates would have axis order (longitude, latitude), this is no longer the case. We will see in <a href="07-Introsf.html#sec-axisorder" class="quarto-xref"><span>Section 7.7.6</span></a> how to deal with this.</p>
<p></p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="sc">|&gt;</span> <span class="fu">suppressPackageStartupMessages</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>countries110 <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ADMIN <span class="sc">==</span> <span class="st">"United Kingdom"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="ot">-&gt;</span> uk</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">=</span> <span class="st">"data/uk_os_OSTN15_NTv2_OSGBtoETRS.tif"</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">file.exists</span>(filename)) {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">read_stars</span>(filename)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_stars</span>(<span class="st">"/vsicurl/https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif"</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>hook <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(uk, <span class="at">border =</span> <span class="st">"orange"</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r[,,,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">axes =</span> <span class="cn">TRUE</span>, <span class="at">hook =</span> hook, <span class="at">key.pos =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-horizontalgrid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-horizontalgrid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-Spaces_files/figure-html/fig-horizontalgrid-1.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-horizontalgrid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: UK horizontal datum grid, from datum OSGB 1936 (EPSG:4277) to datum ETRS89 (EPSG:4258); units arc-seconds
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.plot <span class="im">as</span> rioplot</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'data/uk_os_OSTN15_NTv2_OSGBtoETRS.tif'</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>isFile <span class="op">=</span> os.path.isfile(filename)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> isFile:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(filename)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(<span class="st">"https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif"</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://naciscdn.org/naturalearth/110m/cultural/ne_110m_admin_0_countries.zip"</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>uk <span class="op">=</span> gdf[gdf.NAME <span class="op">==</span> <span class="st">'United Kingdom'</span>]</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>uk_transformed <span class="op">=</span> uk.to_crs(r.crs)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>raster_extent <span class="op">=</span> numpy.asarray(r.bounds)[[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>]]</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> r.read(<span class="dv">1</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r.read(<span class="dv">2</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>int_r1 <span class="op">=</span> r1.astype(<span class="bu">int</span>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>int_r2 <span class="op">=</span> r2.astype(<span class="bu">int</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>plt.sca(axes[<span class="dv">0</span>])</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>plt.imshow(int_r1, cmap<span class="op">=</span><span class="st">'gray'</span>, extent<span class="op">=</span>raster_extent)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>uk_transformed.plot(ax <span class="op">=</span> axes[<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"latitude_offset"</span>)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">True</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># (np.float64(-9.008333333333333), np.float64(2.008333333333333), np.float64(48.99583333333334), np.float64(61.00416666666667))</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>plt.sca(axes[<span class="dv">1</span>])</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>plt.imshow(int_r2, cmap<span class="op">=</span><span class="st">'gray'</span>, extent<span class="op">=</span>raster_extent, )</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>uk_transformed.plot(ax <span class="op">=</span> axes[<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"longitude_offset"</span>)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">True</span>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># (np.float64(-9.008333333333333), np.float64(2.008333333333333), np.float64(48.99583333333334), np.float64(61.00416666666667))</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;matplotlib.colorbar.Colorbar object at 0x7f11e80c5fd0&gt;</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02-Spaces_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>UK horizontal datum grid, from datum OSGB 1936 (EPSG:4277) to datum ETRS89 (EPSG:4258); units arc-seconds</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">=</span> <span class="st">"data/uk_os_OSGM15_GB.tif"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">file.exists</span>(filename)) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_stars</span>(filename)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_stars</span>(<span class="st">"/vsicurl/https://cdn.proj.org/uk_os_OSGM15_GB.tif"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(h, <span class="at">axes =</span> <span class="cn">TRUE</span>, <span class="at">reset =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(uk, <span class="at">border =</span> <span class="st">"orange"</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-verticalgrid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-verticalgrid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="02-Spaces_files/figure-html/fig-verticalgrid-3.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-verticalgrid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: UK vertical datum grid, from ETRS89 (EPSG:4937) to ODN height (EPSG:5701), units m
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.plot <span class="im">as</span> rioplot</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'data/uk_os_OSGM15_GB.tif'</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>isFile <span class="op">=</span> os.path.isfile(filename)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> isFile:</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(filename)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(<span class="st">"https://cdn.proj.org/uk_os_OSGM15_GB.tif"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://naciscdn.org/naturalearth/110m/cultural/ne_110m_admin_0_countries.zip"</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>uk <span class="op">=</span> gdf[gdf.NAME <span class="op">==</span> <span class="st">'United Kingdom'</span>]</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>uk_transformed <span class="op">=</span> uk.to_crs(r.crs)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>raster_extent <span class="op">=</span> numpy.asarray(r.bounds)[[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>]]</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> r.read(<span class="dv">1</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>int_r1 <span class="op">=</span> r1.astype(<span class="bu">int</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>int_r1[int_r1<span class="op">==-</span><span class="dv">32768</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>plt.sca(axes)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>plt.imshow(int_r1, cmap <span class="op">=</span> <span class="st">'gray'</span> ,vmin <span class="op">=</span> <span class="dv">40</span>, vmax <span class="op">=</span> <span class="dv">60</span>,extent <span class="op">=</span> raster_extent)</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>uk_transformed.plot(ax <span class="op">=</span> axes, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">True</span>)</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a><span class="co"># (np.float64(-9.400175143506939), np.float64(3.5566845254796124), np.float64(49.76315756569858), np.float64(61.13587920351422))</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;matplotlib.colorbar.Colorbar object at 0x7f11ebfd0410&gt;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="02-Spaces_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>UK vertical datum grid, from ETRS89 (EPSG:4937) to ODN height (EPSG:5701), units m</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p> </p>
<p>Examples of a horizontal datum grids, downloaded from cdn.proj.org, are shown in <a href="#fig-horizontalgrid" class="quarto-xref">Figure&nbsp;<span>2.4</span></a> and for a vertical datum grid in <a href="#fig-verticalgrid" class="quarto-xref">Figure&nbsp;<span>2.5</span></a>. Datum grids may carry per-pixel accuracy values.</p>
</section>
<section id="sec-wkt2" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="sec-wkt2"><span class="header-section-number">2.5</span> WKT-2</h2>
<p><span class="citation" data-cites="lott2015">Lott (<a href="references.html#ref-lott2015" role="doc-biblioref">2015</a>)</span> describes a standard for encoding coordinate reference systems, as well as transformations between them using <em>well-known text</em>; the standard (and format) is referred to informally as WKT-2. As mentioned above, GDAL and PROJ fully support this encoding. An example of WKT-2 for CRS <code>EPSG:4326</code> is:</p>
<p> </p>
<pre><code>GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
<p>This shows a coordinate system with the axis order <em>latitude, longitude</em>, although in most practical cases the axis order used is <em>longitude, latitude</em>. The <em>ensemble</em> of WGS84 ellipsoids listed represents its various updates over time. Ambiguity about <em>which</em> of these ensemble members a particular dataset should use leads to an uncertainty of several meters. The coordinate reference system <code>OGC:CRS84</code> disambiguates the axis order and explicitly states it to be <code>longitude, latitude</code>, and is the recommended alternative to WGS84 datasets using this axis order. It does not disambiguate the datum ensemble problem.</p>
<p> </p>
<p>A longer introduction on the history and recent changes in PROJ is given in <span class="citation" data-cites="rogerCRS">Bivand (<a href="references.html#ref-rogerCRS" role="doc-biblioref">2020</a>)</span>, building upon the work of <span class="citation" data-cites="knudsen+evers17">Knudsen and Evers (<a href="references.html#ref-knudsen+evers17" role="doc-biblioref">2017</a>)</span> and <span class="citation" data-cites="evers+knudsen17">Evers and Knudsen (<a href="references.html#ref-evers+knudsen17" role="doc-biblioref">2017</a>)</span>.</p>
</section>
<section id="exercises" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.6</span> Exercises</h2>
<p>Try to solve the following exercises with R (without loading packages); try to use functions where appropriate:</p>
<ol type="1">
<li>list three <em>geographic</em> measures that do not have a natural zero origin <!-- latitude, longitude, elevation --></li>
<li>convert the <span class="math inline">\((x,y)\)</span> points <span class="math inline">\((10,2)\)</span>, <span class="math inline">\((-10,-2)\)</span>, <span class="math inline">\((10,-2)\)</span>, and <span class="math inline">\((0,10)\)</span> to polar coordinates</li>
<li>convert the polar <span class="math inline">\((r,\phi)\)</span> points <span class="math inline">\((10,45^{\circ})\)</span>, <span class="math inline">\((0,100^{\circ})\)</span>, and <span class="math inline">\((5,359^{\circ})\)</span> to Cartesian coordinates</li>
<li>assuming the Earth is a sphere with a radius of 6371 km, compute for <span class="math inline">\((\lambda,\phi)\)</span> points the great circle distance between <span class="math inline">\((10,10)\)</span> and <span class="math inline">\((11,10)\)</span>, between <span class="math inline">\((10,80)\)</span> and <span class="math inline">\((11,80)\)</span>, between <span class="math inline">\((10,10)\)</span> and <span class="math inline">\((10,11)\)</span>, and between <span class="math inline">\((10,80)\)</span> and <span class="math inline">\((10,81)\)</span> (units: degree). What are the distance units?</li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-vim" class="csl-entry" role="listitem">
BIPM, IEC, ILAC IFCC, IUPAP IUPAC, and OIML ISO. 2012. <span>“The International Vocabulary of Metrology–Basic and General Concepts and Associated Terms (VIM), 3rd Edn. JCGM 200: 2012.”</span> <em>JCGM (Joint Committee for Guides in Metrology)</em>. <a href="https://www.bipm.org/en/publications/guides/">https://www.bipm.org/en/publications/guides/</a>.
</div>
<div id="ref-rogerCRS" class="csl-entry" role="listitem">
Bivand, Roger. 2020. <em>Why Have CRS, Projections and Transformations Changed?</em><a href=" https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html ">https://rgdal.r-forge.r-project.org/articles/CRS_projections_transformations.html </a>.
</div>
<div id="ref-SI" class="csl-entry" role="listitem">
Bureau International des Poids et Mesures. 2006. <em>The International System of Units (<span>SI</span>), 8th Edition</em>. Organisation Intergouvernementale de la Convention du Mètre. <a href="https://www.bipm.org/en/publications/si-brochure/download.html">https://www.bipm.org/en/publications/si-brochure/download.html</a>.
</div>
<div id="ref-cobbmoore" class="csl-entry" role="listitem">
Cobb, George W., and David S. Moore. 1997. <span>“Mathematics, Statistics and Teaching.”</span> <em>The American Mathematical Monthly</em> 104: 801–23. <a href="https://www.jstor.org/stable/2975286">https://www.jstor.org/stable/2975286</a>.
</div>
<div id="ref-evenden:90" class="csl-entry" role="listitem">
Evenden, Gerald I. 1990. <em>Cartographic Projection Procedures for the <span>UNIX</span> Environment — a User’s Manual</em>. <a href="http://download.osgeo.org/proj/OF90-284.pdf">http://download.osgeo.org/proj/OF90-284.pdf</a>.
</div>
<div id="ref-evers+knudsen17" class="csl-entry" role="listitem">
Evers, Kristian, and Thomas Knudsen. 2017. <em>Transformation Pipelines for PROJ.4</em>. <a href="https://www.fig.net/resources/proceedings/fig_proceedings/fig2017/papers/iss6b/ISS6B_evers_knudsen_9156.pdf">https://www.fig.net/resources/proceedings/fig_proceedings/fig2017/papers/iss6b/ISS6B_evers_knudsen_9156.pdf</a>.
</div>
<div id="ref-hand" class="csl-entry" role="listitem">
Hand, David J. 2004. <em>Measurement Theory and Practice</em>. Arnold, London.
</div>
<div id="ref-iliffelott" class="csl-entry" role="listitem">
Iliffe, Jonathan, and Roger Lott. 2008. <em>Datums and Map Projections for Remote Sensing, GIS, and Surveying. Whittles Pub</em>. CRC Press, Scotland, UK.
</div>
<div id="ref-karney2013algorithms" class="csl-entry" role="listitem">
Karney, Charles F. F. 2013. <span>“Algorithms for Geodesics.”</span> <em>Journal of Geodesy</em> 87 (1): 43–55. <a href="https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf">https://link.springer.com/content/pdf/10.1007/s00190-012-0578-z.pdf</a>.
</div>
<div id="ref-knudsen+evers17" class="csl-entry" role="listitem">
Knudsen, Thomas, and Kristian Evers. 2017. <em>Transformation Pipelines for PROJ.4</em>. <a href="https://meetingorganizer.copernicus.org/EGU2017/EGU2017-8050.pdf">https://meetingorganizer.copernicus.org/EGU2017/EGU2017-8050.pdf</a>.
</div>
<div id="ref-lott2015" class="csl-entry" role="listitem">
Lott, Roger. 2015. <span>“Geographic Information-Well-Known Text Representation of Coordinate Reference Systems.”</span> Open Geospatial Consortium.<a href=" http://docs.opengeospatial.org/is/12-063r5/12-063r5.html ">http://docs.opengeospatial.org/is/12-063r5/12-063r5.html </a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-spatial\.org\/python\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./01-hello.html" class="pagination-link" aria-label="Getting Started">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-Geometries.html" class="pagination-link" aria-label="Geometries">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Coordinates {#sec-cs}</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>"_Data are not just numbers, they are numbers with a context_";</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>"_In data analysis, context provides meaning_"  <span class="co">[</span><span class="ot">@cobbmoore</span><span class="co">]</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>Before we can try to understand geometries like points, lines,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>polygons, coverage and grids, it is useful to review coordinate</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>systems so that we have an idea what exactly coordinates of a</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>point reflect.  For spatial data, the location of observations</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>are characterised by coordinates, and coordinates are defined in</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>a coordinate system.  Different coordinate systems can be used for</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>this, and the most important difference is whether coordinates are</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>defined over a 2 dimensional or 3 dimensional space referenced</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>to orthogonal axes (Cartesian coordinates), or using distance</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>and directions (polar coordinates, spherical and ellipsoidal</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>coordinates). Besides a location of observation, all observations</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>are associated with time of observation, and so time coordinate</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>systems are also briefly discussed. First we will briefly review</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>_quantities_, to learn what units and datum are.</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quantities, units, datum {#sec-units}</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>\index{quantities}</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>\index{units}</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>\index{measurement units}</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>The VIM ("International Vocabulary of Metrology", @vim)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>defines a _quantity_ as a "property of a phenomenon, body, or</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>substance, where the property has a magnitude that can be expressed</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>as a number and a reference", where "<span class="co">[</span><span class="ot">a</span><span class="co">]</span> reference can be a measurement</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>unit, a measurement procedure, a reference material, or a combination</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>of such." Although one could argue about whether all data is</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>constituted of quantities, there is no need to argue that proper</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>data handling requires that numbers (or symbols) are accompanied</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>by information on what they mean, in particular what they refer to.</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>A measurement system consists of _base units_ for base quantities, and</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>_derived units_ for derived quantities. For instance, the SI system</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>of units <span class="co">[</span><span class="ot">@SI</span><span class="co">]</span> consists of seven base units: length (metre,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>m), mass (kilogram, kg), time (second, s), electric current</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>(ampere, A), thermodynamic temperature (Kelvin, K), amount of</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>substance (mole, mol), and luminous intensity (candela, cd).</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>Derived units are composed of products of integer powers of base</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>units; examples are speed ($\mbox{m}~\mbox{s}^{-1}$), density</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>($\mbox{kg}~\mbox{m}^{-3}$) and area ($\mbox{m}^2$).</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>The special case of unitless measures can refer to either cases</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>where units cancel out (for instance mass fraction: kg/kg, or angle measured</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>in rad: m/m) or to cases where objects or events were counted</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>(such as "5 apples").  Adding an angle to a count of apples would not</span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>make sense; adding 5 apples to 3 oranges may make sense if the</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>result is reinterpreted in terms of a superclass, in this case as _pieces of fruit_.</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>Many data variables have units that are not expressible as SI base</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>units or derived units. @hand discusses many such measurement scales,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>including those used to measure variables like intelligence in</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>social sciences, in the context of measurement units.</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>For many quantities, the natural origin of values is zero. This</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>works for amounts, where differences between amounts result in</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>meaningful negative values. For locations and times, differences</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>have a natural zero interpretation: distance and duration.  Absolute</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>location (position) and time need a fixed origin, from which we</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>can meaningfully measure other absolute space time points: we</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>call this **a datum**.</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>For space, a datum involves more than one dimension. The combination</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>of a datum and a measurement unit (scale) is a _reference system_.</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>\index{datum}</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>We will now elaborate how spatial locations can be expressed as</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>either ellipsoidal or Cartesian coordinates.  The next sections will</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>deal with temporal and spatial reference systems, and how they are</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>handled in R.</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ellipsoidal coordinates</span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-polar, echo=!knitr::is_latex_output() }</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 60%</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Two-dimensional polar (red) and Cartesian (blue) coordinates"</span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(0,4))</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a><span class="in">plot(3, 4, xlim = c(-6,6), ylim = c(-6,6), asp = 1)</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, pos = 0, at = 0:6)</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2, pos = 0, at = -6:6)</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="in">xd &lt;- seq(-5, 5, by = .1)</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="in">lines(xd, sqrt(25 - xd^2), col = 'grey')</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="in">lines(xd, -sqrt(25 - xd^2), col = 'grey')</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="in">arrows(0, 0, 3, 4, col = 'red', length = .15, angle = 20)</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a><span class="in">text(1.5, 2.7, label = "r", col = 'red')</span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a><span class="in">xd &lt;- seq(3/5, 1, by = .1)</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a><span class="in">lines(xd, sqrt(1 - xd^2), col = 'red')</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="in">text(1.2, 0.5, label = parse(text = "phi"), col = 'red')</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a><span class="in">lines(c(3,3), c(0,4), lty = 2, col = 'blue')</span></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a><span class="in">lines(c(0,3), c(4,4), lty = 2, col = 'blue')</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a><span class="in">text(3.3, 0.3, label = "x", col = 'blue')</span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a><span class="in">text(0.3, 4.3, label = "y", col = 'blue')</span></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>@fig-polar  shows both polar and Cartesian coordinates</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>for a two-dimensional situation. In Cartesian coordinates,</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>the point shown is $(x,y) = (3,4)$, for polar coordinates it is</span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>$(r,\phi) = (5, \mbox{arctan}(4/3))$, where $\mbox{arctan}(4/3)$ is</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>approximately $0.93$ radians, or $53^{\circ}$. Note that $x$, $y$</span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>and $r$ all have length units, where $\phi$ is an angle (a unitless</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>length/length ratio). Converting back and forth between Cartesian</span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>and polar coordinates is trivial, as</span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>$$x = r~\mbox{cos} \phi,\ \ \ y = r~\mbox{sin} \phi, \ \mbox{and}$$</span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>$$r = \sqrt{x^2 + y^2}, \ \ \ \phi = \mbox{atan2}(y, x)$$</span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>where $\mbox{atan2}$ is used in favour of $\mbox{atan}(y/x)$ to take care</span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>of the right quadrant.</span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spherical or ellipsoidal coordinates</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>\index{ellipsoidal coordinates}</span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a>\index{coordinates!ellipsoidal}</span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>\index{coordinates!geocentric}</span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a>\index{coordinates!Cartesian}</span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a>In three dimensions, where Cartesian coordinates are expressed as</span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a>$(x,y,z)$, spherical coordinates are the three-dimensional equivalent</span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a>of polar coordinates and can be expressed as $(r,\lambda,\phi)$, where:</span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$r$ is the radius of the sphere,</span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\lambda$ is the longitude, measured in the $(x,y)$ plane counter-clockwise from positive $x$, and</span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\phi$ is the latitude, the angle between the vector and the $(x,y)$ plane.</span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a>@fig-sphere  illustrates Cartesian geocentric and</span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>ellipsoidal coordinates.</span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-sphere, echo=!knitr::is_latex_output()}</span></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Cartesian geocentric coordinates (left) measure three distances, ellipsoidal coordinates (right) measure two angles, and possibly an ellipsoidal height"</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf) |&gt; suppressPackageStartupMessages()</span></span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a><span class="in">e &lt;- cbind(-90:90,0) # equator</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a><span class="in">f1 &lt;- rbind(cbind(0, -90:90)) # 0/antimerid.</span></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a><span class="in">f2 &lt;- rbind(cbind(90, -90:90), cbind(270, 90:-90))# +/- 90</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a><span class="in">eq &lt;- st_sfc(st_linestring(e), st_linestring(f1), st_linestring(f2), crs='OGC:CRS84')</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a><span class="in">geoc &lt;- st_transform(eq, "+proj=geocent")</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a><span class="in">cc &lt;- rbind(geoc[[1]], NA, geoc[[2]], NA, geoc[[3]])</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a><span class="in">from3d &lt;- function(x, offset, maxz, minz) {</span></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a><span class="in">    x = x[,c(2,3,1)] + offset # move to y right, x up, z backw</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a><span class="in">    x[,2] = x[,2] - maxz      # shift y to left</span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a><span class="in">    d = maxz</span></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a><span class="in">    z = x[,3] - minz + offset</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a><span class="in">    x[,1] = x[,1] * (d/z)</span></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a><span class="in">    x[,2] = x[,2] * (d/z)</span></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a><span class="in">    x[,1:2]</span></span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a><span class="in">maxz &lt;- max(cc[,3], na.rm = TRUE)</span></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a><span class="in">minz &lt;- min(cc[,3], na.rm = TRUE)</span></span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a><span class="in">offset &lt;- 3e7</span></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a><span class="in">circ &lt;- from3d(cc, offset, maxz, minz)</span></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a><span class="in">mx &lt;- max(cc, na.rm = TRUE) * 1.1</span></span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- rbind(c(0, 0, 0), c(mx, 0, 0))</span></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- rbind(c(0, 0, 0), c(0, mx, 0))</span></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a><span class="in">z &lt;- rbind(c(0, 0, 0), c(0, 0, mx))</span></span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a><span class="in">ll &lt;- rbind(x, NA, y, NA, z)</span></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a><span class="in">l0 &lt;-  from3d(ll, offset, maxz, minz)</span></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a><span class="in">mx &lt;- max(cc, na.rm = TRUE) * 1.2</span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- rbind(c(0, 0, 0), c(mx, 0, 0))</span></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- rbind(c(0, 0, 0), c(0, mx, 0))</span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a><span class="in">z &lt;- rbind(c(0, 0, 0), c(0, 0, mx))</span></span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a><span class="in">ll &lt;- rbind(x, NA, y, NA, z)</span></span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a><span class="in">l &lt;-  from3d(ll, offset, maxz, minz)</span></span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(1, 2))</span></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(0,4))</span></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a><span class="in">plot.new()</span></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a><span class="in">plot.window(xlim = c(min(circ[,1],na.rm = TRUE), 3607103*1.02), </span></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a><span class="in">                        ylim = c(min(circ[,2],na.rm = TRUE), 2873898*1.1), asp = 1)</span></span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a><span class="in">lines(circ)</span></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a><span class="in">lines(l0)</span></span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a><span class="in">text(l[c(2,5,8),], labels = c("x", "y", "z"), col = 'red')</span></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a><span class="in"># add POINT(60 47)</span></span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- st_as_sfc("POINT(60 47)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- p[[1]]</span></span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- rbind(c(0,0,0), c(p[1],0,0), c(p[1],p[2],0), c(p[1],p[2],p[2]))</span></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a><span class="in">ptsl &lt;- from3d(pts, offset, maxz, minz)</span></span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a><span class="in">lines(ptsl, col = 'blue', lty = 2, lwd = 2)</span></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a><span class="in">points(ptsl[4,1], ptsl[4,2], col = 'blue', cex = 1, pch = 16)</span></span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a><span class="in">plot.new()</span></span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a><span class="in">plot.window(xlim = c(min(circ[,1],na.rm = TRUE), 3607103*1.02), </span></span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a><span class="in">                        ylim = c(min(circ[,2],na.rm = TRUE), 2873898*1.1), asp = 1)</span></span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a><span class="in">lines(circ)</span></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- st_as_sfc("POINT(60 47)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- p[[1]]</span></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- rbind(c(0,0,0), c(p[1],p[2],p[3]))</span></span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a><span class="in">pt &lt;-  from3d(pts, offset, maxz, minz)</span></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pt)</span></span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a><span class="in">points(pt[2,1], pt[2,2], col = 'blue', cex = 1, pch = 16)</span></span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- st_as_sfc("POINT(60 0)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- p0[[1]]</span></span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- rbind(c(0,0,0), c(p0[1],p0[2],p0[3]))</span></span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a><span class="in">pt &lt;-  from3d(pts, offset, maxz, minz)</span></span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pt)</span></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- st_as_sfc("POINT(0 0)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- p0[[1]]</span></span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- rbind(c(0,0,0), c(p0[1],p0[2],p0[3]))</span></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a><span class="in">pt &lt;-  from3d(pts, offset, maxz, minz)</span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pt)</span></span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- st_as_sfc("POINT(0 90)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- p0[[1]]</span></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- rbind(c(0,0,0), c(p0[1],p0[2],p0[3]))</span></span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="in">pt &lt;-  from3d(pts, offset, maxz, minz)</span></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pt, lty = 2)</span></span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- st_as_sfc("POINT(90 0)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- p0[[1]]</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- rbind(c(0,0,0), c(p0[1],p0[2],p0[3]))</span></span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a><span class="in">pt &lt;-  from3d(pts, offset, maxz, minz)</span></span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a><span class="in">lines(pt, lty = 2)</span></span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a><span class="in">f1 &lt;- rbind(cbind(0:60, 0))</span></span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a><span class="in">arc &lt;- st_sfc(st_linestring(f1), crs='OGC:CRS84')</span></span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a><span class="in">geoc &lt;- st_transform(arc, "+proj=geocent")</span></span>
<span id="cb17-222"><a href="#cb17-222" aria-hidden="true" tabindex="-1"></a><span class="in">cc &lt;- rbind(geoc[[1]])</span></span>
<span id="cb17-223"><a href="#cb17-223" aria-hidden="true" tabindex="-1"></a><span class="in">circ &lt;- from3d(cc, offset, maxz, minz)</span></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a><span class="in">lines(circ, col = 'red', lwd = 2, lty = 2)</span></span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a><span class="in">f1 &lt;- rbind(cbind(60, 0:47))</span></span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a><span class="in">arc &lt;- st_sfc(st_linestring(f1), crs='OGC:CRS84')</span></span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a><span class="in">geoc &lt;- st_transform(arc, "+proj=geocent")</span></span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a><span class="in">cc &lt;- rbind(geoc[[1]])</span></span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a><span class="in">circ &lt;- from3d(cc, offset, maxz, minz)</span></span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a><span class="in">lines(circ, col = 'blue', lwd = 2, lty = 2)</span></span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a><span class="in">text(pt[1,1]+100000, pt[1,2]+50000, labels = expression(phi), col = 'blue') # lat</span></span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a><span class="in">text(pt[1,1]+20000, pt[1,2]-50000, labels = expression(lambda), col = 'red') # lng</span></span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a>$\lambda$ typically varies between $-180^{\circ}$ and $180^{\circ}$</span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a>(or alternatively from $0^{\circ}$ to $360^{\circ}$), $\phi$ from</span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a>$-90^{\circ}$ to $90^{\circ}$.  When we are only interested in points</span>
<span id="cb17-240"><a href="#cb17-240" aria-hidden="true" tabindex="-1"></a>_on_ a sphere with given radius, we can drop $r$: $(\lambda,\phi)$</span>
<span id="cb17-241"><a href="#cb17-241" aria-hidden="true" tabindex="-1"></a>now suffice to identify any point.</span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a>\newpage</span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a>It should be noted that this is just _a_ definition, one could for</span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a>instance also choose to measure polar angle, the angle between</span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a>the vector and $z$, instead of latitude. There is also a long</span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a>tradition of specifying points as $(\phi,\lambda)$ but throughout</span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a>this book we will stick to longitude-latitude, $(\lambda,\phi)$.</span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a>The point denoted in @fig-sphere  has $(\lambda,\phi)$ or ellipsoidal</span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a>coordinates with angular values</span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- st_as_sfc("POINT(60 47)", crs = 'OGC:CRS84')</span></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a><span class="in">p[[1]]</span></span>
<span id="cb17-256"><a href="#cb17-256" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-257"><a href="#cb17-257" aria-hidden="true" tabindex="-1"></a>measured in degrees, and geocentric coordinates</span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- st_as_sfc("POINT(60 47)", crs = 'OGC:CRS84') |&gt; st_transform("+proj=geocent")</span></span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a><span class="in">p[[1]]</span></span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a>measured in metres.</span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a>\index{coordinates!units}</span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a>For points on an ellipse, there are two ways in which angle can be</span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a>expressed (@fig-ellipse): measured from the centre of the ellipse</span>
<span id="cb17-270"><a href="#cb17-270" aria-hidden="true" tabindex="-1"></a>($\psi$), or measured perpendicular to the tangent on the ellipse</span>
<span id="cb17-271"><a href="#cb17-271" aria-hidden="true" tabindex="-1"></a>at the target point ($\phi$).</span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-ellipse, echo=!knitr::is_latex_output() }</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 60%</span></span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Angles on an ellipse: geodetic (blue) and geocentric (red) latitude"</span></span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(0,4))</span></span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- 4</span></span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a><span class="in">y &lt;- 5/8 * sqrt(48)</span></span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a><span class="in">plot(x, y, xlim = c(-6,6), ylim = c(-8,8), asp = 1)</span></span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a><span class="in">axis(1, pos = 0, at = 0:9)</span></span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a><span class="in">axis(2, pos = 0, at = -5:5)</span></span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a><span class="in">xd &lt;- seq(-8, 8, by = .1)</span></span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a><span class="in">lines(xd, 5/8 * sqrt(64 - xd^2), col = 'grey')</span></span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a><span class="in">lines(xd, 5/8 * -sqrt(64 - xd^2), col = 'grey')</span></span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a><span class="in">arrows(0, 0, x, y, col = 'red', length = .15, angle = 20)</span></span>
<span id="cb17-288"><a href="#cb17-288" aria-hidden="true" tabindex="-1"></a><span class="in">b &lt;- (x * 25) / (-y * 64)</span></span>
<span id="cb17-289"><a href="#cb17-289" aria-hidden="true" tabindex="-1"></a><span class="in">a &lt;- y - x * b</span></span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a><span class="in">abline(a, b, col = 'grey')</span></span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a><span class="in">b &lt;- -1/b</span></span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a><span class="in">x0 &lt;- x - y / b</span></span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a><span class="in">arrows(x0, 0, x, y, col = 'blue', length = .15, angle = 20)</span></span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a><span class="in">text(1.2, 0.5, label = parse(text = "psi"), col = 'red')</span></span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a><span class="in">text(3, 0.5, label = parse(text = "phi"), col = 'blue')</span></span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a>The most commonly used parametric model for the Earth is _an</span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a>ellipsoid of revolution_, an ellipsoid with two equal semi-axes</span>
<span id="cb17-300"><a href="#cb17-300" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@iliffelott</span><span class="co">]</span>. In effect, this is a flattened sphere (or spheroid):</span>
<span id="cb17-301"><a href="#cb17-301" aria-hidden="true" tabindex="-1"></a>the distance between the poles is (slightly: about 0.33%) smaller</span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a>than the distance between two opposite points on the equator. Under</span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a>this model, longitude is always measured along a circle (as in</span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a>@fig-sphere), and latitude along an ellipse (as in</span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a>@fig-ellipse). If we</span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a>think of @fig-ellipse  as a cross section of the Earth</span>
<span id="cb17-307"><a href="#cb17-307" aria-hidden="true" tabindex="-1"></a>passing through the poles, the _geodetic_ latitude measure $\phi$</span>
<span id="cb17-308"><a href="#cb17-308" aria-hidden="true" tabindex="-1"></a>is the one used when no further specification is given. The latitude</span>
<span id="cb17-309"><a href="#cb17-309" aria-hidden="true" tabindex="-1"></a>measure $\psi$ is called the _geocentric latitude_.</span>
<span id="cb17-310"><a href="#cb17-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-311"><a href="#cb17-311" aria-hidden="true" tabindex="-1"></a>\index{latitude!geodetic}</span>
<span id="cb17-312"><a href="#cb17-312" aria-hidden="true" tabindex="-1"></a>\index{latitude!geocentric}</span>
<span id="cb17-313"><a href="#cb17-313" aria-hidden="true" tabindex="-1"></a>\index{longitude}</span>
<span id="cb17-314"><a href="#cb17-314" aria-hidden="true" tabindex="-1"></a>\index{ellipsoid of revolution}</span>
<span id="cb17-315"><a href="#cb17-315" aria-hidden="true" tabindex="-1"></a>\index{altitude}</span>
<span id="cb17-316"><a href="#cb17-316" aria-hidden="true" tabindex="-1"></a>\index{altitude!direction}</span>
<span id="cb17-317"><a href="#cb17-317" aria-hidden="true" tabindex="-1"></a>\index{coordinates!altitude}</span>
<span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a>we can add _altitude_ or elevation to longitude and latitude to</span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a>define points that are above or below the ellipsoid, and obtain</span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a>a three-dimensional space again. When defining altitude, we need</span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a>to choose:</span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>where zero altitude is: on the ellipsoid, or relative to the surface approximating mean sea level (the geoid)?</span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>which direction is positive, and </span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>which direction is "straight up": perpendicular to the ellipsoid surface,</span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a>or in the direction of gravity, perpendicular to the surface of the geoid?</span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a>All these choices may matter, depending on the application area</span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a>and required measurement accuracies.</span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a>The shape of the Earth is not a perfect ellipsoid. As a consequence,</span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a>several ellipsoids with different shape parameters and bound to</span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a>the Earth in different ways are being used. Such ellipsoids are called</span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a>_datums_, and are briefly discussed in @sec-crs, along</span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a>with _coordinate reference systems_.</span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a><span class="fu">### Projected coordinates, distances {#sec-projections}</span></span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a>Because paper maps and computer screens are much more abundant</span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a>and practical than globes, when we look at spatial</span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a>data we see it _projected_: drawn on a flat, two-dimensional</span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a>surface. Computing the locations in a two-dimensional space means</span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a>that we work with _projected_ coordinates. Projecting ellipsoidal</span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a>coordinates means that shapes, directions, areas, or even all three,</span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a>are distorted <span class="co">[</span><span class="ot">@iliffelott</span><span class="co">]</span>.</span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a>\index{coordinates!projected}</span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a>\index{projection}</span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a>\index{distance!straight line}</span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-352"><a href="#cb17-352" aria-hidden="true" tabindex="-1"></a>Distances between two points $p_i$ and $p_j$ in Cartesian coordinates are computed</span>
<span id="cb17-353"><a href="#cb17-353" aria-hidden="true" tabindex="-1"></a>as Euclidean distances, in two dimensions by</span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a>$$d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2}$$</span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a>with $p_i = (x_i,y_i)$</span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a>and in three dimensions by</span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a>$$d_{ij} = \sqrt{(x_i-x_j)^2+(y_i-y_j)^2+(z_i-z_j)^2}$$</span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a>with $p_i = (x_i,y_i,z_i).$</span>
<span id="cb17-359"><a href="#cb17-359" aria-hidden="true" tabindex="-1"></a>These distances represent the length of a _straight_ line between</span>
<span id="cb17-360"><a href="#cb17-360" aria-hidden="true" tabindex="-1"></a>two points $i$ and $j$.</span>
<span id="cb17-361"><a href="#cb17-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-362"><a href="#cb17-362" aria-hidden="true" tabindex="-1"></a>For two points on a circle, the length of the arc of two points $c_1 = (r,{\phi}_1)$ and</span>
<span id="cb17-363"><a href="#cb17-363" aria-hidden="true" tabindex="-1"></a>$c_2 = (r, \phi_2)$ is</span>
<span id="cb17-364"><a href="#cb17-364" aria-hidden="true" tabindex="-1"></a>$$s_{ij}=r~|\phi_1-\phi_2| = r ~\theta$$</span>
<span id="cb17-365"><a href="#cb17-365" aria-hidden="true" tabindex="-1"></a>with $\theta$ the angle between $\phi_1$ and $\phi_2$ in radians.</span>
<span id="cb17-366"><a href="#cb17-366" aria-hidden="true" tabindex="-1"></a>For very small values of $\theta$, we will have $s_{ij} \approx d_{ij}$,</span>
<span id="cb17-367"><a href="#cb17-367" aria-hidden="true" tabindex="-1"></a>because a small arc segment is nearly straight.</span>
<span id="cb17-368"><a href="#cb17-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-369"><a href="#cb17-369" aria-hidden="true" tabindex="-1"></a>\index{distance!great circle}</span>
<span id="cb17-370"><a href="#cb17-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-371"><a href="#cb17-371" aria-hidden="true" tabindex="-1"></a>For two points $p_1 = (\lambda_1,\phi_1)$ and $p_2 =</span>
<span id="cb17-372"><a href="#cb17-372" aria-hidden="true" tabindex="-1"></a>(\lambda_2,\phi_2)$ on a sphere with radius $r'$, the _great circle</span>
<span id="cb17-373"><a href="#cb17-373" aria-hidden="true" tabindex="-1"></a>distance_ is the arc length between $p_1$ and $p_2$ on the circle</span>
<span id="cb17-374"><a href="#cb17-374" aria-hidden="true" tabindex="-1"></a>that passes through $p_1$ and $p_2$ and has the centre of the sphere as its centre, and</span>
<span id="cb17-375"><a href="#cb17-375" aria-hidden="true" tabindex="-1"></a>is given by $s_{12} = r ~ \theta_{12}$ with</span>
<span id="cb17-376"><a href="#cb17-376" aria-hidden="true" tabindex="-1"></a>$$\theta_{12} = \arccos(\sin \phi_1 \cdot \sin \phi_2 + \cos \phi_1 \cdot \cos \phi_2 \cdot \cos(|\lambda_1-\lambda_2|))$$</span>
<span id="cb17-377"><a href="#cb17-377" aria-hidden="true" tabindex="-1"></a>the angle between $p_1$ and $p_2$, in radians.</span>
<span id="cb17-378"><a href="#cb17-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-379"><a href="#cb17-379" aria-hidden="true" tabindex="-1"></a>Arc distances between two points on a spheroid are more complicated</span>
<span id="cb17-380"><a href="#cb17-380" aria-hidden="true" tabindex="-1"></a>to compute; a good discussion on the topic and an explanation of</span>
<span id="cb17-381"><a href="#cb17-381" aria-hidden="true" tabindex="-1"></a>the method implemented in GeographicLib (part of PROJ) is given</span>
<span id="cb17-382"><a href="#cb17-382" aria-hidden="true" tabindex="-1"></a>in @karney2013algorithms.</span>
<span id="cb17-383"><a href="#cb17-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-384"><a href="#cb17-384" aria-hidden="true" tabindex="-1"></a>\index{distance!ellipsoidal}</span>
<span id="cb17-385"><a href="#cb17-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-386"><a href="#cb17-386" aria-hidden="true" tabindex="-1"></a>To show that these distance measures actually give different</span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a>values, we computed them for the distance Berlin - Paris. Here,</span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a><span class="in">`gc_`</span> refers to ellipsoidal and spherical great circle distances,</span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a><span class="in">`str_`</span> refers to straight line, Euclidean distances between</span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a>Cartesian geocentric coordinates associated on the WGS84 ellipse</span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a>and sphere:</span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output(), message=FALSE}</span></span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a><span class="in">pts &lt;- st_sfc(st_point(c(13.4050, 52.5200)), st_point(c(2.3522, 48.8566)), crs = 'OGC:CRS84')</span></span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a><span class="in">s2_orig &lt;- sf_use_s2(FALSE)</span></span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a><span class="in">d1 &lt;- c(gc_ellipse = st_distance(pts)[1,2])</span></span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a><span class="in">sf_use_s2(TRUE)</span></span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a><span class="in"># or, without using s2, use st_distance(st_transform(pts, "+proj=cart +ellps=sphere"))</span></span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a><span class="in">d2 &lt;- c(gc_sphere = st_distance(pts)[1,2])</span></span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- st_transform(pts, "+proj=cart +ellps=WGS84")</span></span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a><span class="in">d3 &lt;- c(str_ellipse = units::set_units(sqrt(sum(apply(do.call(cbind, p), 1, diff)^2)), m))</span></span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a><span class="in">p2 &lt;- st_transform(pts, "+proj=cart +ellps=sphere")</span></span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a><span class="in">d4 &lt;- c(str_sphere = units::set_units(sqrt(sum(apply(do.call(cbind, p2), 1, diff)^2)), m))</span></span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a><span class="in">res &lt;- c(d1, d3, d2, d4) # note order</span></span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a><span class="in"># print as km, re-add names:</span></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a><span class="in">sf_use_s2(s2_orig) # back to what it was before changing</span></span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a><span class="in">res |&gt; units::set_units(km) |&gt; setNames(names(res)) |&gt; print(digits = 5)</span></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bounded and unbounded spaces {#sec-bounded}</span></span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a>\index{sphere}</span>
<span id="cb17-414"><a href="#cb17-414" aria-hidden="true" tabindex="-1"></a>\index{space!bounded}</span>
<span id="cb17-415"><a href="#cb17-415" aria-hidden="true" tabindex="-1"></a>\index{space!unbounded}</span>
<span id="cb17-416"><a href="#cb17-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-417"><a href="#cb17-417" aria-hidden="true" tabindex="-1"></a>Two-dimensional and three-dimensional Euclidean spaces ($R^2$ and</span>
<span id="cb17-418"><a href="#cb17-418" aria-hidden="true" tabindex="-1"></a>$R^3$) are unbounded. Every line in this space has infinite length,</span>
<span id="cb17-419"><a href="#cb17-419" aria-hidden="true" tabindex="-1"></a>and areas or volumes have no natural upper limit.  In contrast,</span>
<span id="cb17-420"><a href="#cb17-420" aria-hidden="true" tabindex="-1"></a>spaces defined on a circle ($S^1$) or sphere ($S^2$) define a bounded</span>
<span id="cb17-421"><a href="#cb17-421" aria-hidden="true" tabindex="-1"></a>set: there may be infinitely many points but the length and area</span>
<span id="cb17-422"><a href="#cb17-422" aria-hidden="true" tabindex="-1"></a>of the circle, and the radius, area and volume of a sphere are bounded.</span>
<span id="cb17-423"><a href="#cb17-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-424"><a href="#cb17-424" aria-hidden="true" tabindex="-1"></a>This may sound trivial but leads to some interesting challenges</span>
<span id="cb17-425"><a href="#cb17-425" aria-hidden="true" tabindex="-1"></a>when handling spatial data. A polygon on $R^2$ has unambiguously an</span>
<span id="cb17-426"><a href="#cb17-426" aria-hidden="true" tabindex="-1"></a>inside and an outside. On a sphere, $S^2$, any polygon divides</span>
<span id="cb17-427"><a href="#cb17-427" aria-hidden="true" tabindex="-1"></a>the sphere in two parts, and which of these two is to be considered</span>
<span id="cb17-428"><a href="#cb17-428" aria-hidden="true" tabindex="-1"></a>inside and which outside is ambiguous and needs to be defined</span>
<span id="cb17-429"><a href="#cb17-429" aria-hidden="true" tabindex="-1"></a>by the traversal direction. @sec-spherical will further discuss</span>
<span id="cb17-430"><a href="#cb17-430" aria-hidden="true" tabindex="-1"></a>consequences when working with geometries on $S^2$.</span>
<span id="cb17-431"><a href="#cb17-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-432"><a href="#cb17-432" aria-hidden="true" tabindex="-1"></a>\index{polygon!on the sphere}</span>
<span id="cb17-433"><a href="#cb17-433" aria-hidden="true" tabindex="-1"></a>\index{polygon!inside, outside}</span>
<span id="cb17-434"><a href="#cb17-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-435"><a href="#cb17-435" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coordinate reference systems {#sec-crs}</span></span>
<span id="cb17-436"><a href="#cb17-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-437"><a href="#cb17-437" aria-hidden="true" tabindex="-1"></a>\index{coordinate reference systems}</span>
<span id="cb17-438"><a href="#cb17-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-439"><a href="#cb17-439" aria-hidden="true" tabindex="-1"></a>We follow @lott2015 when defining the following concepts (italics indicate literal quoting):</span>
<span id="cb17-440"><a href="#cb17-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-441"><a href="#cb17-441" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a **coordinate system** is a _set of mathematical rules for specifying how coordinates are to be assigned to points_,</span>
<span id="cb17-442"><a href="#cb17-442" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a **datum** is a _parameter or set of parameters that define the position of the origin, the scale, and the orientation of a coordinate system_, </span>
<span id="cb17-443"><a href="#cb17-443" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a **geodetic datum** is a _datum describing the relationship of a two- or three-dimensional coordinate system to the Earth_, and</span>
<span id="cb17-444"><a href="#cb17-444" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a **coordinate reference system** is a _coordinate system that is related to an object by a datum; for geodetic and vertical datums, the object will be the Earth._</span>
<span id="cb17-445"><a href="#cb17-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-446"><a href="#cb17-446" aria-hidden="true" tabindex="-1"></a>\index{coordinate system}</span>
<span id="cb17-447"><a href="#cb17-447" aria-hidden="true" tabindex="-1"></a>\index{geodetic datum}</span>
<span id="cb17-448"><a href="#cb17-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-449"><a href="#cb17-449" aria-hidden="true" tabindex="-1"></a>A readable text that further explains these concepts is @iliffelott.</span>
<span id="cb17-450"><a href="#cb17-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-451"><a href="#cb17-451" aria-hidden="true" tabindex="-1"></a>The Earth does not follow a regular shape. The topography of the</span>
<span id="cb17-452"><a href="#cb17-452" aria-hidden="true" tabindex="-1"></a>Earth is of course known to vary strongly, but also the surface</span>
<span id="cb17-453"><a href="#cb17-453" aria-hidden="true" tabindex="-1"></a>formed by constant gravity at mean sea level, the geoid, is</span>
<span id="cb17-454"><a href="#cb17-454" aria-hidden="true" tabindex="-1"></a>irregular. A commonly used model that is fit to the geoid is an</span>
<span id="cb17-455"><a href="#cb17-455" aria-hidden="true" tabindex="-1"></a>ellipsoid of revolution, which is an ellipsoid with two identical</span>
<span id="cb17-456"><a href="#cb17-456" aria-hidden="true" tabindex="-1"></a>minor axes. Fitting such an ellipsoid to the Earth gives a datum.</span>
<span id="cb17-457"><a href="#cb17-457" aria-hidden="true" tabindex="-1"></a>However, fitting it to different areas, or based on different sets of</span>
<span id="cb17-458"><a href="#cb17-458" aria-hidden="true" tabindex="-1"></a>reference points gives different fits, and hence different datums:</span>
<span id="cb17-459"><a href="#cb17-459" aria-hidden="true" tabindex="-1"></a>a datum can for instance be fixed to a particular tectonic plate</span>
<span id="cb17-460"><a href="#cb17-460" aria-hidden="true" tabindex="-1"></a>(like the European Terrestrial Reference System 1989 (ETRS89)), others can be globally fit (like WGS84). More local</span>
<span id="cb17-461"><a href="#cb17-461" aria-hidden="true" tabindex="-1"></a>fits lead to smaller approximation errors.</span>
<span id="cb17-462"><a href="#cb17-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-463"><a href="#cb17-463" aria-hidden="true" tabindex="-1"></a>\index{geoid}</span>
<span id="cb17-464"><a href="#cb17-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-465"><a href="#cb17-465" aria-hidden="true" tabindex="-1"></a>The definitions above imply that coordinates in degrees longitude</span>
<span id="cb17-466"><a href="#cb17-466" aria-hidden="true" tabindex="-1"></a>and latitude only have a meaning and can only be interpreted</span>
<span id="cb17-467"><a href="#cb17-467" aria-hidden="true" tabindex="-1"></a>unambiguously as Earth coordinates, when the datum they are</span>
<span id="cb17-468"><a href="#cb17-468" aria-hidden="true" tabindex="-1"></a>associated with is given.</span>
<span id="cb17-469"><a href="#cb17-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-470"><a href="#cb17-470" aria-hidden="true" tabindex="-1"></a>Note that for projected data, the data that _were_ projected</span>
<span id="cb17-471"><a href="#cb17-471" aria-hidden="true" tabindex="-1"></a>are associated with a reference ellipsoid (datum). Going from</span>
<span id="cb17-472"><a href="#cb17-472" aria-hidden="true" tabindex="-1"></a>one projection to another _without_ changing datum is called</span>
<span id="cb17-473"><a href="#cb17-473" aria-hidden="true" tabindex="-1"></a>_coordinate conversion_, and passes through the ellipsoidal</span>
<span id="cb17-474"><a href="#cb17-474" aria-hidden="true" tabindex="-1"></a>coordinates associated with the datum involved. This process is</span>
<span id="cb17-475"><a href="#cb17-475" aria-hidden="true" tabindex="-1"></a>lossless and invertible: the parameters and equations associated</span>
<span id="cb17-476"><a href="#cb17-476" aria-hidden="true" tabindex="-1"></a>with a _conversion_ are not empirical. Recomputing coordinates in a</span>
<span id="cb17-477"><a href="#cb17-477" aria-hidden="true" tabindex="-1"></a>new datum is called _coordinate transformation_, and is approximate:</span>
<span id="cb17-478"><a href="#cb17-478" aria-hidden="true" tabindex="-1"></a>because datums are a result of model fitting, transformations</span>
<span id="cb17-479"><a href="#cb17-479" aria-hidden="true" tabindex="-1"></a>between datums are models too that have been fit; the equations</span>
<span id="cb17-480"><a href="#cb17-480" aria-hidden="true" tabindex="-1"></a>involved are empirical, and multiple transformation paths, based</span>
<span id="cb17-481"><a href="#cb17-481" aria-hidden="true" tabindex="-1"></a>on different model fits and associated with different accuracies,</span>
<span id="cb17-482"><a href="#cb17-482" aria-hidden="true" tabindex="-1"></a>are possible.</span>
<span id="cb17-483"><a href="#cb17-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-484"><a href="#cb17-484" aria-hidden="true" tabindex="-1"></a>\index{coordinate!conversion}</span>
<span id="cb17-485"><a href="#cb17-485" aria-hidden="true" tabindex="-1"></a>\index{coordinate!transformation}</span>
<span id="cb17-486"><a href="#cb17-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-487"><a href="#cb17-487" aria-hidden="true" tabindex="-1"></a>Plate tectonics imply that within a global datum, fixed objects may</span>
<span id="cb17-488"><a href="#cb17-488" aria-hidden="true" tabindex="-1"></a>have coordinates that change over time, and that transformations</span>
<span id="cb17-489"><a href="#cb17-489" aria-hidden="true" tabindex="-1"></a>from one datum to another may be time-dependent. Earthquakes are a</span>
<span id="cb17-490"><a href="#cb17-490" aria-hidden="true" tabindex="-1"></a>cause of more local and sudden changes in coordinates. Local datums</span>
<span id="cb17-491"><a href="#cb17-491" aria-hidden="true" tabindex="-1"></a>may be fixed to tectonic plates (such as ETRS89), or may be dynamic.</span>
<span id="cb17-492"><a href="#cb17-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-493"><a href="#cb17-493" aria-hidden="true" tabindex="-1"></a>\index{datum!dynamic}</span>
<span id="cb17-494"><a href="#cb17-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-495"><a href="#cb17-495" aria-hidden="true" tabindex="-1"></a><span class="fu">## PROJ and mapping accuracy {#sec-projlib}</span></span>
<span id="cb17-496"><a href="#cb17-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-497"><a href="#cb17-497" aria-hidden="true" tabindex="-1"></a>Very few living people active in open source geospatial software</span>
<span id="cb17-498"><a href="#cb17-498" aria-hidden="true" tabindex="-1"></a>can remember the time before PROJ. PROJ <span class="co">[</span><span class="ot">@evenden:90</span><span class="co">]</span> started in the</span>
<span id="cb17-499"><a href="#cb17-499" aria-hidden="true" tabindex="-1"></a>1970s as a Fortran project, and was released in 1985 as a C library</span>
<span id="cb17-500"><a href="#cb17-500" aria-hidden="true" tabindex="-1"></a>for cartographic projections. It came with command line tools for</span>
<span id="cb17-501"><a href="#cb17-501" aria-hidden="true" tabindex="-1"></a>direct and inverse projections, and could be linked to software</span>
<span id="cb17-502"><a href="#cb17-502" aria-hidden="true" tabindex="-1"></a>to let it support (re)projection directly. Originally, datums were</span>
<span id="cb17-503"><a href="#cb17-503" aria-hidden="true" tabindex="-1"></a>considered implicit, and no datum transformations were allowed.</span>
<span id="cb17-504"><a href="#cb17-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-505"><a href="#cb17-505" aria-hidden="true" tabindex="-1"></a>\index{PROJ}</span>
<span id="cb17-506"><a href="#cb17-506" aria-hidden="true" tabindex="-1"></a>\index{PROJ!PROJ.4}</span>
<span id="cb17-507"><a href="#cb17-507" aria-hidden="true" tabindex="-1"></a>\index{PROJ!proj4string}</span>
<span id="cb17-508"><a href="#cb17-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-509"><a href="#cb17-509" aria-hidden="true" tabindex="-1"></a>In the early 2000s, PROJ was known as PROJ.4, after its never-changing</span>
<span id="cb17-510"><a href="#cb17-510" aria-hidden="true" tabindex="-1"></a>major version number.  Amongst others motivated by the rise of GPS,</span>
<span id="cb17-511"><a href="#cb17-511" aria-hidden="true" tabindex="-1"></a>the need for datum transformations increased and PROJ.4 was extended</span>
<span id="cb17-512"><a href="#cb17-512" aria-hidden="true" tabindex="-1"></a>with rudimentary datum support. PROJ definitions for coordinate</span>
<span id="cb17-513"><a href="#cb17-513" aria-hidden="true" tabindex="-1"></a>reference systems would look like this:</span>
<span id="cb17-514"><a href="#cb17-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-515"><a href="#cb17-515" aria-hidden="true" tabindex="-1"></a><span class="in">+proj=utm +zone=33 +datum=WGS84 +units=m +no_defs</span></span>
<span id="cb17-516"><a href="#cb17-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-517"><a href="#cb17-517" aria-hidden="true" tabindex="-1"></a>where _key_=_value_ pairs are preceded by a <span class="in">`+`</span> and separated by</span>
<span id="cb17-518"><a href="#cb17-518" aria-hidden="true" tabindex="-1"></a>a space. This form came to be known as "PROJ.4 string", since the</span>
<span id="cb17-519"><a href="#cb17-519" aria-hidden="true" tabindex="-1"></a>PROJ project stayed at version 4.x for several decades. Other datums</span>
<span id="cb17-520"><a href="#cb17-520" aria-hidden="true" tabindex="-1"></a>would come with fields like:</span>
<span id="cb17-521"><a href="#cb17-521" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-522"><a href="#cb17-522" aria-hidden="true" tabindex="-1"></a><span class="in">+ellps=bessel +towgs84=565.4,50.3,465.6,-0.399,0.344,-1.877,4.072</span></span>
<span id="cb17-523"><a href="#cb17-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-524"><a href="#cb17-524" aria-hidden="true" tabindex="-1"></a>indicating another ellipse, as well as the seven (or three)</span>
<span id="cb17-525"><a href="#cb17-525" aria-hidden="true" tabindex="-1"></a>parameters for transforming from this ellipse to WGS84 (the "World</span>
<span id="cb17-526"><a href="#cb17-526" aria-hidden="true" tabindex="-1"></a>Geodetic System 1984" global datum once popularised by GPS),</span>
<span id="cb17-527"><a href="#cb17-527" aria-hidden="true" tabindex="-1"></a>effectively defining the datum in terms of a transformation to WGS84.</span>
<span id="cb17-528"><a href="#cb17-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-529"><a href="#cb17-529" aria-hidden="true" tabindex="-1"></a>Along with PROJ.4 came a set of databases with known (registered)</span>
<span id="cb17-530"><a href="#cb17-530" aria-hidden="true" tabindex="-1"></a>projections, from which the best known is the European Petroleum Survey Group (EPSG) registry.</span>
<span id="cb17-531"><a href="#cb17-531" aria-hidden="true" tabindex="-1"></a>National mapping agencies would provide (and update over time)</span>
<span id="cb17-532"><a href="#cb17-532" aria-hidden="true" tabindex="-1"></a>their best guesses of <span class="in">`+towgs84`</span> parameters for national coordinate</span>
<span id="cb17-533"><a href="#cb17-533" aria-hidden="true" tabindex="-1"></a>reference systems, and distribute through the EPSG registry,</span>
<span id="cb17-534"><a href="#cb17-534" aria-hidden="true" tabindex="-1"></a>which was part of PROJ distributions.</span>
<span id="cb17-535"><a href="#cb17-535" aria-hidden="true" tabindex="-1"></a>For some transformations, _datum grids_ were available and</span>
<span id="cb17-536"><a href="#cb17-536" aria-hidden="true" tabindex="-1"></a>distributed as part of PROJ.4: such grids are raster maps that provide</span>
<span id="cb17-537"><a href="#cb17-537" aria-hidden="true" tabindex="-1"></a>for every location pre-computed values for the shift in longitude</span>
<span id="cb17-538"><a href="#cb17-538" aria-hidden="true" tabindex="-1"></a>and latitude, or elevation, for a particular datum transformation.</span>
<span id="cb17-539"><a href="#cb17-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-540"><a href="#cb17-540" aria-hidden="true" tabindex="-1"></a>In PROJ.4, every coordinate transformation had to go through a</span>
<span id="cb17-541"><a href="#cb17-541" aria-hidden="true" tabindex="-1"></a>conversion to and from WGS84; even reprojecting data associated with</span>
<span id="cb17-542"><a href="#cb17-542" aria-hidden="true" tabindex="-1"></a>a datum different from WGS84 had to go through a transformation to</span>
<span id="cb17-543"><a href="#cb17-543" aria-hidden="true" tabindex="-1"></a>and from WGS84. The associated errors of up to 100 m were acceptable</span>
<span id="cb17-544"><a href="#cb17-544" aria-hidden="true" tabindex="-1"></a>for mapping purposes for not too small areas, but some applications </span>
<span id="cb17-545"><a href="#cb17-545" aria-hidden="true" tabindex="-1"></a>need higher accuracy transformations. Examples include precision</span>
<span id="cb17-546"><a href="#cb17-546" aria-hidden="true" tabindex="-1"></a>agriculture, planning flights of UAV's, or object tracking.</span>
<span id="cb17-547"><a href="#cb17-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-548"><a href="#cb17-548" aria-hidden="true" tabindex="-1"></a>In 2018, after a successful "GDAL Coordinate System Barn Raising"</span>
<span id="cb17-549"><a href="#cb17-549" aria-hidden="true" tabindex="-1"></a>initiative, a number of companies profiting from the open source</span>
<span id="cb17-550"><a href="#cb17-550" aria-hidden="true" tabindex="-1"></a>geospatial software stack supported the development of a more modern,</span>
<span id="cb17-551"><a href="#cb17-551" aria-hidden="true" tabindex="-1"></a>mature coordinate transformation system in PROJ. Over a few years,</span>
<span id="cb17-552"><a href="#cb17-552" aria-hidden="true" tabindex="-1"></a>PROJ.4 evolved through versions 5, 6, 7, 8 and 9 and was hence renamed</span>
<span id="cb17-553"><a href="#cb17-553" aria-hidden="true" tabindex="-1"></a>into PROJ (or PR$\phi$J).</span>
<span id="cb17-554"><a href="#cb17-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-555"><a href="#cb17-555" aria-hidden="true" tabindex="-1"></a>\index{GDAL!barn raising}</span>
<span id="cb17-556"><a href="#cb17-556" aria-hidden="true" tabindex="-1"></a>\index{GDAL!datum transformation}</span>
<span id="cb17-557"><a href="#cb17-557" aria-hidden="true" tabindex="-1"></a>\index{PROJ!datum transformation}</span>
<span id="cb17-558"><a href="#cb17-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-559"><a href="#cb17-559" aria-hidden="true" tabindex="-1"></a>The most notable changes include:</span>
<span id="cb17-560"><a href="#cb17-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-561"><a href="#cb17-561" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>although PROJ.4 strings can still be used to initialise certain</span>
<span id="cb17-562"><a href="#cb17-562" aria-hidden="true" tabindex="-1"></a>coordinate reference systems, they are no longer sufficient to</span>
<span id="cb17-563"><a href="#cb17-563" aria-hidden="true" tabindex="-1"></a>represent all of them; a new format, WKT-2 (described in next section)</span>
<span id="cb17-564"><a href="#cb17-564" aria-hidden="true" tabindex="-1"></a>replaces it</span>
<span id="cb17-565"><a href="#cb17-565" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>WGS84 as a hub datum is dropped: coordinate transformations no longer</span>
<span id="cb17-566"><a href="#cb17-566" aria-hidden="true" tabindex="-1"></a>need to go through a particular datum</span>
<span id="cb17-567"><a href="#cb17-567" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>multiple conversion or transformation paths (so-called pipelines)</span>
<span id="cb17-568"><a href="#cb17-568" aria-hidden="true" tabindex="-1"></a>to go from CRS A to CRS B are possible, and can be reported along</span>
<span id="cb17-569"><a href="#cb17-569" aria-hidden="true" tabindex="-1"></a>with the associated accuracy; PROJ will by default use the most accurate</span>
<span id="cb17-570"><a href="#cb17-570" aria-hidden="true" tabindex="-1"></a>one but user control is possible</span>
<span id="cb17-571"><a href="#cb17-571" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>transformation pipelines can chain an arbitrary number of</span>
<span id="cb17-572"><a href="#cb17-572" aria-hidden="true" tabindex="-1"></a>elementary transformation operations, including swapping of axes</span>
<span id="cb17-573"><a href="#cb17-573" aria-hidden="true" tabindex="-1"></a>and unit transformations </span>
<span id="cb17-574"><a href="#cb17-574" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>datum grids, of which there are now _many_ more, are no longer distributed</span>
<span id="cb17-575"><a href="#cb17-575" aria-hidden="true" tabindex="-1"></a>with the library but are accessible from a content delivery network (CDN); PROJ allows enabling and</span>
<span id="cb17-576"><a href="#cb17-576" aria-hidden="true" tabindex="-1"></a>disabling network access to these grids and only downloads the section(s)</span>
<span id="cb17-577"><a href="#cb17-577" aria-hidden="true" tabindex="-1"></a>of the grid actually needed, storing it in a cache on the user's machine for </span>
<span id="cb17-578"><a href="#cb17-578" aria-hidden="true" tabindex="-1"></a>future use </span>
<span id="cb17-579"><a href="#cb17-579" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>coordinate transformations receive support for epochs, time-dependent</span>
<span id="cb17-580"><a href="#cb17-580" aria-hidden="true" tabindex="-1"></a>transformations (and hence: four-dimensional coordinates, including the</span>
<span id="cb17-581"><a href="#cb17-581" aria-hidden="true" tabindex="-1"></a>source and target time)</span>
<span id="cb17-582"><a href="#cb17-582" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the set of files with registered coordinate reference systems is handled</span>
<span id="cb17-583"><a href="#cb17-583" aria-hidden="true" tabindex="-1"></a>in an SQLite database</span>
<span id="cb17-584"><a href="#cb17-584" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>instead of always handling axis order (longitude, latitude),</span>
<span id="cb17-585"><a href="#cb17-585" aria-hidden="true" tabindex="-1"></a>when the authority defines differently this is now obeyed (but see</span>
<span id="cb17-586"><a href="#cb17-586" aria-hidden="true" tabindex="-1"></a>@sec-wkt2 and @sec-axisorder)</span>
<span id="cb17-587"><a href="#cb17-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-588"><a href="#cb17-588" aria-hidden="true" tabindex="-1"></a>\index{WKT-2}</span>
<span id="cb17-589"><a href="#cb17-589" aria-hidden="true" tabindex="-1"></a>\index{PROJ!WKT-2}</span>
<span id="cb17-590"><a href="#cb17-590" aria-hidden="true" tabindex="-1"></a>\index{projection!accuracy}</span>
<span id="cb17-591"><a href="#cb17-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-592"><a href="#cb17-592" aria-hidden="true" tabindex="-1"></a>All these points sound like massive improvements, and accuracies</span>
<span id="cb17-593"><a href="#cb17-593" aria-hidden="true" tabindex="-1"></a>of transformation can be below 1 metre. An interesting point</span>
<span id="cb17-594"><a href="#cb17-594" aria-hidden="true" tabindex="-1"></a>is the last: Where we could safely assume for many decades that</span>
<span id="cb17-595"><a href="#cb17-595" aria-hidden="true" tabindex="-1"></a>spatial data with ellipsoidal coordinates would have axis order</span>
<span id="cb17-596"><a href="#cb17-596" aria-hidden="true" tabindex="-1"></a>(longitude, latitude), this is no longer the case. We will see in</span>
<span id="cb17-597"><a href="#cb17-597" aria-hidden="true" tabindex="-1"></a>@sec-axisorder how to deal with this.</span>
<span id="cb17-598"><a href="#cb17-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-599"><a href="#cb17-599" aria-hidden="true" tabindex="-1"></a>\index{datum!grids}</span>
<span id="cb17-600"><a href="#cb17-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-601"><a href="#cb17-601" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb17-602"><a href="#cb17-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-603"><a href="#cb17-603" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb17-604"><a href="#cb17-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-horizontalgrid, echo=!knitr::is_latex_output(), message = FALSE}</span></span>
<span id="cb17-605"><a href="#cb17-605" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 70%</span></span>
<span id="cb17-606"><a href="#cb17-606" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "UK horizontal datum grid, from datum OSGB 1936 (EPSG:4277) to datum ETRS89 (EPSG:4258); units arc-seconds"</span></span>
<span id="cb17-607"><a href="#cb17-607" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-608"><a href="#cb17-608" aria-hidden="true" tabindex="-1"></a><span class="in">library(stars)</span></span>
<span id="cb17-609"><a href="#cb17-609" aria-hidden="true" tabindex="-1"></a><span class="in">library(rnaturalearth)</span></span>
<span id="cb17-610"><a href="#cb17-610" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr) |&gt; suppressPackageStartupMessages()</span></span>
<span id="cb17-611"><a href="#cb17-611" aria-hidden="true" tabindex="-1"></a><span class="in">countries110 |&gt; </span></span>
<span id="cb17-612"><a href="#cb17-612" aria-hidden="true" tabindex="-1"></a><span class="in">    st_as_sf() |&gt;</span></span>
<span id="cb17-613"><a href="#cb17-613" aria-hidden="true" tabindex="-1"></a><span class="in">    filter(ADMIN == "United Kingdom") |&gt;</span></span>
<span id="cb17-614"><a href="#cb17-614" aria-hidden="true" tabindex="-1"></a><span class="in">    st_geometry() -&gt; uk</span></span>
<span id="cb17-615"><a href="#cb17-615" aria-hidden="true" tabindex="-1"></a><span class="in">filename = "data/uk_os_OSTN15_NTv2_OSGBtoETRS.tif"</span></span>
<span id="cb17-616"><a href="#cb17-616" aria-hidden="true" tabindex="-1"></a><span class="in">r &lt;- if (file.exists(filename)) {</span></span>
<span id="cb17-617"><a href="#cb17-617" aria-hidden="true" tabindex="-1"></a><span class="in">    r &lt;- read_stars(filename)</span></span>
<span id="cb17-618"><a href="#cb17-618" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb17-619"><a href="#cb17-619" aria-hidden="true" tabindex="-1"></a><span class="in">    read_stars("/vsicurl/https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif")</span></span>
<span id="cb17-620"><a href="#cb17-620" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb17-621"><a href="#cb17-621" aria-hidden="true" tabindex="-1"></a><span class="in">hook &lt;- function() {</span></span>
<span id="cb17-622"><a href="#cb17-622" aria-hidden="true" tabindex="-1"></a><span class="in">        plot(uk, border = "orange", col = NA, add = TRUE)</span></span>
<span id="cb17-623"><a href="#cb17-623" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb17-624"><a href="#cb17-624" aria-hidden="true" tabindex="-1"></a><span class="in">plot(r[,,,1:2], axes = TRUE, hook = hook, key.pos = 4)</span></span>
<span id="cb17-625"><a href="#cb17-625" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-626"><a href="#cb17-626" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb17-629"><a href="#cb17-629" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb17-630"><a href="#cb17-630" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-631"><a href="#cb17-631" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "UK horizontal datum grid, from datum OSGB 1936 (EPSG:4277) to datum ETRS89 (EPSG:4258); units arc-seconds"</span></span>
<span id="cb17-632"><a href="#cb17-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-633"><a href="#cb17-633" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb17-634"><a href="#cb17-634" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb17-635"><a href="#cb17-635" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.plot <span class="im">as</span> rioplot</span>
<span id="cb17-636"><a href="#cb17-636" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb17-637"><a href="#cb17-637" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb17-638"><a href="#cb17-638" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb17-639"><a href="#cb17-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-640"><a href="#cb17-640" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'data/uk_os_OSTN15_NTv2_OSGBtoETRS.tif'</span></span>
<span id="cb17-641"><a href="#cb17-641" aria-hidden="true" tabindex="-1"></a>isFile <span class="op">=</span> os.path.isfile(filename)</span>
<span id="cb17-642"><a href="#cb17-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-643"><a href="#cb17-643" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> isFile:</span>
<span id="cb17-644"><a href="#cb17-644" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(filename)</span>
<span id="cb17-645"><a href="#cb17-645" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb17-646"><a href="#cb17-646" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(<span class="st">"https://cdn.proj.org/uk_os_OSTN15_NTv2_OSGBtoETRS.tif"</span>)</span>
<span id="cb17-647"><a href="#cb17-647" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-648"><a href="#cb17-648" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://naciscdn.org/naturalearth/110m/cultural/ne_110m_admin_0_countries.zip"</span></span>
<span id="cb17-649"><a href="#cb17-649" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb17-650"><a href="#cb17-650" aria-hidden="true" tabindex="-1"></a>uk <span class="op">=</span> gdf[gdf.NAME <span class="op">==</span> <span class="st">'United Kingdom'</span>]</span>
<span id="cb17-651"><a href="#cb17-651" aria-hidden="true" tabindex="-1"></a>uk_transformed <span class="op">=</span> uk.to_crs(r.crs)</span>
<span id="cb17-652"><a href="#cb17-652" aria-hidden="true" tabindex="-1"></a>raster_extent <span class="op">=</span> numpy.asarray(r.bounds)[[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>]]</span>
<span id="cb17-653"><a href="#cb17-653" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> r.read(<span class="dv">1</span>)</span>
<span id="cb17-654"><a href="#cb17-654" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r.read(<span class="dv">2</span>)</span>
<span id="cb17-655"><a href="#cb17-655" aria-hidden="true" tabindex="-1"></a>int_r1 <span class="op">=</span> r1.astype(<span class="bu">int</span>)</span>
<span id="cb17-656"><a href="#cb17-656" aria-hidden="true" tabindex="-1"></a>int_r2 <span class="op">=</span> r2.astype(<span class="bu">int</span>)</span>
<span id="cb17-657"><a href="#cb17-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-658"><a href="#cb17-658" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb17-659"><a href="#cb17-659" aria-hidden="true" tabindex="-1"></a>plt.sca(axes[<span class="dv">0</span>])</span>
<span id="cb17-660"><a href="#cb17-660" aria-hidden="true" tabindex="-1"></a>plt.imshow(int_r1, cmap<span class="op">=</span><span class="st">'gray'</span>, extent<span class="op">=</span>raster_extent)</span>
<span id="cb17-661"><a href="#cb17-661" aria-hidden="true" tabindex="-1"></a>uk_transformed.plot(ax <span class="op">=</span> axes[<span class="dv">0</span>], facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb17-662"><a href="#cb17-662" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"latitude_offset"</span>)</span>
<span id="cb17-663"><a href="#cb17-663" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">True</span>)</span>
<span id="cb17-664"><a href="#cb17-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-665"><a href="#cb17-665" aria-hidden="true" tabindex="-1"></a>plt.sca(axes[<span class="dv">1</span>])</span>
<span id="cb17-666"><a href="#cb17-666" aria-hidden="true" tabindex="-1"></a>plt.imshow(int_r2, cmap<span class="op">=</span><span class="st">'gray'</span>, extent<span class="op">=</span>raster_extent, )</span>
<span id="cb17-667"><a href="#cb17-667" aria-hidden="true" tabindex="-1"></a>uk_transformed.plot(ax <span class="op">=</span> axes[<span class="dv">1</span>], facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'orange'</span>)</span>
<span id="cb17-668"><a href="#cb17-668" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"longitude_offset"</span>)</span>
<span id="cb17-669"><a href="#cb17-669" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">True</span>)</span>
<span id="cb17-670"><a href="#cb17-670" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb17-671"><a href="#cb17-671" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span>
<span id="cb17-672"><a href="#cb17-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-673"><a href="#cb17-673" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-674"><a href="#cb17-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-675"><a href="#cb17-675" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb17-676"><a href="#cb17-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-677"><a href="#cb17-677" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb17-678"><a href="#cb17-678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-verticalgrid, echo=!knitr::is_latex_output(), message = FALSE}</span></span>
<span id="cb17-679"><a href="#cb17-679" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 70%</span></span>
<span id="cb17-680"><a href="#cb17-680" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "UK vertical datum grid, from ETRS89 (EPSG:4937) to ODN height (EPSG:5701), units m"</span></span>
<span id="cb17-681"><a href="#cb17-681" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb17-682"><a href="#cb17-682" aria-hidden="true" tabindex="-1"></a><span class="in">filename = "data/uk_os_OSGM15_GB.tif"</span></span>
<span id="cb17-683"><a href="#cb17-683" aria-hidden="true" tabindex="-1"></a><span class="in">h &lt;- if (file.exists(filename)) {</span></span>
<span id="cb17-684"><a href="#cb17-684" aria-hidden="true" tabindex="-1"></a><span class="in">    read_stars(filename)</span></span>
<span id="cb17-685"><a href="#cb17-685" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb17-686"><a href="#cb17-686" aria-hidden="true" tabindex="-1"></a><span class="in">    read_stars("/vsicurl/https://cdn.proj.org/uk_os_OSGM15_GB.tif")</span></span>
<span id="cb17-687"><a href="#cb17-687" aria-hidden="true" tabindex="-1"></a><span class="in">  } </span></span>
<span id="cb17-688"><a href="#cb17-688" aria-hidden="true" tabindex="-1"></a><span class="in">plot(h, axes = TRUE, reset = FALSE)</span></span>
<span id="cb17-689"><a href="#cb17-689" aria-hidden="true" tabindex="-1"></a><span class="in">plot(uk, border = "orange", col = NA, add = TRUE)</span></span>
<span id="cb17-690"><a href="#cb17-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-691"><a href="#cb17-691" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb17-694"><a href="#cb17-694" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb17-695"><a href="#cb17-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb17-696"><a href="#cb17-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "UK vertical datum grid, from ETRS89 (EPSG:4937) to ODN height (EPSG:5701), units m"</span></span>
<span id="cb17-697"><a href="#cb17-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-698"><a href="#cb17-698" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb17-699"><a href="#cb17-699" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio <span class="im">as</span> rio</span>
<span id="cb17-700"><a href="#cb17-700" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio.plot <span class="im">as</span> rioplot</span>
<span id="cb17-701"><a href="#cb17-701" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb17-702"><a href="#cb17-702" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb17-703"><a href="#cb17-703" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-704"><a href="#cb17-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-705"><a href="#cb17-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-706"><a href="#cb17-706" aria-hidden="true" tabindex="-1"></a>filename <span class="op">=</span> <span class="st">'data/uk_os_OSGM15_GB.tif'</span></span>
<span id="cb17-707"><a href="#cb17-707" aria-hidden="true" tabindex="-1"></a>isFile <span class="op">=</span> os.path.isfile(filename)</span>
<span id="cb17-708"><a href="#cb17-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-709"><a href="#cb17-709" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> isFile:</span>
<span id="cb17-710"><a href="#cb17-710" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(filename)</span>
<span id="cb17-711"><a href="#cb17-711" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb17-712"><a href="#cb17-712" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> rio.<span class="bu">open</span>(<span class="st">"https://cdn.proj.org/uk_os_OSGM15_GB.tif"</span>)</span>
<span id="cb17-713"><a href="#cb17-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-714"><a href="#cb17-714" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://naciscdn.org/naturalearth/110m/cultural/ne_110m_admin_0_countries.zip"</span></span>
<span id="cb17-715"><a href="#cb17-715" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb17-716"><a href="#cb17-716" aria-hidden="true" tabindex="-1"></a>uk <span class="op">=</span> gdf[gdf.NAME <span class="op">==</span> <span class="st">'United Kingdom'</span>]</span>
<span id="cb17-717"><a href="#cb17-717" aria-hidden="true" tabindex="-1"></a>uk_transformed <span class="op">=</span> uk.to_crs(r.crs)</span>
<span id="cb17-718"><a href="#cb17-718" aria-hidden="true" tabindex="-1"></a>raster_extent <span class="op">=</span> numpy.asarray(r.bounds)[[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">3</span>]]</span>
<span id="cb17-719"><a href="#cb17-719" aria-hidden="true" tabindex="-1"></a>r1 <span class="op">=</span> r.read(<span class="dv">1</span>)</span>
<span id="cb17-720"><a href="#cb17-720" aria-hidden="true" tabindex="-1"></a>int_r1 <span class="op">=</span> r1.astype(<span class="bu">int</span>)</span>
<span id="cb17-721"><a href="#cb17-721" aria-hidden="true" tabindex="-1"></a>int_r1[int_r1<span class="op">==-</span><span class="dv">32768</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb17-722"><a href="#cb17-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-723"><a href="#cb17-723" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb17-724"><a href="#cb17-724" aria-hidden="true" tabindex="-1"></a>plt.sca(axes)</span>
<span id="cb17-725"><a href="#cb17-725" aria-hidden="true" tabindex="-1"></a>plt.imshow(int_r1, cmap <span class="op">=</span> <span class="st">'gray'</span> ,vmin <span class="op">=</span> <span class="dv">40</span>, vmax <span class="op">=</span> <span class="dv">60</span>,extent <span class="op">=</span> raster_extent)</span>
<span id="cb17-726"><a href="#cb17-726" aria-hidden="true" tabindex="-1"></a>uk_transformed.plot(ax <span class="op">=</span> axes, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb17-727"><a href="#cb17-727" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="va">True</span>)</span>
<span id="cb17-728"><a href="#cb17-728" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb17-729"><a href="#cb17-729" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span>
<span id="cb17-730"><a href="#cb17-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-731"><a href="#cb17-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-732"><a href="#cb17-732" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-733"><a href="#cb17-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-734"><a href="#cb17-734" aria-hidden="true" tabindex="-1"></a>\index{coordinates!axis order}</span>
<span id="cb17-735"><a href="#cb17-735" aria-hidden="true" tabindex="-1"></a>\index{axis order}</span>
<span id="cb17-736"><a href="#cb17-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-737"><a href="#cb17-737" aria-hidden="true" tabindex="-1"></a>Examples of a horizontal datum grids, downloaded from cdn.proj.org,</span>
<span id="cb17-738"><a href="#cb17-738" aria-hidden="true" tabindex="-1"></a>are shown in @fig-horizontalgrid  and for a vertical</span>
<span id="cb17-739"><a href="#cb17-739" aria-hidden="true" tabindex="-1"></a>datum grid in @fig-verticalgrid. Datum grids may carry</span>
<span id="cb17-740"><a href="#cb17-740" aria-hidden="true" tabindex="-1"></a>per-pixel accuracy values.</span>
<span id="cb17-741"><a href="#cb17-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-742"><a href="#cb17-742" aria-hidden="true" tabindex="-1"></a><span class="fu">## WKT-2 {#sec-wkt2}</span></span>
<span id="cb17-743"><a href="#cb17-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-744"><a href="#cb17-744" aria-hidden="true" tabindex="-1"></a>@lott2015 describes a standard for encoding coordinate reference</span>
<span id="cb17-745"><a href="#cb17-745" aria-hidden="true" tabindex="-1"></a>systems, as well as transformations between them using _well-known text_; </span>
<span id="cb17-746"><a href="#cb17-746" aria-hidden="true" tabindex="-1"></a>the standard (and format) is referred to informally as</span>
<span id="cb17-747"><a href="#cb17-747" aria-hidden="true" tabindex="-1"></a>WKT-2. As mentioned above, GDAL and PROJ fully support this encoding.</span>
<span id="cb17-748"><a href="#cb17-748" aria-hidden="true" tabindex="-1"></a>An example of WKT-2 for CRS <span class="in">`EPSG:4326`</span> is:</span>
<span id="cb17-749"><a href="#cb17-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-750"><a href="#cb17-750" aria-hidden="true" tabindex="-1"></a>\index{coordinates!WKT-2}</span>
<span id="cb17-751"><a href="#cb17-751" aria-hidden="true" tabindex="-1"></a>\index{WKT-2}</span>
<span id="cb17-752"><a href="#cb17-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-753"><a href="#cb17-753" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-754"><a href="#cb17-754" aria-hidden="true" tabindex="-1"></a><span class="in">GEOGCRS["WGS 84",</span></span>
<span id="cb17-755"><a href="#cb17-755" aria-hidden="true" tabindex="-1"></a><span class="in">    ENSEMBLE["World Geodetic System 1984 ensemble",</span></span>
<span id="cb17-756"><a href="#cb17-756" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (Transit)"],</span></span>
<span id="cb17-757"><a href="#cb17-757" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (G730)"],</span></span>
<span id="cb17-758"><a href="#cb17-758" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (G873)"],</span></span>
<span id="cb17-759"><a href="#cb17-759" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (G1150)"],</span></span>
<span id="cb17-760"><a href="#cb17-760" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (G1674)"],</span></span>
<span id="cb17-761"><a href="#cb17-761" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (G1762)"],</span></span>
<span id="cb17-762"><a href="#cb17-762" aria-hidden="true" tabindex="-1"></a><span class="in">        MEMBER["World Geodetic System 1984 (G2139)"],</span></span>
<span id="cb17-763"><a href="#cb17-763" aria-hidden="true" tabindex="-1"></a><span class="in">        ELLIPSOID["WGS 84",6378137,298.257223563,</span></span>
<span id="cb17-764"><a href="#cb17-764" aria-hidden="true" tabindex="-1"></a><span class="in">            LENGTHUNIT["metre",1]],</span></span>
<span id="cb17-765"><a href="#cb17-765" aria-hidden="true" tabindex="-1"></a><span class="in">        ENSEMBLEACCURACY[2.0]],</span></span>
<span id="cb17-766"><a href="#cb17-766" aria-hidden="true" tabindex="-1"></a><span class="in">    PRIMEM["Greenwich",0,</span></span>
<span id="cb17-767"><a href="#cb17-767" aria-hidden="true" tabindex="-1"></a><span class="in">        ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb17-768"><a href="#cb17-768" aria-hidden="true" tabindex="-1"></a><span class="in">    CS[ellipsoidal,2],</span></span>
<span id="cb17-769"><a href="#cb17-769" aria-hidden="true" tabindex="-1"></a><span class="in">        AXIS["geodetic latitude (Lat)",north,</span></span>
<span id="cb17-770"><a href="#cb17-770" aria-hidden="true" tabindex="-1"></a><span class="in">            ORDER[1],</span></span>
<span id="cb17-771"><a href="#cb17-771" aria-hidden="true" tabindex="-1"></a><span class="in">            ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb17-772"><a href="#cb17-772" aria-hidden="true" tabindex="-1"></a><span class="in">        AXIS["geodetic longitude (Lon)",east,</span></span>
<span id="cb17-773"><a href="#cb17-773" aria-hidden="true" tabindex="-1"></a><span class="in">            ORDER[2],</span></span>
<span id="cb17-774"><a href="#cb17-774" aria-hidden="true" tabindex="-1"></a><span class="in">            ANGLEUNIT["degree",0.0174532925199433]],</span></span>
<span id="cb17-775"><a href="#cb17-775" aria-hidden="true" tabindex="-1"></a><span class="in">    USAGE[</span></span>
<span id="cb17-776"><a href="#cb17-776" aria-hidden="true" tabindex="-1"></a><span class="in">        SCOPE["Horizontal component of 3D system."],</span></span>
<span id="cb17-777"><a href="#cb17-777" aria-hidden="true" tabindex="-1"></a><span class="in">        AREA["World."],</span></span>
<span id="cb17-778"><a href="#cb17-778" aria-hidden="true" tabindex="-1"></a><span class="in">        BBOX[-90,-180,90,180]],</span></span>
<span id="cb17-779"><a href="#cb17-779" aria-hidden="true" tabindex="-1"></a><span class="in">    ID["EPSG",4326]]</span></span>
<span id="cb17-780"><a href="#cb17-780" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-781"><a href="#cb17-781" aria-hidden="true" tabindex="-1"></a>This shows a coordinate system with the axis order _latitude,</span>
<span id="cb17-782"><a href="#cb17-782" aria-hidden="true" tabindex="-1"></a>longitude_, although in most practical cases the axis order used is</span>
<span id="cb17-783"><a href="#cb17-783" aria-hidden="true" tabindex="-1"></a>_longitude, latitude_.  The _ensemble_ of WGS84 ellipsoids listed</span>
<span id="cb17-784"><a href="#cb17-784" aria-hidden="true" tabindex="-1"></a>represents its various updates over time.  Ambiguity about _which_</span>
<span id="cb17-785"><a href="#cb17-785" aria-hidden="true" tabindex="-1"></a>of these ensemble members a particular dataset should use leads to</span>
<span id="cb17-786"><a href="#cb17-786" aria-hidden="true" tabindex="-1"></a>an uncertainty of several meters. The coordinate reference system</span>
<span id="cb17-787"><a href="#cb17-787" aria-hidden="true" tabindex="-1"></a><span class="in">`OGC:CRS84`</span> disambiguates the axis order and explicitly states it</span>
<span id="cb17-788"><a href="#cb17-788" aria-hidden="true" tabindex="-1"></a>to be <span class="in">`longitude, latitude`</span>, and is the recommended alternative to</span>
<span id="cb17-789"><a href="#cb17-789" aria-hidden="true" tabindex="-1"></a>WGS84 datasets using this axis order. It does not disambiguate</span>
<span id="cb17-790"><a href="#cb17-790" aria-hidden="true" tabindex="-1"></a>the datum ensemble problem.</span>
<span id="cb17-791"><a href="#cb17-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-792"><a href="#cb17-792" aria-hidden="true" tabindex="-1"></a>\index{axis order!disambiguate}</span>
<span id="cb17-793"><a href="#cb17-793" aria-hidden="true" tabindex="-1"></a>\index{WGS84}</span>
<span id="cb17-794"><a href="#cb17-794" aria-hidden="true" tabindex="-1"></a>\index{OGC:CRS84}</span>
<span id="cb17-795"><a href="#cb17-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-796"><a href="#cb17-796" aria-hidden="true" tabindex="-1"></a>A longer introduction on the history and recent changes in PROJ</span>
<span id="cb17-797"><a href="#cb17-797" aria-hidden="true" tabindex="-1"></a>is given in @rogerCRS, building upon the work of @knudsen+evers17</span>
<span id="cb17-798"><a href="#cb17-798" aria-hidden="true" tabindex="-1"></a>and @evers+knudsen17.</span>
<span id="cb17-799"><a href="#cb17-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-800"><a href="#cb17-800" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb17-801"><a href="#cb17-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-802"><a href="#cb17-802" aria-hidden="true" tabindex="-1"></a>Try to solve the following exercises with R (without loading packages); try to use functions where appropriate:</span>
<span id="cb17-803"><a href="#cb17-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-804"><a href="#cb17-804" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>list three _geographic_ measures that do not have a natural zero origin</span>
<span id="cb17-805"><a href="#cb17-805" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- latitude, longitude, elevation --&gt;</span></span>
<span id="cb17-806"><a href="#cb17-806" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>convert the $(x,y)$ points $(10,2)$, $(-10,-2)$, $(10,-2)$, and $(0,10)$ to polar coordinates</span>
<span id="cb17-807"><a href="#cb17-807" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>convert the polar $(r,\phi)$ points $(10,45^{\circ})$, $(0,100^{\circ})$, and $(5,359^{\circ})$ to Cartesian coordinates</span>
<span id="cb17-808"><a href="#cb17-808" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>assuming the Earth is a sphere with a radius of 6371 km, compute for $(\lambda,\phi)$ points the great circle distance between $(10,10)$ and $(11,10)$, between $(10,80)$ and $(11,80)$, between $(10,10)$ and $(10,11)$, and between $(10,80)$ and $(10,81)$ (units: degree). What are the distance units?</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/sdsr/edit/python/02-Spaces.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>