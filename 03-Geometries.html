<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spatial Data Science - 3&nbsp; Geometries</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-Spherical.html" rel="next">
<link href="./02-Spaces.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-04YTZNEH1K"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-04YTZNEH1K', { 'anonymize_ip': true});
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-1.html">Spatial Data</a></li><li class="breadcrumb-item"><a href="./03-Geometries.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Spatial Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/sdsr/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-hello.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Spaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Geometries.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Spherical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Attributes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Attributes and Support</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Cubes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Cubes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R for Spatial Data Science</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Introsf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Introduction to sf and stars</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Plotting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Plotting spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Large.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Large data and cloud native</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models for Spatial Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Statistical modelling of spatial data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-PointPattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Point Pattern Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatial Interpolation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Geostatistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Multivariate and Spatiotemporal Geostatistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Areal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Proximity and Areal Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Measures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Measures of Spatial Autocorrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-SpatialRegression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Spatial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Econometrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Spatial Econometrics Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Older R Spatial Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rbasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">R Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ERRATA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Errata to the printed ed.</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-simplefeatures" id="toc-sec-simplefeatures" class="nav-link active" data-scroll-target="#sec-simplefeatures"><span class="header-section-number">3.1</span> Simple feature geometries</a>
  <ul class="collapse">
  <li><a href="#sec-seven" id="toc-sec-seven" class="nav-link" data-scroll-target="#sec-seven">The big seven</a></li>
  <li><a href="#sec-valid" id="toc-sec-valid" class="nav-link" data-scroll-target="#sec-valid">Simple and valid geometries, ring direction</a></li>
  <li><a href="#z-and-m-coordinates" id="toc-z-and-m-coordinates" class="nav-link" data-scroll-target="#z-and-m-coordinates">Z and M coordinates</a></li>
  <li><a href="#empty-geometries" id="toc-empty-geometries" class="nav-link" data-scroll-target="#empty-geometries">Empty geometries</a></li>
  <li><a href="#ten-further-geometry-types" id="toc-ten-further-geometry-types" class="nav-link" data-scroll-target="#ten-further-geometry-types">Ten further geometry types</a></li>
  <li><a href="#text-and-binary-encodings" id="toc-text-and-binary-encodings" class="nav-link" data-scroll-target="#text-and-binary-encodings">Text and binary encodings</a></li>
  </ul></li>
  <li><a href="#sec-opgeom" id="toc-sec-opgeom" class="nav-link" data-scroll-target="#sec-opgeom"><span class="header-section-number">3.2</span> Operations on geometries</a>
  <ul class="collapse">
  <li><a href="#unary-predicates" id="toc-unary-predicates" class="nav-link" data-scroll-target="#unary-predicates">Unary predicates</a></li>
  <li><a href="#sec-de9im" id="toc-sec-de9im" class="nav-link" data-scroll-target="#sec-de9im">Binary predicates and DE-9IM</a></li>
  <li><a href="#unary-measures" id="toc-unary-measures" class="nav-link" data-scroll-target="#unary-measures">Unary measures</a></li>
  <li><a href="#binary-measures" id="toc-binary-measures" class="nav-link" data-scroll-target="#binary-measures">Binary measures</a></li>
  <li><a href="#unary-transformers" id="toc-unary-transformers" class="nav-link" data-scroll-target="#unary-transformers">Unary transformers</a></li>
  <li><a href="#sec-bintrans" id="toc-sec-bintrans" class="nav-link" data-scroll-target="#sec-bintrans">Binary transformers</a></li>
  <li><a href="#sec-nary" id="toc-sec-nary" class="nav-link" data-scroll-target="#sec-nary">N-ary transformers</a></li>
  </ul></li>
  <li><a href="#sec-precision" id="toc-sec-precision" class="nav-link" data-scroll-target="#sec-precision"><span class="header-section-number">3.3</span> Precision</a></li>
  <li><a href="#sec-coverages" id="toc-sec-coverages" class="nav-link" data-scroll-target="#sec-coverages"><span class="header-section-number">3.4</span> Coverages: tessellations and rasters</a>
  <ul class="collapse">
  <li><a href="#topological-models" id="toc-topological-models" class="nav-link" data-scroll-target="#topological-models">Topological models</a></li>
  <li><a href="#raster-tessellations" id="toc-raster-tessellations" class="nav-link" data-scroll-target="#raster-tessellations">Raster tessellations</a></li>
  </ul></li>
  <li><a href="#networks" id="toc-networks" class="nav-link" data-scroll-target="#networks"><span class="header-section-number">3.5</span> Networks</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.6</span> Exercises</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/edzer/sdsr/edit/python/03-Geometries.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-1.html">Spatial Data</a></li><li class="breadcrumb-item"><a href="./03-Geometries.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-geometries" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geometries</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p> </p>
<p>Having learned how we represent coordinates systems, we can define how geometries can be described using these coordinate systems. This chapter will explain:</p>
<ul>
<li><em>simple features</em>, a standard that describes point, line, and polygon geometries along with operations on them,</li>
<li>operations on geometries,</li>
<li>coverages, functions of space or space-time,</li>
<li>tesselations, sub-divisions of larger regions into sub-regions, and</li>
<li>networks.</li>
</ul>
<p>Geometries on the sphere are discussed in <a href="04-Spherical.html" class="quarto-xref"><span>Chapter 4</span></a>, rasters and other rectangular sub-divisions of space or space time are discussed in <a href="06-Cubes.html" class="quarto-xref"><span>Chapter 6</span></a>.</p>
<section id="sec-simplefeatures" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-simplefeatures"><span class="header-section-number">3.1</span> Simple feature geometries</h2>
<p> </p>
<p>Simple feature geometries are a way to describe the geometries of <em>features</em>. By <em>features</em> we mean <em>things</em> that have a geometry, potentially implicitly some time properties, and further <em>attributes</em> that could include labels describing the thing and/or values quantitatively measuring it. The main application of simple feature geometries is to describe geometries in two-dimensional space by points, lines, or polygons. The “simple” adjective refers to the fact that the line or polygon geometries are represented by sequences of points connected with straight lines that do not self-intersect.</p>
<p><em>Simple features access</em> is a standard <span class="citation" data-cites="sfa sfa2 iso">(<a href="references.html#ref-sfa" role="doc-biblioref">Herring 2011</a>, <a href="references.html#ref-sfa2" role="doc-biblioref">2010</a>; <a href="references.html#ref-iso" role="doc-biblioref">ISO 2004</a>)</span> for describing simple feature geometries. It includes:</p>
<p></p>
<ul>
<li>a class hierarchy</li>
<li>a set of operations</li>
<li>binary and text encodings</li>
</ul>
<p>We will first discuss the seven most common simple feature geometry types.</p>
<section id="sec-seven" class="level3">
<h3 class="anchored" data-anchor-id="sec-seven">The big seven</h3>
<p> </p>
<p>The most common simple feature geometries used to represent a <em>single</em> feature are:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>POINT</code></td>
<td>single point geometry</td>
</tr>
<tr class="even">
<td><code>MULTIPOINT</code></td>
<td>set of points</td>
</tr>
<tr class="odd">
<td><code>LINESTRING</code></td>
<td>single linestring (two or more points connected by straight lines)</td>
</tr>
<tr class="even">
<td><code>MULTILINESTRING</code></td>
<td>set of linestrings</td>
</tr>
<tr class="odd">
<td><code>POLYGON</code></td>
<td>exterior ring with zero or more inner rings, denoting holes</td>
</tr>
<tr class="even">
<td><code>MULTIPOLYGON</code></td>
<td>set of polygons</td>
</tr>
<tr class="odd">
<td><code>GEOMETRYCOLLECTION</code></td>
<td>set of the geometries above</td>
</tr>
</tbody>
</table>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="sc">|&gt;</span> <span class="fu">suppressPackageStartupMessages</span>()</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="fl">1.2</span>,<span class="dv">1</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">st_point</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"point"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 2</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>mp <span class="ot">&lt;-</span> <span class="fu">st_multipoint</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)))</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mp, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"multipoint"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 3</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>ls <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)))</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ls, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"linestring"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 4</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>mls <span class="ot">&lt;-</span> <span class="fu">st_multilinestring</span>(<span class="fu">list</span>(</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>)),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mls, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"multilinestring"</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 polygon</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>po <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)),</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))))</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(po, <span class="at">border =</span> <span class="st">'black'</span>, <span class="at">col =</span> <span class="st">'#ff8888'</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"polygon"</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 multipolygon</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>mpo <span class="ot">&lt;-</span> <span class="fu">st_multipolygon</span>(<span class="fu">list</span>(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)),</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))),</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>)))))</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mpo, <span class="at">border =</span> <span class="st">'black'</span>, <span class="at">col =</span> <span class="st">'#ff8888'</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"multipolygon"</span>)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 geometrycollection</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>gc <span class="ot">&lt;-</span> <span class="fu">st_geometrycollection</span>(<span class="fu">list</span>(po, ls <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">4</span>))))</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(gc, <span class="at">border =</span> <span class="st">'black'</span>, <span class="at">col =</span> <span class="st">'#ff6666'</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"geometrycollection"</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">col =</span> <span class="st">'grey'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sfgeometries" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sfgeometries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-Geometries_files/figure-html/fig-sfgeometries-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sfgeometries-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Sketches of the main simple feature geometry types
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a 2x4 grid of plots</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="fl">0.1</span>, bottom<span class="op">=</span><span class="fl">0.1</span>, right<span class="op">=</span><span class="fl">0.9</span>, top<span class="op">=</span><span class="fl">0.9</span>, wspace<span class="op">=</span><span class="fl">0.4</span>, hspace<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> gpd.GeoSeries([Point(<span class="dv">0</span>, <span class="dv">1</span>)])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">241</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>p.plot(ax<span class="op">=</span>ax1, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"point"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>ax1.set_axis_off()</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>mp <span class="op">=</span> gpd.GeoSeries([MultiPoint([(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">3</span>), (<span class="dv">1</span>, <span class="dv">4</span>)])])</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">242</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>mp.plot(ax<span class="op">=</span>ax2, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"multipoint"</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>ax2.set_axis_off()</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> gpd.GeoSeries([LineString([(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">5</span>), (<span class="dv">5</span>, <span class="dv">6</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">2</span>, <span class="dv">3</span>)])])</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> plt.subplot(<span class="dv">243</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>ls.plot(ax<span class="op">=</span>ax3, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"linestring"</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>ax3.set_axis_off()</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>mls <span class="op">=</span> gpd.GeoSeries([</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    MultiLineString([</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        [(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">5</span>), (<span class="dv">5</span>, <span class="dv">6</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">2</span>, <span class="dv">3</span>)],</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        [(<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">1</span>)]</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> plt.subplot(<span class="dv">244</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>mls.plot(ax<span class="op">=</span>ax4, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">"multilinestring"</span>)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>ax4.set_axis_off()</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 polygon</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>po <span class="op">=</span> gpd.GeoSeries([</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    Polygon([(<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">2</span>), (<span class="dv">6</span>, <span class="dv">3</span>), (<span class="dv">5</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">4</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">1</span>, <span class="dv">3</span>), (<span class="dv">2</span>, <span class="dv">1</span>)]),</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    Polygon([(<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">3</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">2</span>)])</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>ax5 <span class="op">=</span> plt.subplot(<span class="dv">245</span>)</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>po.plot(ax<span class="op">=</span>ax5, facecolor<span class="op">=</span><span class="st">'#ff8888'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>ax5.set_title(<span class="st">"polygon"</span>)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>ax5.set_axis_off()</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 multipolygon</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> Polygon([(<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">2</span>), (<span class="dv">6</span>, <span class="dv">3</span>), (<span class="dv">5</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">4</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">1</span>, <span class="dv">3</span>), (<span class="dv">2</span>, <span class="dv">1</span>)])</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> Polygon([(<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">3</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">2</span>)])</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> Polygon([(<span class="dv">3</span>, <span class="dv">7</span>), (<span class="dv">4</span>, <span class="dv">7</span>), (<span class="dv">5</span>, <span class="dv">8</span>), (<span class="dv">3</span>, <span class="dv">9</span>), (<span class="dv">2</span>, <span class="dv">8</span>), (<span class="dv">3</span>, <span class="dv">7</span>)])</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>mpo <span class="op">=</span> gpd.GeoSeries([MultiPolygon([p1, p2, p3])])</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>ax6 <span class="op">=</span> plt.subplot(<span class="dv">246</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>mpo.plot(ax<span class="op">=</span>ax6, linewidth<span class="op">=</span><span class="dv">2</span>, facecolor<span class="op">=</span><span class="st">'#ff8888'</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>ax6.set_title(<span class="st">"multipolygon"</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>ax6.set_axis_off()</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 geometrycollection</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co">#gc = GeometryCollection([po, ls]) #Issue Spotted here! in this line</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="co">#ax7 = plt.subplot(247)</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co">#gc.plot(ax=ax7, markersize=10, marker='o', linewidth=2, facecolor='#ff6666', edgecolor='k')</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co">#ax7.set_title("geometrycollection")</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-Geometries_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Sketches of the main simple feature geometry types</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p><a href="#fig-sfgeometries" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> shows examples of these basic geometry types. The human-readable, “well-known text” (WKT) representation of the geometries plotted are:</p>
<p> </p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mp</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ls</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>mls</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>po</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>mpo</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>gc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print(p, mp, ls, mls, po, mpo, gc)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p, mp, ls, mls, po, mpo)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 0    POINT (0.00000 1.00000)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dtype: geometry 0    MULTIPOINT (1.00000 1.00000, 2.00000 2.00000, ...</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># dtype: geometry 0    LINESTRING (1.00000 1.00000, 5.00000 5.00000, ...</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># dtype: geometry 0    MULTILINESTRING ((1.00000 1.00000, 5.00000 5.0...</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># dtype: geometry 0    POLYGON ((2.00000 1.00000, 3.00000 1.00000, 5....</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1    POLYGON ((2.00000 2.00000, 3.00000 3.00000, 4....</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># dtype: geometry 0    MULTIPOLYGON (((2.00000 1.00000, 3.00000 1.000...</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># dtype: geometry</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<pre><code>POINT (0 1)
MULTIPOINT ((1 1), (2 2), (4 1), (2 3), (1 4))
LINESTRING (1 1, 5 5, 5 6, 4 6, 3 4, 2 3)
MULTILINESTRING ((1 1, 5 5, 5 6, 4 6, 3 4, 2 3), (3 0, 4 1, 2 1))
POLYGON ((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),
    (2 2, 3 3, 4 3, 4 2, 2 2))
MULTIPOLYGON (((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),
    (2 2, 3 3, 4 3, 4 2, 2 2)), ((3 7, 4 7, 5 8, 3 9, 2 8, 3 7)))
GEOMETRYCOLLECTION (
    POLYGON ((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),
      (2 2 , 3 3, 4 3, 4 2, 2 2)),
    LINESTRING (1 6, 5 10, 5 11, 4 11, 3 9, 2 8),
    POINT (2 5),
    POINT (5 4)
)</code></pre>
<p>In this representation, coordinates are separated by space, and points by commas. Sets are grouped by parentheses, and separated by commas. Polygons consist of an outer ring followed by zero or more inner rings denoting holes.</p>
<p>Individual points in a geometry contain at least two coordinates: <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, in that order. If these coordinates refer to ellipsoidal coordinates, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> usually refer to longitude and latitude, respectively, although sometimes to latitude and longitude (see <a href="02-Spaces.html#sec-projlib" class="quarto-xref"><span>Section 2.4</span></a> and <a href="07-Introsf.html#sec-axisorder" class="quarto-xref"><span>Section 7.7.6</span></a>).</p>
</section>
<section id="sec-valid" class="level3">
<h3 class="anchored" data-anchor-id="sec-valid">Simple and valid geometries, ring direction</h3>
<p> </p>
<p>Linestrings are called <em>simple</em> when they do not self-intersect:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(ls <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">0</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># LINESTRING (0 0, 1 1, 2 2, 0 2, 1 1, 2 0)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="at">is_simple =</span> <span class="fu">st_is_simple</span>(ls))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># is_simple 
#     FALSE</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> LineString([(<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">0</span>)])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(line.is_simple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># False</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Valid polygons and multi-polygons obey all of the following properties:</p>
<ul>
<li>polygon rings are closed (the last point equals the first)</li>
<li>polygon holes (inner rings) are inside their exterior ring</li>
<li>polygon inner rings maximally touch the exterior ring in single points, not over a line</li>
<li>a polygon ring does not repeat its own path</li>
<li>in a multi-polygon, an external ring maximally touches another exterior ring in single points, not over a line</li>
</ul>
<p>If this is not the case, the geometry concerned is not valid. Invalid geometries typically cause errors when they are processed, but they can usually be repaired to make them valid.</p>
<p>A further convention is that the outer ring of a polygon is winded counter-clockwise, while the holes are winded clockwise, but polygons for which this is not the case are still considered valid. For polygons on the sphere, the “clockwise” concept is not very useful: if for instance we take the equator as polygon, is the Northern Hemisphere or the Southern Hemisphere “inside”? The convention taken here is to consider the area on the left while traversing the polygon is considered the polygon’s inside (see also <a href="07-Introsf.html#sec-ccw" class="quarto-xref"><span>Section 7.3</span></a>).</p>
</section>
<section id="z-and-m-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="z-and-m-coordinates">Z and M coordinates</h3>
<p> </p>
<p>In addition to X and Y coordinates, single points (vertices) of simple feature geometries may have:</p>
<ul>
<li>a <code>Z</code> coordinate, denoting altitude, and/or</li>
<li>an <code>M</code> value, denoting some “measure”</li>
</ul>
<p>The <code>M</code> attribute shall be a property of the vertex. It sounds attractive to encode a time stamp in it for instance to pack movement data (trajectories) in <code>LINESTRING</code>s. These become however invalid (or “non-simple”) once the trajectory self-intersects, which happens when only <code>X</code> and <code>Y</code> are considered for self-intersections.</p>
<p>Both <code>Z</code> and <code>M</code> are not found often, and software support to do something useful with them is (still) rare. Their WKT representation are fairly easily understood:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># POINT Z (1 3 2)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">dim =</span> <span class="st">"XYM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># POINT M (1 3 2)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># LINESTRING ZM (3 1 2 4, 4 4 2 2)</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> Point(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(point)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># POINT Z (1 3 2)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="empty-geometries" class="level3">
<h3 class="anchored" data-anchor-id="empty-geometries">Empty geometries</h3>
<p> </p>
<p>A very important concept in the feature geometry framework is that of the empty geometry. Empty geometries arise naturally when we do geometrical operations (<a href="#sec-opgeom" class="quarto-xref"><span>Section 3.2</span></a>), for instance when we want to know the intersection of <code>POINT (0 0)</code> and <code>POINT (1 1)</code>:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>(e <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)), <span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># GEOMETRYCOLLECTION EMPTY</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>point1 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>point2 <span class="op">=</span> Point(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>intersection <span class="op">=</span> point1.intersection(point2)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(intersection)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># POINT EMPTY</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</div>
<p>and it represents essentially the empty set: when combining (unioning) an empty point with other non-empty geometries, it vanishes.</p>
<p>All geometry types have a special value representing the empty (typed) geometry, like</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># POINT EMPTY</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_linestring</span>(<span class="fu">matrix</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>)[<span class="dv">0</span>,], <span class="at">dim =</span> <span class="st">"XYM"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code># LINESTRING M EMPTY</code></pre>
</div>
</div>
<p>and so on, but they all point to the empty set, differing only in their dimension (<a href="#sec-de9im" class="quarto-xref"><span>Section 3.2.2</span></a>).</p>
</section>
<section id="ten-further-geometry-types" class="level3">
<h3 class="anchored" data-anchor-id="ten-further-geometry-types">Ten further geometry types</h3>
<p>There are 10 more geometry types which are more rare, but increasingly find implementation:</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>CIRCULARSTRING</code></td>
<td>The CircularString is the basic curve type, similar to a LineString in the linear world. A single segment requires three points, the start and end points (first and third) and any other point on the arc. The exception to this is for a closed circle, where the start and end points are the same. In this case the second point MUST be the centre of the arc, i.e., the opposite side of the circle. To chain arcs together, the last point of the previous arc becomes the first point of the next arc, just like in LineString. This means that a valid circular string must have an odd number of points greater than 1.</td>
</tr>
<tr class="even">
<td><code>COMPOUNDCURVE</code></td>
<td>A CompoundCurve is a single, continuous curve that has both curved (circular) segments and linear segments. That means that in addition to having well-formed components, the end point of every component (except the last) must be coincident with the start point of the following component.</td>
</tr>
<tr class="odd">
<td><code>CURVEPOLYGON</code></td>
<td>Example compound curve in a curve polygon: <code>CURVEPOLYGON( COMPOUNDCURVE( CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1))</code></td>
</tr>
<tr class="even">
<td><code>MULTICURVE</code></td>
<td>A MultiCurve is a 1 dimensional GeometryCollection whose elements are Curves. It can include linear strings, circular strings, or compound strings.</td>
</tr>
<tr class="odd">
<td><code>MULTISURFACE</code></td>
<td>A MultiSurface is a 2 dimensional GeometryCollection whose elements are Surfaces, all using coordinates from the same coordinate reference system.</td>
</tr>
<tr class="even">
<td><code>CURVE</code></td>
<td>A Curve is a 1 dimensional geometric object usually stored as a sequence of Points, with the subtype of Curve specifying the form of the interpolation between Points.</td>
</tr>
<tr class="odd">
<td><code>SURFACE</code></td>
<td>A Surface is a 2 dimensional geometric object.</td>
</tr>
<tr class="even">
<td><code>POLYHEDRALSURFACE</code></td>
<td>A PolyhedralSurface is a contiguous collection of polygons, which share common boundary segments.</td>
</tr>
<tr class="odd">
<td><code>TIN</code></td>
<td>A TIN (triangulated irregular network) is a PolyhedralSurface consisting only of Triangle patches.</td>
</tr>
<tr class="even">
<td><code>TRIANGLE</code></td>
<td>A Triangle is a polygon with three distinct, non-collinear vertices and no interior boundary.</td>
</tr>
</tbody>
</table>
<p><code>CIRCULARSTRING</code>, <code>COMPOUNDCURVE</code> and <code>CURVEPOLYGON</code> are not described in the SFA standard, but in the <a href="https://www.iso.org/standard/38651.html">SQL-MM part 3 standard</a>. The descriptions above were copied from the <a href="http://postgis.net/docs/using_postgis_dbmanagement.html">PostGIS manual</a>.</p>
<p> </p>
</section>
<section id="text-and-binary-encodings" class="level3">
<h3 class="anchored" data-anchor-id="text-and-binary-encodings">Text and binary encodings</h3>
<p> </p>
<p>Part of the simple feature standard are two encodings: a text and a binary encoding. The well-known text encoding, used above, is human-readable. The well-known binary encoding is machine-readable. Well-known binary (WKB) encodings are lossless and typically faster to work with than text encoding (and decoding), and they are used for instance in all communications between R package <strong>sf</strong> and the GDAL, GEOS, liblwgeom, and s2geometry libraries (<a href="01-hello.html#fig-gdal-fig-nodetails" class="quarto-xref">Figure&nbsp;<span>1.7</span></a>).</p>
</section>
</section>
<section id="sec-opgeom" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-opgeom"><span class="header-section-number">3.2</span> Operations on geometries</h2>
<p></p>
<p>Simple feature geometries can be queried for properties, or transformed or combined into new geometries, and combinations of geometries can be queried for further properties. This section gives an overview of the operations entirely focusing on <em>geometrical</em> properties. <a href="05-Attributes.html" class="quarto-xref"><span>Chapter 5</span></a> focuses on the analysis of non-geometrical feature properties, in relationship to their geometries. Some of the material in this section appeared in <span class="citation" data-cites="rjsf">Pebesma (<a href="references.html#ref-rjsf" role="doc-biblioref">2018</a>)</span>.</p>
<p>We can categorise operations on geometries in terms of what they take as input, and what they return as output. In terms of output we have operations that return:</p>
<ul>
<li><strong>predicates</strong>: a logical asserting a certain property is <code>TRUE</code></li>
<li><strong>measures</strong>: a quantity (a numeric value, possibly with measurement unit)</li>
<li><strong>transformations</strong>: newly generated geometries</li>
</ul>
<p>and in terms of what they operate on, we distinguish operations that are:</p>
<ul>
<li><strong>unary</strong> when they work on a single geometry</li>
<li><strong>binary</strong> when they work on pairs of geometries</li>
<li><strong>n-ary</strong> when they work on sets of geometries</li>
</ul>
<section id="unary-predicates" class="level3">
<h3 class="anchored" data-anchor-id="unary-predicates">Unary predicates</h3>
<p> </p>
<p>Unary predicates describe a certain property of a geometry. The predicates <code>is_simple</code>, <code>is_valid</code>, and <code>is_empty</code> return respectively whether a geometry is simple, valid, or empty. Given a coordinate reference system, <code>is_longlat</code> returns whether the coordinates are geographic or projected. <code>is(geometry, class)</code> checks whether a geometry belongs to a particular class.</p>
<p> </p>
</section>
<section id="sec-de9im" class="level3">
<h3 class="anchored" data-anchor-id="sec-de9im">Binary predicates and DE-9IM</h3>
<p> </p>
<p>The Dimensionally Extended Nine-Intersection Model <span class="citation" data-cites="de9im1 de9im2">(DE-9IM, <a href="references.html#ref-de9im1" role="doc-biblioref">Clementini, Di Felice, and Oosterom 1993</a>; <a href="references.html#ref-de9im2" role="doc-biblioref">Egenhofer and Franzosa 1991</a>)</span> is a model that describes the qualitative relation between any two geometries in two-dimensional space (<span class="math inline">\(R^2\)</span>). Any geometry has a <em>dimension</em> value that is:</p>
<ul>
<li>0 for points,</li>
<li>1 for linear geometries,</li>
<li>2 for polygonal geometries, and</li>
<li>F (false) for empty geometries</li>
</ul>
<p>Any geometry also has an inside (I), a boundary (B), and an exterior (E); these roles are obvious for polygons, however, for:</p>
<ul>
<li><strong>lines</strong> the boundary is formed by the end points, and the interior by all non-end points on the line</li>
<li><strong>points</strong> have a zero-dimensional inside but no boundary</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>polygon <span class="ot">&lt;-</span> po <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="sc">-</span><span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">2</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>))))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>line <span class="ot">&lt;-</span> li <span class="ot">&lt;-</span> <span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(.<span class="dv">5</span>, <span class="sc">-</span>.<span class="dv">5</span>), <span class="fu">c</span>(.<span class="dv">5</span>, <span class="fl">0.5</span>)))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(po, li)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># "1020F1102"</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 1: 1</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"I(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"I(line) = 1"</span>)))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">0</span>), <span class="fu">c</span>(.<span class="dv">5</span>,.<span class="dv">495</span>)), <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2: 0</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"I(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"B(line) = 0"</span>)))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 3: 2</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"I(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"E(line) = 2"</span>)))</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(po, <span class="at">col =</span> <span class="st">'#ff8888'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 4: 0</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"B(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"I(line) = 0"</span>)))</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(.<span class="dv">5</span>, <span class="dv">0</span>, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 5: F</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"B(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"B(line) = F"</span>)))</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 6: 1</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"B(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"E(line) = 1"</span>)))</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(po, <span class="at">border =</span> <span class="st">'red'</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 7: 1</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"E(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"I(line) = 1"</span>)))</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(.<span class="dv">5</span>, <span class="sc">-</span>.<span class="dv">5</span>), <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">0</span>)), <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 8: 0</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"E(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"B(line) = 0"</span>)))</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(.<span class="dv">5</span>, <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 9: 2</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">main =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"E(pol)"</span>,<span class="fu">intersect</span>(),<span class="st">"E(line) = 2"</span>)))</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p0 <span class="sc">/</span> po, <span class="at">col =</span> <span class="st">'#ff8888'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s, <span class="at">col =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="st">'darkgreen'</span>), <span class="at">border =</span> <span class="st">'blue'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-de9im" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-de9im-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-Geometries_files/figure-html/fig-de9im-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-de9im-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: DE-9IM: intersections between the interior, boundary, and exterior of a polygon (rows) and of a linestring (columns) indicated by red
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-de9im" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> shows the intersections between the I, B, and E components of a polygon and a linestring indicated by red; the sub-plot title gives the dimension of these intersections (0, 1, 2 or F). The relationship between the polygon and the line geometry is the concatenation of these dimensions:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_relate</span>(polygon, line)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>#      [,1]       
# [1,] "1020F1102"</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon, LineString</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>polygon <span class="op">=</span> Polygon([(<span class="dv">0</span>,<span class="dv">0</span>), (<span class="dv">1</span>,<span class="dv">0</span>), (<span class="dv">1</span>,<span class="dv">1</span>), (<span class="dv">0</span>,<span class="dv">1</span>), (<span class="dv">0</span>,<span class="dv">0</span>)])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> LineString([(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>), (<span class="fl">0.5</span>, <span class="fl">0.5</span>)])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the spatial relationship between the polygon and line string</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>relation <span class="op">=</span> polygon.relate(line)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(relation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># 1020F1102</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>where the first three characters are associated with the inside of the <em>first</em> geometry (polygon): <a href="#fig-de9im" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> is summarised row-wise. Using this ability to express relationships, we can also query pairs of geometries about particular conditions expressed in a <em>mask string</em>. As an example, the string <code>"*0*******"</code> would evaluate <code>TRUE</code> when the second geometry has one or more boundary <em>points</em> in common with the interior of the first geometry; the symbol <code>*</code> standing for “any dimensionality” (0, 1, 2 or F). The mask string <code>"T********"</code> matches pairs of geometry with intersecting interiors, where the symbol <code>T</code> stands for any non-empty intersection of dimensionality 0, 1, or 2.</p>
<p>Binary predicates are further described using normal-language verbs, using DE-9IM definitions. For instance, the predicate <code>equals</code> corresponds to the relationship <code>"T*F**FFF*"</code>. If any two geometries obey this relationship, they are (topologically) equal, but may have a different ordering of nodes.</p>
<p>A list of binary predicates is:</p>
<table class="table">
<colgroup>
<col style="width: 27%">
<col style="width: 58%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>predicate</th>
<th>meaning</th>
<th>inverse of</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>contains</code></td>
<td>None of the points of A are outside B</td>
<td><code>within</code></td>
</tr>
<tr class="even">
<td><code>contains_properly</code></td>
<td>A contains B and B has no points in common with the boundary of A</td>
<td></td>
</tr>
<tr class="odd">
<td><code>covers</code></td>
<td>No points of B lie in the exterior of A</td>
<td><code>covered_by</code></td>
</tr>
<tr class="even">
<td><code>covered_by</code></td>
<td>Inverse of <code>covers</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code>crosses</code></td>
<td>A and B have some but not all interior points in common</td>
<td></td>
</tr>
<tr class="even">
<td><code>disjoint</code></td>
<td>A and B have no points in common</td>
<td><code>intersects</code></td>
</tr>
<tr class="odd">
<td><code>equals</code></td>
<td>A and B are topologically equal: node order or number of nodes may differ; identical to A contains B and A within B</td>
<td></td>
</tr>
<tr class="even">
<td><code>equals_exact</code></td>
<td>A and B are geometrically equal, and have identical node order</td>
<td></td>
</tr>
<tr class="odd">
<td><code>intersects</code></td>
<td>A and B are not disjoint</td>
<td><code>disjoint</code></td>
</tr>
<tr class="even">
<td><code>is_within_distance</code></td>
<td>A is closer to B than a given distance</td>
<td></td>
</tr>
<tr class="odd">
<td><code>within</code></td>
<td>None of the points of B are outside A</td>
<td><code>contains</code></td>
</tr>
<tr class="even">
<td><code>touches</code></td>
<td>A and B have at least one boundary point in common, but no interior points</td>
<td></td>
</tr>
<tr class="odd">
<td><code>overlaps</code></td>
<td>A and B have some points in common; the dimension of these is identical to that of A and B</td>
<td></td>
</tr>
<tr class="even">
<td><code>relate</code></td>
<td>Given a mask pattern, return whether A and B adhere to this pattern</td>
<td></td>
</tr>
</tbody>
</table>
<p> </p>
<p>The <a href="https://en.wikipedia.org/wiki/DE-9IM">Wikipedia DE-9IM page</a> provides the <code>relate</code> patterns for each of these verbs. They are important to check out; for instance <em>covers</em> and <em>contains</em> (and their inverses) are often not completely intuitive:</p>
<ul>
<li>if A <em>contains</em> B, B has no points in common with the exterior <em>or boundary</em> of A</li>
<li>if A <em>covers</em> B, B has no points in common with the exterior of A</li>
</ul>
</section>
<section id="unary-measures" class="level3">
<h3 class="anchored" data-anchor-id="unary-measures">Unary measures</h3>
<p></p>
<p>Unary measures return a measure or quantity that describes a property of the geometry:</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 74%">
</colgroup>
<thead>
<tr class="header">
<th>measure</th>
<th>returns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>dimension</code></td>
<td>0 for points, 1 for linear, 2 for polygons, possibly <code>NA</code> for empty geometries</td>
</tr>
<tr class="even">
<td><code>area</code></td>
<td>the area of a geometry</td>
</tr>
<tr class="odd">
<td><code>length</code></td>
<td>the length of a linear geometry</td>
</tr>
</tbody>
</table>
<p> </p>
</section>
<section id="binary-measures" class="level3">
<h3 class="anchored" data-anchor-id="binary-measures">Binary measures</h3>
<p></p>
<p><code>distance</code> returns the distance between pairs of geometries. The qualitative measure <code>relate</code> (without mask) gives the relation pattern. A description of the geometrical relationship between two geometries is given in <a href="#sec-de9im" class="quarto-xref"><span>Section 3.2.2</span></a>.</p>
<p> </p>
</section>
<section id="unary-transformers" class="level3">
<h3 class="anchored" data-anchor-id="unary-transformers">Unary transformers</h3>
<p></p>
<p>Unary transformations work on a per-geometry basis, and return for each geometry a new geometry.</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>transformer</th>
<th>returns a geometry …</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>centroid</code></td>
<td>of type <code>POINT</code> with the geometry’s centroid</td>
</tr>
<tr class="even">
<td><code>buffer</code></td>
<td>that is larger (or smaller) than the input geometry, depending on the buffer size</td>
</tr>
<tr class="odd">
<td><code>jitter</code></td>
<td>that was moved in space a certain amount, using a bivariate uniform distribution</td>
</tr>
<tr class="even">
<td><code>wrap_dateline</code></td>
<td>cut into pieces that no longer cover or cross the dateline</td>
</tr>
<tr class="odd">
<td><code>boundary</code></td>
<td>with the boundary of the input geometry</td>
</tr>
<tr class="even">
<td><code>convex_hull</code></td>
<td>that forms the convex hull of the input geometry (<a href="#fig-vor" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>)</td>
</tr>
<tr class="odd">
<td><code>line_merge</code></td>
<td>after merging connecting <code>LINESTRING</code> elements of a <code>MULTILINESTRING</code> into longer <code>LINESTRING</code>s.</td>
</tr>
<tr class="even">
<td><code>make_valid</code></td>
<td>that is valid</td>
</tr>
<tr class="odd">
<td><code>node</code></td>
<td>with added nodes to linear geometries at intersections without a node; only works on individual linear geometries</td>
</tr>
<tr class="even">
<td><code>point_on_surface</code></td>
<td>with a (arbitrary) point on a surface</td>
</tr>
<tr class="odd">
<td><code>polygonize</code></td>
<td>of type polygon, created from lines that form a closed ring</td>
</tr>
<tr class="even">
<td><code>segmentize</code></td>
<td>a (linear) geometry with nodes at a given density or minimal distance</td>
</tr>
<tr class="odd">
<td><code>simplify</code></td>
<td>simplified by removing vertices/nodes (lines or polygons)</td>
</tr>
<tr class="even">
<td><code>split</code></td>
<td>that has been split with a splitting linestring</td>
</tr>
<tr class="odd">
<td><code>transform</code></td>
<td>transformed or convert to a new coordinate reference system (<a href="02-Spaces.html" class="quarto-xref"><span>Chapter 2</span></a>)</td>
</tr>
<tr class="even">
<td><code>triangulate</code></td>
<td>with Delauney triangulated polygon(s) (<a href="#fig-vor" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>)</td>
</tr>
<tr class="odd">
<td><code>voronoi</code></td>
<td>with the Voronoi tessellation of an input geometry (<a href="#fig-vor" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>)</td>
</tr>
<tr class="even">
<td><code>zm</code></td>
<td>with removed or added <code>Z</code> and/or <code>M</code> coordinates</td>
</tr>
<tr class="odd">
<td><code>collection_extract</code></td>
<td>with sub-geometries from a <code>GEOMETRYCOLLECTION</code> of a particular type</td>
</tr>
<tr class="even">
<td><code>cast</code></td>
<td>that is converted to another type</td>
</tr>
<tr class="odd">
<td><code>+</code></td>
<td>that is shifted over a given vector</td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td>that is multiplied by a scalar or matrix</td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">133331</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>mp <span class="ot">&lt;-</span> <span class="fu">st_multipoint</span>(<span class="fu">matrix</span>(<span class="fu">runif</span>(<span class="dv">20</span>), <span class="dv">10</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mp, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_convex_hull</span>(mp), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">'red'</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mp, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_voronoi</span>(mp), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">'red'</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mp, <span class="at">cex =</span> <span class="dv">2</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_triangulate</span>(mp), <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">'darkgreen'</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-vor" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-vor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-Geometries_files/figure-html/fig-vor-1.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: For a set of points, left: convex hull (red); middle: Voronoi polygons; right: Delauney triangulation
</figcaption>
</figure>
</div>
</div>
</div>
<p> </p>
</section>
<section id="sec-bintrans" class="level3">
<h3 class="anchored" data-anchor-id="sec-bintrans">Binary transformers</h3>
<p></p>
<p>Binary transformers are functions that return a geometry based on operating on a pair of geometries. They include:</p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 64%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th>function</th>
<th>returns</th>
<th style="text-align: center;">infix operator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>intersection</code></td>
<td>the overlapping geometries for pair of geometries</td>
<td style="text-align: center;"><code>&amp;</code></td>
</tr>
<tr class="even">
<td><code>union</code></td>
<td>the combination of the geometries; removes internal boundaries and duplicate points, nodes or line pieces</td>
<td style="text-align: center;"><code>|</code></td>
</tr>
<tr class="odd">
<td><code>difference</code></td>
<td>the geometries of the first after removing the overlap with the second geometry</td>
<td style="text-align: center;"><code>/</code></td>
</tr>
<tr class="even">
<td><code>sym_difference</code></td>
<td>the combinations of the geometries after removing where they intersect; the negation (opposite) of <code>intersection</code></td>
<td style="text-align: center;"><code>%/%</code></td>
</tr>
</tbody>
</table>
<p> </p>
</section>
<section id="sec-nary" class="level3">
<h3 class="anchored" data-anchor-id="sec-nary">N-ary transformers</h3>
<p></p>
<p>N-ary transformers operate on sets of geometries. <code>union</code> can be applied to a set of geometries to return its geometrical union. Otherwise, any set of geometries can be combined into a <code>MULTI</code>-type geometry when they have equal dimension, or else into a <code>GEOMETRYCOLLECTION</code>. Without unioning, this may lead to a geometry that is not valid, for instance when two polygon rings have a boundary line in common.</p>
<p> </p>
<p>N-ary <code>intersection</code> and <code>difference</code> take a single argument but operate (sequentially) on all pairs, triples, quadruples, etc. Consider the plot in <a href="#fig-boxes" class="quarto-xref">Figure&nbsp;<span>3.4</span></a>: how do we identify the area where all three boxes overlap? Using binary intersections gives us intersections for all pairs: 1-1, 1-2, 1-3, 2-1, 2-2, 2-3, 3-1, 3-2, 3-3, but that does not let us identify areas where more than two geometries intersect. <a href="#fig-boxes" class="quarto-xref">Figure&nbsp;<span>3.4</span></a> (right) shows the n-ary intersection: the seven unique, non-overlapping geometries originating from intersection of one, two, <em>or more</em> geometries.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(.<span class="dv">1</span>, <span class="dv">4</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>sq <span class="ot">&lt;-</span> <span class="cf">function</span>(pt, <span class="at">sz =</span> <span class="dv">1</span>) <span class="fu">st_polygon</span>(<span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(pt <span class="sc">-</span> sz), </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(pt[<span class="dv">1</span>] <span class="sc">+</span> sz, pt[<span class="dv">2</span>] <span class="sc">-</span> sz), <span class="fu">c</span>(pt <span class="sc">+</span> sz), <span class="fu">c</span>(pt[<span class="dv">1</span>] <span class="sc">-</span> sz, pt[<span class="dv">2</span>] <span class="sc">+</span> sz), <span class="fu">c</span>(pt <span class="sc">-</span> sz))))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">box =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">st_sfc</span>(<span class="fu">sq</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)), <span class="fu">sq</span>(<span class="fu">c</span>(<span class="fl">1.7</span>, <span class="sc">-</span><span class="fl">0.5</span>)), <span class="fu">sq</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>))))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(x), <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="fu">sf.colors</span>(<span class="dv">3</span>, <span class="at">categorical =</span> <span class="cn">TRUE</span>), <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_intersection</span>(<span class="fu">st_geometry</span>(x)), <span class="at">col =</span> <span class="fu">sf.colors</span>(<span class="dv">7</span>, <span class="at">categorical=</span><span class="cn">TRUE</span>, <span class="at">alpha =</span> .<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-boxes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-Geometries_files/figure-html/fig-boxes-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: Left: three overlapping squares – how do we identify the small box where all three overlap? Right: unique, non-overlapping n-ary intersections
</figcaption>
</figure>
</div>
</div>
</div>
<p>Similarly, one can compute an n-ary <em>difference</em> from a set <span class="math inline">\(\{s_1, s_2,
s_3, ...\}\)</span> by creating differences <span class="math inline">\(\{s_1, s_2-s_1, s_3-s_2-s_1,
...\}\)</span>. This is shown in <a href="#fig-diff" class="quarto-xref">Figure&nbsp;<span>3.5</span></a>, (left) for the original set, and (right) for the set after reversing its order to make clear that the result here depends on the ordering of the input geometries. Again, resulting geometries do not overlap.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(.<span class="dv">1</span>, <span class="dv">4</span>), <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>xg <span class="ot">&lt;-</span> <span class="fu">st_geometry</span>(x)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_difference</span>(xg), <span class="at">col =</span> <span class="fu">sf.colors</span>(<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">categorical=</span><span class="cn">TRUE</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_difference</span>(xg[<span class="dv">3</span><span class="sc">:</span><span class="dv">1</span>]), <span class="at">col =</span> <span class="fu">sf.colors</span>(<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">categorical=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-diff" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-Geometries_files/figure-html/fig-diff-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Difference between subsequent boxes, left: in original order; right: in reverse order
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-precision" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-precision"><span class="header-section-number">3.3</span> Precision</h2>
<p> </p>
<p>Geometrical operations, such as finding out whether a certain point is on a line, may fail when coordinates are represented by double precision floating point numbers, such as 8-byte doubles used in R. An often chosen remedy is to limit the precision of the coordinates before the operation. For this, a <em>precision model</em> is adopted; the most common is to choose a factor <span class="math inline">\(p\)</span> and compute rounded coordinates <span class="math inline">\(c'\)</span> from original coordinates <span class="math inline">\(c\)</span> by <span class="math display">\[c' = \mbox{round}(p \cdot c) / p\]</span></p>
<p>Rounding of this kind brings the coordinates to points on a regular grid with spacing <span class="math inline">\(1/p\)</span>, which is beneficial for geometric computations. Of course, it also affects all computations like areas and distances, and may turn valid geometries into invalid ones. Which precision values are best for which application is often a matter of common sense combined with trial and error.</p>
</section>
<section id="sec-coverages" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-coverages"><span class="header-section-number">3.4</span> Coverages: tessellations and rasters</h2>
<p></p>
<p>The Open Geospatial Consortium defines a <em>coverage</em> as a “feature that acts as a function to return values from its range for any direct position within its spatiotemporal domain” <span class="citation" data-cites="ogccov">(<a href="references.html#ref-ogccov" role="doc-biblioref">Baumann, Hirschorn, and Masó 2017</a>)</span>. Having a <em>function</em> implies that for every space time “point”, every combination of a spatial point and a moment in time of the spatiotemporal domain, we have a <em>single</em> value for the range. This is a very common situation for spatiotemporal phenomena, a few examples can be given:</p>
<ul>
<li>boundary disputes aside, at a give time every point in a region (domain) belongs to a single administrative unit (range)</li>
<li>at any given moment in time, every point in a region (domain) has a certain <em>land cover type</em> (range)</li>
<li>every point in an area (domain) has a single surface elevation (range), which could be measured with respect to a given mean sea level surface</li>
<li>every spatiotemporal point in a three-dimensional body of air (domain) has single value for temperature (range)</li>
</ul>
<p>A caveat here is that because observation or measurement always takes time and requires space, measured values are always an average over a spatiotemporal volume, and hence range variables can rarely be measured for true, zero-volume “points”; for many practical cases however the measured volume is small enough to be considered a “point”. For a variable like <em>land cover type</em> the volume needs to be chosen such that the types distinguished make sense with respect to the measured areal units.</p>
<p>In the first two of the given examples the range variable is <em>categorical</em>, in the last two the range variable is <em>continuous</em>. For categorical range variables, if large connected areas have a constant range value, an efficient way to represent these data is by storing the boundaries of the areas with constant value, such as country boundaries. Although this can be done (and is often done) by a set of simple feature geometries (polygons or multi-polygons), this brings along some challenges:</p>
<ul>
<li>it is hard to guarantee for such a set of simple feature polygons that they do not overlap, or that there are no unwanted gaps between them</li>
<li>simple features have no way of assigning points <em>on</em> the boundary of two adjacent polygons uniquely to a single polygon, which conflicts with the interpretation as coverage</li>
</ul>
<section id="topological-models" class="level3">
<h3 class="anchored" data-anchor-id="topological-models">Topological models</h3>
<p></p>
<p>A data model that guarantees no inadvertent gaps or overlaps of polygonal coverages is the <em>topological</em> model, examples of which are found in geographic information systems (GIS) like GRASS GIS or ArcGIS. Topological models store boundaries between polygons only once and register which polygonal area is on either side of a boundary.</p>
<p>Deriving the set of (multi)polygons for each area with a constant range value from a topological model is straightforward; the other way around, reconstructing topology from a set of polygons typically involves setting thresholds on errors and handling gaps or overlaps.</p>
</section>
<section id="raster-tessellations" class="level3">
<h3 class="anchored" data-anchor-id="raster-tessellations">Raster tessellations</h3>
<p> </p>
<p>A tessellation is a sub-division of a space (area, volume) into smaller elements by ways of polygons. A regular tessellation does this with regular polygons: triangles, squares, or hexagons. Tessellations using squares are commonly used for spatial data and are called <em>raster data</em>. Raster data tessellate each spatial dimension <span class="math inline">\(d\)</span> into regular cells, formed by left-closed and right-open intervals <span class="math inline">\(d_i\)</span>: <span class="math display">\[\begin{equation}
d_i = d_0 + [i \times \delta, (i+1) \times \delta)
\end{equation}\]</span> with <span class="math inline">\(d_0\)</span> an offset, <span class="math inline">\(\delta\)</span> the interval (cell or pixel) size, and where the cell index <span class="math inline">\(i\)</span> is an arbitrary but consecutive set of integers. The <span class="math inline">\(\delta\)</span> value is often taken negative for the <span class="math inline">\(y\)</span>-axis (Northing), indicating that raster row numbers increasing Southwards correspond to <span class="math inline">\(y\)</span>-coordinates increasing Northwards.</p>
<p>Whereas in arbitrary polygon tessellations the assignment of points to polygons is ambiguous for points falling on a boundary shared by two polygons, using left-closed “[” and right-open “)” intervals in regular tessellations removes this ambiguity. This means that for rasters with negative <span class="math inline">\(\delta\)</span> values for the <span class="math inline">\(y\)</span>-coordinate and positive for the <span class="math inline">\(x\)</span>-coordinate, only the top-left corner point is part of each raster cell. An artifact resulting from this is shown in <a href="#fig-rasterizeline" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars) <span class="sc">|&gt;</span> <span class="fu">suppressPackageStartupMessages</span>()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">4</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>ls <span class="ot">&lt;-</span> <span class="fu">st_sf</span>(<span class="at">a =</span> <span class="dv">2</span>, <span class="fu">st_sfc</span>(<span class="fu">st_linestring</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fl">0.1</span>, <span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">9</span>)))))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>grd <span class="ot">&lt;-</span> <span class="fu">st_as_stars</span>(<span class="fu">st_bbox</span>(ls), <span class="at">nx =</span> <span class="dv">10</span>, <span class="at">ny =</span> <span class="dv">10</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.0</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">values =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">st_rasterize</span>(ls, grd, <span class="at">options =</span> <span class="st">"ALL_TOUCHED=TRUE"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>r[r <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(<span class="fu">st_as_sf</span>(grd)), <span class="at">border =</span> <span class="st">'orange'</span>, <span class="at">col =</span> <span class="cn">NA</span>, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">reset =</span> <span class="cn">FALSE</span>, <span class="at">key.pos =</span> <span class="cn">NULL</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="st">"equal"</span>, <span class="at">main =</span> <span class="cn">NA</span>) <span class="co"># ALL_TOUCHED=FALSE;</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ls, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-rasterizeline" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-rasterizeline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="03-Geometries_files/figure-html/fig-rasterizeline-1.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-rasterizeline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: Rasterization artifact: as only top-left corners are part of the raster cell, only cells touching the red line below the diagonal line are rasterized
</figcaption>
</figure>
</div>
</div>
</div>
<p></p>
<p>Tessellating the time dimension with left-closed right-open intervals is very common, and it reflects the implicit assumption underlying time series software such as the <strong>xts</strong> package in R, where time stamps indicate the start of time intervals. Different models can be combined: one could use simple feature polygons to tessellate space and combine this with a regular tessellation of time in order to cover a space time <em>vector data cube</em>. Raster and vector data cubes are discussed in <a href="06-Cubes.html" class="quarto-xref"><span>Chapter 6</span></a>.</p>
<p>As mentioned above, besides square cells the other two shapes that can lead to regular tessellations of <span class="math inline">\(R^2\)</span> are triangles and hexagons. On the sphere, there are a few more, including cube, octahedron, icosahedron, and dodecahedron. A spatial index that builds on the cube is <a href="https://s2geometry.io/">s2geometry</a>, the <a href="https://eng.uber.com/h3/">H3 library</a> uses the icosahedron and densifies that with (mostly) hexagons. Mosaics that cover the entire Earth are also called <em>discrete global grids</em>.</p>
</section>
</section>
<section id="networks" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="networks"><span class="header-section-number">3.5</span> Networks</h2>
<p></p>
<p>Spatial networks are typically composed of linear (<code>LINESTRING</code>) elements, but possess further topological properties describing the network coherence:</p>
<ul>
<li>start- and end-points of a linestring may be connected to other linestring start or end points, forming a set of nodes and edges</li>
<li>edges may be directed, to only allow for connection (flow, transport) in one way</li>
</ul>
<p>R packages including <strong>osmar</strong> <span class="citation" data-cites="R-osmar">(<a href="references.html#ref-R-osmar" role="doc-biblioref">Schlesinger and Eugster 2013</a>)</span>, <strong>stplanr</strong> <span class="citation" data-cites="R-stplanr">(<a href="references.html#ref-R-stplanr" role="doc-biblioref">Lovelace, Ellison, and Morgan 2022</a>)</span>, and <strong>sfnetworks</strong> <span class="citation" data-cites="R-sfnetworks">(<a href="references.html#ref-R-sfnetworks" role="doc-biblioref">van der Meer et al. 2022</a>)</span> provide functionality for constructing network objects, and working with them, including computation of shortest or fastest routes through a network. Package <strong>spatstat</strong> <span class="citation" data-cites="R-spatstat baddeley2015spatial">(<a href="references.html#ref-R-spatstat" role="doc-biblioref">Baddeley, Turner, and Rubak 2022</a>; <a href="references.html#ref-baddeley2015spatial" role="doc-biblioref">Baddeley, Rubak, and Turner 2015</a>)</span> has infrastructure for analysing point patterns on linear networks (<a href="11-PointPattern.html" class="quarto-xref"><span>Chapter 11</span></a>). Chapter 12 of <span class="citation" data-cites="geocomp">Lovelace, Nowosad, and Muenchow (<a href="references.html#ref-geocomp" role="doc-biblioref">2019</a>)</span> has a transportation application using networks.</p>
</section>
<section id="exercises" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.6</span> Exercises</h2>
<p>For the following exercises, use R where possible.</p>
<ol type="1">
<li>Give two examples of geometries in 2-D (flat) space that cannot be represented as simple feature geometries, and create a plot of them.</li>
<li>Recompute the coordinates 10.542, 0.01, 45321.6789 using precision values 1, 1e3, 1e6, and 1e-2.</li>
<li>Describe a practical problem for which an n-ary intersection would be needed.</li>
<li>How can you create a Voronoi diagram (<a href="#fig-vor" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>) that has one closed polygons for every single point?</li>
<li>Give the unary measure <code>dimension</code> for geometries <code>POINT Z (0 1 1)</code>, <code>LINESTRING Z (0 0 1,1 1 2)</code>, and <code>POLYGON Z ((0 0 0,1 0 0,1 1 0,0 0 0))</code></li>
<li>Give the DE-9IM relation between <code>LINESTRING(0 0,1 0)</code> and <code>LINESTRING(0.5 0,0.5 1)</code>; explain the individual characters.</li>
<li>Can a set of simple feature polygons form a coverage? If so, under which constraints?</li>
<li>For the <code>nc</code> counties in the dataset that comes with R package <strong>sf</strong>, find the points touched by four counties.</li>
<li>How would <a href="#fig-rasterizeline" class="quarto-xref">Figure&nbsp;<span>3.6</span></a> look like if <span class="math inline">\(\delta\)</span> for the <span class="math inline">\(y\)</span>-coordinate was positive?</li>
</ol>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-baddeley2015spatial" class="csl-entry" role="listitem">
Baddeley, Adrian, Ege Rubak, and Rolf Turner. 2015. <em>Spatial Point Patterns: Methodology and Applications with <span>R</span></em>. Chapman &amp; Hall/CRC.
</div>
<div id="ref-R-spatstat" class="csl-entry" role="listitem">
Baddeley, Adrian, Rolf Turner, and Ege Rubak. 2022. <em>Spatstat: Spatial Point Pattern Analysis, Model-Fitting, Simulation, Tests</em>. <a href="http://spatstat.org/">http://spatstat.org/</a>.
</div>
<div id="ref-ogccov" class="csl-entry" role="listitem">
Baumann, Peter, Eric Hirschorn, and Joan Masó. 2017. <span>“OGC Coverage Implementation Schema.”</span> <em>OGC Implementation Standard</em>. <a href="https://docs.opengeospatial.org/is/09-146r6/09-146r6.html">https://docs.opengeospatial.org/is/09-146r6/09-146r6.html</a>.
</div>
<div id="ref-de9im1" class="csl-entry" role="listitem">
Clementini, Eliseo, Paolino Di Felice, and Peter van Oosterom. 1993. <span>“A Small Set of Formal Topological Relationships Suitable for End-User Interaction.”</span> In <em>Advances in Spatial Databases</em>, edited by David Abel and Beng Chin Ooi, 277–95. Berlin, Heidelberg: Springer Berlin Heidelberg.
</div>
<div id="ref-de9im2" class="csl-entry" role="listitem">
Egenhofer, Max J., and Robert D. Franzosa. 1991. <span>“Point-Set Topological Spatial Relations.”</span> <em>International Journal of Geographical Information Systems</em> 5 (2): 161–74. <a href="https://doi.org/10.1080/02693799108927841">https://doi.org/10.1080/02693799108927841</a>.
</div>
<div id="ref-sfa2" class="csl-entry" role="listitem">
Herring, J. R. 2010. <span>“OpenGIS Implementation Standard for Geographic Information-Simple Feature Access-Part 2: SQL Option.”</span> <em>Open Geospatial Consortium Inc</em>. <a href="http://portal.opengeospatial.org/files/?artifact_id=25354">http://portal.opengeospatial.org/files/?artifact_id=25354</a>.
</div>
<div id="ref-sfa" class="csl-entry" role="listitem">
———. 2011. <span>“OpenGIS Implementation Standard for Geographic Information-Simple Feature Access-Part 1: Common Architecture.”</span> <em>Open Geospatial Consortium Inc</em>, 111. <a href="http://portal.opengeospatial.org/files/?artifact_id=25355">http://portal.opengeospatial.org/files/?artifact_id=25355</a>.
</div>
<div id="ref-iso" class="csl-entry" role="listitem">
ISO. 2004. <em>Geographic Information – Simple Feature Access – Part 1: Common Architecture</em>.<a href=" https://www.iso.org/standard/40114.html ">https://www.iso.org/standard/40114.html </a>.
</div>
<div id="ref-R-stplanr" class="csl-entry" role="listitem">
Lovelace, Robin, Richard Ellison, and Malcolm Morgan. 2022. <em>Stplanr: Sustainable Transport Planning</em>. <a href="https://CRAN.R-project.org/package=stplanr">https://CRAN.R-project.org/package=stplanr</a>.
</div>
<div id="ref-geocomp" class="csl-entry" role="listitem">
Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2019. <em>Geocomputation with <span>R</span></em>. Chapman &amp; Hall/CRC.<a href=" https://geocompr.robinlovelace.net/ ">https://geocompr.robinlovelace.net/ </a>.
</div>
<div id="ref-rjsf" class="csl-entry" role="listitem">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R: Standardized Support for Spatial Vector Data</span>.”</span> <em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-R-osmar" class="csl-entry" role="listitem">
Schlesinger, Thomas, and Manuel J. A. Eugster. 2013. <em>Osmar: OpenStreetMap and r</em>. <a href="http://osmar.r-forge.r-project.org/">http://osmar.r-forge.r-project.org/</a>.
</div>
<div id="ref-R-sfnetworks" class="csl-entry" role="listitem">
van der Meer, Lucas, Lorena Abad, Andrea Gilardi, and Robin Lovelace. 2022. <em>Sfnetworks: Tidy Geospatial Networks</em>. <a href="https://CRAN.R-project.org/package=sfnetworks">https://CRAN.R-project.org/package=sfnetworks</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-spatial\.org\/python\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02-Spaces.html" class="pagination-link" aria-label="Coordinates">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coordinates</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-Spherical.html" class="pagination-link" aria-label="Spherical Geometries">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spherical Geometries</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb35" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Geometries {#sec-geometries}</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>\index{geometry!simple feature}</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>\index{simple feature!definition}</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>Having learned how we represent coordinates systems, we can define</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>how geometries can be described using these coordinate systems. This</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>chapter will explain:</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>_simple features_, a standard that describes point, line, and polygon </span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>geometries along with operations on them,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>operations on geometries,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>coverages, functions of space or space-time,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>tesselations, sub-divisions of larger regions into sub-regions, and</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>networks.</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>Geometries on the sphere are discussed in @sec-spherical, rasters and</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>other rectangular sub-divisions of space or space time are discussed</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>in @sec-datacube.</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simple feature geometries {#sec-simplefeatures}</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>\index{simple feature geometry}</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>\index{simple feature!geometry}</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>Simple feature geometries are a way to describe the geometries of</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>_features_.  By _features_ we mean _things_ that have a geometry,</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>potentially implicitly some time properties, and further _attributes_ that could</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>include labels describing the thing and/or values quantitatively measuring it.</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>The main application of simple feature geometries is to describe</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>geometries in two-dimensional space by points, lines, or polygons. The</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>"simple" adjective refers to the fact that the line or polygon</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>geometries are represented by sequences of points connected with</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>straight lines that do not self-intersect.</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>_Simple features access_ is a standard <span class="co">[</span><span class="ot">@sfa; @sfa2; @iso</span><span class="co">]</span> for</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>describing simple feature geometries. It includes:</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>\index{simple feature access}</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a class hierarchy</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a set of operations</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>binary and text encodings</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>We will first discuss the seven most common simple feature geometry</span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>types.</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a><span class="fu">### The big seven {#sec-seven}</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>\index{simple feature geometry!types}</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>\index{POINT}</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>\index{MULTIPOINT}</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>\index{LINESTRING}</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>\index{MULTILINESTRING}</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>\index{POLYGON}</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>\index{MULTIPOLYGON}</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>\index{GEOMETRYCOLLECTION}</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>The most common simple feature geometries used to represent a _single_ feature are:</span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>| type                      | description                                                               |</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>|---------------------------|---------------------------------------------------------------------------|</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>| <span class="in">`POINT`</span>                   | single point geometry |</span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>| <span class="in">`MULTIPOINT`</span>              | set of points |</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>| <span class="in">`LINESTRING`</span>              | single linestring (two or more points connected by straight lines) |</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>| <span class="in">`MULTILINESTRING`</span>         | set of linestrings |</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>| <span class="in">`POLYGON`</span>                 | exterior ring with zero or more inner rings, denoting holes |</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>| <span class="in">`MULTIPOLYGON`</span>            | set of polygons |</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>| <span class="in">`GEOMETRYCOLLECTION`</span>      | set of the geometries above  |</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R </span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-sfgeometries, echo=!knitr::is_latex_output(), message = FALSE}</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Sketches of the main simple feature geometry types"</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf) |&gt; suppressPackageStartupMessages()</span></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(2,4))</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(1,1,1.2,1))</span></span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a><span class="in"># 1</span></span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a><span class="in">p &lt;- st_point(0:1)</span></span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a><span class="in">plot(p, pch = 16)</span></span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a><span class="in">title("point")</span></span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a><span class="in"># 2</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a><span class="in">mp &lt;- st_multipoint(rbind(c(1,1), c(2, 2), c(4, 1), c(2, 3), c(1,4)))</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a><span class="in">plot(mp, pch = 16)</span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a><span class="in">title("multipoint")</span></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a><span class="in"># 3</span></span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a><span class="in">ls &lt;- st_linestring(rbind(c(1,1), c(5,5), c(5, 6), c(4, 6), c(3, 4), c(2, 3)))</span></span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a><span class="in">plot(ls, lwd = 2)</span></span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a><span class="in">title("linestring")</span></span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a><span class="in"># 4</span></span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a><span class="in">mls &lt;- st_multilinestring(list(</span></span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(c(1,1), c(5,5), c(5, 6), c(4, 6), c(3, 4), c(2, 3)),</span></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a><span class="in">  rbind(c(3,0), c(4,1), c(2,1))))</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a><span class="in">plot(mls, lwd = 2)</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a><span class="in">title("multilinestring")</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a><span class="in"># 5 polygon</span></span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a><span class="in">po &lt;- st_polygon(list(rbind(c(2,1), c(3,1), c(5,2), c(6,3), c(5,3), c(4,4), c(3,4), c(1,3), c(2,1)),</span></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a><span class="in">    rbind(c(2,2), c(3,3), c(4,3), c(4,2), c(2,2))))</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a><span class="in">plot(po, border = 'black', col = '#ff8888', lwd = 2)</span></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a><span class="in">title("polygon")</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a><span class="in"># 6 multipolygon</span></span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a><span class="in">mpo &lt;- st_multipolygon(list(</span></span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a><span class="in">    list(rbind(c(2,1), c(3,1), c(5,2), c(6,3), c(5,3), c(4,4), c(3,4), c(1,3), c(2,1)),</span></span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a><span class="in">        rbind(c(2,2), c(3,3), c(4,3), c(4,2), c(2,2))),</span></span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a><span class="in">    list(rbind(c(3,7), c(4,7), c(5,8), c(3,9), c(2,8), c(3,7)))))</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a><span class="in">plot(mpo, border = 'black', col = '#ff8888', lwd = 2)</span></span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a><span class="in">title("multipolygon")</span></span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a><span class="in"># 7 geometrycollection</span></span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a><span class="in">gc &lt;- st_geometrycollection(list(po, ls + c(0,5), st_point(c(2,5)), st_point(c(5,4))))</span></span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a><span class="in">plot(gc, border = 'black', col = '#ff6666', pch = 16, lwd = 2)</span></span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a><span class="in">title("geometrycollection")</span></span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a><span class="in">box(col = 'grey')</span></span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Sketches of the main simple feature geometry types"</span></span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Point, MultiPoint, LineString, MultiLineString, Polygon, MultiPolygon</span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a 2x4 grid of plots</span></span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(left<span class="op">=</span><span class="fl">0.1</span>, bottom<span class="op">=</span><span class="fl">0.1</span>, right<span class="op">=</span><span class="fl">0.9</span>, top<span class="op">=</span><span class="fl">0.9</span>, wspace<span class="op">=</span><span class="fl">0.4</span>, hspace<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a><span class="co"># 1</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> gpd.GeoSeries([Point(<span class="dv">0</span>, <span class="dv">1</span>)])</span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">241</span>)</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a>p.plot(ax<span class="op">=</span>ax1, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"point"</span>)</span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a>ax1.set_axis_off()</span>
<span id="cb35-152"><a href="#cb35-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-153"><a href="#cb35-153" aria-hidden="true" tabindex="-1"></a><span class="co"># 2</span></span>
<span id="cb35-154"><a href="#cb35-154" aria-hidden="true" tabindex="-1"></a>mp <span class="op">=</span> gpd.GeoSeries([MultiPoint([(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">3</span>), (<span class="dv">1</span>, <span class="dv">4</span>)])])</span>
<span id="cb35-155"><a href="#cb35-155" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">242</span>)</span>
<span id="cb35-156"><a href="#cb35-156" aria-hidden="true" tabindex="-1"></a>mp.plot(ax<span class="op">=</span>ax2, marker<span class="op">=</span><span class="st">'o'</span>, markersize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb35-157"><a href="#cb35-157" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"multipoint"</span>)</span>
<span id="cb35-158"><a href="#cb35-158" aria-hidden="true" tabindex="-1"></a>ax2.set_axis_off()</span>
<span id="cb35-159"><a href="#cb35-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-160"><a href="#cb35-160" aria-hidden="true" tabindex="-1"></a><span class="co"># 3</span></span>
<span id="cb35-161"><a href="#cb35-161" aria-hidden="true" tabindex="-1"></a>ls <span class="op">=</span> gpd.GeoSeries([LineString([(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">5</span>), (<span class="dv">5</span>, <span class="dv">6</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">2</span>, <span class="dv">3</span>)])])</span>
<span id="cb35-162"><a href="#cb35-162" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> plt.subplot(<span class="dv">243</span>)</span>
<span id="cb35-163"><a href="#cb35-163" aria-hidden="true" tabindex="-1"></a>ls.plot(ax<span class="op">=</span>ax3, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-164"><a href="#cb35-164" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">"linestring"</span>)</span>
<span id="cb35-165"><a href="#cb35-165" aria-hidden="true" tabindex="-1"></a>ax3.set_axis_off()</span>
<span id="cb35-166"><a href="#cb35-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-167"><a href="#cb35-167" aria-hidden="true" tabindex="-1"></a><span class="co"># 4</span></span>
<span id="cb35-168"><a href="#cb35-168" aria-hidden="true" tabindex="-1"></a>mls <span class="op">=</span> gpd.GeoSeries([</span>
<span id="cb35-169"><a href="#cb35-169" aria-hidden="true" tabindex="-1"></a>    MultiLineString([</span>
<span id="cb35-170"><a href="#cb35-170" aria-hidden="true" tabindex="-1"></a>        [(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">5</span>), (<span class="dv">5</span>, <span class="dv">6</span>), (<span class="dv">4</span>, <span class="dv">6</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">2</span>, <span class="dv">3</span>)],</span>
<span id="cb35-171"><a href="#cb35-171" aria-hidden="true" tabindex="-1"></a>        [(<span class="dv">3</span>, <span class="dv">0</span>), (<span class="dv">4</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">1</span>)]</span>
<span id="cb35-172"><a href="#cb35-172" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb35-173"><a href="#cb35-173" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb35-174"><a href="#cb35-174" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> plt.subplot(<span class="dv">244</span>)</span>
<span id="cb35-175"><a href="#cb35-175" aria-hidden="true" tabindex="-1"></a>mls.plot(ax<span class="op">=</span>ax4, color<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-176"><a href="#cb35-176" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">"multilinestring"</span>)</span>
<span id="cb35-177"><a href="#cb35-177" aria-hidden="true" tabindex="-1"></a>ax4.set_axis_off()</span>
<span id="cb35-178"><a href="#cb35-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-179"><a href="#cb35-179" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 polygon</span></span>
<span id="cb35-180"><a href="#cb35-180" aria-hidden="true" tabindex="-1"></a>po <span class="op">=</span> gpd.GeoSeries([</span>
<span id="cb35-181"><a href="#cb35-181" aria-hidden="true" tabindex="-1"></a>    Polygon([(<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">2</span>), (<span class="dv">6</span>, <span class="dv">3</span>), (<span class="dv">5</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">4</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">1</span>, <span class="dv">3</span>), (<span class="dv">2</span>, <span class="dv">1</span>)]),</span>
<span id="cb35-182"><a href="#cb35-182" aria-hidden="true" tabindex="-1"></a>    Polygon([(<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">3</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">2</span>)])</span>
<span id="cb35-183"><a href="#cb35-183" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb35-184"><a href="#cb35-184" aria-hidden="true" tabindex="-1"></a>ax5 <span class="op">=</span> plt.subplot(<span class="dv">245</span>)</span>
<span id="cb35-185"><a href="#cb35-185" aria-hidden="true" tabindex="-1"></a>po.plot(ax<span class="op">=</span>ax5, facecolor<span class="op">=</span><span class="st">'#ff8888'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-186"><a href="#cb35-186" aria-hidden="true" tabindex="-1"></a>ax5.set_title(<span class="st">"polygon"</span>)</span>
<span id="cb35-187"><a href="#cb35-187" aria-hidden="true" tabindex="-1"></a>ax5.set_axis_off()</span>
<span id="cb35-188"><a href="#cb35-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-189"><a href="#cb35-189" aria-hidden="true" tabindex="-1"></a><span class="co"># 6 multipolygon</span></span>
<span id="cb35-190"><a href="#cb35-190" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> Polygon([(<span class="dv">2</span>, <span class="dv">1</span>), (<span class="dv">3</span>, <span class="dv">1</span>), (<span class="dv">5</span>, <span class="dv">2</span>), (<span class="dv">6</span>, <span class="dv">3</span>), (<span class="dv">5</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">4</span>), (<span class="dv">3</span>, <span class="dv">4</span>), (<span class="dv">1</span>, <span class="dv">3</span>), (<span class="dv">2</span>, <span class="dv">1</span>)])</span>
<span id="cb35-191"><a href="#cb35-191" aria-hidden="true" tabindex="-1"></a>p2 <span class="op">=</span> Polygon([(<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">3</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">3</span>), (<span class="dv">4</span>, <span class="dv">2</span>), (<span class="dv">2</span>, <span class="dv">2</span>)])</span>
<span id="cb35-192"><a href="#cb35-192" aria-hidden="true" tabindex="-1"></a>p3 <span class="op">=</span> Polygon([(<span class="dv">3</span>, <span class="dv">7</span>), (<span class="dv">4</span>, <span class="dv">7</span>), (<span class="dv">5</span>, <span class="dv">8</span>), (<span class="dv">3</span>, <span class="dv">9</span>), (<span class="dv">2</span>, <span class="dv">8</span>), (<span class="dv">3</span>, <span class="dv">7</span>)])</span>
<span id="cb35-193"><a href="#cb35-193" aria-hidden="true" tabindex="-1"></a>mpo <span class="op">=</span> gpd.GeoSeries([MultiPolygon([p1, p2, p3])])</span>
<span id="cb35-194"><a href="#cb35-194" aria-hidden="true" tabindex="-1"></a>ax6 <span class="op">=</span> plt.subplot(<span class="dv">246</span>)</span>
<span id="cb35-195"><a href="#cb35-195" aria-hidden="true" tabindex="-1"></a>mpo.plot(ax<span class="op">=</span>ax6, linewidth<span class="op">=</span><span class="dv">2</span>, facecolor<span class="op">=</span><span class="st">'#ff8888'</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>)</span>
<span id="cb35-196"><a href="#cb35-196" aria-hidden="true" tabindex="-1"></a>ax6.set_title(<span class="st">"multipolygon"</span>)</span>
<span id="cb35-197"><a href="#cb35-197" aria-hidden="true" tabindex="-1"></a>ax6.set_axis_off()</span>
<span id="cb35-198"><a href="#cb35-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-199"><a href="#cb35-199" aria-hidden="true" tabindex="-1"></a><span class="co"># 7 geometrycollection</span></span>
<span id="cb35-200"><a href="#cb35-200" aria-hidden="true" tabindex="-1"></a><span class="co">#gc = GeometryCollection([po, ls]) #Issue Spotted here! in this line</span></span>
<span id="cb35-201"><a href="#cb35-201" aria-hidden="true" tabindex="-1"></a><span class="co">#ax7 = plt.subplot(247)</span></span>
<span id="cb35-202"><a href="#cb35-202" aria-hidden="true" tabindex="-1"></a><span class="co">#gc.plot(ax=ax7, markersize=10, marker='o', linewidth=2, facecolor='#ff6666', edgecolor='k')</span></span>
<span id="cb35-203"><a href="#cb35-203" aria-hidden="true" tabindex="-1"></a><span class="co">#ax7.set_title("geometrycollection")</span></span>
<span id="cb35-204"><a href="#cb35-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-205"><a href="#cb35-205" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb35-206"><a href="#cb35-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-207"><a href="#cb35-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-208"><a href="#cb35-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-209"><a href="#cb35-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-210"><a href="#cb35-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-211"><a href="#cb35-211" aria-hidden="true" tabindex="-1"></a>@fig-sfgeometries  shows examples of these basic</span>
<span id="cb35-212"><a href="#cb35-212" aria-hidden="true" tabindex="-1"></a>geometry types. The human-readable, "well-known text" (WKT) representation</span>
<span id="cb35-213"><a href="#cb35-213" aria-hidden="true" tabindex="-1"></a>of the geometries plotted are:</span>
<span id="cb35-214"><a href="#cb35-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-215"><a href="#cb35-215" aria-hidden="true" tabindex="-1"></a>\index{geometry!well-known text}</span>
<span id="cb35-216"><a href="#cb35-216" aria-hidden="true" tabindex="-1"></a>\index{geometry!WKT}</span>
<span id="cb35-217"><a href="#cb35-217" aria-hidden="true" tabindex="-1"></a>\index{well-known text}</span>
<span id="cb35-218"><a href="#cb35-218" aria-hidden="true" tabindex="-1"></a>\index{encoding!well-known text}</span>
<span id="cb35-219"><a href="#cb35-219" aria-hidden="true" tabindex="-1"></a>\index{WKT}</span>
<span id="cb35-220"><a href="#cb35-220" aria-hidden="true" tabindex="-1"></a>\index{encoding!WKT}</span>
<span id="cb35-221"><a href="#cb35-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-222"><a href="#cb35-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-223"><a href="#cb35-223" aria-hidden="true" tabindex="-1"></a>:::panel-tabset</span>
<span id="cb35-224"><a href="#cb35-224" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb35-225"><a href="#cb35-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output(), eval=FALSE}</span></span>
<span id="cb35-226"><a href="#cb35-226" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-227"><a href="#cb35-227" aria-hidden="true" tabindex="-1"></a><span class="in">p</span></span>
<span id="cb35-228"><a href="#cb35-228" aria-hidden="true" tabindex="-1"></a><span class="in">mp</span></span>
<span id="cb35-229"><a href="#cb35-229" aria-hidden="true" tabindex="-1"></a><span class="in">ls</span></span>
<span id="cb35-230"><a href="#cb35-230" aria-hidden="true" tabindex="-1"></a><span class="in">mls</span></span>
<span id="cb35-231"><a href="#cb35-231" aria-hidden="true" tabindex="-1"></a><span class="in">po</span></span>
<span id="cb35-232"><a href="#cb35-232" aria-hidden="true" tabindex="-1"></a><span class="in">mpo</span></span>
<span id="cb35-233"><a href="#cb35-233" aria-hidden="true" tabindex="-1"></a><span class="in">gc</span></span>
<span id="cb35-234"><a href="#cb35-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-235"><a href="#cb35-235" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb35-238"><a href="#cb35-238" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-239"><a href="#cb35-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb35-240"><a href="#cb35-240" aria-hidden="true" tabindex="-1"></a><span class="co">#print(p, mp, ls, mls, po, mpo, gc)</span></span>
<span id="cb35-241"><a href="#cb35-241" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(p, mp, ls, mls, po, mpo)</span>
<span id="cb35-242"><a href="#cb35-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-243"><a href="#cb35-243" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-244"><a href="#cb35-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-245"><a href="#cb35-245" aria-hidden="true" tabindex="-1"></a><span class="in">POINT (0 1)</span></span>
<span id="cb35-246"><a href="#cb35-246" aria-hidden="true" tabindex="-1"></a><span class="in">MULTIPOINT ((1 1), (2 2), (4 1), (2 3), (1 4))</span></span>
<span id="cb35-247"><a href="#cb35-247" aria-hidden="true" tabindex="-1"></a><span class="in">LINESTRING (1 1, 5 5, 5 6, 4 6, 3 4, 2 3)</span></span>
<span id="cb35-248"><a href="#cb35-248" aria-hidden="true" tabindex="-1"></a><span class="in">MULTILINESTRING ((1 1, 5 5, 5 6, 4 6, 3 4, 2 3), (3 0, 4 1, 2 1))</span></span>
<span id="cb35-249"><a href="#cb35-249" aria-hidden="true" tabindex="-1"></a><span class="in">POLYGON ((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),</span></span>
<span id="cb35-250"><a href="#cb35-250" aria-hidden="true" tabindex="-1"></a><span class="in">    (2 2, 3 3, 4 3, 4 2, 2 2))</span></span>
<span id="cb35-251"><a href="#cb35-251" aria-hidden="true" tabindex="-1"></a><span class="in">MULTIPOLYGON (((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),</span></span>
<span id="cb35-252"><a href="#cb35-252" aria-hidden="true" tabindex="-1"></a><span class="in">    (2 2, 3 3, 4 3, 4 2, 2 2)), ((3 7, 4 7, 5 8, 3 9, 2 8, 3 7)))</span></span>
<span id="cb35-253"><a href="#cb35-253" aria-hidden="true" tabindex="-1"></a><span class="in">GEOMETRYCOLLECTION (</span></span>
<span id="cb35-254"><a href="#cb35-254" aria-hidden="true" tabindex="-1"></a><span class="in">    POLYGON ((2 1, 3 1, 5 2, 6 3, 5 3, 4 4, 3 4, 1 3, 2 1),</span></span>
<span id="cb35-255"><a href="#cb35-255" aria-hidden="true" tabindex="-1"></a><span class="in">      (2 2 , 3 3, 4 3, 4 2, 2 2)),</span></span>
<span id="cb35-256"><a href="#cb35-256" aria-hidden="true" tabindex="-1"></a><span class="in">    LINESTRING (1 6, 5 10, 5 11, 4 11, 3 9, 2 8),</span></span>
<span id="cb35-257"><a href="#cb35-257" aria-hidden="true" tabindex="-1"></a><span class="in">    POINT (2 5),</span></span>
<span id="cb35-258"><a href="#cb35-258" aria-hidden="true" tabindex="-1"></a><span class="in">    POINT (5 4)</span></span>
<span id="cb35-259"><a href="#cb35-259" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb35-260"><a href="#cb35-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-261"><a href="#cb35-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-262"><a href="#cb35-262" aria-hidden="true" tabindex="-1"></a>In this representation, coordinates are separated by space, and</span>
<span id="cb35-263"><a href="#cb35-263" aria-hidden="true" tabindex="-1"></a>points by commas. Sets are grouped by parentheses, and separated</span>
<span id="cb35-264"><a href="#cb35-264" aria-hidden="true" tabindex="-1"></a>by commas. Polygons consist of an outer ring followed by zero or</span>
<span id="cb35-265"><a href="#cb35-265" aria-hidden="true" tabindex="-1"></a>more inner rings denoting holes.</span>
<span id="cb35-266"><a href="#cb35-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-267"><a href="#cb35-267" aria-hidden="true" tabindex="-1"></a>Individual points in a geometry contain at least two coordinates:</span>
<span id="cb35-268"><a href="#cb35-268" aria-hidden="true" tabindex="-1"></a>$x$ and $y$, in that order.  If these coordinates refer to ellipsoidal</span>
<span id="cb35-269"><a href="#cb35-269" aria-hidden="true" tabindex="-1"></a>coordinates, $x$ and $y$ usually refer to longitude and latitude,</span>
<span id="cb35-270"><a href="#cb35-270" aria-hidden="true" tabindex="-1"></a>respectively, although sometimes to latitude and longitude (see</span>
<span id="cb35-271"><a href="#cb35-271" aria-hidden="true" tabindex="-1"></a>@sec-projlib and @sec-axisorder).</span>
<span id="cb35-272"><a href="#cb35-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-273"><a href="#cb35-273" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simple and valid geometries, ring direction {#sec-valid}</span></span>
<span id="cb35-274"><a href="#cb35-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-275"><a href="#cb35-275" aria-hidden="true" tabindex="-1"></a>\index{geometry!valid}</span>
<span id="cb35-276"><a href="#cb35-276" aria-hidden="true" tabindex="-1"></a>\index{geometry!simple}</span>
<span id="cb35-277"><a href="#cb35-277" aria-hidden="true" tabindex="-1"></a>\index{valid geometry}</span>
<span id="cb35-278"><a href="#cb35-278" aria-hidden="true" tabindex="-1"></a>\index{simple geometry}</span>
<span id="cb35-279"><a href="#cb35-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-280"><a href="#cb35-280" aria-hidden="true" tabindex="-1"></a>Linestrings are called _simple_ when they do not self-intersect:</span>
<span id="cb35-281"><a href="#cb35-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-282"><a href="#cb35-282" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb35-283"><a href="#cb35-283" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb35-284"><a href="#cb35-284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-285"><a href="#cb35-285" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-286"><a href="#cb35-286" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb35-287"><a href="#cb35-287" aria-hidden="true" tabindex="-1"></a><span class="in">(ls &lt;- st_linestring(rbind(c(0,0), c(1,1), c(2,2), c(0,2), c(1,1), c(2,0))))</span></span>
<span id="cb35-288"><a href="#cb35-288" aria-hidden="true" tabindex="-1"></a><span class="in">c(is_simple = st_is_simple(ls))</span></span>
<span id="cb35-289"><a href="#cb35-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-290"><a href="#cb35-290" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb35-293"><a href="#cb35-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-294"><a href="#cb35-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb35-295"><a href="#cb35-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: false</span></span>
<span id="cb35-296"><a href="#cb35-296" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> LineString([(<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">2</span>), (<span class="dv">0</span>, <span class="dv">2</span>), (<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">2</span>, <span class="dv">0</span>)])</span>
<span id="cb35-297"><a href="#cb35-297" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(line.is_simple)</span>
<span id="cb35-298"><a href="#cb35-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-299"><a href="#cb35-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-300"><a href="#cb35-300" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-301"><a href="#cb35-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-302"><a href="#cb35-302" aria-hidden="true" tabindex="-1"></a>Valid polygons and multi-polygons obey all of the following properties:</span>
<span id="cb35-303"><a href="#cb35-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-304"><a href="#cb35-304" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>polygon rings are closed (the last point equals the first)</span>
<span id="cb35-305"><a href="#cb35-305" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>polygon holes (inner rings) are inside their exterior ring</span>
<span id="cb35-306"><a href="#cb35-306" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>polygon inner rings maximally touch the exterior ring in single points, not over a line</span>
<span id="cb35-307"><a href="#cb35-307" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a polygon ring does not repeat its own path</span>
<span id="cb35-308"><a href="#cb35-308" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>in a multi-polygon, an external ring maximally touches another exterior ring in single points, not over a line</span>
<span id="cb35-309"><a href="#cb35-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-310"><a href="#cb35-310" aria-hidden="true" tabindex="-1"></a>If this is not the case, the geometry concerned is not valid. Invalid</span>
<span id="cb35-311"><a href="#cb35-311" aria-hidden="true" tabindex="-1"></a>geometries typically cause errors when they are processed, but they can</span>
<span id="cb35-312"><a href="#cb35-312" aria-hidden="true" tabindex="-1"></a>usually be repaired to make them valid.</span>
<span id="cb35-313"><a href="#cb35-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-314"><a href="#cb35-314" aria-hidden="true" tabindex="-1"></a>A further convention is that the outer ring of a polygon is winded</span>
<span id="cb35-315"><a href="#cb35-315" aria-hidden="true" tabindex="-1"></a>counter-clockwise, while the holes are winded clockwise, but polygons</span>
<span id="cb35-316"><a href="#cb35-316" aria-hidden="true" tabindex="-1"></a>for which this is not the case are still considered valid. For</span>
<span id="cb35-317"><a href="#cb35-317" aria-hidden="true" tabindex="-1"></a>polygons on the sphere, the "clockwise" concept is not very useful:</span>
<span id="cb35-318"><a href="#cb35-318" aria-hidden="true" tabindex="-1"></a>if for instance we take the equator as polygon, is the Northern</span>
<span id="cb35-319"><a href="#cb35-319" aria-hidden="true" tabindex="-1"></a>Hemisphere or the Southern Hemisphere "inside"? The convention</span>
<span id="cb35-320"><a href="#cb35-320" aria-hidden="true" tabindex="-1"></a>taken here is to consider the area on the left while traversing</span>
<span id="cb35-321"><a href="#cb35-321" aria-hidden="true" tabindex="-1"></a>the polygon is considered the polygon's inside (see also @sec-ccw).</span>
<span id="cb35-322"><a href="#cb35-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-323"><a href="#cb35-323" aria-hidden="true" tabindex="-1"></a><span class="fu">### Z and M coordinates</span></span>
<span id="cb35-324"><a href="#cb35-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-325"><a href="#cb35-325" aria-hidden="true" tabindex="-1"></a>\index{coordinates!z and m}</span>
<span id="cb35-326"><a href="#cb35-326" aria-hidden="true" tabindex="-1"></a>\index{simple feature geometry!z and m}</span>
<span id="cb35-327"><a href="#cb35-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-328"><a href="#cb35-328" aria-hidden="true" tabindex="-1"></a>In addition to X and Y coordinates, single points (vertices) of</span>
<span id="cb35-329"><a href="#cb35-329" aria-hidden="true" tabindex="-1"></a>simple feature geometries may have:</span>
<span id="cb35-330"><a href="#cb35-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-331"><a href="#cb35-331" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a <span class="in">`Z`</span> coordinate, denoting altitude, and/or</span>
<span id="cb35-332"><a href="#cb35-332" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>an <span class="in">`M`</span> value, denoting some "measure"</span>
<span id="cb35-333"><a href="#cb35-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-334"><a href="#cb35-334" aria-hidden="true" tabindex="-1"></a>The <span class="in">`M`</span> attribute shall be a property of the vertex. It sounds</span>
<span id="cb35-335"><a href="#cb35-335" aria-hidden="true" tabindex="-1"></a>attractive to encode a time stamp in it for instance to pack movement data</span>
<span id="cb35-336"><a href="#cb35-336" aria-hidden="true" tabindex="-1"></a>(trajectories) in <span class="in">`LINESTRING`</span>s. These become however invalid (or</span>
<span id="cb35-337"><a href="#cb35-337" aria-hidden="true" tabindex="-1"></a>"non-simple") once the trajectory self-intersects, which</span>
<span id="cb35-338"><a href="#cb35-338" aria-hidden="true" tabindex="-1"></a>happens when only <span class="in">`X`</span> and <span class="in">`Y`</span> are considered for self-intersections.</span>
<span id="cb35-339"><a href="#cb35-339" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-340"><a href="#cb35-340" aria-hidden="true" tabindex="-1"></a>Both <span class="in">`Z`</span> and <span class="in">`M`</span> are not found often, and software support</span>
<span id="cb35-341"><a href="#cb35-341" aria-hidden="true" tabindex="-1"></a>to do something useful with them is (still) rare. Their</span>
<span id="cb35-342"><a href="#cb35-342" aria-hidden="true" tabindex="-1"></a>WKT representation are fairly easily understood:</span>
<span id="cb35-343"><a href="#cb35-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-344"><a href="#cb35-344" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb35-345"><a href="#cb35-345" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb35-346"><a href="#cb35-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-347"><a href="#cb35-347" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-348"><a href="#cb35-348" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb35-349"><a href="#cb35-349" aria-hidden="true" tabindex="-1"></a><span class="in">st_point(c(1,3,2))</span></span>
<span id="cb35-350"><a href="#cb35-350" aria-hidden="true" tabindex="-1"></a><span class="in">st_point(c(1,3,2), dim = "XYM")</span></span>
<span id="cb35-351"><a href="#cb35-351" aria-hidden="true" tabindex="-1"></a><span class="in">st_linestring(rbind(c(3,1,2,4), c(4,4,2,2)))</span></span>
<span id="cb35-352"><a href="#cb35-352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-353"><a href="#cb35-353" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb35-356"><a href="#cb35-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-357"><a href="#cb35-357" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb35-358"><a href="#cb35-358" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: false</span></span>
<span id="cb35-359"><a href="#cb35-359" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> Point(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb35-360"><a href="#cb35-360" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(point)</span>
<span id="cb35-361"><a href="#cb35-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-362"><a href="#cb35-362" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-363"><a href="#cb35-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-364"><a href="#cb35-364" aria-hidden="true" tabindex="-1"></a><span class="fu">### Empty geometries</span></span>
<span id="cb35-365"><a href="#cb35-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-366"><a href="#cb35-366" aria-hidden="true" tabindex="-1"></a>\index{empty geometry}</span>
<span id="cb35-367"><a href="#cb35-367" aria-hidden="true" tabindex="-1"></a>\index{geometry!empty}</span>
<span id="cb35-368"><a href="#cb35-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-369"><a href="#cb35-369" aria-hidden="true" tabindex="-1"></a>A very important concept in the feature geometry framework is that of the</span>
<span id="cb35-370"><a href="#cb35-370" aria-hidden="true" tabindex="-1"></a>empty geometry. </span>
<span id="cb35-371"><a href="#cb35-371" aria-hidden="true" tabindex="-1"></a>Empty geometries arise naturally when we do geometrical</span>
<span id="cb35-372"><a href="#cb35-372" aria-hidden="true" tabindex="-1"></a>operations (@sec-opgeom), for instance when we want to</span>
<span id="cb35-373"><a href="#cb35-373" aria-hidden="true" tabindex="-1"></a>know the intersection of <span class="in">`POINT (0 0)`</span> and <span class="in">`POINT (1 1)`</span>: </span>
<span id="cb35-374"><a href="#cb35-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-375"><a href="#cb35-375" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb35-376"><a href="#cb35-376" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb35-377"><a href="#cb35-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-378"><a href="#cb35-378" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-379"><a href="#cb35-379" aria-hidden="true" tabindex="-1"></a><span class="in">(e &lt;- st_intersection(st_point(c(0,0)), st_point(c(1,1))))</span></span>
<span id="cb35-380"><a href="#cb35-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-381"><a href="#cb35-381" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb35-384"><a href="#cb35-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-385"><a href="#cb35-385" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb35-386"><a href="#cb35-386" aria-hidden="true" tabindex="-1"></a>point1 <span class="op">=</span> Point(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb35-387"><a href="#cb35-387" aria-hidden="true" tabindex="-1"></a>point2 <span class="op">=</span> Point(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb35-388"><a href="#cb35-388" aria-hidden="true" tabindex="-1"></a>intersection <span class="op">=</span> point1.intersection(point2)</span>
<span id="cb35-389"><a href="#cb35-389" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(intersection)</span>
<span id="cb35-390"><a href="#cb35-390" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-391"><a href="#cb35-391" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-392"><a href="#cb35-392" aria-hidden="true" tabindex="-1"></a>and it represents essentially the empty set: when combining</span>
<span id="cb35-393"><a href="#cb35-393" aria-hidden="true" tabindex="-1"></a>(unioning) an empty point with other non-empty geometries,</span>
<span id="cb35-394"><a href="#cb35-394" aria-hidden="true" tabindex="-1"></a>it vanishes.</span>
<span id="cb35-395"><a href="#cb35-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-396"><a href="#cb35-396" aria-hidden="true" tabindex="-1"></a>All geometry types have a special value representing the empty (typed) geometry, like</span>
<span id="cb35-397"><a href="#cb35-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-398"><a href="#cb35-398" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-399"><a href="#cb35-399" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb35-400"><a href="#cb35-400" aria-hidden="true" tabindex="-1"></a><span class="in">st_point()</span></span>
<span id="cb35-401"><a href="#cb35-401" aria-hidden="true" tabindex="-1"></a><span class="in">st_linestring(matrix(1,1,3)[0,], dim = "XYM")</span></span>
<span id="cb35-402"><a href="#cb35-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-403"><a href="#cb35-403" aria-hidden="true" tabindex="-1"></a>and so on, but they all point to the empty set, differing only in their</span>
<span id="cb35-404"><a href="#cb35-404" aria-hidden="true" tabindex="-1"></a>dimension (@sec-de9im).</span>
<span id="cb35-405"><a href="#cb35-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-406"><a href="#cb35-406" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ten further geometry types</span></span>
<span id="cb35-407"><a href="#cb35-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-408"><a href="#cb35-408" aria-hidden="true" tabindex="-1"></a>There are 10 more geometry types which are more rare, but increasingly find implementation:</span>
<span id="cb35-409"><a href="#cb35-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-410"><a href="#cb35-410" aria-hidden="true" tabindex="-1"></a>| type | description                      |</span>
<span id="cb35-411"><a href="#cb35-411" aria-hidden="true" tabindex="-1"></a>|------|----------------------------------|</span>
<span id="cb35-412"><a href="#cb35-412" aria-hidden="true" tabindex="-1"></a>| <span class="in">`CIRCULARSTRING`</span> | The CircularString is the basic curve type, similar to a LineString in the linear world. A single segment requires three points, the start and end points (first and third) and any other point on the arc. The exception to this is for a closed circle, where the start and end points are the same. In this case the second point MUST be the centre of the arc, i.e., the opposite side of the circle. To chain arcs together, the last point of the previous arc becomes the first point of the next arc, just like in LineString. This means that a valid circular string must have an odd number of points greater than 1. |</span>
<span id="cb35-413"><a href="#cb35-413" aria-hidden="true" tabindex="-1"></a>| <span class="in">`COMPOUNDCURVE`</span> | A CompoundCurve is a single, continuous curve that has both curved (circular) segments and linear segments. That means that in addition to having well-formed components, the end point of every component (except the last) must be coincident with the start point of the following component. |</span>
<span id="cb35-414"><a href="#cb35-414" aria-hidden="true" tabindex="-1"></a>| <span class="in">`CURVEPOLYGON`</span> | Example compound curve in a curve polygon: <span class="in">`CURVEPOLYGON( COMPOUNDCURVE( CIRCULARSTRING(0 0,2 0, 2 1, 2 3, 4 3),(4 3, 4 5, 1 4, 0 0)), CIRCULARSTRING(1.7 1, 1.4 0.4, 1.6 0.4, 1.6 0.5, 1.7 1))`</span> |</span>
<span id="cb35-415"><a href="#cb35-415" aria-hidden="true" tabindex="-1"></a>| <span class="in">`MULTICURVE`</span> |  A MultiCurve is a 1 dimensional GeometryCollection whose elements are Curves. It can include linear strings, circular strings, or compound strings. |</span>
<span id="cb35-416"><a href="#cb35-416" aria-hidden="true" tabindex="-1"></a>| <span class="in">`MULTISURFACE`</span> | A MultiSurface is a 2 dimensional GeometryCollection whose elements are Surfaces, all using coordinates from the same coordinate reference system. |</span>
<span id="cb35-417"><a href="#cb35-417" aria-hidden="true" tabindex="-1"></a>| <span class="in">`CURVE`</span> | A Curve is a 1 dimensional geometric object usually stored as a sequence of Points, with the subtype of Curve specifying the form of the interpolation between Points. |</span>
<span id="cb35-418"><a href="#cb35-418" aria-hidden="true" tabindex="-1"></a>| <span class="in">`SURFACE`</span> | A Surface is a 2 dimensional geometric object. |</span>
<span id="cb35-419"><a href="#cb35-419" aria-hidden="true" tabindex="-1"></a>| <span class="in">`POLYHEDRALSURFACE`</span> | A PolyhedralSurface is a contiguous collection of polygons, which share common boundary segments. |</span>
<span id="cb35-420"><a href="#cb35-420" aria-hidden="true" tabindex="-1"></a>| <span class="in">`TIN`</span> | A TIN (triangulated irregular network) is a PolyhedralSurface consisting only of Triangle patches. |</span>
<span id="cb35-421"><a href="#cb35-421" aria-hidden="true" tabindex="-1"></a>| <span class="in">`TRIANGLE`</span> | A Triangle is a polygon with three distinct, non-collinear vertices and no interior boundary. |</span>
<span id="cb35-422"><a href="#cb35-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-423"><a href="#cb35-423" aria-hidden="true" tabindex="-1"></a><span class="in">`CIRCULARSTRING`</span>, <span class="in">`COMPOUNDCURVE`</span> and <span class="in">`CURVEPOLYGON`</span> are not</span>
<span id="cb35-424"><a href="#cb35-424" aria-hidden="true" tabindex="-1"></a>described in the SFA standard, but in the [SQL-MM part 3</span>
<span id="cb35-425"><a href="#cb35-425" aria-hidden="true" tabindex="-1"></a>standard](https://www.iso.org/standard/38651.html). The</span>
<span id="cb35-426"><a href="#cb35-426" aria-hidden="true" tabindex="-1"></a>descriptions above were copied from the [PostGIS</span>
<span id="cb35-427"><a href="#cb35-427" aria-hidden="true" tabindex="-1"></a>manual](http://postgis.net/docs/using_postgis_dbmanagement.html).</span>
<span id="cb35-428"><a href="#cb35-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-429"><a href="#cb35-429" aria-hidden="true" tabindex="-1"></a>\index{CIRCULARSTRING}</span>
<span id="cb35-430"><a href="#cb35-430" aria-hidden="true" tabindex="-1"></a>\index{COMPOUNDCURVE}</span>
<span id="cb35-431"><a href="#cb35-431" aria-hidden="true" tabindex="-1"></a>\index{CURVEPOLYGON}</span>
<span id="cb35-432"><a href="#cb35-432" aria-hidden="true" tabindex="-1"></a>\index{MULTICURVE}</span>
<span id="cb35-433"><a href="#cb35-433" aria-hidden="true" tabindex="-1"></a>\index{MULTISURFACE}</span>
<span id="cb35-434"><a href="#cb35-434" aria-hidden="true" tabindex="-1"></a>\index{CURVE}</span>
<span id="cb35-435"><a href="#cb35-435" aria-hidden="true" tabindex="-1"></a>\index{SURFACE}</span>
<span id="cb35-436"><a href="#cb35-436" aria-hidden="true" tabindex="-1"></a>\index{POLYHEDRALSURFACE}</span>
<span id="cb35-437"><a href="#cb35-437" aria-hidden="true" tabindex="-1"></a>\index{TIN}</span>
<span id="cb35-438"><a href="#cb35-438" aria-hidden="true" tabindex="-1"></a>\index{TRIANGLE}</span>
<span id="cb35-439"><a href="#cb35-439" aria-hidden="true" tabindex="-1"></a>\index{SQL-MM part 3}</span>
<span id="cb35-440"><a href="#cb35-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-441"><a href="#cb35-441" aria-hidden="true" tabindex="-1"></a><span class="fu">### Text and binary encodings</span></span>
<span id="cb35-442"><a href="#cb35-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-443"><a href="#cb35-443" aria-hidden="true" tabindex="-1"></a>\index{well-known binary}</span>
<span id="cb35-444"><a href="#cb35-444" aria-hidden="true" tabindex="-1"></a>\index{encoding!well-known binary}</span>
<span id="cb35-445"><a href="#cb35-445" aria-hidden="true" tabindex="-1"></a>\index{WKB}</span>
<span id="cb35-446"><a href="#cb35-446" aria-hidden="true" tabindex="-1"></a>\index{encoding!WKB}</span>
<span id="cb35-447"><a href="#cb35-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-448"><a href="#cb35-448" aria-hidden="true" tabindex="-1"></a>Part of the simple feature standard are two encodings: a text and</span>
<span id="cb35-449"><a href="#cb35-449" aria-hidden="true" tabindex="-1"></a>a binary encoding. The well-known text encoding, used above, is</span>
<span id="cb35-450"><a href="#cb35-450" aria-hidden="true" tabindex="-1"></a>human-readable. The well-known binary encoding is machine-readable.</span>
<span id="cb35-451"><a href="#cb35-451" aria-hidden="true" tabindex="-1"></a>Well-known binary (WKB) encodings are lossless and typically faster</span>
<span id="cb35-452"><a href="#cb35-452" aria-hidden="true" tabindex="-1"></a>to work with than text encoding (and decoding), and they are used for</span>
<span id="cb35-453"><a href="#cb35-453" aria-hidden="true" tabindex="-1"></a>instance in all communications between R package **sf** and the GDAL,</span>
<span id="cb35-454"><a href="#cb35-454" aria-hidden="true" tabindex="-1"></a>GEOS, liblwgeom, and s2geometry libraries (@fig-gdal-fig-nodetails).</span>
<span id="cb35-455"><a href="#cb35-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-456"><a href="#cb35-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## Operations on geometries {#sec-opgeom}</span></span>
<span id="cb35-457"><a href="#cb35-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-458"><a href="#cb35-458" aria-hidden="true" tabindex="-1"></a>\index{geometry!operations}</span>
<span id="cb35-459"><a href="#cb35-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-460"><a href="#cb35-460" aria-hidden="true" tabindex="-1"></a>Simple feature geometries can be queried for properties, or</span>
<span id="cb35-461"><a href="#cb35-461" aria-hidden="true" tabindex="-1"></a>transformed or combined into new geometries, and combinations of geometries</span>
<span id="cb35-462"><a href="#cb35-462" aria-hidden="true" tabindex="-1"></a>can be queried for further properties. This section gives an overview</span>
<span id="cb35-463"><a href="#cb35-463" aria-hidden="true" tabindex="-1"></a>of the operations entirely focusing on _geometrical_ properties.</span>
<span id="cb35-464"><a href="#cb35-464" aria-hidden="true" tabindex="-1"></a>@sec-featureattributes focuses on the analysis of non-geometrical</span>
<span id="cb35-465"><a href="#cb35-465" aria-hidden="true" tabindex="-1"></a>feature properties, in relationship to their geometries. Some of</span>
<span id="cb35-466"><a href="#cb35-466" aria-hidden="true" tabindex="-1"></a>the material in this section appeared in @rjsf.</span>
<span id="cb35-467"><a href="#cb35-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-468"><a href="#cb35-468" aria-hidden="true" tabindex="-1"></a>We can categorise operations on geometries in terms of what they</span>
<span id="cb35-469"><a href="#cb35-469" aria-hidden="true" tabindex="-1"></a>take as input, and what they return as output. In terms of output</span>
<span id="cb35-470"><a href="#cb35-470" aria-hidden="true" tabindex="-1"></a>we have operations that return:</span>
<span id="cb35-471"><a href="#cb35-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-472"><a href="#cb35-472" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**predicates**: a logical asserting a certain property is <span class="in">`TRUE`</span></span>
<span id="cb35-473"><a href="#cb35-473" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**measures**: a quantity (a numeric value, possibly with measurement unit)</span>
<span id="cb35-474"><a href="#cb35-474" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**transformations**: newly generated geometries</span>
<span id="cb35-475"><a href="#cb35-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-476"><a href="#cb35-476" aria-hidden="true" tabindex="-1"></a>and in terms of what they operate on, we distinguish operations</span>
<span id="cb35-477"><a href="#cb35-477" aria-hidden="true" tabindex="-1"></a>that are:</span>
<span id="cb35-478"><a href="#cb35-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-479"><a href="#cb35-479" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**unary** when they work on a single geometry</span>
<span id="cb35-480"><a href="#cb35-480" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**binary** when they work on pairs of geometries</span>
<span id="cb35-481"><a href="#cb35-481" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**n-ary** when they work on sets of geometries</span>
<span id="cb35-482"><a href="#cb35-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-483"><a href="#cb35-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### Unary predicates</span></span>
<span id="cb35-484"><a href="#cb35-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-485"><a href="#cb35-485" aria-hidden="true" tabindex="-1"></a>\index{geometry!predicates}</span>
<span id="cb35-486"><a href="#cb35-486" aria-hidden="true" tabindex="-1"></a>\index{geometry!valid}</span>
<span id="cb35-487"><a href="#cb35-487" aria-hidden="true" tabindex="-1"></a>\index{geometry!predicates!unary}</span>
<span id="cb35-488"><a href="#cb35-488" aria-hidden="true" tabindex="-1"></a>\index{geometry!empty}</span>
<span id="cb35-489"><a href="#cb35-489" aria-hidden="true" tabindex="-1"></a>\index{geometry!simple}</span>
<span id="cb35-490"><a href="#cb35-490" aria-hidden="true" tabindex="-1"></a>\index{geometry!projected}</span>
<span id="cb35-491"><a href="#cb35-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-492"><a href="#cb35-492" aria-hidden="true" tabindex="-1"></a>Unary predicates describe a certain property of a geometry.</span>
<span id="cb35-493"><a href="#cb35-493" aria-hidden="true" tabindex="-1"></a>The predicates <span class="in">`is_simple`</span>, <span class="in">`is_valid`</span>, and <span class="in">`is_empty`</span> return</span>
<span id="cb35-494"><a href="#cb35-494" aria-hidden="true" tabindex="-1"></a>respectively whether a geometry is simple, valid, or empty.  Given a</span>
<span id="cb35-495"><a href="#cb35-495" aria-hidden="true" tabindex="-1"></a>coordinate reference system, <span class="in">`is_longlat`</span> returns whether the</span>
<span id="cb35-496"><a href="#cb35-496" aria-hidden="true" tabindex="-1"></a>coordinates are geographic or projected. <span class="in">`is(geometry, class)`</span></span>
<span id="cb35-497"><a href="#cb35-497" aria-hidden="true" tabindex="-1"></a>checks whether a geometry belongs to a particular class.</span>
<span id="cb35-498"><a href="#cb35-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-499"><a href="#cb35-499" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>is<span class="sc">\_</span>simple}</span>
<span id="cb35-500"><a href="#cb35-500" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>is<span class="sc">\_</span>valid}</span>
<span id="cb35-501"><a href="#cb35-501" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>is<span class="sc">\_</span>empty}</span>
<span id="cb35-502"><a href="#cb35-502" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>is<span class="sc">\_</span>longlat}</span>
<span id="cb35-503"><a href="#cb35-503" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>is}</span>
<span id="cb35-504"><a href="#cb35-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-505"><a href="#cb35-505" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary predicates and DE-9IM {#sec-de9im}</span></span>
<span id="cb35-506"><a href="#cb35-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-507"><a href="#cb35-507" aria-hidden="true" tabindex="-1"></a>\index{geometry!predicates!binary}</span>
<span id="cb35-508"><a href="#cb35-508" aria-hidden="true" tabindex="-1"></a>\index{geometry!DE-9IM}</span>
<span id="cb35-509"><a href="#cb35-509" aria-hidden="true" tabindex="-1"></a>\index{DE-9IM}</span>
<span id="cb35-510"><a href="#cb35-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-511"><a href="#cb35-511" aria-hidden="true" tabindex="-1"></a>The Dimensionally Extended Nine-Intersection Model [DE-9IM,</span>
<span id="cb35-512"><a href="#cb35-512" aria-hidden="true" tabindex="-1"></a>@de9im1; @de9im2] is a model that describes the qualitative</span>
<span id="cb35-513"><a href="#cb35-513" aria-hidden="true" tabindex="-1"></a>relation between any two geometries in two-dimensional space</span>
<span id="cb35-514"><a href="#cb35-514" aria-hidden="true" tabindex="-1"></a>($R^2$). Any geometry has a _dimension_ value that is:</span>
<span id="cb35-515"><a href="#cb35-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-516"><a href="#cb35-516" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>0 for points, </span>
<span id="cb35-517"><a href="#cb35-517" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>1 for linear geometries, </span>
<span id="cb35-518"><a href="#cb35-518" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>2 for polygonal geometries, and </span>
<span id="cb35-519"><a href="#cb35-519" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>F (false) for empty geometries</span>
<span id="cb35-520"><a href="#cb35-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-521"><a href="#cb35-521" aria-hidden="true" tabindex="-1"></a>Any geometry also has an inside (I), a boundary (B), and an exterior (E); these</span>
<span id="cb35-522"><a href="#cb35-522" aria-hidden="true" tabindex="-1"></a>roles are obvious for polygons, however, for:</span>
<span id="cb35-523"><a href="#cb35-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-524"><a href="#cb35-524" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**lines** the boundary is formed by the end points, and the interior</span>
<span id="cb35-525"><a href="#cb35-525" aria-hidden="true" tabindex="-1"></a>by all non-end points on the line</span>
<span id="cb35-526"><a href="#cb35-526" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**points** have a zero-dimensional inside but no boundary</span>
<span id="cb35-527"><a href="#cb35-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-528"><a href="#cb35-528" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-de9im, fig.cap = "DE-9IM: intersections between the interior, boundary, and exterior of a polygon (rows) and of a linestring (columns) indicated by red", echo=!knitr::is_latex_output() }</span></span>
<span id="cb35-529"><a href="#cb35-529" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-530"><a href="#cb35-530" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb35-531"><a href="#cb35-531" aria-hidden="true" tabindex="-1"></a><span class="in">polygon &lt;- po &lt;- st_polygon(list(rbind(c(0,0), c(1,0), c(1,1), c(0,1), c(0,0))))</span></span>
<span id="cb35-532"><a href="#cb35-532" aria-hidden="true" tabindex="-1"></a><span class="in">p0 &lt;- st_polygon(list(rbind(c(-1,-1), c(2,-1), c(2,2), c(-1,2), c(-1,-1))))</span></span>
<span id="cb35-533"><a href="#cb35-533" aria-hidden="true" tabindex="-1"></a><span class="in">line &lt;- li &lt;- st_linestring(rbind(c(.5, -.5), c(.5, 0.5)))</span></span>
<span id="cb35-534"><a href="#cb35-534" aria-hidden="true" tabindex="-1"></a><span class="in">s &lt;- st_sfc(po, li)</span></span>
<span id="cb35-535"><a href="#cb35-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-536"><a href="#cb35-536" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(3,3))</span></span>
<span id="cb35-537"><a href="#cb35-537" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(1,1,1,1))</span></span>
<span id="cb35-538"><a href="#cb35-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-539"><a href="#cb35-539" aria-hidden="true" tabindex="-1"></a><span class="in"># "1020F1102"</span></span>
<span id="cb35-540"><a href="#cb35-540" aria-hidden="true" tabindex="-1"></a><span class="in"># 1: 1</span></span>
<span id="cb35-541"><a href="#cb35-541" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("I(pol)",intersect(),"I(line) = 1")))</span></span>
<span id="cb35-542"><a href="#cb35-542" aria-hidden="true" tabindex="-1"></a><span class="in">lines(rbind(c(.5,0), c(.5,.495)), col = 'red', lwd = 2)</span></span>
<span id="cb35-543"><a href="#cb35-543" aria-hidden="true" tabindex="-1"></a><span class="in">points(0.5, 0.5, pch = 1)</span></span>
<span id="cb35-544"><a href="#cb35-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-545"><a href="#cb35-545" aria-hidden="true" tabindex="-1"></a><span class="in"># 2: 0</span></span>
<span id="cb35-546"><a href="#cb35-546" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("I(pol)",intersect(),"B(line) = 0")))</span></span>
<span id="cb35-547"><a href="#cb35-547" aria-hidden="true" tabindex="-1"></a><span class="in">points(0.5, 0.5, col = 'red', pch = 16)</span></span>
<span id="cb35-548"><a href="#cb35-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-549"><a href="#cb35-549" aria-hidden="true" tabindex="-1"></a><span class="in"># 3: 2</span></span>
<span id="cb35-550"><a href="#cb35-550" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("I(pol)",intersect(),"E(line) = 2")))</span></span>
<span id="cb35-551"><a href="#cb35-551" aria-hidden="true" tabindex="-1"></a><span class="in">plot(po, col = '#ff8888', add = TRUE)</span></span>
<span id="cb35-552"><a href="#cb35-552" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', add = TRUE)</span></span>
<span id="cb35-553"><a href="#cb35-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-554"><a href="#cb35-554" aria-hidden="true" tabindex="-1"></a><span class="in"># 4: 0</span></span>
<span id="cb35-555"><a href="#cb35-555" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("B(pol)",intersect(),"I(line) = 0")))</span></span>
<span id="cb35-556"><a href="#cb35-556" aria-hidden="true" tabindex="-1"></a><span class="in">points(.5, 0, col = 'red', pch = 16)</span></span>
<span id="cb35-557"><a href="#cb35-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-558"><a href="#cb35-558" aria-hidden="true" tabindex="-1"></a><span class="in"># 5: F</span></span>
<span id="cb35-559"><a href="#cb35-559" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("B(pol)",intersect(),"B(line) = F")))</span></span>
<span id="cb35-560"><a href="#cb35-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-561"><a href="#cb35-561" aria-hidden="true" tabindex="-1"></a><span class="in"># 6: 1</span></span>
<span id="cb35-562"><a href="#cb35-562" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("B(pol)",intersect(),"E(line) = 1")))</span></span>
<span id="cb35-563"><a href="#cb35-563" aria-hidden="true" tabindex="-1"></a><span class="in">plot(po, border = 'red', col = NA, add = TRUE, lwd = 2)</span></span>
<span id="cb35-564"><a href="#cb35-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-565"><a href="#cb35-565" aria-hidden="true" tabindex="-1"></a><span class="in"># 7: 1</span></span>
<span id="cb35-566"><a href="#cb35-566" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("E(pol)",intersect(),"I(line) = 1")))</span></span>
<span id="cb35-567"><a href="#cb35-567" aria-hidden="true" tabindex="-1"></a><span class="in">lines(rbind(c(.5, -.5), c(.5, 0)), col = 'red', lwd = 2)</span></span>
<span id="cb35-568"><a href="#cb35-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-569"><a href="#cb35-569" aria-hidden="true" tabindex="-1"></a><span class="in"># 8: 0</span></span>
<span id="cb35-570"><a href="#cb35-570" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("E(pol)",intersect(),"B(line) = 0")))</span></span>
<span id="cb35-571"><a href="#cb35-571" aria-hidden="true" tabindex="-1"></a><span class="in">points(.5, -.5, col = 'red', pch = 16)</span></span>
<span id="cb35-572"><a href="#cb35-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-573"><a href="#cb35-573" aria-hidden="true" tabindex="-1"></a><span class="in"># 9: 2</span></span>
<span id="cb35-574"><a href="#cb35-574" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', main = expression(paste("E(pol)",intersect(),"E(line) = 2")))</span></span>
<span id="cb35-575"><a href="#cb35-575" aria-hidden="true" tabindex="-1"></a><span class="in">plot(p0 / po, col = '#ff8888', add = TRUE)</span></span>
<span id="cb35-576"><a href="#cb35-576" aria-hidden="true" tabindex="-1"></a><span class="in">plot(s, col = c(NA, 'darkgreen'), border = 'blue', add = TRUE)</span></span>
<span id="cb35-577"><a href="#cb35-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-578"><a href="#cb35-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-579"><a href="#cb35-579" aria-hidden="true" tabindex="-1"></a>@fig-de9im  shows the intersections between the I,</span>
<span id="cb35-580"><a href="#cb35-580" aria-hidden="true" tabindex="-1"></a>B, and E components of a polygon and a linestring indicated by red;</span>
<span id="cb35-581"><a href="#cb35-581" aria-hidden="true" tabindex="-1"></a>the sub-plot title gives the dimension of these intersections (0,</span>
<span id="cb35-582"><a href="#cb35-582" aria-hidden="true" tabindex="-1"></a>1, 2 or F). The relationship between the polygon and the line geometry is the</span>
<span id="cb35-583"><a href="#cb35-583" aria-hidden="true" tabindex="-1"></a>concatenation of these dimensions:</span>
<span id="cb35-584"><a href="#cb35-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-585"><a href="#cb35-585" aria-hidden="true" tabindex="-1"></a>::: panel-tabset</span>
<span id="cb35-586"><a href="#cb35-586" aria-hidden="true" tabindex="-1"></a><span class="fu">#### R</span></span>
<span id="cb35-587"><a href="#cb35-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-588"><a href="#cb35-588" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-589"><a href="#cb35-589" aria-hidden="true" tabindex="-1"></a><span class="in">#| collapse: false</span></span>
<span id="cb35-590"><a href="#cb35-590" aria-hidden="true" tabindex="-1"></a><span class="in">st_relate(polygon, line)</span></span>
<span id="cb35-591"><a href="#cb35-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-592"><a href="#cb35-592" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Python</span></span>
<span id="cb35-595"><a href="#cb35-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb35-596"><a href="#cb35-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb35-597"><a href="#cb35-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| collapse: false</span></span>
<span id="cb35-598"><a href="#cb35-598" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon, LineString</span>
<span id="cb35-599"><a href="#cb35-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-600"><a href="#cb35-600" aria-hidden="true" tabindex="-1"></a>polygon <span class="op">=</span> Polygon([(<span class="dv">0</span>,<span class="dv">0</span>), (<span class="dv">1</span>,<span class="dv">0</span>), (<span class="dv">1</span>,<span class="dv">1</span>), (<span class="dv">0</span>,<span class="dv">1</span>), (<span class="dv">0</span>,<span class="dv">0</span>)])</span>
<span id="cb35-601"><a href="#cb35-601" aria-hidden="true" tabindex="-1"></a>line <span class="op">=</span> LineString([(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>), (<span class="fl">0.5</span>, <span class="fl">0.5</span>)])</span>
<span id="cb35-602"><a href="#cb35-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-603"><a href="#cb35-603" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the spatial relationship between the polygon and line string</span></span>
<span id="cb35-604"><a href="#cb35-604" aria-hidden="true" tabindex="-1"></a>relation <span class="op">=</span> polygon.relate(line)</span>
<span id="cb35-605"><a href="#cb35-605" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(relation)</span>
<span id="cb35-606"><a href="#cb35-606" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-607"><a href="#cb35-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-608"><a href="#cb35-608" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb35-609"><a href="#cb35-609" aria-hidden="true" tabindex="-1"></a>where the first three characters are associated with the inside</span>
<span id="cb35-610"><a href="#cb35-610" aria-hidden="true" tabindex="-1"></a>of the _first_ geometry (polygon): @fig-de9im  is</span>
<span id="cb35-611"><a href="#cb35-611" aria-hidden="true" tabindex="-1"></a>summarised row-wise.</span>
<span id="cb35-612"><a href="#cb35-612" aria-hidden="true" tabindex="-1"></a>Using this ability to express relationships, we can also query</span>
<span id="cb35-613"><a href="#cb35-613" aria-hidden="true" tabindex="-1"></a>pairs of geometries about particular conditions expressed in a</span>
<span id="cb35-614"><a href="#cb35-614" aria-hidden="true" tabindex="-1"></a>_mask string_. As an example, the string <span class="in">`"*0*******"`</span> would evaluate <span class="in">`TRUE`</span></span>
<span id="cb35-615"><a href="#cb35-615" aria-hidden="true" tabindex="-1"></a>when the second geometry has one or more boundary _points_ in common</span>
<span id="cb35-616"><a href="#cb35-616" aria-hidden="true" tabindex="-1"></a>with the interior of the first geometry; the symbol <span class="in">`*`</span> standing for</span>
<span id="cb35-617"><a href="#cb35-617" aria-hidden="true" tabindex="-1"></a>"any dimensionality" (0, 1, 2 or F). The mask string <span class="in">`"T********"`</span></span>
<span id="cb35-618"><a href="#cb35-618" aria-hidden="true" tabindex="-1"></a>matches pairs of geometry with intersecting interiors, where the</span>
<span id="cb35-619"><a href="#cb35-619" aria-hidden="true" tabindex="-1"></a>symbol <span class="in">`T`</span> stands for any non-empty intersection of dimensionality 0,</span>
<span id="cb35-620"><a href="#cb35-620" aria-hidden="true" tabindex="-1"></a>1, or 2.</span>
<span id="cb35-621"><a href="#cb35-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-622"><a href="#cb35-622" aria-hidden="true" tabindex="-1"></a>Binary predicates are further described using normal-language verbs,</span>
<span id="cb35-623"><a href="#cb35-623" aria-hidden="true" tabindex="-1"></a>using DE-9IM definitions. For instance, the predicate <span class="in">`equals`</span></span>
<span id="cb35-624"><a href="#cb35-624" aria-hidden="true" tabindex="-1"></a>corresponds to the relationship <span class="in">`"T*F**FFF*"`</span>. If any two geometries</span>
<span id="cb35-625"><a href="#cb35-625" aria-hidden="true" tabindex="-1"></a>obey this relationship, they are (topologically) equal, but may</span>
<span id="cb35-626"><a href="#cb35-626" aria-hidden="true" tabindex="-1"></a>have a different ordering of nodes.</span>
<span id="cb35-627"><a href="#cb35-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-628"><a href="#cb35-628" aria-hidden="true" tabindex="-1"></a>A list of binary predicates is:</span>
<span id="cb35-629"><a href="#cb35-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-630"><a href="#cb35-630" aria-hidden="true" tabindex="-1"></a>|predicate                     |meaning                                                          |inverse of      |</span>
<span id="cb35-631"><a href="#cb35-631" aria-hidden="true" tabindex="-1"></a>|------------------------------|-----------------------------------------------------------------|----------------|</span>
<span id="cb35-632"><a href="#cb35-632" aria-hidden="true" tabindex="-1"></a>|<span class="in">`contains`</span>                    |None of the points of A are outside B| <span class="in">`within`</span>|</span>
<span id="cb35-633"><a href="#cb35-633" aria-hidden="true" tabindex="-1"></a>|<span class="in">`contains_properly`</span>           |A contains B and B has no points in common with the boundary of A| |</span>
<span id="cb35-634"><a href="#cb35-634" aria-hidden="true" tabindex="-1"></a>|<span class="in">`covers`</span>                      |No points of B lie in the exterior of A| <span class="in">`covered_by`</span>|</span>
<span id="cb35-635"><a href="#cb35-635" aria-hidden="true" tabindex="-1"></a>|<span class="in">`covered_by`</span>                  |Inverse of <span class="in">`covers`</span>| |</span>
<span id="cb35-636"><a href="#cb35-636" aria-hidden="true" tabindex="-1"></a>|<span class="in">`crosses`</span>                     |A and B have some but not all interior points in common| |</span>
<span id="cb35-637"><a href="#cb35-637" aria-hidden="true" tabindex="-1"></a>|<span class="in">`disjoint`</span>                    |A and B have no points in common| <span class="in">`intersects`</span>|</span>
<span id="cb35-638"><a href="#cb35-638" aria-hidden="true" tabindex="-1"></a>|<span class="in">`equals`</span>                      |A and B are topologically equal: node order or number of nodes may differ; identical to A contains B and A within B|</span>
<span id="cb35-639"><a href="#cb35-639" aria-hidden="true" tabindex="-1"></a>|<span class="in">`equals_exact`</span>                |A and B are geometrically equal, and have identical node order| |</span>
<span id="cb35-640"><a href="#cb35-640" aria-hidden="true" tabindex="-1"></a>|<span class="in">`intersects`</span>                  |A and B are not disjoint| <span class="in">`disjoint`</span>|</span>
<span id="cb35-641"><a href="#cb35-641" aria-hidden="true" tabindex="-1"></a>|<span class="in">`is_within_distance`</span>          |A is closer to B than a given distance|</span>
<span id="cb35-642"><a href="#cb35-642" aria-hidden="true" tabindex="-1"></a>|<span class="in">`within`</span>                      |None of the points of B are outside A| <span class="in">`contains`</span>|</span>
<span id="cb35-643"><a href="#cb35-643" aria-hidden="true" tabindex="-1"></a>|<span class="in">`touches`</span>                     |A and B have at least one boundary point in common, but no interior points|  |</span>
<span id="cb35-644"><a href="#cb35-644" aria-hidden="true" tabindex="-1"></a>|<span class="in">`overlaps`</span>                    |A and B have some points in common; the dimension of these is identical to that of A and B|  |</span>
<span id="cb35-645"><a href="#cb35-645" aria-hidden="true" tabindex="-1"></a>|<span class="in">`relate`</span>                      |Given a mask pattern, return whether A and B adhere to this pattern| |</span>
<span id="cb35-646"><a href="#cb35-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-647"><a href="#cb35-647" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>contains}</span>
<span id="cb35-648"><a href="#cb35-648" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>contains<span class="sc">\_</span>properly}</span>
<span id="cb35-649"><a href="#cb35-649" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>covers}</span>
<span id="cb35-650"><a href="#cb35-650" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>covered<span class="sc">\_</span>by}</span>
<span id="cb35-651"><a href="#cb35-651" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>crosses}</span>
<span id="cb35-652"><a href="#cb35-652" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>disjoint}</span>
<span id="cb35-653"><a href="#cb35-653" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>equals}</span>
<span id="cb35-654"><a href="#cb35-654" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>equals<span class="sc">\_</span>exact}</span>
<span id="cb35-655"><a href="#cb35-655" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>intersects}</span>
<span id="cb35-656"><a href="#cb35-656" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>is<span class="sc">\_</span>within<span class="sc">\_</span>distance}</span>
<span id="cb35-657"><a href="#cb35-657" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>within}</span>
<span id="cb35-658"><a href="#cb35-658" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>touches}</span>
<span id="cb35-659"><a href="#cb35-659" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>overlaps}</span>
<span id="cb35-660"><a href="#cb35-660" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>relate}</span>
<span id="cb35-661"><a href="#cb35-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-662"><a href="#cb35-662" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">Wikipedia DE-9IM page</span><span class="co">](https://en.wikipedia.org/wiki/DE-9IM)</span></span>
<span id="cb35-663"><a href="#cb35-663" aria-hidden="true" tabindex="-1"></a>provides the <span class="in">`relate`</span> patterns for each of these verbs. They are</span>
<span id="cb35-664"><a href="#cb35-664" aria-hidden="true" tabindex="-1"></a>important to check out; for instance _covers_ and _contains_ (and</span>
<span id="cb35-665"><a href="#cb35-665" aria-hidden="true" tabindex="-1"></a>their inverses) are often not completely intuitive:</span>
<span id="cb35-666"><a href="#cb35-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-667"><a href="#cb35-667" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>if A _contains_ B, B has no points in common with the exterior _or</span>
<span id="cb35-668"><a href="#cb35-668" aria-hidden="true" tabindex="-1"></a>boundary_ of A</span>
<span id="cb35-669"><a href="#cb35-669" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>if A _covers_ B, B has no points in common with the exterior of A</span>
<span id="cb35-670"><a href="#cb35-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-671"><a href="#cb35-671" aria-hidden="true" tabindex="-1"></a><span class="fu">### Unary measures</span></span>
<span id="cb35-672"><a href="#cb35-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-673"><a href="#cb35-673" aria-hidden="true" tabindex="-1"></a>\index{geometry!measures!unary}</span>
<span id="cb35-674"><a href="#cb35-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-675"><a href="#cb35-675" aria-hidden="true" tabindex="-1"></a>Unary measures return a measure or quantity that describes a property of</span>
<span id="cb35-676"><a href="#cb35-676" aria-hidden="true" tabindex="-1"></a>the geometry:</span>
<span id="cb35-677"><a href="#cb35-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-678"><a href="#cb35-678" aria-hidden="true" tabindex="-1"></a>|measure              |returns                                                       |</span>
<span id="cb35-679"><a href="#cb35-679" aria-hidden="true" tabindex="-1"></a>|---------------------|--------------------------------------------------------------|</span>
<span id="cb35-680"><a href="#cb35-680" aria-hidden="true" tabindex="-1"></a>|<span class="in">`dimension`</span>          |0 for points, 1 for linear, 2 for polygons, possibly <span class="in">`NA`</span> for empty geometries|</span>
<span id="cb35-681"><a href="#cb35-681" aria-hidden="true" tabindex="-1"></a>|<span class="in">`area`</span>               |the area of a geometry|</span>
<span id="cb35-682"><a href="#cb35-682" aria-hidden="true" tabindex="-1"></a>|<span class="in">`length`</span>             |the length of a linear geometry|</span>
<span id="cb35-683"><a href="#cb35-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-684"><a href="#cb35-684" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>dimension}</span>
<span id="cb35-685"><a href="#cb35-685" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>area}</span>
<span id="cb35-686"><a href="#cb35-686" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>length}</span>
<span id="cb35-687"><a href="#cb35-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-688"><a href="#cb35-688" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary measures</span></span>
<span id="cb35-689"><a href="#cb35-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-690"><a href="#cb35-690" aria-hidden="true" tabindex="-1"></a>\index{geometry!measures!binary}</span>
<span id="cb35-691"><a href="#cb35-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-692"><a href="#cb35-692" aria-hidden="true" tabindex="-1"></a><span class="in">`distance`</span> returns the distance between pairs of geometries.</span>
<span id="cb35-693"><a href="#cb35-693" aria-hidden="true" tabindex="-1"></a>The qualitative measure <span class="in">`relate`</span> (without mask) gives the relation</span>
<span id="cb35-694"><a href="#cb35-694" aria-hidden="true" tabindex="-1"></a>pattern. A description of the geometrical relationship between two</span>
<span id="cb35-695"><a href="#cb35-695" aria-hidden="true" tabindex="-1"></a>geometries is given in @sec-de9im.</span>
<span id="cb35-696"><a href="#cb35-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-697"><a href="#cb35-697" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>distance}</span>
<span id="cb35-698"><a href="#cb35-698" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>relate}</span>
<span id="cb35-699"><a href="#cb35-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-700"><a href="#cb35-700" aria-hidden="true" tabindex="-1"></a><span class="fu">### Unary transformers</span></span>
<span id="cb35-701"><a href="#cb35-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-702"><a href="#cb35-702" aria-hidden="true" tabindex="-1"></a>\index{geometry!transformers!unary}</span>
<span id="cb35-703"><a href="#cb35-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-704"><a href="#cb35-704" aria-hidden="true" tabindex="-1"></a>Unary transformations work on a per-geometry basis, and return for each geometry a new geometry.</span>
<span id="cb35-705"><a href="#cb35-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-706"><a href="#cb35-706" aria-hidden="true" tabindex="-1"></a>|transformer                  |returns a geometry ...                                                            |</span>
<span id="cb35-707"><a href="#cb35-707" aria-hidden="true" tabindex="-1"></a>|-----------------------------|----------------------------------------------------------------------------------|</span>
<span id="cb35-708"><a href="#cb35-708" aria-hidden="true" tabindex="-1"></a>|<span class="in">`centroid`</span>|of type <span class="in">`POINT`</span> with the geometry's centroid|</span>
<span id="cb35-709"><a href="#cb35-709" aria-hidden="true" tabindex="-1"></a>|<span class="in">`buffer`</span>|that is larger (or smaller) than the input geometry, depending on the buffer size|</span>
<span id="cb35-710"><a href="#cb35-710" aria-hidden="true" tabindex="-1"></a>|<span class="in">`jitter`</span> |that was moved in space a certain amount, using a bivariate uniform distribution|</span>
<span id="cb35-711"><a href="#cb35-711" aria-hidden="true" tabindex="-1"></a>|<span class="in">`wrap_dateline`</span>|cut into pieces that no longer cover or cross the dateline|</span>
<span id="cb35-712"><a href="#cb35-712" aria-hidden="true" tabindex="-1"></a>|<span class="in">`boundary`</span>|with the boundary of the input geometry|</span>
<span id="cb35-713"><a href="#cb35-713" aria-hidden="true" tabindex="-1"></a>|<span class="in">`convex_hull`</span>|that forms the convex hull of the input geometry (@fig-vor) |</span>
<span id="cb35-714"><a href="#cb35-714" aria-hidden="true" tabindex="-1"></a>|<span class="in">`line_merge`</span>|after merging connecting <span class="in">`LINESTRING`</span> elements of a <span class="in">`MULTILINESTRING`</span> into longer <span class="in">`LINESTRING`</span>s.|</span>
<span id="cb35-715"><a href="#cb35-715" aria-hidden="true" tabindex="-1"></a>|<span class="in">`make_valid`</span>|that is valid |</span>
<span id="cb35-716"><a href="#cb35-716" aria-hidden="true" tabindex="-1"></a>|<span class="in">`node`</span>|with added nodes to linear geometries at intersections without a node; only works on individual linear geometries|</span>
<span id="cb35-717"><a href="#cb35-717" aria-hidden="true" tabindex="-1"></a>|<span class="in">`point_on_surface`</span>|with a (arbitrary) point on a surface|</span>
<span id="cb35-718"><a href="#cb35-718" aria-hidden="true" tabindex="-1"></a>|<span class="in">`polygonize`</span>|of type polygon, created from lines that form a closed ring|</span>
<span id="cb35-719"><a href="#cb35-719" aria-hidden="true" tabindex="-1"></a>|<span class="in">`segmentize`</span>|a (linear) geometry with nodes at a given density or minimal distance|</span>
<span id="cb35-720"><a href="#cb35-720" aria-hidden="true" tabindex="-1"></a>|<span class="in">`simplify`</span>|simplified by removing vertices/nodes (lines or polygons)|</span>
<span id="cb35-721"><a href="#cb35-721" aria-hidden="true" tabindex="-1"></a>|<span class="in">`split`</span>|that has been split with a splitting linestring|</span>
<span id="cb35-722"><a href="#cb35-722" aria-hidden="true" tabindex="-1"></a>|<span class="in">`transform`</span>|transformed or convert to a new coordinate reference system (@sec-cs)|</span>
<span id="cb35-723"><a href="#cb35-723" aria-hidden="true" tabindex="-1"></a>|<span class="in">`triangulate`</span>|with Delauney triangulated polygon(s) (@fig-vor) |</span>
<span id="cb35-724"><a href="#cb35-724" aria-hidden="true" tabindex="-1"></a>|<span class="in">`voronoi`</span>|with the Voronoi tessellation of an input geometry (@fig-vor) |</span>
<span id="cb35-725"><a href="#cb35-725" aria-hidden="true" tabindex="-1"></a>|<span class="in">`zm`</span>|with removed or added <span class="in">`Z`</span> and/or <span class="in">`M`</span> coordinates|</span>
<span id="cb35-726"><a href="#cb35-726" aria-hidden="true" tabindex="-1"></a>|<span class="in">`collection_extract`</span>|with sub-geometries from a <span class="in">`GEOMETRYCOLLECTION`</span> of a particular type|</span>
<span id="cb35-727"><a href="#cb35-727" aria-hidden="true" tabindex="-1"></a>|<span class="in">`cast`</span>|that is converted to another type|</span>
<span id="cb35-728"><a href="#cb35-728" aria-hidden="true" tabindex="-1"></a>|<span class="in">`+`</span>|that is shifted over a given vector|</span>
<span id="cb35-729"><a href="#cb35-729" aria-hidden="true" tabindex="-1"></a>|<span class="in">`*`</span>|that is multiplied by a scalar or matrix|</span>
<span id="cb35-730"><a href="#cb35-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-731"><a href="#cb35-731" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-vor, echo = !knitr::is_latex_output()}</span></span>
<span id="cb35-732"><a href="#cb35-732" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "For a set of points, left: convex hull (red); middle: Voronoi polygons; right: Delauney triangulation"</span></span>
<span id="cb35-733"><a href="#cb35-733" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-734"><a href="#cb35-734" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 60%</span></span>
<span id="cb35-735"><a href="#cb35-735" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(0,4), mfrow = c(1, 3))</span></span>
<span id="cb35-736"><a href="#cb35-736" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(133331)</span></span>
<span id="cb35-737"><a href="#cb35-737" aria-hidden="true" tabindex="-1"></a><span class="in">mp &lt;- st_multipoint(matrix(runif(20), 10))</span></span>
<span id="cb35-738"><a href="#cb35-738" aria-hidden="true" tabindex="-1"></a><span class="in">plot(mp, cex = 2)</span></span>
<span id="cb35-739"><a href="#cb35-739" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_convex_hull(mp), add = TRUE, col = NA, border = 'red')</span></span>
<span id="cb35-740"><a href="#cb35-740" aria-hidden="true" tabindex="-1"></a><span class="in">box()</span></span>
<span id="cb35-741"><a href="#cb35-741" aria-hidden="true" tabindex="-1"></a><span class="in">plot(mp, cex = 2)</span></span>
<span id="cb35-742"><a href="#cb35-742" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_voronoi(mp), add = TRUE, col = NA, border = 'red')</span></span>
<span id="cb35-743"><a href="#cb35-743" aria-hidden="true" tabindex="-1"></a><span class="in">box()</span></span>
<span id="cb35-744"><a href="#cb35-744" aria-hidden="true" tabindex="-1"></a><span class="in">plot(mp, cex = 2)</span></span>
<span id="cb35-745"><a href="#cb35-745" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_triangulate(mp), add = TRUE, col = NA, border = 'darkgreen')</span></span>
<span id="cb35-746"><a href="#cb35-746" aria-hidden="true" tabindex="-1"></a><span class="in">box()</span></span>
<span id="cb35-747"><a href="#cb35-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-748"><a href="#cb35-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-749"><a href="#cb35-749" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>centroid}</span>
<span id="cb35-750"><a href="#cb35-750" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>buffer}</span>
<span id="cb35-751"><a href="#cb35-751" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>jitter}</span>
<span id="cb35-752"><a href="#cb35-752" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>wrap<span class="sc">\_</span>dateline}</span>
<span id="cb35-753"><a href="#cb35-753" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>boundary}</span>
<span id="cb35-754"><a href="#cb35-754" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>convex<span class="sc">\_</span>hull}</span>
<span id="cb35-755"><a href="#cb35-755" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>line<span class="sc">\_</span>merge}</span>
<span id="cb35-756"><a href="#cb35-756" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>make<span class="sc">\_</span>valid}</span>
<span id="cb35-757"><a href="#cb35-757" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>node}</span>
<span id="cb35-758"><a href="#cb35-758" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>point<span class="sc">\_</span>on<span class="sc">\_</span>surface}</span>
<span id="cb35-759"><a href="#cb35-759" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>polygonize}</span>
<span id="cb35-760"><a href="#cb35-760" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>segmentize}</span>
<span id="cb35-761"><a href="#cb35-761" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>simplify}</span>
<span id="cb35-762"><a href="#cb35-762" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>split}</span>
<span id="cb35-763"><a href="#cb35-763" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>transform}</span>
<span id="cb35-764"><a href="#cb35-764" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>triangulate}</span>
<span id="cb35-765"><a href="#cb35-765" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>voronoi}</span>
<span id="cb35-766"><a href="#cb35-766" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>zm}</span>
<span id="cb35-767"><a href="#cb35-767" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>collection<span class="sc">\_</span>extract}</span>
<span id="cb35-768"><a href="#cb35-768" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>cast}</span>
<span id="cb35-769"><a href="#cb35-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-770"><a href="#cb35-770" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary transformers {#sec-bintrans}</span></span>
<span id="cb35-771"><a href="#cb35-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-772"><a href="#cb35-772" aria-hidden="true" tabindex="-1"></a>\index{geometry!transformers!binary}</span>
<span id="cb35-773"><a href="#cb35-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-774"><a href="#cb35-774" aria-hidden="true" tabindex="-1"></a>Binary transformers are functions that return a geometry based on</span>
<span id="cb35-775"><a href="#cb35-775" aria-hidden="true" tabindex="-1"></a>operating on a pair of geometries.  They include:</span>
<span id="cb35-776"><a href="#cb35-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-777"><a href="#cb35-777" aria-hidden="true" tabindex="-1"></a>|function           |returns                                                    |infix operator|</span>
<span id="cb35-778"><a href="#cb35-778" aria-hidden="true" tabindex="-1"></a>|-------------------|-----------------------------------------------------------|:------------:|</span>
<span id="cb35-779"><a href="#cb35-779" aria-hidden="true" tabindex="-1"></a>|<span class="in">`intersection`</span>     |the overlapping geometries for pair of geometries          |<span class="in">`&amp;`</span>|</span>
<span id="cb35-780"><a href="#cb35-780" aria-hidden="true" tabindex="-1"></a>|<span class="in">`union`</span>            |the combination of the geometries; removes internal boundaries and duplicate points, nodes or line pieces|<span class="in">`|`</span>|</span>
<span id="cb35-781"><a href="#cb35-781" aria-hidden="true" tabindex="-1"></a>|<span class="in">`difference`</span>       |the geometries of the first after removing the overlap with the second geometry|<span class="in">`/`</span>|</span>
<span id="cb35-782"><a href="#cb35-782" aria-hidden="true" tabindex="-1"></a>|<span class="in">`sym_difference`</span>   |the combinations of the geometries after removing where they intersect; the negation (opposite) of <span class="in">`intersection`</span>|<span class="in">`%/%`</span>|</span>
<span id="cb35-783"><a href="#cb35-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-784"><a href="#cb35-784" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>intersection}</span>
<span id="cb35-785"><a href="#cb35-785" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>union}</span>
<span id="cb35-786"><a href="#cb35-786" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>difference}</span>
<span id="cb35-787"><a href="#cb35-787" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>sym<span class="sc">\_</span>difference}</span>
<span id="cb35-788"><a href="#cb35-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-789"><a href="#cb35-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### N-ary transformers {#sec-nary}</span></span>
<span id="cb35-790"><a href="#cb35-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-791"><a href="#cb35-791" aria-hidden="true" tabindex="-1"></a>\index{geometry!transformers!n-ary}</span>
<span id="cb35-792"><a href="#cb35-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-793"><a href="#cb35-793" aria-hidden="true" tabindex="-1"></a>N-ary transformers operate on sets of geometries.</span>
<span id="cb35-794"><a href="#cb35-794" aria-hidden="true" tabindex="-1"></a><span class="in">`union`</span> can be applied to a set of geometries to return its</span>
<span id="cb35-795"><a href="#cb35-795" aria-hidden="true" tabindex="-1"></a>geometrical union.  Otherwise, any set of geometries can be combined</span>
<span id="cb35-796"><a href="#cb35-796" aria-hidden="true" tabindex="-1"></a>into a <span class="in">`MULTI`</span>-type geometry when they have equal dimension, or</span>
<span id="cb35-797"><a href="#cb35-797" aria-hidden="true" tabindex="-1"></a>else into a <span class="in">`GEOMETRYCOLLECTION`</span>. Without unioning, this may</span>
<span id="cb35-798"><a href="#cb35-798" aria-hidden="true" tabindex="-1"></a>lead to a geometry that is not valid, for instance when two polygon</span>
<span id="cb35-799"><a href="#cb35-799" aria-hidden="true" tabindex="-1"></a>rings have a boundary line in common.</span>
<span id="cb35-800"><a href="#cb35-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-801"><a href="#cb35-801" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>union!n-ary}</span>
<span id="cb35-802"><a href="#cb35-802" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>intersection!n-ary}</span>
<span id="cb35-803"><a href="#cb35-803" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>difference!n-ary}</span>
<span id="cb35-804"><a href="#cb35-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-805"><a href="#cb35-805" aria-hidden="true" tabindex="-1"></a>N-ary <span class="in">`intersection`</span> and <span class="in">`difference`</span> take a single argument</span>
<span id="cb35-806"><a href="#cb35-806" aria-hidden="true" tabindex="-1"></a>but operate (sequentially) on all pairs, triples, quadruples, etc.</span>
<span id="cb35-807"><a href="#cb35-807" aria-hidden="true" tabindex="-1"></a>Consider the plot in @fig-boxes: how do we identify</span>
<span id="cb35-808"><a href="#cb35-808" aria-hidden="true" tabindex="-1"></a>the area where all three boxes overlap?  Using binary intersections</span>
<span id="cb35-809"><a href="#cb35-809" aria-hidden="true" tabindex="-1"></a>gives us intersections for all pairs: 1-1, 1-2, 1-3, 2-1, 2-2, 2-3,</span>
<span id="cb35-810"><a href="#cb35-810" aria-hidden="true" tabindex="-1"></a>3-1, 3-2, 3-3, but that does not let us identify areas where more than</span>
<span id="cb35-811"><a href="#cb35-811" aria-hidden="true" tabindex="-1"></a>two geometries intersect.</span>
<span id="cb35-812"><a href="#cb35-812" aria-hidden="true" tabindex="-1"></a>@fig-boxes (right) shows the n-ary intersection: the seven</span>
<span id="cb35-813"><a href="#cb35-813" aria-hidden="true" tabindex="-1"></a>unique, non-overlapping geometries originating from intersection</span>
<span id="cb35-814"><a href="#cb35-814" aria-hidden="true" tabindex="-1"></a>of one, two, _or more_ geometries.</span>
<span id="cb35-815"><a href="#cb35-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-816"><a href="#cb35-816" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-boxes, eval=TRUE, echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-817"><a href="#cb35-817" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-818"><a href="#cb35-818" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 50%</span></span>
<span id="cb35-819"><a href="#cb35-819" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Left: three overlapping squares -- how do we identify the small box where all three overlap? Right: unique, non-overlapping n-ary intersections"</span></span>
<span id="cb35-820"><a href="#cb35-820" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(.1, 4), mfrow = c(1, 2))</span></span>
<span id="cb35-821"><a href="#cb35-821" aria-hidden="true" tabindex="-1"></a><span class="in">sq &lt;- function(pt, sz = 1) st_polygon(list(rbind(c(pt - sz), </span></span>
<span id="cb35-822"><a href="#cb35-822" aria-hidden="true" tabindex="-1"></a><span class="in">  c(pt[1] + sz, pt[2] - sz), c(pt + sz), c(pt[1] - sz, pt[2] + sz), c(pt - sz))))</span></span>
<span id="cb35-823"><a href="#cb35-823" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- st_sf(box = 1:3, st_sfc(sq(c(0, 0)), sq(c(1.7, -0.5)), sq(c(0.5, 1))))</span></span>
<span id="cb35-824"><a href="#cb35-824" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_geometry(x), col = NA, border = sf.colors(3, categorical = TRUE), lwd = 3)</span></span>
<span id="cb35-825"><a href="#cb35-825" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_intersection(st_geometry(x)), col = sf.colors(7, categorical=TRUE, alpha = .5))</span></span>
<span id="cb35-826"><a href="#cb35-826" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-827"><a href="#cb35-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-828"><a href="#cb35-828" aria-hidden="true" tabindex="-1"></a>Similarly, one can compute an n-ary _difference_ from a set $<span class="sc">\{</span>s_1, s_2,</span>
<span id="cb35-829"><a href="#cb35-829" aria-hidden="true" tabindex="-1"></a>s_3, ...<span class="sc">\}</span>$ by creating differences $<span class="sc">\{</span>s_1, s_2-s_1, s_3-s_2-s_1,</span>
<span id="cb35-830"><a href="#cb35-830" aria-hidden="true" tabindex="-1"></a>...<span class="sc">\}</span>$. This is shown in @fig-diff, (left) for the original</span>
<span id="cb35-831"><a href="#cb35-831" aria-hidden="true" tabindex="-1"></a>set, and (right) for the set after reversing its order to make clear that</span>
<span id="cb35-832"><a href="#cb35-832" aria-hidden="true" tabindex="-1"></a>the result here depends on the ordering of the input geometries. Again,</span>
<span id="cb35-833"><a href="#cb35-833" aria-hidden="true" tabindex="-1"></a>resulting geometries do not overlap.</span>
<span id="cb35-834"><a href="#cb35-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-835"><a href="#cb35-835" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-diff, echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-836"><a href="#cb35-836" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-837"><a href="#cb35-837" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 50%</span></span>
<span id="cb35-838"><a href="#cb35-838" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Difference between subsequent boxes, left: in original order; right: in reverse order"</span></span>
<span id="cb35-839"><a href="#cb35-839" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(.1, 4), mfrow = c(1, 2)) </span></span>
<span id="cb35-840"><a href="#cb35-840" aria-hidden="true" tabindex="-1"></a><span class="in">xg &lt;- st_geometry(x)</span></span>
<span id="cb35-841"><a href="#cb35-841" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_difference(xg), col = sf.colors(3, alpha = .5, categorical=TRUE))</span></span>
<span id="cb35-842"><a href="#cb35-842" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_difference(xg[3:1]), col = sf.colors(3, alpha = .5, categorical=TRUE))</span></span>
<span id="cb35-843"><a href="#cb35-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-844"><a href="#cb35-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-845"><a href="#cb35-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## Precision {#sec-precision}</span></span>
<span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a>\index{precisions}</span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a>\index{coordinates!precisions}</span>
<span id="cb35-849"><a href="#cb35-849" aria-hidden="true" tabindex="-1"></a>\index<span class="co">[</span><span class="ot">function</span><span class="co">]</span>{st<span class="sc">\_</span>precision}</span>
<span id="cb35-850"><a href="#cb35-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-851"><a href="#cb35-851" aria-hidden="true" tabindex="-1"></a>Geometrical operations, such as finding out whether a certain</span>
<span id="cb35-852"><a href="#cb35-852" aria-hidden="true" tabindex="-1"></a>point is on a line, may fail when coordinates are represented by</span>
<span id="cb35-853"><a href="#cb35-853" aria-hidden="true" tabindex="-1"></a>double precision floating point numbers, such as 8-byte doubles</span>
<span id="cb35-854"><a href="#cb35-854" aria-hidden="true" tabindex="-1"></a>used in R. An often chosen remedy is to limit the precision of the</span>
<span id="cb35-855"><a href="#cb35-855" aria-hidden="true" tabindex="-1"></a>coordinates before the operation.  For this, a _precision model_</span>
<span id="cb35-856"><a href="#cb35-856" aria-hidden="true" tabindex="-1"></a>is adopted; the most common is to choose a factor $p$ and compute</span>
<span id="cb35-857"><a href="#cb35-857" aria-hidden="true" tabindex="-1"></a>rounded coordinates $c'$ from original coordinates $c$ by</span>
<span id="cb35-858"><a href="#cb35-858" aria-hidden="true" tabindex="-1"></a>$$c' = \mbox{round}(p \cdot c) / p$$</span>
<span id="cb35-859"><a href="#cb35-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-860"><a href="#cb35-860" aria-hidden="true" tabindex="-1"></a>Rounding of this kind brings the coordinates to points on a</span>
<span id="cb35-861"><a href="#cb35-861" aria-hidden="true" tabindex="-1"></a>regular grid with spacing $1/p$, which is beneficial for geometric</span>
<span id="cb35-862"><a href="#cb35-862" aria-hidden="true" tabindex="-1"></a>computations. Of course, it also affects all computations like</span>
<span id="cb35-863"><a href="#cb35-863" aria-hidden="true" tabindex="-1"></a>areas and distances, and may turn valid geometries into invalid</span>
<span id="cb35-864"><a href="#cb35-864" aria-hidden="true" tabindex="-1"></a>ones. Which precision values are best for which application is</span>
<span id="cb35-865"><a href="#cb35-865" aria-hidden="true" tabindex="-1"></a>often a matter of common sense combined with trial and error. </span>
<span id="cb35-866"><a href="#cb35-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-867"><a href="#cb35-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coverages: tessellations and rasters {#sec-coverages}</span></span>
<span id="cb35-868"><a href="#cb35-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-869"><a href="#cb35-869" aria-hidden="true" tabindex="-1"></a>\index{coverage}</span>
<span id="cb35-870"><a href="#cb35-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-871"><a href="#cb35-871" aria-hidden="true" tabindex="-1"></a>The Open Geospatial Consortium defines a _coverage_ as a "feature</span>
<span id="cb35-872"><a href="#cb35-872" aria-hidden="true" tabindex="-1"></a>that acts as a function to return values from its range for any</span>
<span id="cb35-873"><a href="#cb35-873" aria-hidden="true" tabindex="-1"></a>direct position within its spatiotemporal domain" <span class="co">[</span><span class="ot">@ogccov</span><span class="co">]</span>. Having</span>
<span id="cb35-874"><a href="#cb35-874" aria-hidden="true" tabindex="-1"></a>a _function_ implies that for every space time "point", every combination</span>
<span id="cb35-875"><a href="#cb35-875" aria-hidden="true" tabindex="-1"></a>of a spatial point and a moment in time of the spatiotemporal domain,</span>
<span id="cb35-876"><a href="#cb35-876" aria-hidden="true" tabindex="-1"></a>we have a _single_ value for the range. This is a very common situation</span>
<span id="cb35-877"><a href="#cb35-877" aria-hidden="true" tabindex="-1"></a>for spatiotemporal phenomena, a few examples can be given:</span>
<span id="cb35-878"><a href="#cb35-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-879"><a href="#cb35-879" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>boundary disputes aside, at a give time every point in a region (domain) belongs to a single administrative unit (range)</span>
<span id="cb35-880"><a href="#cb35-880" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>at any given moment in time, every point in a region (domain) has a certain _land cover type_ (range)</span>
<span id="cb35-881"><a href="#cb35-881" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>every point in an area (domain) has a single surface elevation (range), which could be measured with respect to a given mean sea level surface</span>
<span id="cb35-882"><a href="#cb35-882" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>every spatiotemporal point in a three-dimensional body of air (domain) has single value for temperature (range)</span>
<span id="cb35-883"><a href="#cb35-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-884"><a href="#cb35-884" aria-hidden="true" tabindex="-1"></a>A caveat here is that because observation or measurement always takes</span>
<span id="cb35-885"><a href="#cb35-885" aria-hidden="true" tabindex="-1"></a>time and requires space, measured values are always an average over</span>
<span id="cb35-886"><a href="#cb35-886" aria-hidden="true" tabindex="-1"></a>a spatiotemporal volume, and hence range variables can rarely be</span>
<span id="cb35-887"><a href="#cb35-887" aria-hidden="true" tabindex="-1"></a>measured for true, zero-volume "points"; for many practical cases</span>
<span id="cb35-888"><a href="#cb35-888" aria-hidden="true" tabindex="-1"></a>however the measured volume is small enough to be considered a</span>
<span id="cb35-889"><a href="#cb35-889" aria-hidden="true" tabindex="-1"></a>"point". For a variable like _land cover type_ the volume needs to</span>
<span id="cb35-890"><a href="#cb35-890" aria-hidden="true" tabindex="-1"></a>be chosen such that the types distinguished make sense with respect</span>
<span id="cb35-891"><a href="#cb35-891" aria-hidden="true" tabindex="-1"></a>to the measured areal units.</span>
<span id="cb35-892"><a href="#cb35-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-893"><a href="#cb35-893" aria-hidden="true" tabindex="-1"></a>In the first two of the given examples the range variable is</span>
<span id="cb35-894"><a href="#cb35-894" aria-hidden="true" tabindex="-1"></a>_categorical_, in the last two the range variable is _continuous_.</span>
<span id="cb35-895"><a href="#cb35-895" aria-hidden="true" tabindex="-1"></a>For categorical range variables, if large connected areas have a</span>
<span id="cb35-896"><a href="#cb35-896" aria-hidden="true" tabindex="-1"></a>constant range value, an efficient way to represent these data</span>
<span id="cb35-897"><a href="#cb35-897" aria-hidden="true" tabindex="-1"></a>is by storing the boundaries of the areas with constant value, such</span>
<span id="cb35-898"><a href="#cb35-898" aria-hidden="true" tabindex="-1"></a>as country boundaries. Although this can be done (and is often done)</span>
<span id="cb35-899"><a href="#cb35-899" aria-hidden="true" tabindex="-1"></a>by a set of simple feature geometries (polygons or multi-polygons),</span>
<span id="cb35-900"><a href="#cb35-900" aria-hidden="true" tabindex="-1"></a>this brings along some challenges:</span>
<span id="cb35-901"><a href="#cb35-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-902"><a href="#cb35-902" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>it is hard to guarantee for such a set of simple feature polygons that they do not overlap, or that there are no unwanted gaps between them</span>
<span id="cb35-903"><a href="#cb35-903" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>simple features have no way of assigning points _on_ the boundary of two adjacent polygons uniquely to a single polygon, which conflicts with the interpretation as coverage</span>
<span id="cb35-904"><a href="#cb35-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-905"><a href="#cb35-905" aria-hidden="true" tabindex="-1"></a><span class="fu">### Topological models</span></span>
<span id="cb35-906"><a href="#cb35-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-907"><a href="#cb35-907" aria-hidden="true" tabindex="-1"></a>\index{topology}</span>
<span id="cb35-908"><a href="#cb35-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-909"><a href="#cb35-909" aria-hidden="true" tabindex="-1"></a>A data model that guarantees no inadvertent gaps or overlaps of</span>
<span id="cb35-910"><a href="#cb35-910" aria-hidden="true" tabindex="-1"></a>polygonal coverages is the _topological_ model, examples of which</span>
<span id="cb35-911"><a href="#cb35-911" aria-hidden="true" tabindex="-1"></a>are found in geographic information systems (GIS) like GRASS GIS</span>
<span id="cb35-912"><a href="#cb35-912" aria-hidden="true" tabindex="-1"></a>or ArcGIS. Topological models store boundaries between polygons</span>
<span id="cb35-913"><a href="#cb35-913" aria-hidden="true" tabindex="-1"></a>only once and register which polygonal area is on either side</span>
<span id="cb35-914"><a href="#cb35-914" aria-hidden="true" tabindex="-1"></a>of a boundary. </span>
<span id="cb35-915"><a href="#cb35-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-916"><a href="#cb35-916" aria-hidden="true" tabindex="-1"></a>Deriving the set of (multi)polygons for each area with a constant</span>
<span id="cb35-917"><a href="#cb35-917" aria-hidden="true" tabindex="-1"></a>range value from a topological model is straightforward; the other</span>
<span id="cb35-918"><a href="#cb35-918" aria-hidden="true" tabindex="-1"></a>way around, reconstructing topology from a set of polygons typically</span>
<span id="cb35-919"><a href="#cb35-919" aria-hidden="true" tabindex="-1"></a>involves setting thresholds on errors and handling gaps or overlaps.</span>
<span id="cb35-920"><a href="#cb35-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-921"><a href="#cb35-921" aria-hidden="true" tabindex="-1"></a><span class="fu">### Raster tessellations</span></span>
<span id="cb35-922"><a href="#cb35-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-923"><a href="#cb35-923" aria-hidden="true" tabindex="-1"></a>\index{tesselation}</span>
<span id="cb35-924"><a href="#cb35-924" aria-hidden="true" tabindex="-1"></a>\index{coverage!tesselation}</span>
<span id="cb35-925"><a href="#cb35-925" aria-hidden="true" tabindex="-1"></a>\index{polygon!tesselation}</span>
<span id="cb35-926"><a href="#cb35-926" aria-hidden="true" tabindex="-1"></a>\index{raster!tesselation}</span>
<span id="cb35-927"><a href="#cb35-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-928"><a href="#cb35-928" aria-hidden="true" tabindex="-1"></a>A tessellation is a sub-division of a space (area, volume) into</span>
<span id="cb35-929"><a href="#cb35-929" aria-hidden="true" tabindex="-1"></a>smaller elements by ways of polygons. A regular tessellation</span>
<span id="cb35-930"><a href="#cb35-930" aria-hidden="true" tabindex="-1"></a>does this with regular polygons: triangles, squares, or hexagons.</span>
<span id="cb35-931"><a href="#cb35-931" aria-hidden="true" tabindex="-1"></a>Tessellations using squares are commonly used for spatial data</span>
<span id="cb35-932"><a href="#cb35-932" aria-hidden="true" tabindex="-1"></a>and are called _raster data_. Raster data</span>
<span id="cb35-933"><a href="#cb35-933" aria-hidden="true" tabindex="-1"></a>tessellate each spatial dimension $d$ into regular cells,</span>
<span id="cb35-934"><a href="#cb35-934" aria-hidden="true" tabindex="-1"></a>formed by left-closed and right-open intervals $d_i$:</span>
<span id="cb35-935"><a href="#cb35-935" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb35-936"><a href="#cb35-936" aria-hidden="true" tabindex="-1"></a>d_i = d_0 + [i \times \delta, (i+1) \times \delta)</span>
<span id="cb35-937"><a href="#cb35-937" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb35-938"><a href="#cb35-938" aria-hidden="true" tabindex="-1"></a>with $d_0$ an offset, $\delta$ the interval (cell or</span>
<span id="cb35-939"><a href="#cb35-939" aria-hidden="true" tabindex="-1"></a>pixel) size, and where the cell index $i$ is an arbitrary but</span>
<span id="cb35-940"><a href="#cb35-940" aria-hidden="true" tabindex="-1"></a>consecutive set of integers. The $\delta$ value is often taken</span>
<span id="cb35-941"><a href="#cb35-941" aria-hidden="true" tabindex="-1"></a>negative for the $y$-axis (Northing), indicating that raster</span>
<span id="cb35-942"><a href="#cb35-942" aria-hidden="true" tabindex="-1"></a>row numbers increasing Southwards correspond to $y$-coordinates</span>
<span id="cb35-943"><a href="#cb35-943" aria-hidden="true" tabindex="-1"></a>increasing Northwards.</span>
<span id="cb35-944"><a href="#cb35-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-945"><a href="#cb35-945" aria-hidden="true" tabindex="-1"></a>Whereas in arbitrary polygon tessellations the assignment of points</span>
<span id="cb35-946"><a href="#cb35-946" aria-hidden="true" tabindex="-1"></a>to polygons is ambiguous for points falling on a boundary shared</span>
<span id="cb35-947"><a href="#cb35-947" aria-hidden="true" tabindex="-1"></a>by two polygons, using left-closed "[" and right-open ")" intervals</span>
<span id="cb35-948"><a href="#cb35-948" aria-hidden="true" tabindex="-1"></a>in regular tessellations removes this ambiguity. This means that for</span>
<span id="cb35-949"><a href="#cb35-949" aria-hidden="true" tabindex="-1"></a>rasters with negative $\delta$ values for the $y$-coordinate and</span>
<span id="cb35-950"><a href="#cb35-950" aria-hidden="true" tabindex="-1"></a>positive for the $x$-coordinate, only the top-left corner point</span>
<span id="cb35-951"><a href="#cb35-951" aria-hidden="true" tabindex="-1"></a>is part of each raster cell. An artifact resulting from this is</span>
<span id="cb35-952"><a href="#cb35-952" aria-hidden="true" tabindex="-1"></a>shown in @fig-rasterizeline.</span>
<span id="cb35-953"><a href="#cb35-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-954"><a href="#cb35-954" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-rasterizeline, echo=!knitr::is_latex_output()}</span></span>
<span id="cb35-955"><a href="#cb35-955" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: 50%</span></span>
<span id="cb35-956"><a href="#cb35-956" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Rasterization artifact: as only top-left corners are part of the raster cell, only cells touching the red line below the diagonal line are rasterized"</span></span>
<span id="cb35-957"><a href="#cb35-957" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb35-958"><a href="#cb35-958" aria-hidden="true" tabindex="-1"></a><span class="in">library(stars) |&gt; suppressPackageStartupMessages()</span></span>
<span id="cb35-959"><a href="#cb35-959" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = rep(1, 4))</span></span>
<span id="cb35-960"><a href="#cb35-960" aria-hidden="true" tabindex="-1"></a><span class="in">ls &lt;- st_sf(a = 2, st_sfc(st_linestring(rbind(c(0.1, 0), c(1, .9)))))</span></span>
<span id="cb35-961"><a href="#cb35-961" aria-hidden="true" tabindex="-1"></a><span class="in">grd &lt;- st_as_stars(st_bbox(ls), nx = 10, ny = 10, xlim = c(0, 1.0), ylim = c(0, 1),</span></span>
<span id="cb35-962"><a href="#cb35-962" aria-hidden="true" tabindex="-1"></a><span class="in">   values = -1)</span></span>
<span id="cb35-963"><a href="#cb35-963" aria-hidden="true" tabindex="-1"></a><span class="in">r &lt;- st_rasterize(ls, grd, options = "ALL_TOUCHED=TRUE")</span></span>
<span id="cb35-964"><a href="#cb35-964" aria-hidden="true" tabindex="-1"></a><span class="in">r[r == -1] &lt;- NA</span></span>
<span id="cb35-965"><a href="#cb35-965" aria-hidden="true" tabindex="-1"></a><span class="in">plot(st_geometry(st_as_sf(grd)), border = 'orange', col = NA, </span></span>
<span id="cb35-966"><a href="#cb35-966" aria-hidden="true" tabindex="-1"></a><span class="in">     reset = FALSE, key.pos = NULL)</span></span>
<span id="cb35-967"><a href="#cb35-967" aria-hidden="true" tabindex="-1"></a><span class="in">plot(r, axes = FALSE, add = TRUE, breaks = "equal", main = NA) # ALL_TOUCHED=FALSE;</span></span>
<span id="cb35-968"><a href="#cb35-968" aria-hidden="true" tabindex="-1"></a><span class="in">plot(ls, add = TRUE, col = "red", lwd = 2)</span></span>
<span id="cb35-969"><a href="#cb35-969" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb35-970"><a href="#cb35-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-971"><a href="#cb35-971" aria-hidden="true" tabindex="-1"></a>\index{tesselation!time}</span>
<span id="cb35-972"><a href="#cb35-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-973"><a href="#cb35-973" aria-hidden="true" tabindex="-1"></a>Tessellating the time dimension with left-closed right-open intervals</span>
<span id="cb35-974"><a href="#cb35-974" aria-hidden="true" tabindex="-1"></a>is very common, and it reflects the implicit assumption underlying</span>
<span id="cb35-975"><a href="#cb35-975" aria-hidden="true" tabindex="-1"></a>time series software such as the **xts** package in R, where time</span>
<span id="cb35-976"><a href="#cb35-976" aria-hidden="true" tabindex="-1"></a>stamps indicate the start of time intervals.  Different models can</span>
<span id="cb35-977"><a href="#cb35-977" aria-hidden="true" tabindex="-1"></a>be combined: one could use simple feature polygons to tessellate</span>
<span id="cb35-978"><a href="#cb35-978" aria-hidden="true" tabindex="-1"></a>space and combine this with a regular tessellation of time in order</span>
<span id="cb35-979"><a href="#cb35-979" aria-hidden="true" tabindex="-1"></a>to cover a space time _vector data cube_.  Raster and vector data</span>
<span id="cb35-980"><a href="#cb35-980" aria-hidden="true" tabindex="-1"></a>cubes are discussed in @sec-datacube.</span>
<span id="cb35-981"><a href="#cb35-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-982"><a href="#cb35-982" aria-hidden="true" tabindex="-1"></a>As mentioned above, besides square cells the other two shapes</span>
<span id="cb35-983"><a href="#cb35-983" aria-hidden="true" tabindex="-1"></a>that can lead to regular tessellations of $R^2$ are triangles</span>
<span id="cb35-984"><a href="#cb35-984" aria-hidden="true" tabindex="-1"></a>and hexagons. On the sphere, there are a few more, including cube,</span>
<span id="cb35-985"><a href="#cb35-985" aria-hidden="true" tabindex="-1"></a>octahedron, icosahedron, and dodecahedron. A spatial index that</span>
<span id="cb35-986"><a href="#cb35-986" aria-hidden="true" tabindex="-1"></a>builds on the cube is <span class="co">[</span><span class="ot">s2geometry</span><span class="co">](https://s2geometry.io/)</span>, the</span>
<span id="cb35-987"><a href="#cb35-987" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">H3 library</span><span class="co">](https://eng.uber.com/h3/)</span> uses the icosahedron and</span>
<span id="cb35-988"><a href="#cb35-988" aria-hidden="true" tabindex="-1"></a>densifies that with (mostly) hexagons. Mosaics that cover the entire</span>
<span id="cb35-989"><a href="#cb35-989" aria-hidden="true" tabindex="-1"></a>Earth are also called _discrete global grids_.</span>
<span id="cb35-990"><a href="#cb35-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-991"><a href="#cb35-991" aria-hidden="true" tabindex="-1"></a><span class="fu">## Networks</span></span>
<span id="cb35-992"><a href="#cb35-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-993"><a href="#cb35-993" aria-hidden="true" tabindex="-1"></a>\index{networks}</span>
<span id="cb35-994"><a href="#cb35-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-995"><a href="#cb35-995" aria-hidden="true" tabindex="-1"></a>Spatial networks are typically composed of linear (<span class="in">`LINESTRING`</span>)</span>
<span id="cb35-996"><a href="#cb35-996" aria-hidden="true" tabindex="-1"></a>elements, but possess further topological properties describing</span>
<span id="cb35-997"><a href="#cb35-997" aria-hidden="true" tabindex="-1"></a>the network coherence:</span>
<span id="cb35-998"><a href="#cb35-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-999"><a href="#cb35-999" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>start- and end-points of a linestring may be connected to other linestring</span>
<span id="cb35-1000"><a href="#cb35-1000" aria-hidden="true" tabindex="-1"></a>start or end points, forming a set of nodes and edges</span>
<span id="cb35-1001"><a href="#cb35-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>edges may be directed, to only allow for connection (flow,</span>
<span id="cb35-1002"><a href="#cb35-1002" aria-hidden="true" tabindex="-1"></a>transport) in one way</span>
<span id="cb35-1003"><a href="#cb35-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1004"><a href="#cb35-1004" aria-hidden="true" tabindex="-1"></a>R packages including **osmar** [@R-osmar], **stplanr** <span class="co">[</span><span class="ot">@R-stplanr</span><span class="co">]</span>, and</span>
<span id="cb35-1005"><a href="#cb35-1005" aria-hidden="true" tabindex="-1"></a>**sfnetworks** <span class="co">[</span><span class="ot">@R-sfnetworks</span><span class="co">]</span> provide functionality for constructing</span>
<span id="cb35-1006"><a href="#cb35-1006" aria-hidden="true" tabindex="-1"></a>network objects, and working with them, including computation of shortest or</span>
<span id="cb35-1007"><a href="#cb35-1007" aria-hidden="true" tabindex="-1"></a>fastest routes through a network. Package **spatstat** [@R-spatstat;</span>
<span id="cb35-1008"><a href="#cb35-1008" aria-hidden="true" tabindex="-1"></a>@baddeley2015spatial] has infrastructure for analysing point</span>
<span id="cb35-1009"><a href="#cb35-1009" aria-hidden="true" tabindex="-1"></a>patterns on linear networks (@sec-pointpatterns). Chapter 12 of</span>
<span id="cb35-1010"><a href="#cb35-1010" aria-hidden="true" tabindex="-1"></a>@geocomp has a transportation application using networks.</span>
<span id="cb35-1011"><a href="#cb35-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1012"><a href="#cb35-1012" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises </span></span>
<span id="cb35-1013"><a href="#cb35-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1014"><a href="#cb35-1014" aria-hidden="true" tabindex="-1"></a>For the following exercises, use R where possible.</span>
<span id="cb35-1015"><a href="#cb35-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-1016"><a href="#cb35-1016" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Give two examples of geometries in 2-D (flat) space that cannot be represented as simple feature geometries, and create a plot of them.</span>
<span id="cb35-1017"><a href="#cb35-1017" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Recompute the coordinates 10.542, 0.01, 45321.6789 using precision values 1, 1e3, 1e6, and 1e-2.</span>
<span id="cb35-1018"><a href="#cb35-1018" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Describe a practical problem for which an n-ary intersection would be needed. </span>
<span id="cb35-1019"><a href="#cb35-1019" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>How can you create a Voronoi diagram (@fig-vor)  that has one closed polygons for every single point?</span>
<span id="cb35-1020"><a href="#cb35-1020" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Give the unary measure <span class="in">`dimension`</span> for geometries <span class="in">`POINT Z (0 1 1)`</span>, <span class="in">`LINESTRING Z (0 0 1,1 1 2)`</span>, and <span class="in">`POLYGON Z ((0 0 0,1 0 0,1 1 0,0 0 0))`</span></span>
<span id="cb35-1021"><a href="#cb35-1021" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Give the DE-9IM relation between <span class="in">`LINESTRING(0 0,1 0)`</span> and <span class="in">`LINESTRING(0.5 0,0.5 1)`</span>; explain the individual characters.</span>
<span id="cb35-1022"><a href="#cb35-1022" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Can a set of simple feature polygons form a coverage? If so, under which constraints?</span>
<span id="cb35-1023"><a href="#cb35-1023" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>For the <span class="in">`nc`</span> counties in the dataset that comes with R package **sf**, find the points touched by four counties.</span>
<span id="cb35-1024"><a href="#cb35-1024" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>How would @fig-rasterizeline  look like if $\delta$ for the $y$-coordinate was positive?</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/sdsr/edit/python/03-Geometries.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>